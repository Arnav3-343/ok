<html>
<head>
<title>test_atomics.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #2aacb8;}
.s4 { color: #6aab73;}
.s5 { color: #7a7e85;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_atomics.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">from </span><span class="s1">textwrap </span><span class="s0">import </span><span class="s1">dedent</span>

<span class="s0">from </span><span class="s1">numba </span><span class="s0">import </span><span class="s1">cuda</span><span class="s2">, </span><span class="s1">uint32</span><span class="s2">, </span><span class="s1">uint64</span><span class="s2">, </span><span class="s1">float32</span><span class="s2">, </span><span class="s1">float64</span>
<span class="s0">from </span><span class="s1">numba</span><span class="s2">.</span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">testing </span><span class="s0">import </span><span class="s1">unittest</span><span class="s2">, </span><span class="s1">CUDATestCase</span><span class="s2">, </span><span class="s1">cc_X_or_above</span>
<span class="s0">from </span><span class="s1">numba</span><span class="s2">.</span><span class="s1">core </span><span class="s0">import </span><span class="s1">config</span>


<span class="s2">@</span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">device</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">atomic_cast_to_uint64</span><span class="s2">(</span><span class="s1">num</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">uint64</span><span class="s2">(</span><span class="s1">num</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">device</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">atomic_cast_to_int</span><span class="s2">(</span><span class="s1">num</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">int</span><span class="s2">(</span><span class="s1">num</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">device</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">atomic_cast_none</span><span class="s2">(</span><span class="s1">num</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">num</span>


<span class="s2">@</span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">device</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">atomic_binary_1dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">, </span><span class="s1">ary_dtype</span><span class="s2">, </span><span class="s1">ary_nelements</span><span class="s2">,</span>
                              <span class="s1">binop_func</span><span class="s2">, </span><span class="s1">cast_func</span><span class="s2">, </span><span class="s1">initializer</span><span class="s2">,</span>
                              <span class="s1">neg_idx</span><span class="s2">):</span>
    <span class="s1">tid </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">threadIdx</span><span class="s2">.</span><span class="s1">x</span>
    <span class="s1">sm </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">shared</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">ary_nelements</span><span class="s2">, </span><span class="s1">ary_dtype</span><span class="s2">)</span>
    <span class="s1">sm</span><span class="s2">[</span><span class="s1">tid</span><span class="s2">] = </span><span class="s1">initializer</span>
    <span class="s1">cuda</span><span class="s2">.</span><span class="s1">syncthreads</span><span class="s2">()</span>
    <span class="s1">bin </span><span class="s2">= </span><span class="s1">cast_func</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">[</span><span class="s1">tid</span><span class="s2">] % </span><span class="s1">ary_nelements</span><span class="s2">)</span>
    <span class="s0">if </span><span class="s1">neg_idx</span><span class="s2">:</span>
        <span class="s1">bin </span><span class="s2">= </span><span class="s1">bin </span><span class="s2">% </span><span class="s1">ary_nelements</span>
    <span class="s1">binop_func</span><span class="s2">(</span><span class="s1">sm</span><span class="s2">, </span><span class="s1">bin</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">)</span>
    <span class="s1">cuda</span><span class="s2">.</span><span class="s1">syncthreads</span><span class="s2">()</span>
    <span class="s1">ary</span><span class="s2">[</span><span class="s1">tid</span><span class="s2">] = </span><span class="s1">sm</span><span class="s2">[</span><span class="s1">tid</span><span class="s2">]</span>


<span class="s2">@</span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">device</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">atomic_binary_1dim_shared2</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">, </span><span class="s1">ary_dtype</span><span class="s2">, </span><span class="s1">ary_nelements</span><span class="s2">,</span>
                               <span class="s1">binop_func</span><span class="s2">, </span><span class="s1">cast_func</span><span class="s2">):</span>
    <span class="s1">tid </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">threadIdx</span><span class="s2">.</span><span class="s1">x</span>
    <span class="s1">sm </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">shared</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">ary_nelements</span><span class="s2">, </span><span class="s1">ary_dtype</span><span class="s2">)</span>
    <span class="s1">sm</span><span class="s2">[</span><span class="s1">tid</span><span class="s2">] = </span><span class="s1">ary</span><span class="s2">[</span><span class="s1">tid</span><span class="s2">]</span>
    <span class="s1">cuda</span><span class="s2">.</span><span class="s1">syncthreads</span><span class="s2">()</span>
    <span class="s1">bin </span><span class="s2">= </span><span class="s1">cast_func</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">[</span><span class="s1">tid</span><span class="s2">] % </span><span class="s1">ary_nelements</span><span class="s2">)</span>
    <span class="s1">binop_func</span><span class="s2">(</span><span class="s1">sm</span><span class="s2">, </span><span class="s1">bin</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">)</span>
    <span class="s1">cuda</span><span class="s2">.</span><span class="s1">syncthreads</span><span class="s2">()</span>
    <span class="s1">ary</span><span class="s2">[</span><span class="s1">tid</span><span class="s2">] = </span><span class="s1">sm</span><span class="s2">[</span><span class="s1">tid</span><span class="s2">]</span>


<span class="s2">@</span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">device</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">atomic_binary_2dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">, </span><span class="s1">ary_dtype</span><span class="s2">, </span><span class="s1">ary_shape</span><span class="s2">,</span>
                              <span class="s1">binop_func</span><span class="s2">, </span><span class="s1">y_cast_func</span><span class="s2">, </span><span class="s1">neg_idx</span><span class="s2">):</span>
    <span class="s1">tx </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">threadIdx</span><span class="s2">.</span><span class="s1">x</span>
    <span class="s1">ty </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">threadIdx</span><span class="s2">.</span><span class="s1">y</span>
    <span class="s1">sm </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">shared</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">ary_shape</span><span class="s2">, </span><span class="s1">ary_dtype</span><span class="s2">)</span>
    <span class="s1">sm</span><span class="s2">[</span><span class="s1">tx</span><span class="s2">, </span><span class="s1">ty</span><span class="s2">] = </span><span class="s1">ary</span><span class="s2">[</span><span class="s1">tx</span><span class="s2">, </span><span class="s1">ty</span><span class="s2">]</span>
    <span class="s1">cuda</span><span class="s2">.</span><span class="s1">syncthreads</span><span class="s2">()</span>
    <span class="s1">bin </span><span class="s2">= (</span><span class="s1">tx</span><span class="s2">, </span><span class="s1">y_cast_func</span><span class="s2">(</span><span class="s1">ty</span><span class="s2">))</span>
    <span class="s0">if </span><span class="s1">neg_idx</span><span class="s2">:</span>
        <span class="s1">bin </span><span class="s2">= (</span><span class="s1">bin</span><span class="s2">[</span><span class="s3">0</span><span class="s2">] % </span><span class="s1">ary_shape</span><span class="s2">[</span><span class="s3">0</span><span class="s2">], </span><span class="s1">bin</span><span class="s2">[</span><span class="s3">1</span><span class="s2">] % </span><span class="s1">ary_shape</span><span class="s2">[</span><span class="s3">1</span><span class="s2">])</span>
    <span class="s1">binop_func</span><span class="s2">(</span><span class="s1">sm</span><span class="s2">, </span><span class="s1">bin</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">)</span>
    <span class="s1">cuda</span><span class="s2">.</span><span class="s1">syncthreads</span><span class="s2">()</span>
    <span class="s1">ary</span><span class="s2">[</span><span class="s1">tx</span><span class="s2">, </span><span class="s1">ty</span><span class="s2">] = </span><span class="s1">sm</span><span class="s2">[</span><span class="s1">tx</span><span class="s2">, </span><span class="s1">ty</span><span class="s2">]</span>


<span class="s2">@</span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">device</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">atomic_binary_2dim_global</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">, </span><span class="s1">binop_func</span><span class="s2">, </span><span class="s1">y_cast_func</span><span class="s2">, </span><span class="s1">neg_idx</span><span class="s2">):</span>
    <span class="s1">tx </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">threadIdx</span><span class="s2">.</span><span class="s1">x</span>
    <span class="s1">ty </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">threadIdx</span><span class="s2">.</span><span class="s1">y</span>
    <span class="s1">bin </span><span class="s2">= (</span><span class="s1">tx</span><span class="s2">, </span><span class="s1">y_cast_func</span><span class="s2">(</span><span class="s1">ty</span><span class="s2">))</span>
    <span class="s0">if </span><span class="s1">neg_idx</span><span class="s2">:</span>
        <span class="s1">bin </span><span class="s2">= (</span><span class="s1">bin</span><span class="s2">[</span><span class="s3">0</span><span class="s2">] % </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">[</span><span class="s3">0</span><span class="s2">], </span><span class="s1">bin</span><span class="s2">[</span><span class="s3">1</span><span class="s2">] % </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">[</span><span class="s3">1</span><span class="s2">])</span>
    <span class="s1">binop_func</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">bin</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">device</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">atomic_binary_1dim_global</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">ary_nelements</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">,</span>
                              <span class="s1">binop_func</span><span class="s2">, </span><span class="s1">neg_idx</span><span class="s2">):</span>
    <span class="s1">tid </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">threadIdx</span><span class="s2">.</span><span class="s1">x</span>
    <span class="s1">bin </span><span class="s2">= </span><span class="s1">int</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">[</span><span class="s1">tid</span><span class="s2">] % </span><span class="s1">ary_nelements</span><span class="s2">)</span>
    <span class="s0">if </span><span class="s1">neg_idx</span><span class="s2">:</span>
        <span class="s1">bin </span><span class="s2">= </span><span class="s1">bin </span><span class="s2">% </span><span class="s1">ary_nelements</span>
    <span class="s1">binop_func</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">bin</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_add</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">):</span>
    <span class="s1">atomic_binary_1dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">uint32</span><span class="s2">, </span><span class="s3">32</span><span class="s2">,</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">add</span><span class="s2">, </span><span class="s1">atomic_cast_none</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_add_wrap</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">):</span>
    <span class="s1">atomic_binary_1dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">uint32</span><span class="s2">, </span><span class="s3">32</span><span class="s2">,</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">add</span><span class="s2">, </span><span class="s1">atomic_cast_none</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s0">True</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_add2</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">uint32</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">),</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">add</span><span class="s2">, </span><span class="s1">atomic_cast_none</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_add2_wrap</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">uint32</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">),</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">add</span><span class="s2">, </span><span class="s1">atomic_cast_none</span><span class="s2">, </span><span class="s0">True</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_add3</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">uint32</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">),</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">add</span><span class="s2">, </span><span class="s1">atomic_cast_to_uint64</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_add_float</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">):</span>
    <span class="s1">atomic_binary_1dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s1">float32</span><span class="s2">, </span><span class="s3">32</span><span class="s2">,</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">add</span><span class="s2">, </span><span class="s1">atomic_cast_to_int</span><span class="s2">, </span><span class="s3">0.0</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_add_float_wrap</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">):</span>
    <span class="s1">atomic_binary_1dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s1">float32</span><span class="s2">, </span><span class="s3">32</span><span class="s2">,</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">add</span><span class="s2">, </span><span class="s1">atomic_cast_to_int</span><span class="s2">, </span><span class="s3">0.0</span><span class="s2">, </span><span class="s0">True</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_add_float_2</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s1">float32</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">),</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">add</span><span class="s2">, </span><span class="s1">atomic_cast_none</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_add_float_2_wrap</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s1">float32</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">),</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">add</span><span class="s2">, </span><span class="s1">atomic_cast_none</span><span class="s2">, </span><span class="s0">True</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_add_float_3</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s1">float32</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">),</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">add</span><span class="s2">, </span><span class="s1">atomic_cast_to_uint64</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_add_double_global</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">):</span>
    <span class="s1">atomic_binary_1dim_global</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">add</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_add_double_global_wrap</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">):</span>
    <span class="s1">atomic_binary_1dim_global</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">add</span><span class="s2">, </span><span class="s0">True</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_add_double_global_2</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_global</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">add</span><span class="s2">, </span><span class="s1">atomic_cast_none</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_add_double_global_2_wrap</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_global</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">add</span><span class="s2">, </span><span class="s1">atomic_cast_none</span><span class="s2">, </span><span class="s0">True</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_add_double_global_3</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_global</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">add</span><span class="s2">, </span><span class="s1">atomic_cast_to_uint64</span><span class="s2">,</span>
                              <span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_add_double</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">):</span>
    <span class="s1">atomic_binary_1dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s1">float64</span><span class="s2">, </span><span class="s3">32</span><span class="s2">,</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">add</span><span class="s2">, </span><span class="s1">atomic_cast_none</span><span class="s2">, </span><span class="s3">0.0</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_add_double_wrap</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">):</span>
    <span class="s1">atomic_binary_1dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s1">float64</span><span class="s2">, </span><span class="s3">32</span><span class="s2">,</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">add</span><span class="s2">, </span><span class="s1">atomic_cast_none</span><span class="s2">, </span><span class="s3">0.0</span><span class="s2">, </span><span class="s0">True</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_add_double_2</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s1">float64</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">),</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">add</span><span class="s2">, </span><span class="s1">atomic_cast_none</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_add_double_2_wrap</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s1">float64</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">),</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">add</span><span class="s2">, </span><span class="s1">atomic_cast_none</span><span class="s2">, </span><span class="s0">True</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_add_double_3</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s1">float64</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">),</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">add</span><span class="s2">, </span><span class="s1">atomic_cast_to_uint64</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_sub</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">):</span>
    <span class="s1">atomic_binary_1dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">uint32</span><span class="s2">, </span><span class="s3">32</span><span class="s2">,</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">sub</span><span class="s2">, </span><span class="s1">atomic_cast_none</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_sub2</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">uint32</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">),</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">sub</span><span class="s2">, </span><span class="s1">atomic_cast_none</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_sub3</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">uint32</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">),</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">sub</span><span class="s2">, </span><span class="s1">atomic_cast_to_uint64</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_sub_float</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">):</span>
    <span class="s1">atomic_binary_1dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s1">float32</span><span class="s2">, </span><span class="s3">32</span><span class="s2">,</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">sub</span><span class="s2">, </span><span class="s1">atomic_cast_to_int</span><span class="s2">, </span><span class="s3">0.0</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_sub_float_2</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s1">float32</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">),</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">sub</span><span class="s2">, </span><span class="s1">atomic_cast_none</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_sub_float_3</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s1">float32</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">),</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">sub</span><span class="s2">, </span><span class="s1">atomic_cast_to_uint64</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_sub_double</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">):</span>
    <span class="s1">atomic_binary_1dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s1">float64</span><span class="s2">, </span><span class="s3">32</span><span class="s2">,</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">sub</span><span class="s2">, </span><span class="s1">atomic_cast_none</span><span class="s2">, </span><span class="s3">0.0</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_sub_double_2</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s1">float64</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">),</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">sub</span><span class="s2">, </span><span class="s1">atomic_cast_none</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_sub_double_3</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s1">float64</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">),</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">sub</span><span class="s2">, </span><span class="s1">atomic_cast_to_uint64</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_sub_double_global</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">):</span>
    <span class="s1">atomic_binary_1dim_global</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">sub</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_sub_double_global_2</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_global</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">sub</span><span class="s2">, </span><span class="s1">atomic_cast_none</span><span class="s2">,</span>
                              <span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_sub_double_global_3</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s1">float64</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">),</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">sub</span><span class="s2">, </span><span class="s1">atomic_cast_to_uint64</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_and</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">):</span>
    <span class="s1">atomic_binary_1dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">, </span><span class="s1">uint32</span><span class="s2">, </span><span class="s3">32</span><span class="s2">,</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">and_</span><span class="s2">, </span><span class="s1">atomic_cast_none</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_and2</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">, </span><span class="s1">uint32</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">),</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">and_</span><span class="s2">, </span><span class="s1">atomic_cast_none</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_and3</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">, </span><span class="s1">uint32</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">),</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">and_</span><span class="s2">, </span><span class="s1">atomic_cast_to_uint64</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_and_global</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">):</span>
    <span class="s1">atomic_binary_1dim_global</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">, </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">and_</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_and_global_2</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_global</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">, </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">and_</span><span class="s2">,</span>
                              <span class="s1">atomic_cast_none</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_or</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">):</span>
    <span class="s1">atomic_binary_1dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">, </span><span class="s1">uint32</span><span class="s2">, </span><span class="s3">32</span><span class="s2">,</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">or_</span><span class="s2">, </span><span class="s1">atomic_cast_none</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_or2</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">, </span><span class="s1">uint32</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">),</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">or_</span><span class="s2">, </span><span class="s1">atomic_cast_none</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_or3</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">, </span><span class="s1">uint32</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">),</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">or_</span><span class="s2">, </span><span class="s1">atomic_cast_to_uint64</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_or_global</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">):</span>
    <span class="s1">atomic_binary_1dim_global</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">, </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">or_</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_or_global_2</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_global</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">, </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">or_</span><span class="s2">,</span>
                              <span class="s1">atomic_cast_none</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_xor</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">):</span>
    <span class="s1">atomic_binary_1dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">, </span><span class="s1">uint32</span><span class="s2">, </span><span class="s3">32</span><span class="s2">,</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">xor</span><span class="s2">, </span><span class="s1">atomic_cast_none</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_xor2</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">, </span><span class="s1">uint32</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">),</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">xor</span><span class="s2">, </span><span class="s1">atomic_cast_none</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_xor3</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">, </span><span class="s1">uint32</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">),</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">xor</span><span class="s2">, </span><span class="s1">atomic_cast_to_uint64</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_xor_global</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">):</span>
    <span class="s1">atomic_binary_1dim_global</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">, </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">xor</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_xor_global_2</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_global</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">, </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">xor</span><span class="s2">,</span>
                              <span class="s1">atomic_cast_none</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_inc32</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">):</span>
    <span class="s1">atomic_binary_1dim_shared2</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">, </span><span class="s1">uint32</span><span class="s2">, </span><span class="s3">32</span><span class="s2">,</span>
                               <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">inc</span><span class="s2">, </span><span class="s1">atomic_cast_none</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_inc64</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">):</span>
    <span class="s1">atomic_binary_1dim_shared2</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">, </span><span class="s1">uint64</span><span class="s2">, </span><span class="s3">32</span><span class="s2">,</span>
                               <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">inc</span><span class="s2">, </span><span class="s1">atomic_cast_to_int</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_inc2_32</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">, </span><span class="s1">uint32</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">),</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">inc</span><span class="s2">, </span><span class="s1">atomic_cast_none</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_inc2_64</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">, </span><span class="s1">uint64</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">),</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">inc</span><span class="s2">, </span><span class="s1">atomic_cast_none</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_inc3</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">, </span><span class="s1">uint32</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">),</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">inc</span><span class="s2">, </span><span class="s1">atomic_cast_to_uint64</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_inc_global</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">):</span>
    <span class="s1">atomic_binary_1dim_global</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">, </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">inc</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_inc_global_2</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_global</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">, </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">inc</span><span class="s2">,</span>
                              <span class="s1">atomic_cast_none</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_dec32</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">):</span>
    <span class="s1">atomic_binary_1dim_shared2</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">, </span><span class="s1">uint32</span><span class="s2">, </span><span class="s3">32</span><span class="s2">,</span>
                               <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">dec</span><span class="s2">, </span><span class="s1">atomic_cast_none</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_dec64</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">):</span>
    <span class="s1">atomic_binary_1dim_shared2</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">, </span><span class="s1">uint64</span><span class="s2">, </span><span class="s3">32</span><span class="s2">,</span>
                               <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">dec</span><span class="s2">, </span><span class="s1">atomic_cast_to_int</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_dec2_32</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">, </span><span class="s1">uint32</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">),</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">dec</span><span class="s2">, </span><span class="s1">atomic_cast_none</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_dec2_64</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">, </span><span class="s1">uint64</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">),</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">dec</span><span class="s2">, </span><span class="s1">atomic_cast_none</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_dec3</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">, </span><span class="s1">uint32</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">),</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">dec</span><span class="s2">, </span><span class="s1">atomic_cast_to_uint64</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_dec_global</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">):</span>
    <span class="s1">atomic_binary_1dim_global</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">, </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">dec</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_dec_global_2</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_global</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">, </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">dec</span><span class="s2">,</span>
                              <span class="s1">atomic_cast_none</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_exch</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">):</span>
    <span class="s1">atomic_binary_1dim_shared2</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">, </span><span class="s1">uint32</span><span class="s2">, </span><span class="s3">32</span><span class="s2">,</span>
                               <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">exch</span><span class="s2">, </span><span class="s1">atomic_cast_none</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_exch2</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">, </span><span class="s1">uint32</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">),</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">exch</span><span class="s2">, </span><span class="s1">atomic_cast_none</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_exch3</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">):</span>
    <span class="s1">atomic_binary_2dim_shared</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">, </span><span class="s1">uint64</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">),</span>
                              <span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">exch</span><span class="s2">, </span><span class="s1">atomic_cast_none</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_exch_global</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">):</span>
    <span class="s1">atomic_binary_1dim_global</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">op2</span><span class="s2">, </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">exch</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">gen_atomic_extreme_funcs</span><span class="s2">(</span><span class="s1">func</span><span class="s2">):</span>

    <span class="s1">fns </span><span class="s2">= </span><span class="s1">dedent</span><span class="s2">(</span><span class="s4">&quot;&quot;&quot; 
    def atomic(res, ary): 
        tx = cuda.threadIdx.x 
        bx = cuda.blockIdx.x 
        {func}(res, 0, ary[tx, bx]) 
 
    def atomic_double_normalizedindex(res, ary): 
        tx = cuda.threadIdx.x 
        bx = cuda.blockIdx.x 
        {func}(res, 0, ary[tx, uint64(bx)]) 
 
    def atomic_double_oneindex(res, ary): 
        tx = cuda.threadIdx.x 
        {func}(res, 0, ary[tx]) 
 
    def atomic_double_shared(res, ary): 
        tid = cuda.threadIdx.x 
        smary = cuda.shared.array(32, float64) 
        smary[tid] = ary[tid] 
        smres = cuda.shared.array(1, float64) 
        if tid == 0: 
            smres[0] = res[0] 
        cuda.syncthreads() 
        {func}(smres, 0, smary[tid]) 
        cuda.syncthreads() 
        if tid == 0: 
            res[0] = smres[0] 
    &quot;&quot;&quot;</span><span class="s2">).</span><span class="s1">format</span><span class="s2">(</span><span class="s1">func</span><span class="s2">=</span><span class="s1">func</span><span class="s2">)</span>
    <span class="s1">ld </span><span class="s2">= {}</span>
    <span class="s1">exec</span><span class="s2">(</span><span class="s1">fns</span><span class="s2">, {</span><span class="s4">'cuda'</span><span class="s2">: </span><span class="s1">cuda</span><span class="s2">, </span><span class="s4">'float64'</span><span class="s2">: </span><span class="s1">float64</span><span class="s2">, </span><span class="s4">'uint64'</span><span class="s2">: </span><span class="s1">uint64</span><span class="s2">}, </span><span class="s1">ld</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s2">(</span><span class="s1">ld</span><span class="s2">[</span><span class="s4">'atomic'</span><span class="s2">], </span><span class="s1">ld</span><span class="s2">[</span><span class="s4">'atomic_double_normalizedindex'</span><span class="s2">],</span>
            <span class="s1">ld</span><span class="s2">[</span><span class="s4">'atomic_double_oneindex'</span><span class="s2">], </span><span class="s1">ld</span><span class="s2">[</span><span class="s4">'atomic_double_shared'</span><span class="s2">])</span>


<span class="s2">(</span><span class="s1">atomic_max</span><span class="s2">, </span><span class="s1">atomic_max_double_normalizedindex</span><span class="s2">, </span><span class="s1">atomic_max_double_oneindex</span><span class="s2">,</span>
 <span class="s1">atomic_max_double_shared</span><span class="s2">) = </span><span class="s1">gen_atomic_extreme_funcs</span><span class="s2">(</span><span class="s4">'cuda.atomic.max'</span><span class="s2">)</span>
<span class="s2">(</span><span class="s1">atomic_min</span><span class="s2">, </span><span class="s1">atomic_min_double_normalizedindex</span><span class="s2">, </span><span class="s1">atomic_min_double_oneindex</span><span class="s2">,</span>
 <span class="s1">atomic_min_double_shared</span><span class="s2">) = </span><span class="s1">gen_atomic_extreme_funcs</span><span class="s2">(</span><span class="s4">'cuda.atomic.min'</span><span class="s2">)</span>
<span class="s2">(</span><span class="s1">atomic_nanmax</span><span class="s2">, </span><span class="s1">atomic_nanmax_double_normalizedindex</span><span class="s2">,</span>
 <span class="s1">atomic_nanmax_double_oneindex</span><span class="s2">, </span><span class="s1">atomic_nanmax_double_shared</span><span class="s2">) = </span><span class="s1">\</span>
    <span class="s1">gen_atomic_extreme_funcs</span><span class="s2">(</span><span class="s4">'cuda.atomic.nanmax'</span><span class="s2">)</span>
<span class="s2">(</span><span class="s1">atomic_nanmin</span><span class="s2">, </span><span class="s1">atomic_nanmin_double_normalizedindex</span><span class="s2">,</span>
 <span class="s1">atomic_nanmin_double_oneindex</span><span class="s2">, </span><span class="s1">atomic_nanmin_double_shared</span><span class="s2">) = </span><span class="s1">\</span>
    <span class="s1">gen_atomic_extreme_funcs</span><span class="s2">(</span><span class="s4">'cuda.atomic.nanmin'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">atomic_compare_and_swap</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">old</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s1">fill_val</span><span class="s2">):</span>
    <span class="s1">gid </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">grid</span><span class="s2">(</span><span class="s3">1</span><span class="s2">)</span>
    <span class="s0">if </span><span class="s1">gid </span><span class="s2">&lt; </span><span class="s1">res</span><span class="s2">.</span><span class="s1">size</span><span class="s2">:</span>
        <span class="s1">old</span><span class="s2">[</span><span class="s1">gid</span><span class="s2">] = </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">compare_and_swap</span><span class="s2">(</span><span class="s1">res</span><span class="s2">[</span><span class="s1">gid</span><span class="s2">:], </span><span class="s1">fill_val</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">[</span><span class="s1">gid</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">atomic_cas_1dim</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">old</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s1">fill_val</span><span class="s2">):</span>
    <span class="s1">gid </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">grid</span><span class="s2">(</span><span class="s3">1</span><span class="s2">)</span>
    <span class="s0">if </span><span class="s1">gid </span><span class="s2">&lt; </span><span class="s1">res</span><span class="s2">.</span><span class="s1">size</span><span class="s2">:</span>
        <span class="s1">old</span><span class="s2">[</span><span class="s1">gid</span><span class="s2">] = </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">cas</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">gid</span><span class="s2">, </span><span class="s1">fill_val</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">[</span><span class="s1">gid</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">atomic_cas_2dim</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">old</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s1">fill_val</span><span class="s2">):</span>
    <span class="s1">gid </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">grid</span><span class="s2">(</span><span class="s3">2</span><span class="s2">)</span>
    <span class="s0">if </span><span class="s1">gid</span><span class="s2">[</span><span class="s3">0</span><span class="s2">] &lt; </span><span class="s1">res</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">[</span><span class="s3">0</span><span class="s2">] </span><span class="s0">and </span><span class="s1">gid</span><span class="s2">[</span><span class="s3">1</span><span class="s2">] &lt; </span><span class="s1">res</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">[</span><span class="s3">1</span><span class="s2">]:</span>
        <span class="s1">old</span><span class="s2">[</span><span class="s1">gid</span><span class="s2">] = </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">cas</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">gid</span><span class="s2">, </span><span class="s1">fill_val</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">[</span><span class="s1">gid</span><span class="s2">])</span>


<span class="s0">class </span><span class="s1">TestCudaAtomics</span><span class="s2">(</span><span class="s1">CUDATestCase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setUp</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">super</span><span class="s2">().</span><span class="s1">setUp</span><span class="s2">()</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s3">0</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_add</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">)</span>
        <span class="s1">ary_wrap </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>

        <span class="s1">cuda_atomic_add </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(uint32[:])'</span><span class="s2">)(</span><span class="s1">atomic_add</span><span class="s2">)</span>
        <span class="s1">cuda_atomic_add</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">32</span><span class="s2">](</span><span class="s1">ary</span><span class="s2">)</span>

        <span class="s1">cuda_atomic_add_wrap </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(uint32[:])'</span><span class="s2">)(</span><span class="s1">atomic_add_wrap</span><span class="s2">)</span>
        <span class="s1">cuda_atomic_add_wrap</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">32</span><span class="s2">](</span><span class="s1">ary_wrap</span><span class="s2">)</span>

        <span class="s1">gold </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s3">32</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">orig</span><span class="s2">.</span><span class="s1">size</span><span class="s2">):</span>
            <span class="s1">gold</span><span class="s2">[</span><span class="s1">orig</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]] += </span><span class="s3">1</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">ary </span><span class="s2">== </span><span class="s1">gold</span><span class="s2">))</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">ary_wrap </span><span class="s2">== </span><span class="s1">gold</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_atomic_add2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)</span>
        <span class="s1">ary_wrap </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>

        <span class="s1">cuda_atomic_add2 </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(uint32[:,:])'</span><span class="s2">)(</span><span class="s1">atomic_add2</span><span class="s2">)</span>
        <span class="s1">cuda_atomic_add2</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)](</span><span class="s1">ary</span><span class="s2">)</span>

        <span class="s1">cuda_atomic_add2_wrap </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(uint32[:,:])'</span><span class="s2">)(</span><span class="s1">atomic_add2_wrap</span><span class="s2">)</span>
        <span class="s1">cuda_atomic_add2_wrap</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)](</span><span class="s1">ary_wrap</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">ary </span><span class="s2">== </span><span class="s1">orig </span><span class="s2">+ </span><span class="s3">1</span><span class="s2">))</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">ary_wrap </span><span class="s2">== </span><span class="s1">orig </span><span class="s2">+ </span><span class="s3">1</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_atomic_add3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">cuda_atomic_add3 </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(uint32[:,:])'</span><span class="s2">)(</span><span class="s1">atomic_add3</span><span class="s2">)</span>
        <span class="s1">cuda_atomic_add3</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)](</span><span class="s1">ary</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">ary </span><span class="s2">== </span><span class="s1">orig </span><span class="s2">+ </span><span class="s3">1</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_atomic_add_float</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">)</span>
        <span class="s1">ary_wrap </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">().</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">intp</span><span class="s2">)</span>

        <span class="s1">cuda_atomic_add_float </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(float32[:])'</span><span class="s2">)(</span><span class="s1">atomic_add_float</span><span class="s2">)</span>
        <span class="s1">cuda_atomic_add_float</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">32</span><span class="s2">](</span><span class="s1">ary</span><span class="s2">)</span>

        <span class="s1">add_float_wrap </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(float32[:])'</span><span class="s2">)(</span><span class="s1">atomic_add_float_wrap</span><span class="s2">)</span>
        <span class="s1">add_float_wrap</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">32</span><span class="s2">](</span><span class="s1">ary_wrap</span><span class="s2">)</span>

        <span class="s1">gold </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s3">32</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">orig</span><span class="s2">.</span><span class="s1">size</span><span class="s2">):</span>
            <span class="s1">gold</span><span class="s2">[</span><span class="s1">orig</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]] += </span><span class="s3">1.0</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">ary </span><span class="s2">== </span><span class="s1">gold</span><span class="s2">))</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">ary_wrap </span><span class="s2">== </span><span class="s1">gold</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_atomic_add_float_2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)</span>
        <span class="s1">ary_wrap </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>

        <span class="s1">cuda_atomic_add2 </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(float32[:,:])'</span><span class="s2">)(</span><span class="s1">atomic_add_float_2</span><span class="s2">)</span>
        <span class="s1">cuda_atomic_add2</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)](</span><span class="s1">ary</span><span class="s2">)</span>

        <span class="s1">cuda_func_wrap </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(float32[:,:])'</span><span class="s2">)(</span><span class="s1">atomic_add_float_2_wrap</span><span class="s2">)</span>
        <span class="s1">cuda_func_wrap</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)](</span><span class="s1">ary_wrap</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">ary </span><span class="s2">== </span><span class="s1">orig </span><span class="s2">+ </span><span class="s3">1</span><span class="s2">))</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">ary_wrap </span><span class="s2">== </span><span class="s1">orig </span><span class="s2">+ </span><span class="s3">1</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_atomic_add_float_3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">cuda_atomic_add3 </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(float32[:,:])'</span><span class="s2">)(</span><span class="s1">atomic_add_float_3</span><span class="s2">)</span>
        <span class="s1">cuda_atomic_add3</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)](</span><span class="s1">ary</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">ary </span><span class="s2">== </span><span class="s1">orig </span><span class="s2">+ </span><span class="s3">1</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">assertCorrectFloat64Atomics</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">kernel</span><span class="s2">, </span><span class="s1">shared</span><span class="s2">=</span><span class="s0">True</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">config</span><span class="s2">.</span><span class="s1">ENABLE_CUDASIM</span><span class="s2">:</span>
            <span class="s0">return</span>

        <span class="s5"># Use the first (and only) definition</span>
        <span class="s1">asm </span><span class="s2">= </span><span class="s1">next</span><span class="s2">(</span><span class="s1">iter</span><span class="s2">(</span><span class="s1">kernel</span><span class="s2">.</span><span class="s1">inspect_asm</span><span class="s2">().</span><span class="s1">values</span><span class="s2">()))</span>
        <span class="s0">if </span><span class="s1">cc_X_or_above</span><span class="s2">(</span><span class="s3">6</span><span class="s2">, </span><span class="s3">0</span><span class="s2">):</span>
            <span class="s0">if </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">runtime</span><span class="s2">.</span><span class="s1">get_version</span><span class="s2">() &gt; (</span><span class="s3">12</span><span class="s2">, </span><span class="s3">1</span><span class="s2">):</span>
                <span class="s5"># CUDA 12.2 and above generate a more optimized reduction</span>
                <span class="s5"># instruction, because the result does not need to be</span>
                <span class="s5"># placed in a register.</span>
                <span class="s1">inst </span><span class="s2">= </span><span class="s4">'red'</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s1">inst </span><span class="s2">= </span><span class="s4">'atom'</span>

            <span class="s0">if </span><span class="s1">shared</span><span class="s2">:</span>
                <span class="s1">inst </span><span class="s2">= </span><span class="s4">f'</span><span class="s0">{</span><span class="s1">inst</span><span class="s0">}</span><span class="s4">.shared'</span>

            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s4">f'</span><span class="s0">{</span><span class="s1">inst</span><span class="s0">}</span><span class="s4">.add.f64'</span><span class="s2">, </span><span class="s1">asm</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">shared</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s4">'atom.shared.cas.b64'</span><span class="s2">, </span><span class="s1">asm</span><span class="s2">)</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s4">'atom.cas.b64'</span><span class="s2">, </span><span class="s1">asm</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_add_double</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">)</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s3">32</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
        <span class="s1">ary_wrap </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>

        <span class="s1">cuda_fn </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(int64[:], float64[:])'</span><span class="s2">)(</span><span class="s1">atomic_add_double</span><span class="s2">)</span>
        <span class="s1">cuda_fn</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">32</span><span class="s2">](</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">)</span>

        <span class="s1">wrap_fn </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(int64[:], float64[:])'</span><span class="s2">)(</span><span class="s1">atomic_add_double_wrap</span><span class="s2">)</span>
        <span class="s1">wrap_fn</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">32</span><span class="s2">](</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">ary_wrap</span><span class="s2">)</span>

        <span class="s1">gold </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s3">32</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">size</span><span class="s2">):</span>
            <span class="s1">gold</span><span class="s2">[</span><span class="s1">idx</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]] += </span><span class="s3">1.0</span>

        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">gold</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ary_wrap</span><span class="s2">, </span><span class="s1">gold</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertCorrectFloat64Atomics</span><span class="s2">(</span><span class="s1">cuda_fn</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertCorrectFloat64Atomics</span><span class="s2">(</span><span class="s1">wrap_fn</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_add_double_2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)</span>
        <span class="s1">ary_wrap </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>

        <span class="s1">cuda_fn </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(float64[:,:])'</span><span class="s2">)(</span><span class="s1">atomic_add_double_2</span><span class="s2">)</span>
        <span class="s1">cuda_fn</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)](</span><span class="s1">ary</span><span class="s2">)</span>

        <span class="s1">cuda_fn_wrap </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(float64[:,:])'</span><span class="s2">)(</span><span class="s1">atomic_add_double_2_wrap</span><span class="s2">)</span>
        <span class="s1">cuda_fn_wrap</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)](</span><span class="s1">ary_wrap</span><span class="s2">)</span>

        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">orig </span><span class="s2">+ </span><span class="s3">1</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ary_wrap</span><span class="s2">, </span><span class="s1">orig </span><span class="s2">+ </span><span class="s3">1</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertCorrectFloat64Atomics</span><span class="s2">(</span><span class="s1">cuda_fn</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertCorrectFloat64Atomics</span><span class="s2">(</span><span class="s1">cuda_fn_wrap</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_add_double_3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(float64[:,:])'</span><span class="s2">)(</span><span class="s1">atomic_add_double_3</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)](</span><span class="s1">ary</span><span class="s2">)</span>

        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">orig </span><span class="s2">+ </span><span class="s3">1</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertCorrectFloat64Atomics</span><span class="s2">(</span><span class="s1">cuda_func</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_add_double_global</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">)</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s3">32</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
        <span class="s1">ary_wrap </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>

        <span class="s1">sig </span><span class="s2">= </span><span class="s4">'void(int64[:], float64[:])'</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">sig</span><span class="s2">)(</span><span class="s1">atomic_add_double_global</span><span class="s2">)</span>
        <span class="s1">wrap_cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">sig</span><span class="s2">)(</span><span class="s1">atomic_add_double_global_wrap</span><span class="s2">)</span>

        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">32</span><span class="s2">](</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">)</span>
        <span class="s1">wrap_cuda_func</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">32</span><span class="s2">](</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">ary_wrap</span><span class="s2">)</span>

        <span class="s1">gold </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s3">32</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">size</span><span class="s2">):</span>
            <span class="s1">gold</span><span class="s2">[</span><span class="s1">idx</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]] += </span><span class="s3">1.0</span>

        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">gold</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ary_wrap</span><span class="s2">, </span><span class="s1">gold</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertCorrectFloat64Atomics</span><span class="s2">(</span><span class="s1">cuda_func</span><span class="s2">, </span><span class="s1">shared</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertCorrectFloat64Atomics</span><span class="s2">(</span><span class="s1">wrap_cuda_func</span><span class="s2">, </span><span class="s1">shared</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_add_double_global_2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)</span>
        <span class="s1">ary_wrap </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>

        <span class="s1">sig </span><span class="s2">= </span><span class="s4">'void(float64[:,:])'</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">sig</span><span class="s2">)(</span><span class="s1">atomic_add_double_global_2</span><span class="s2">)</span>
        <span class="s1">wrap_cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">sig</span><span class="s2">)(</span><span class="s1">atomic_add_double_global_2_wrap</span><span class="s2">)</span>

        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)](</span><span class="s1">ary</span><span class="s2">)</span>
        <span class="s1">wrap_cuda_func</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)](</span><span class="s1">ary_wrap</span><span class="s2">)</span>

        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">orig </span><span class="s2">+ </span><span class="s3">1</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ary_wrap</span><span class="s2">, </span><span class="s1">orig </span><span class="s2">+ </span><span class="s3">1</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertCorrectFloat64Atomics</span><span class="s2">(</span><span class="s1">cuda_func</span><span class="s2">, </span><span class="s1">shared</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertCorrectFloat64Atomics</span><span class="s2">(</span><span class="s1">wrap_cuda_func</span><span class="s2">, </span><span class="s1">shared</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_add_double_global_3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(float64[:,:])'</span><span class="s2">)(</span><span class="s1">atomic_add_double_global_3</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)](</span><span class="s1">ary</span><span class="s2">)</span>

        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">orig </span><span class="s2">+ </span><span class="s3">1</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertCorrectFloat64Atomics</span><span class="s2">(</span><span class="s1">cuda_func</span><span class="s2">, </span><span class="s1">shared</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_sub</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">)</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">cuda_atomic_sub </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(uint32[:])'</span><span class="s2">)(</span><span class="s1">atomic_sub</span><span class="s2">)</span>
        <span class="s1">cuda_atomic_sub</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">32</span><span class="s2">](</span><span class="s1">ary</span><span class="s2">)</span>

        <span class="s1">gold </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s3">32</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">orig</span><span class="s2">.</span><span class="s1">size</span><span class="s2">):</span>
            <span class="s1">gold</span><span class="s2">[</span><span class="s1">orig</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]] -= </span><span class="s3">1</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">ary </span><span class="s2">== </span><span class="s1">gold</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_atomic_sub2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">cuda_atomic_sub2 </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(uint32[:,:])'</span><span class="s2">)(</span><span class="s1">atomic_sub2</span><span class="s2">)</span>
        <span class="s1">cuda_atomic_sub2</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)](</span><span class="s1">ary</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">ary </span><span class="s2">== </span><span class="s1">orig </span><span class="s2">- </span><span class="s3">1</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_atomic_sub3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">cuda_atomic_sub3 </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(uint32[:,:])'</span><span class="s2">)(</span><span class="s1">atomic_sub3</span><span class="s2">)</span>
        <span class="s1">cuda_atomic_sub3</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)](</span><span class="s1">ary</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">ary </span><span class="s2">== </span><span class="s1">orig </span><span class="s2">- </span><span class="s3">1</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_atomic_sub_float</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">)</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">().</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">intp</span><span class="s2">)</span>
        <span class="s1">cuda_atomic_sub_float </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(float32[:])'</span><span class="s2">)(</span><span class="s1">atomic_sub_float</span><span class="s2">)</span>
        <span class="s1">cuda_atomic_sub_float</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">32</span><span class="s2">](</span><span class="s1">ary</span><span class="s2">)</span>

        <span class="s1">gold </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s3">32</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">orig</span><span class="s2">.</span><span class="s1">size</span><span class="s2">):</span>
            <span class="s1">gold</span><span class="s2">[</span><span class="s1">orig</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]] -= </span><span class="s3">1.0</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">ary </span><span class="s2">== </span><span class="s1">gold</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_atomic_sub_float_2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">cuda_atomic_sub2 </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(float32[:,:])'</span><span class="s2">)(</span><span class="s1">atomic_sub_float_2</span><span class="s2">)</span>
        <span class="s1">cuda_atomic_sub2</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)](</span><span class="s1">ary</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">ary </span><span class="s2">== </span><span class="s1">orig </span><span class="s2">- </span><span class="s3">1</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_atomic_sub_float_3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">cuda_atomic_sub3 </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(float32[:,:])'</span><span class="s2">)(</span><span class="s1">atomic_sub_float_3</span><span class="s2">)</span>
        <span class="s1">cuda_atomic_sub3</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)](</span><span class="s1">ary</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">ary </span><span class="s2">== </span><span class="s1">orig </span><span class="s2">- </span><span class="s3">1</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_atomic_sub_double</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">)</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s3">32</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(int64[:], float64[:])'</span><span class="s2">)(</span><span class="s1">atomic_sub_double</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">32</span><span class="s2">](</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">)</span>

        <span class="s1">gold </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s3">32</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">size</span><span class="s2">):</span>
            <span class="s1">gold</span><span class="s2">[</span><span class="s1">idx</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]] -= </span><span class="s3">1.0</span>

        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">gold</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_sub_double_2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(float64[:,:])'</span><span class="s2">)(</span><span class="s1">atomic_sub_double_2</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)](</span><span class="s1">ary</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">orig </span><span class="s2">- </span><span class="s3">1</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_sub_double_3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(float64[:,:])'</span><span class="s2">)(</span><span class="s1">atomic_sub_double_3</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)](</span><span class="s1">ary</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">orig </span><span class="s2">- </span><span class="s3">1</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_sub_double_global</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">)</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s3">32</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
        <span class="s1">sig </span><span class="s2">= </span><span class="s4">'void(int64[:], float64[:])'</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">sig</span><span class="s2">)(</span><span class="s1">atomic_sub_double_global</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">32</span><span class="s2">](</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">)</span>

        <span class="s1">gold </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s3">32</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">size</span><span class="s2">):</span>
            <span class="s1">gold</span><span class="s2">[</span><span class="s1">idx</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]] -= </span><span class="s3">1.0</span>

        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">gold</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_sub_double_global_2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(float64[:,:])'</span><span class="s2">)(</span><span class="s1">atomic_sub_double_global_2</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)](</span><span class="s1">ary</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">orig </span><span class="s2">- </span><span class="s3">1</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_sub_double_global_3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(float64[:,:])'</span><span class="s2">)(</span><span class="s1">atomic_sub_double_global_3</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)](</span><span class="s1">ary</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">orig </span><span class="s2">- </span><span class="s3">1</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_and</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rand_const </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">500</span><span class="s2">)</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">)</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(uint32[:], uint32)'</span><span class="s2">)(</span><span class="s1">atomic_and</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">32</span><span class="s2">](</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">)</span>

        <span class="s1">gold </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">orig</span><span class="s2">.</span><span class="s1">size</span><span class="s2">):</span>
            <span class="s1">gold</span><span class="s2">[</span><span class="s1">orig</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]] &amp;= </span><span class="s1">rand_const</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">ary </span><span class="s2">== </span><span class="s1">gold</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_atomic_and2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rand_const </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">500</span><span class="s2">)</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">cuda_atomic_and2 </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(uint32[:,:], uint32)'</span><span class="s2">)(</span><span class="s1">atomic_and2</span><span class="s2">)</span>
        <span class="s1">cuda_atomic_and2</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)](</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">ary </span><span class="s2">== </span><span class="s1">orig </span><span class="s2">&amp; </span><span class="s1">rand_const</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_atomic_and3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rand_const </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">500</span><span class="s2">)</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">cuda_atomic_and3 </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(uint32[:,:], uint32)'</span><span class="s2">)(</span><span class="s1">atomic_and3</span><span class="s2">)</span>
        <span class="s1">cuda_atomic_and3</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)](</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">ary </span><span class="s2">== </span><span class="s1">orig </span><span class="s2">&amp; </span><span class="s1">rand_const</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_atomic_and_global</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rand_const </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">500</span><span class="s2">)</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">)</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">)</span>
        <span class="s1">sig </span><span class="s2">= </span><span class="s4">'void(int32[:], int32[:], int32)'</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">sig</span><span class="s2">)(</span><span class="s1">atomic_and_global</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">32</span><span class="s2">](</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">)</span>

        <span class="s1">gold </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">size</span><span class="s2">):</span>
            <span class="s1">gold</span><span class="s2">[</span><span class="s1">idx</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]] &amp;= </span><span class="s1">rand_const</span>

        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">gold</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_and_global_2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rand_const </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">500</span><span class="s2">)</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(uint32[:,:], uint32)'</span><span class="s2">)(</span><span class="s1">atomic_and_global_2</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)](</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">orig </span><span class="s2">&amp; </span><span class="s1">rand_const</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_or</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rand_const </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">500</span><span class="s2">)</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">)</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(uint32[:], uint32)'</span><span class="s2">)(</span><span class="s1">atomic_or</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">32</span><span class="s2">](</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">)</span>

        <span class="s1">gold </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s3">32</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">orig</span><span class="s2">.</span><span class="s1">size</span><span class="s2">):</span>
            <span class="s1">gold</span><span class="s2">[</span><span class="s1">orig</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]] |= </span><span class="s1">rand_const</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">ary </span><span class="s2">== </span><span class="s1">gold</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_atomic_or2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rand_const </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">500</span><span class="s2">)</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">cuda_atomic_and2 </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(uint32[:,:], uint32)'</span><span class="s2">)(</span><span class="s1">atomic_or2</span><span class="s2">)</span>
        <span class="s1">cuda_atomic_and2</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)](</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">ary </span><span class="s2">== </span><span class="s1">orig </span><span class="s2">| </span><span class="s1">rand_const</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_atomic_or3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rand_const </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">500</span><span class="s2">)</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">cuda_atomic_and3 </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(uint32[:,:], uint32)'</span><span class="s2">)(</span><span class="s1">atomic_or3</span><span class="s2">)</span>
        <span class="s1">cuda_atomic_and3</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)](</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">ary </span><span class="s2">== </span><span class="s1">orig </span><span class="s2">| </span><span class="s1">rand_const</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_atomic_or_global</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rand_const </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">500</span><span class="s2">)</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">)</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">)</span>
        <span class="s1">sig </span><span class="s2">= </span><span class="s4">'void(int32[:], int32[:], int32)'</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">sig</span><span class="s2">)(</span><span class="s1">atomic_or_global</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">32</span><span class="s2">](</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">)</span>

        <span class="s1">gold </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">size</span><span class="s2">):</span>
            <span class="s1">gold</span><span class="s2">[</span><span class="s1">idx</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]] |= </span><span class="s1">rand_const</span>

        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">gold</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_or_global_2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rand_const </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">500</span><span class="s2">)</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(uint32[:,:], uint32)'</span><span class="s2">)(</span><span class="s1">atomic_or_global_2</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)](</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">orig </span><span class="s2">| </span><span class="s1">rand_const</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_xor</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rand_const </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">500</span><span class="s2">)</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">)</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(uint32[:], uint32)'</span><span class="s2">)(</span><span class="s1">atomic_xor</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">32</span><span class="s2">](</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">)</span>

        <span class="s1">gold </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s3">32</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">orig</span><span class="s2">.</span><span class="s1">size</span><span class="s2">):</span>
            <span class="s1">gold</span><span class="s2">[</span><span class="s1">orig</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]] ^= </span><span class="s1">rand_const</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">ary </span><span class="s2">== </span><span class="s1">gold</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_atomic_xor2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rand_const </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">500</span><span class="s2">)</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">cuda_atomic_xor2 </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(uint32[:,:], uint32)'</span><span class="s2">)(</span><span class="s1">atomic_xor2</span><span class="s2">)</span>
        <span class="s1">cuda_atomic_xor2</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)](</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">ary </span><span class="s2">== </span><span class="s1">orig </span><span class="s2">^ </span><span class="s1">rand_const</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_atomic_xor3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rand_const </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">500</span><span class="s2">)</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">cuda_atomic_xor3 </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(uint32[:,:], uint32)'</span><span class="s2">)(</span><span class="s1">atomic_xor3</span><span class="s2">)</span>
        <span class="s1">cuda_atomic_xor3</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)](</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">ary </span><span class="s2">== </span><span class="s1">orig </span><span class="s2">^ </span><span class="s1">rand_const</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_atomic_xor_global</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rand_const </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">500</span><span class="s2">)</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">)</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">)</span>
        <span class="s1">gold </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">sig </span><span class="s2">= </span><span class="s4">'void(int32[:], int32[:], int32)'</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">sig</span><span class="s2">)(</span><span class="s1">atomic_xor_global</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">32</span><span class="s2">](</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">)</span>

        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">size</span><span class="s2">):</span>
            <span class="s1">gold</span><span class="s2">[</span><span class="s1">idx</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]] ^= </span><span class="s1">rand_const</span>

        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">gold</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_xor_global_2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rand_const </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">500</span><span class="s2">)</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(uint32[:,:], uint32)'</span><span class="s2">)(</span><span class="s1">atomic_xor_global_2</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)](</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">orig </span><span class="s2">^ </span><span class="s1">rand_const</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">inc_dec_1dim_setup</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">):</span>
        <span class="s1">rconst </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">32</span><span class="s2">,  </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">dtype</span><span class="s2">)</span>
        <span class="s1">rary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">)</span>
        <span class="s1">ary_idx </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s3">32</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">dtype</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">rconst</span><span class="s2">, </span><span class="s1">rary</span><span class="s2">, </span><span class="s1">ary_idx</span>

    <span class="s0">def </span><span class="s1">inc_dec_2dim_setup</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">):</span>
        <span class="s1">rconst </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">32</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">dtype</span><span class="s2">)</span>
        <span class="s1">rary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">rconst</span><span class="s2">, </span><span class="s1">rary</span>

    <span class="s0">def </span><span class="s1">check_inc_index</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">rconst</span><span class="s2">, </span><span class="s1">sig</span><span class="s2">, </span><span class="s1">nblocks</span><span class="s2">, </span><span class="s1">blksize</span><span class="s2">, </span><span class="s1">func</span><span class="s2">):</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">sig</span><span class="s2">)(</span><span class="s1">func</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s1">nblocks</span><span class="s2">, </span><span class="s1">blksize</span><span class="s2">](</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">rconst</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">where</span><span class="s2">(</span><span class="s1">orig </span><span class="s2">&gt;= </span><span class="s1">rconst</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">orig </span><span class="s2">+ </span><span class="s3">1</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">check_inc_index2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">rconst</span><span class="s2">, </span><span class="s1">sig</span><span class="s2">, </span><span class="s1">nblocks</span><span class="s2">, </span><span class="s1">blksize</span><span class="s2">, </span><span class="s1">func</span><span class="s2">):</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">sig</span><span class="s2">)(</span><span class="s1">func</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s1">nblocks</span><span class="s2">, </span><span class="s1">blksize</span><span class="s2">](</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rconst</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">where</span><span class="s2">(</span><span class="s1">orig </span><span class="s2">&gt;= </span><span class="s1">rconst</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">orig </span><span class="s2">+ </span><span class="s3">1</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">check_inc</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rconst</span><span class="s2">, </span><span class="s1">sig</span><span class="s2">, </span><span class="s1">nblocks</span><span class="s2">, </span><span class="s1">blksize</span><span class="s2">, </span><span class="s1">func</span><span class="s2">):</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">sig</span><span class="s2">)(</span><span class="s1">func</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s1">nblocks</span><span class="s2">, </span><span class="s1">blksize</span><span class="s2">](</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rconst</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">where</span><span class="s2">(</span><span class="s1">orig </span><span class="s2">&gt;= </span><span class="s1">rconst</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">orig </span><span class="s2">+ </span><span class="s3">1</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_atomic_inc_32</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rand_const</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">inc_dec_1dim_setup</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">)</span>
        <span class="s1">sig </span><span class="s2">= </span><span class="s4">'void(uint32[:], uint32[:], uint32)'</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_inc_index</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">, </span><span class="s1">sig</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">atomic_inc32</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_inc_64</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rand_const</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">inc_dec_1dim_setup</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint64</span><span class="s2">)</span>
        <span class="s1">sig </span><span class="s2">= </span><span class="s4">'void(uint64[:], uint64[:], uint64)'</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_inc_index</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">, </span><span class="s1">sig</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">atomic_inc64</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_inc2_32</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rand_const</span><span class="s2">, </span><span class="s1">ary </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">inc_dec_2dim_setup</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">)</span>
        <span class="s1">sig </span><span class="s2">= </span><span class="s4">'void(uint32[:,:], uint32)'</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_inc</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">, </span><span class="s1">sig</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">,</span><span class="s3">8</span><span class="s2">), </span><span class="s1">atomic_inc2_32</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_inc2_64</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rand_const</span><span class="s2">, </span><span class="s1">ary </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">inc_dec_2dim_setup</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint64</span><span class="s2">)</span>
        <span class="s1">sig </span><span class="s2">= </span><span class="s4">'void(uint64[:,:], uint64)'</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_inc</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">, </span><span class="s1">sig</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">,</span><span class="s3">8</span><span class="s2">), </span><span class="s1">atomic_inc2_64</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_inc3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rand_const</span><span class="s2">, </span><span class="s1">ary </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">inc_dec_2dim_setup</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">)</span>
        <span class="s1">sig </span><span class="s2">= </span><span class="s4">'void(uint32[:,:], uint32)'</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_inc</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">, </span><span class="s1">sig</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">,</span><span class="s3">8</span><span class="s2">), </span><span class="s1">atomic_inc3</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_inc_global_32</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rand_const</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">inc_dec_1dim_setup</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">)</span>
        <span class="s1">sig </span><span class="s2">= </span><span class="s4">'void(uint32[:], uint32[:], uint32)'</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_inc_index2</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">, </span><span class="s1">sig</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">32</span><span class="s2">,</span>
                              <span class="s1">atomic_inc_global</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_inc_global_64</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rand_const</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">inc_dec_1dim_setup</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint64</span><span class="s2">)</span>
        <span class="s1">sig </span><span class="s2">= </span><span class="s4">'void(uint64[:], uint64[:], uint64)'</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_inc_index2</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">, </span><span class="s1">sig</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">32</span><span class="s2">,</span>
                              <span class="s1">atomic_inc_global</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_inc_global_2_32</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rand_const</span><span class="s2">, </span><span class="s1">ary </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">inc_dec_2dim_setup</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">)</span>
        <span class="s1">sig </span><span class="s2">= </span><span class="s4">'void(uint32[:,:], uint32)'</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_inc</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">, </span><span class="s1">sig</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">,</span><span class="s3">8</span><span class="s2">), </span><span class="s1">atomic_inc_global_2</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_inc_global_2_64</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rand_const</span><span class="s2">, </span><span class="s1">ary </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">inc_dec_2dim_setup</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint64</span><span class="s2">)</span>
        <span class="s1">sig </span><span class="s2">= </span><span class="s4">'void(uint64[:,:], uint64)'</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_inc</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">, </span><span class="s1">sig</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">,</span><span class="s3">8</span><span class="s2">), </span><span class="s1">atomic_inc_global_2</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">check_dec_index</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">rconst</span><span class="s2">, </span><span class="s1">sig</span><span class="s2">, </span><span class="s1">nblocks</span><span class="s2">, </span><span class="s1">blksize</span><span class="s2">, </span><span class="s1">func</span><span class="s2">):</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">sig</span><span class="s2">)(</span><span class="s1">func</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s1">nblocks</span><span class="s2">, </span><span class="s1">blksize</span><span class="s2">](</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">rconst</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">where</span><span class="s2">(</span><span class="s1">orig </span><span class="s2">== </span><span class="s3">0</span><span class="s2">, </span><span class="s1">rconst</span><span class="s2">,</span>
                                              <span class="s1">np</span><span class="s2">.</span><span class="s1">where</span><span class="s2">(</span><span class="s1">orig </span><span class="s2">&gt; </span><span class="s1">rconst</span><span class="s2">,</span>
                                                       <span class="s1">rconst</span><span class="s2">,</span>
                                                       <span class="s1">orig </span><span class="s2">- </span><span class="s3">1</span><span class="s2">)))</span>

    <span class="s0">def </span><span class="s1">check_dec_index2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">rconst</span><span class="s2">, </span><span class="s1">sig</span><span class="s2">, </span><span class="s1">nblocks</span><span class="s2">, </span><span class="s1">blksize</span><span class="s2">, </span><span class="s1">func</span><span class="s2">):</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">sig</span><span class="s2">)(</span><span class="s1">func</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s1">nblocks</span><span class="s2">, </span><span class="s1">blksize</span><span class="s2">](</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rconst</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">where</span><span class="s2">(</span><span class="s1">orig </span><span class="s2">== </span><span class="s3">0</span><span class="s2">, </span><span class="s1">rconst</span><span class="s2">,</span>
                                              <span class="s1">np</span><span class="s2">.</span><span class="s1">where</span><span class="s2">(</span><span class="s1">orig </span><span class="s2">&gt; </span><span class="s1">rconst</span><span class="s2">,</span>
                                                       <span class="s1">rconst</span><span class="s2">,</span>
                                                       <span class="s1">orig </span><span class="s2">- </span><span class="s3">1</span><span class="s2">)))</span>

    <span class="s0">def </span><span class="s1">check_dec</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rconst</span><span class="s2">, </span><span class="s1">sig</span><span class="s2">, </span><span class="s1">nblocks</span><span class="s2">, </span><span class="s1">blksize</span><span class="s2">, </span><span class="s1">func</span><span class="s2">):</span>
        <span class="s1">orig </span><span class="s2">= </span><span class="s1">ary</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">sig</span><span class="s2">)(</span><span class="s1">func</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s1">nblocks</span><span class="s2">, </span><span class="s1">blksize</span><span class="s2">](</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rconst</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">where</span><span class="s2">(</span><span class="s1">orig </span><span class="s2">== </span><span class="s3">0</span><span class="s2">, </span><span class="s1">rconst</span><span class="s2">,</span>
                                              <span class="s1">np</span><span class="s2">.</span><span class="s1">where</span><span class="s2">(</span><span class="s1">orig </span><span class="s2">&gt; </span><span class="s1">rconst</span><span class="s2">,</span>
                                                       <span class="s1">rconst</span><span class="s2">,</span>
                                                       <span class="s1">orig </span><span class="s2">- </span><span class="s3">1</span><span class="s2">)))</span>

    <span class="s0">def </span><span class="s1">test_atomic_dec_32</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rand_const</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">inc_dec_1dim_setup</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">)</span>
        <span class="s1">sig </span><span class="s2">= </span><span class="s4">'void(uint32[:], uint32[:], uint32)'</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_dec_index</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">, </span><span class="s1">sig</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">atomic_dec32</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_dec_64</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rand_const</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">inc_dec_1dim_setup</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint64</span><span class="s2">)</span>
        <span class="s1">sig </span><span class="s2">= </span><span class="s4">'void(uint64[:], uint64[:], uint64)'</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_dec_index</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">, </span><span class="s1">sig</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">atomic_dec64</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_dec2_32</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rand_const</span><span class="s2">, </span><span class="s1">ary </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">inc_dec_2dim_setup</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">)</span>
        <span class="s1">sig </span><span class="s2">= </span><span class="s4">'void(uint32[:,:], uint32)'</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_dec</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">, </span><span class="s1">sig</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">,</span><span class="s3">8</span><span class="s2">), </span><span class="s1">atomic_dec2_32</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_dec2_64</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rand_const</span><span class="s2">, </span><span class="s1">ary </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">inc_dec_2dim_setup</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint64</span><span class="s2">)</span>
        <span class="s1">sig </span><span class="s2">= </span><span class="s4">'void(uint64[:,:], uint64)'</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_dec</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">, </span><span class="s1">sig</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">,</span><span class="s3">8</span><span class="s2">), </span><span class="s1">atomic_dec2_64</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_dec3_new</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rand_const</span><span class="s2">, </span><span class="s1">ary </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">inc_dec_2dim_setup</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">)</span>
        <span class="s1">sig </span><span class="s2">= </span><span class="s4">'void(uint32[:,:], uint32)'</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_dec</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">, </span><span class="s1">sig</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">,</span><span class="s3">8</span><span class="s2">), </span><span class="s1">atomic_dec3</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_dec_global_32</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rand_const</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">inc_dec_1dim_setup</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">)</span>
        <span class="s1">sig </span><span class="s2">= </span><span class="s4">'void(uint32[:], uint32[:], uint32)'</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_dec_index2</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">, </span><span class="s1">sig</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">32</span><span class="s2">,</span>
                              <span class="s1">atomic_dec_global</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_dec_global_64</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rand_const</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">inc_dec_1dim_setup</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint64</span><span class="s2">)</span>
        <span class="s1">sig </span><span class="s2">= </span><span class="s4">'void(uint64[:], uint64[:], uint64)'</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_dec_index2</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">, </span><span class="s1">sig</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">32</span><span class="s2">,</span>
                              <span class="s1">atomic_dec_global</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_dec_global2_32</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rand_const</span><span class="s2">, </span><span class="s1">ary </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">inc_dec_2dim_setup</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">)</span>
        <span class="s1">sig </span><span class="s2">= </span><span class="s4">'void(uint32[:,:], uint32)'</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_dec</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">, </span><span class="s1">sig</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">,</span><span class="s3">8</span><span class="s2">), </span><span class="s1">atomic_dec_global_2</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_dec_global2_64</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rand_const</span><span class="s2">, </span><span class="s1">ary </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">inc_dec_2dim_setup</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint64</span><span class="s2">)</span>
        <span class="s1">sig </span><span class="s2">= </span><span class="s4">'void(uint64[:,:], uint64)'</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_dec</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">, </span><span class="s1">sig</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">,</span><span class="s3">8</span><span class="s2">), </span><span class="s1">atomic_dec_global_2</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_exch</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rand_const </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">50</span><span class="s2">, </span><span class="s3">100</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">)</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">)</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s3">32</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">)</span>

        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(uint32[:], uint32[:], uint32)'</span><span class="s2">)(</span><span class="s1">atomic_exch</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">32</span><span class="s2">](</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">)</span>

        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_exch2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rand_const </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">50</span><span class="s2">, </span><span class="s3">100</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">)</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)</span>

        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(uint32[:,:], uint32)'</span><span class="s2">)(</span><span class="s1">atomic_exch2</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)](</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_exch3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rand_const </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">50</span><span class="s2">, </span><span class="s3">100</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint64</span><span class="s2">)</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint64</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)</span>

        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(uint64[:,:], uint64)'</span><span class="s2">)(</span><span class="s1">atomic_exch3</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, (</span><span class="s3">4</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)](</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_exch_global</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rand_const </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">50</span><span class="s2">, </span><span class="s3">100</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">)</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s3">32</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">)</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">)</span>

        <span class="s1">sig </span><span class="s2">= </span><span class="s4">'void(uint32[:], uint32[:], uint32)'</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">sig</span><span class="s2">)(</span><span class="s1">atomic_exch_global</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">32</span><span class="s2">](</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ary</span><span class="s2">, </span><span class="s1">rand_const</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">check_atomic_max</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">lo</span><span class="s2">, </span><span class="s1">hi</span><span class="s2">):</span>
        <span class="s1">vals </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s1">lo</span><span class="s2">, </span><span class="s1">hi</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=(</span><span class="s3">32</span><span class="s2">, </span><span class="s3">32</span><span class="s2">)).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">)</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">vals</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">)</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">atomic_max</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">32</span><span class="s2">, </span><span class="s3">32</span><span class="s2">](</span><span class="s1">res</span><span class="s2">, </span><span class="s1">vals</span><span class="s2">)</span>
        <span class="s1">gold </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s1">vals</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">gold</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_max_int32</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_atomic_max</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">, </span><span class="s1">lo</span><span class="s2">=-</span><span class="s3">65535</span><span class="s2">, </span><span class="s1">hi</span><span class="s2">=</span><span class="s3">65535</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_max_uint32</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_atomic_max</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">, </span><span class="s1">lo</span><span class="s2">=</span><span class="s3">0</span><span class="s2">, </span><span class="s1">hi</span><span class="s2">=</span><span class="s3">65535</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_max_int64</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_atomic_max</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">, </span><span class="s1">lo</span><span class="s2">=-</span><span class="s3">65535</span><span class="s2">, </span><span class="s1">hi</span><span class="s2">=</span><span class="s3">65535</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_max_uint64</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_atomic_max</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint64</span><span class="s2">, </span><span class="s1">lo</span><span class="s2">=</span><span class="s3">0</span><span class="s2">, </span><span class="s1">hi</span><span class="s2">=</span><span class="s3">65535</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_max_float32</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_atomic_max</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">, </span><span class="s1">lo</span><span class="s2">=-</span><span class="s3">65535</span><span class="s2">, </span><span class="s1">hi</span><span class="s2">=</span><span class="s3">65535</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_max_double</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_atomic_max</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">, </span><span class="s1">lo</span><span class="s2">=-</span><span class="s3">65535</span><span class="s2">, </span><span class="s1">hi</span><span class="s2">=</span><span class="s3">65535</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_max_double_normalizedindex</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">vals </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">65535</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=(</span><span class="s3">32</span><span class="s2">, </span><span class="s3">32</span><span class="s2">)).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(float64[:], float64[:,:])'</span><span class="s2">)(</span>
            <span class="s1">atomic_max_double_normalizedindex</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">32</span><span class="s2">, </span><span class="s3">32</span><span class="s2">](</span><span class="s1">res</span><span class="s2">, </span><span class="s1">vals</span><span class="s2">)</span>

        <span class="s1">gold </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s1">vals</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">gold</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_max_double_oneindex</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">vals </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">128</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(float64[:], float64[:])'</span><span class="s2">)(</span>
            <span class="s1">atomic_max_double_oneindex</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">32</span><span class="s2">](</span><span class="s1">res</span><span class="s2">, </span><span class="s1">vals</span><span class="s2">)</span>

        <span class="s1">gold </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s1">vals</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">gold</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">check_atomic_min</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">lo</span><span class="s2">, </span><span class="s1">hi</span><span class="s2">):</span>
        <span class="s1">vals </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s1">lo</span><span class="s2">, </span><span class="s1">hi</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=(</span><span class="s3">32</span><span class="s2">, </span><span class="s3">32</span><span class="s2">)).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">)</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s3">65535</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">vals</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">)</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">atomic_min</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">32</span><span class="s2">, </span><span class="s3">32</span><span class="s2">](</span><span class="s1">res</span><span class="s2">, </span><span class="s1">vals</span><span class="s2">)</span>

        <span class="s1">gold </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">min</span><span class="s2">(</span><span class="s1">vals</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">gold</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_min_int32</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_atomic_min</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">, </span><span class="s1">lo</span><span class="s2">=-</span><span class="s3">65535</span><span class="s2">, </span><span class="s1">hi</span><span class="s2">=</span><span class="s3">65535</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_min_uint32</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_atomic_min</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">, </span><span class="s1">lo</span><span class="s2">=</span><span class="s3">0</span><span class="s2">, </span><span class="s1">hi</span><span class="s2">=</span><span class="s3">65535</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_min_int64</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_atomic_min</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">, </span><span class="s1">lo</span><span class="s2">=-</span><span class="s3">65535</span><span class="s2">, </span><span class="s1">hi</span><span class="s2">=</span><span class="s3">65535</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_min_uint64</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_atomic_min</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint64</span><span class="s2">, </span><span class="s1">lo</span><span class="s2">=</span><span class="s3">0</span><span class="s2">, </span><span class="s1">hi</span><span class="s2">=</span><span class="s3">65535</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_min_float</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_atomic_min</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">, </span><span class="s1">lo</span><span class="s2">=-</span><span class="s3">65535</span><span class="s2">, </span><span class="s1">hi</span><span class="s2">=</span><span class="s3">65535</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_min_double</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_atomic_min</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">, </span><span class="s1">lo</span><span class="s2">=-</span><span class="s3">65535</span><span class="s2">, </span><span class="s1">hi</span><span class="s2">=</span><span class="s3">65535</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_min_double_normalizedindex</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">vals </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">65535</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=(</span><span class="s3">32</span><span class="s2">, </span><span class="s3">32</span><span class="s2">)).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">) * </span><span class="s3">65535</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(float64[:], float64[:,:])'</span><span class="s2">)(</span>
            <span class="s1">atomic_min_double_normalizedindex</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">32</span><span class="s2">, </span><span class="s3">32</span><span class="s2">](</span><span class="s1">res</span><span class="s2">, </span><span class="s1">vals</span><span class="s2">)</span>

        <span class="s1">gold </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">min</span><span class="s2">(</span><span class="s1">vals</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">gold</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_min_double_oneindex</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">vals </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">128</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">) * </span><span class="s3">128</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(float64[:], float64[:])'</span><span class="s2">)(</span>
            <span class="s1">atomic_min_double_oneindex</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">32</span><span class="s2">](</span><span class="s1">res</span><span class="s2">, </span><span class="s1">vals</span><span class="s2">)</span>

        <span class="s1">gold </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">min</span><span class="s2">(</span><span class="s1">vals</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">gold</span><span class="s2">)</span>

    <span class="s5"># Taken together, _test_atomic_minmax_nan_location and</span>
    <span class="s5"># _test_atomic_minmax_nan_val check that NaNs are treated similarly to the</span>
    <span class="s5"># way they are in Python / NumPy - that is, {min,max}(a, b) == a if either</span>
    <span class="s5"># a or b is a NaN. For the atomics, this means that the max is taken as the</span>
    <span class="s5"># value stored in the memory location rather than the value supplied - i.e.</span>
    <span class="s5"># for:</span>
    <span class="s5">#</span>
    <span class="s5">#    cuda.atomic.{min,max}(ary, idx, val)</span>
    <span class="s5">#</span>
    <span class="s5"># the result will be ary[idx] for either of ary[idx] or val being NaN.</span>

    <span class="s0">def </span><span class="s1">_test_atomic_minmax_nan_location</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">func</span><span class="s2">):</span>

        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(float64[:], float64[:,:])'</span><span class="s2">)(</span><span class="s1">func</span><span class="s2">)</span>

        <span class="s1">vals </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">128</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=(</span><span class="s3">1</span><span class="s2">,</span><span class="s3">1</span><span class="s2">)).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">) + </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">](</span><span class="s1">res</span><span class="s2">, </span><span class="s1">vals</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">_test_atomic_minmax_nan_val</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">func</span><span class="s2">):</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(float64[:], float64[:,:])'</span><span class="s2">)(</span><span class="s1">func</span><span class="s2">)</span>

        <span class="s1">res </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">128</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">1</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
        <span class="s1">gold </span><span class="s2">= </span><span class="s1">res</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">vals </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">((</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">) + </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">](</span><span class="s1">res</span><span class="s2">, </span><span class="s1">vals</span><span class="s2">)</span>

        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">gold</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_min_nan_location</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_atomic_minmax_nan_location</span><span class="s2">(</span><span class="s1">atomic_min</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_max_nan_location</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_atomic_minmax_nan_location</span><span class="s2">(</span><span class="s1">atomic_max</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_min_nan_val</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_atomic_minmax_nan_val</span><span class="s2">(</span><span class="s1">atomic_min</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_max_nan_val</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_atomic_minmax_nan_val</span><span class="s2">(</span><span class="s1">atomic_max</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_max_double_shared</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">vals </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
        <span class="s1">sig </span><span class="s2">= </span><span class="s4">'void(float64[:], float64[:])'</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">sig</span><span class="s2">)(</span><span class="s1">atomic_max_double_shared</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">32</span><span class="s2">](</span><span class="s1">res</span><span class="s2">, </span><span class="s1">vals</span><span class="s2">)</span>

        <span class="s1">gold </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s1">vals</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">gold</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_min_double_shared</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">vals </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">) * </span><span class="s3">32</span>
        <span class="s1">sig </span><span class="s2">= </span><span class="s4">'void(float64[:], float64[:])'</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">sig</span><span class="s2">)(</span><span class="s1">atomic_min_double_shared</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">32</span><span class="s2">](</span><span class="s1">res</span><span class="s2">, </span><span class="s1">vals</span><span class="s2">)</span>

        <span class="s1">gold </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">min</span><span class="s2">(</span><span class="s1">vals</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">gold</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">check_cas</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">n</span><span class="s2">, </span><span class="s1">fill</span><span class="s2">, </span><span class="s1">unfill</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">cas_func</span><span class="s2">, </span><span class="s1">ndim</span><span class="s2">=</span><span class="s3">1</span><span class="s2">):</span>
        <span class="s1">res </span><span class="s2">= [</span><span class="s1">fill</span><span class="s2">] * (</span><span class="s1">n </span><span class="s2">// </span><span class="s3">2</span><span class="s2">) + [</span><span class="s1">unfill</span><span class="s2">] * (</span><span class="s1">n </span><span class="s2">// </span><span class="s3">2</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">shuffle</span><span class="s2">(</span><span class="s1">res</span><span class="s2">)</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">asarray</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">dtype</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">ndim </span><span class="s2">== </span><span class="s3">2</span><span class="s2">:</span>
            <span class="s1">res</span><span class="s2">.</span><span class="s1">shape </span><span class="s2">= (</span><span class="s3">10</span><span class="s2">, -</span><span class="s3">1</span><span class="s2">)</span>
        <span class="s1">out </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros_like</span><span class="s2">(</span><span class="s1">res</span><span class="s2">)</span>
        <span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">10</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s1">res</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">res</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">)</span>

        <span class="s1">fill_mask </span><span class="s2">= </span><span class="s1">res </span><span class="s2">== </span><span class="s1">fill</span>
        <span class="s1">unfill_mask </span><span class="s2">= </span><span class="s1">res </span><span class="s2">== </span><span class="s1">unfill</span>

        <span class="s1">expect_res </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros_like</span><span class="s2">(</span><span class="s1">res</span><span class="s2">)</span>
        <span class="s1">expect_res</span><span class="s2">[</span><span class="s1">fill_mask</span><span class="s2">] = </span><span class="s1">ary</span><span class="s2">[</span><span class="s1">fill_mask</span><span class="s2">]</span>
        <span class="s1">expect_res</span><span class="s2">[</span><span class="s1">unfill_mask</span><span class="s2">] = </span><span class="s1">unfill</span>

        <span class="s1">expect_out </span><span class="s2">= </span><span class="s1">res</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>

        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">cas_func</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">ndim </span><span class="s2">== </span><span class="s3">1</span><span class="s2">:</span>
            <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">10</span><span class="s2">, </span><span class="s3">10</span><span class="s2">](</span><span class="s1">res</span><span class="s2">, </span><span class="s1">out</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s1">fill</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">cuda_func</span><span class="s2">[(</span><span class="s3">10</span><span class="s2">, </span><span class="s3">10</span><span class="s2">), (</span><span class="s3">10</span><span class="s2">, </span><span class="s3">10</span><span class="s2">)](</span><span class="s1">res</span><span class="s2">, </span><span class="s1">out</span><span class="s2">, </span><span class="s1">ary</span><span class="s2">, </span><span class="s1">fill</span><span class="s2">)</span>

        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">expect_res</span><span class="s2">, </span><span class="s1">res</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">expect_out</span><span class="s2">, </span><span class="s1">out</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_compare_and_swap</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_cas</span><span class="s2">(</span><span class="s1">n</span><span class="s2">=</span><span class="s3">100</span><span class="s2">, </span><span class="s1">fill</span><span class="s2">=-</span><span class="s3">99</span><span class="s2">, </span><span class="s1">unfill</span><span class="s2">=-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">,</span>
                       <span class="s1">cas_func</span><span class="s2">=</span><span class="s1">atomic_compare_and_swap</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_compare_and_swap2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_cas</span><span class="s2">(</span><span class="s1">n</span><span class="s2">=</span><span class="s3">100</span><span class="s2">, </span><span class="s1">fill</span><span class="s2">=-</span><span class="s3">45</span><span class="s2">, </span><span class="s1">unfill</span><span class="s2">=-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">,</span>
                       <span class="s1">cas_func</span><span class="s2">=</span><span class="s1">atomic_compare_and_swap</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_compare_and_swap3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rfill </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">50</span><span class="s2">, </span><span class="s3">500</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">)</span>
        <span class="s1">runfill </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">25</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_cas</span><span class="s2">(</span><span class="s1">n</span><span class="s2">=</span><span class="s3">100</span><span class="s2">, </span><span class="s1">fill</span><span class="s2">=</span><span class="s1">rfill</span><span class="s2">, </span><span class="s1">unfill</span><span class="s2">=</span><span class="s1">runfill</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">,</span>
                       <span class="s1">cas_func</span><span class="s2">=</span><span class="s1">atomic_compare_and_swap</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_compare_and_swap4</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rfill </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">50</span><span class="s2">, </span><span class="s3">500</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint64</span><span class="s2">)</span>
        <span class="s1">runfill </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">25</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint64</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_cas</span><span class="s2">(</span><span class="s1">n</span><span class="s2">=</span><span class="s3">100</span><span class="s2">, </span><span class="s1">fill</span><span class="s2">=</span><span class="s1">rfill</span><span class="s2">, </span><span class="s1">unfill</span><span class="s2">=</span><span class="s1">runfill</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint64</span><span class="s2">,</span>
                       <span class="s1">cas_func</span><span class="s2">=</span><span class="s1">atomic_compare_and_swap</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_cas_1dim</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_cas</span><span class="s2">(</span><span class="s1">n</span><span class="s2">=</span><span class="s3">100</span><span class="s2">, </span><span class="s1">fill</span><span class="s2">=-</span><span class="s3">99</span><span class="s2">, </span><span class="s1">unfill</span><span class="s2">=-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">,</span>
                       <span class="s1">cas_func</span><span class="s2">=</span><span class="s1">atomic_cas_1dim</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_cas_2dim</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_cas</span><span class="s2">(</span><span class="s1">n</span><span class="s2">=</span><span class="s3">100</span><span class="s2">, </span><span class="s1">fill</span><span class="s2">=-</span><span class="s3">99</span><span class="s2">, </span><span class="s1">unfill</span><span class="s2">=-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">,</span>
                       <span class="s1">cas_func</span><span class="s2">=</span><span class="s1">atomic_cas_2dim</span><span class="s2">, </span><span class="s1">ndim</span><span class="s2">=</span><span class="s3">2</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_cas2_1dim</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_cas</span><span class="s2">(</span><span class="s1">n</span><span class="s2">=</span><span class="s3">100</span><span class="s2">, </span><span class="s1">fill</span><span class="s2">=-</span><span class="s3">45</span><span class="s2">, </span><span class="s1">unfill</span><span class="s2">=-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">,</span>
                       <span class="s1">cas_func</span><span class="s2">=</span><span class="s1">atomic_cas_1dim</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_cas2_2dim</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_cas</span><span class="s2">(</span><span class="s1">n</span><span class="s2">=</span><span class="s3">100</span><span class="s2">, </span><span class="s1">fill</span><span class="s2">=-</span><span class="s3">45</span><span class="s2">, </span><span class="s1">unfill</span><span class="s2">=-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">,</span>
                       <span class="s1">cas_func</span><span class="s2">=</span><span class="s1">atomic_cas_2dim</span><span class="s2">, </span><span class="s1">ndim</span><span class="s2">=</span><span class="s3">2</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_cas3_1dim</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rfill </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">50</span><span class="s2">, </span><span class="s3">500</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">)</span>
        <span class="s1">runfill </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">25</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_cas</span><span class="s2">(</span><span class="s1">n</span><span class="s2">=</span><span class="s3">100</span><span class="s2">, </span><span class="s1">fill</span><span class="s2">=</span><span class="s1">rfill</span><span class="s2">, </span><span class="s1">unfill</span><span class="s2">=</span><span class="s1">runfill</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">,</span>
                       <span class="s1">cas_func</span><span class="s2">=</span><span class="s1">atomic_cas_1dim</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_cas3_2dim</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rfill </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">50</span><span class="s2">, </span><span class="s3">500</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">)</span>
        <span class="s1">runfill </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">25</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_cas</span><span class="s2">(</span><span class="s1">n</span><span class="s2">=</span><span class="s3">100</span><span class="s2">, </span><span class="s1">fill</span><span class="s2">=</span><span class="s1">rfill</span><span class="s2">, </span><span class="s1">unfill</span><span class="s2">=</span><span class="s1">runfill</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">,</span>
                       <span class="s1">cas_func</span><span class="s2">=</span><span class="s1">atomic_cas_2dim</span><span class="s2">, </span><span class="s1">ndim</span><span class="s2">=</span><span class="s3">2</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_cas4_1dim</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rfill </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">50</span><span class="s2">, </span><span class="s3">500</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint64</span><span class="s2">)</span>
        <span class="s1">runfill </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">25</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint64</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_cas</span><span class="s2">(</span><span class="s1">n</span><span class="s2">=</span><span class="s3">100</span><span class="s2">, </span><span class="s1">fill</span><span class="s2">=</span><span class="s1">rfill</span><span class="s2">, </span><span class="s1">unfill</span><span class="s2">=</span><span class="s1">runfill</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint64</span><span class="s2">,</span>
                       <span class="s1">cas_func</span><span class="s2">=</span><span class="s1">atomic_cas_1dim</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_cas4_2dim</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rfill </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">50</span><span class="s2">, </span><span class="s3">500</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint64</span><span class="s2">)</span>
        <span class="s1">runfill </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">25</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint64</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_cas</span><span class="s2">(</span><span class="s1">n</span><span class="s2">=</span><span class="s3">100</span><span class="s2">, </span><span class="s1">fill</span><span class="s2">=</span><span class="s1">rfill</span><span class="s2">, </span><span class="s1">unfill</span><span class="s2">=</span><span class="s1">runfill</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint64</span><span class="s2">,</span>
                       <span class="s1">cas_func</span><span class="s2">=</span><span class="s1">atomic_cas_2dim</span><span class="s2">, </span><span class="s1">ndim</span><span class="s2">=</span><span class="s3">2</span><span class="s2">)</span>

    <span class="s5"># Tests that the atomic add, min, and max operations return the old value -</span>
    <span class="s5"># in the simulator, they did not (see Issue #5458). The max and min have</span>
    <span class="s5"># special handling for NaN values, so we explicitly test with a NaN in the</span>
    <span class="s5"># array being modified and the value provided.</span>

    <span class="s0">def </span><span class="s1">_test_atomic_returns_old</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">kernel</span><span class="s2">, </span><span class="s1">initial</span><span class="s2">):</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s3">2</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">)</span>
        <span class="s1">x</span><span class="s2">[</span><span class="s3">0</span><span class="s2">] = </span><span class="s1">initial</span>
        <span class="s1">kernel</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">](</span><span class="s1">x</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">np</span><span class="s2">.</span><span class="s1">isnan</span><span class="s2">(</span><span class="s1">initial</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">isnan</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s3">1</span><span class="s2">]))</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s3">1</span><span class="s2">], </span><span class="s1">initial</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_add_returns_old</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s2">@</span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span>
        <span class="s0">def </span><span class="s1">kernel</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s1">x</span><span class="s2">[</span><span class="s3">1</span><span class="s2">] = </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_atomic_returns_old</span><span class="s2">(</span><span class="s1">kernel</span><span class="s2">, </span><span class="s3">10</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_max_returns_no_replace</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s2">@</span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span>
        <span class="s0">def </span><span class="s1">kernel</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s1">x</span><span class="s2">[</span><span class="s3">1</span><span class="s2">] = </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_atomic_returns_old</span><span class="s2">(</span><span class="s1">kernel</span><span class="s2">, </span><span class="s3">10</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_max_returns_old_replace</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s2">@</span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span>
        <span class="s0">def </span><span class="s1">kernel</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s1">x</span><span class="s2">[</span><span class="s3">1</span><span class="s2">] = </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">10</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_atomic_returns_old</span><span class="s2">(</span><span class="s1">kernel</span><span class="s2">, </span><span class="s3">1</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_max_returns_old_nan_in_array</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s2">@</span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span>
        <span class="s0">def </span><span class="s1">kernel</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s1">x</span><span class="s2">[</span><span class="s3">1</span><span class="s2">] = </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_atomic_returns_old</span><span class="s2">(</span><span class="s1">kernel</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_max_returns_old_nan_val</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s2">@</span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span>
        <span class="s0">def </span><span class="s1">kernel</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s1">x</span><span class="s2">[</span><span class="s3">1</span><span class="s2">] = </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_atomic_returns_old</span><span class="s2">(</span><span class="s1">kernel</span><span class="s2">, </span><span class="s3">10</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_min_returns_old_no_replace</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s2">@</span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span>
        <span class="s0">def </span><span class="s1">kernel</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s1">x</span><span class="s2">[</span><span class="s3">1</span><span class="s2">] = </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">min</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">11</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_atomic_returns_old</span><span class="s2">(</span><span class="s1">kernel</span><span class="s2">, </span><span class="s3">10</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_min_returns_old_replace</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s2">@</span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span>
        <span class="s0">def </span><span class="s1">kernel</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s1">x</span><span class="s2">[</span><span class="s3">1</span><span class="s2">] = </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">min</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">10</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_atomic_returns_old</span><span class="s2">(</span><span class="s1">kernel</span><span class="s2">, </span><span class="s3">11</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_min_returns_old_nan_in_array</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s2">@</span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span>
        <span class="s0">def </span><span class="s1">kernel</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s1">x</span><span class="s2">[</span><span class="s3">1</span><span class="s2">] = </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">min</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">11</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_atomic_returns_old</span><span class="s2">(</span><span class="s1">kernel</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_min_returns_old_nan_val</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s2">@</span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span>
        <span class="s0">def </span><span class="s1">kernel</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s1">x</span><span class="s2">[</span><span class="s3">1</span><span class="s2">] = </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">min</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_atomic_returns_old</span><span class="s2">(</span><span class="s1">kernel</span><span class="s2">, </span><span class="s3">11</span><span class="s2">)</span>

    <span class="s5"># Tests for atomic nanmin/nanmax</span>

    <span class="s5"># nanmax tests</span>
    <span class="s0">def </span><span class="s1">check_atomic_nanmax</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">lo</span><span class="s2">, </span><span class="s1">hi</span><span class="s2">, </span><span class="s1">init_val</span><span class="s2">):</span>
        <span class="s1">vals </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s1">lo</span><span class="s2">, </span><span class="s1">hi</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=(</span><span class="s3">32</span><span class="s2">, </span><span class="s3">32</span><span class="s2">)).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">)</span>
        <span class="s1">vals</span><span class="s2">[</span><span class="s3">1</span><span class="s2">::</span><span class="s3">2</span><span class="s2">] = </span><span class="s1">init_val</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">vals</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">)</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">atomic_nanmax</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">32</span><span class="s2">, </span><span class="s3">32</span><span class="s2">](</span><span class="s1">res</span><span class="s2">, </span><span class="s1">vals</span><span class="s2">)</span>
        <span class="s1">gold </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nanmax</span><span class="s2">(</span><span class="s1">vals</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">gold</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_nanmax_int32</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_atomic_nanmax</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">, </span><span class="s1">lo</span><span class="s2">=-</span><span class="s3">65535</span><span class="s2">, </span><span class="s1">hi</span><span class="s2">=</span><span class="s3">65535</span><span class="s2">,</span>
                                 <span class="s1">init_val</span><span class="s2">=</span><span class="s3">0</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_nanmax_uint32</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_atomic_nanmax</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">, </span><span class="s1">lo</span><span class="s2">=</span><span class="s3">0</span><span class="s2">, </span><span class="s1">hi</span><span class="s2">=</span><span class="s3">65535</span><span class="s2">,</span>
                                 <span class="s1">init_val</span><span class="s2">=</span><span class="s3">0</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_nanmax_int64</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_atomic_nanmax</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">, </span><span class="s1">lo</span><span class="s2">=-</span><span class="s3">65535</span><span class="s2">, </span><span class="s1">hi</span><span class="s2">=</span><span class="s3">65535</span><span class="s2">,</span>
                                 <span class="s1">init_val</span><span class="s2">=</span><span class="s3">0</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_nanmax_uint64</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_atomic_nanmax</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint64</span><span class="s2">, </span><span class="s1">lo</span><span class="s2">=</span><span class="s3">0</span><span class="s2">, </span><span class="s1">hi</span><span class="s2">=</span><span class="s3">65535</span><span class="s2">,</span>
                                 <span class="s1">init_val</span><span class="s2">=</span><span class="s3">0</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_nanmax_float32</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_atomic_nanmax</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">, </span><span class="s1">lo</span><span class="s2">=-</span><span class="s3">65535</span><span class="s2">, </span><span class="s1">hi</span><span class="s2">=</span><span class="s3">65535</span><span class="s2">,</span>
                                 <span class="s1">init_val</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_nanmax_double</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_atomic_nanmax</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">, </span><span class="s1">lo</span><span class="s2">=-</span><span class="s3">65535</span><span class="s2">, </span><span class="s1">hi</span><span class="s2">=</span><span class="s3">65535</span><span class="s2">,</span>
                                 <span class="s1">init_val</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_nanmax_double_shared</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">vals </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
        <span class="s1">vals</span><span class="s2">[</span><span class="s3">1</span><span class="s2">::</span><span class="s3">2</span><span class="s2">] = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s3">0</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">vals</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">)</span>
        <span class="s1">sig </span><span class="s2">= </span><span class="s4">'void(float64[:], float64[:])'</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">sig</span><span class="s2">)(</span><span class="s1">atomic_nanmax_double_shared</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">32</span><span class="s2">](</span><span class="s1">res</span><span class="s2">, </span><span class="s1">vals</span><span class="s2">)</span>

        <span class="s1">gold </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nanmax</span><span class="s2">(</span><span class="s1">vals</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">gold</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_nanmax_double_oneindex</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">vals </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">128</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
        <span class="s1">vals</span><span class="s2">[</span><span class="s3">1</span><span class="s2">::</span><span class="s3">2</span><span class="s2">] = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(float64[:], float64[:])'</span><span class="s2">)(</span>
            <span class="s1">atomic_max_double_oneindex</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">32</span><span class="s2">](</span><span class="s1">res</span><span class="s2">, </span><span class="s1">vals</span><span class="s2">)</span>

        <span class="s1">gold </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nanmax</span><span class="s2">(</span><span class="s1">vals</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">gold</span><span class="s2">)</span>

    <span class="s5"># nanmin tests</span>
    <span class="s0">def </span><span class="s1">check_atomic_nanmin</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">lo</span><span class="s2">, </span><span class="s1">hi</span><span class="s2">, </span><span class="s1">init_val</span><span class="s2">):</span>
        <span class="s1">vals </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s1">lo</span><span class="s2">, </span><span class="s1">hi</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=(</span><span class="s3">32</span><span class="s2">, </span><span class="s3">32</span><span class="s2">)).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">)</span>
        <span class="s1">vals</span><span class="s2">[</span><span class="s3">1</span><span class="s2">::</span><span class="s3">2</span><span class="s2">] = </span><span class="s1">init_val</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s3">65535</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">vals</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">)</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">atomic_nanmin</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">32</span><span class="s2">, </span><span class="s3">32</span><span class="s2">](</span><span class="s1">res</span><span class="s2">, </span><span class="s1">vals</span><span class="s2">)</span>

        <span class="s1">gold </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nanmin</span><span class="s2">(</span><span class="s1">vals</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">gold</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_nanmin_int32</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_atomic_nanmin</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">, </span><span class="s1">lo</span><span class="s2">=-</span><span class="s3">65535</span><span class="s2">, </span><span class="s1">hi</span><span class="s2">=</span><span class="s3">65535</span><span class="s2">,</span>
                                 <span class="s1">init_val</span><span class="s2">=</span><span class="s3">0</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_nanmin_uint32</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_atomic_nanmin</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">, </span><span class="s1">lo</span><span class="s2">=</span><span class="s3">0</span><span class="s2">, </span><span class="s1">hi</span><span class="s2">=</span><span class="s3">65535</span><span class="s2">,</span>
                                 <span class="s1">init_val</span><span class="s2">=</span><span class="s3">0</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_nanmin_int64</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_atomic_nanmin</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">, </span><span class="s1">lo</span><span class="s2">=-</span><span class="s3">65535</span><span class="s2">, </span><span class="s1">hi</span><span class="s2">=</span><span class="s3">65535</span><span class="s2">,</span>
                                 <span class="s1">init_val</span><span class="s2">=</span><span class="s3">0</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_nanmin_uint64</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_atomic_nanmin</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint64</span><span class="s2">, </span><span class="s1">lo</span><span class="s2">=</span><span class="s3">0</span><span class="s2">, </span><span class="s1">hi</span><span class="s2">=</span><span class="s3">65535</span><span class="s2">,</span>
                                 <span class="s1">init_val</span><span class="s2">=</span><span class="s3">0</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_nanmin_float</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_atomic_nanmin</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">, </span><span class="s1">lo</span><span class="s2">=-</span><span class="s3">65535</span><span class="s2">, </span><span class="s1">hi</span><span class="s2">=</span><span class="s3">65535</span><span class="s2">,</span>
                                 <span class="s1">init_val</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_nanmin_double</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_atomic_nanmin</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">, </span><span class="s1">lo</span><span class="s2">=-</span><span class="s3">65535</span><span class="s2">, </span><span class="s1">hi</span><span class="s2">=</span><span class="s3">65535</span><span class="s2">,</span>
                                 <span class="s1">init_val</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_nanmin_double_shared</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">vals </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
        <span class="s1">vals</span><span class="s2">[</span><span class="s3">1</span><span class="s2">::</span><span class="s3">2</span><span class="s2">] = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s3">32</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">vals</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">)</span>
        <span class="s1">sig </span><span class="s2">= </span><span class="s4">'void(float64[:], float64[:])'</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">sig</span><span class="s2">)(</span><span class="s1">atomic_nanmin_double_shared</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">32</span><span class="s2">](</span><span class="s1">res</span><span class="s2">, </span><span class="s1">vals</span><span class="s2">)</span>

        <span class="s1">gold </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nanmin</span><span class="s2">(</span><span class="s1">vals</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">gold</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_nanmin_double_oneindex</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">vals </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">128</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">32</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
        <span class="s1">vals</span><span class="s2">[</span><span class="s3">1</span><span class="s2">::</span><span class="s3">2</span><span class="s2">] = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s3">128</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
        <span class="s1">cuda_func </span><span class="s2">= </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span><span class="s2">(</span><span class="s4">'void(float64[:], float64[:])'</span><span class="s2">)(</span>
            <span class="s1">atomic_min_double_oneindex</span><span class="s2">)</span>
        <span class="s1">cuda_func</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">32</span><span class="s2">](</span><span class="s1">res</span><span class="s2">, </span><span class="s1">vals</span><span class="s2">)</span>

        <span class="s1">gold </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nanmin</span><span class="s2">(</span><span class="s1">vals</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">gold</span><span class="s2">)</span>

    <span class="s5"># Returning old value tests</span>

    <span class="s0">def </span><span class="s1">_test_atomic_nan_returns_old</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">kernel</span><span class="s2">, </span><span class="s1">initial</span><span class="s2">):</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s3">2</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">)</span>
        <span class="s1">x</span><span class="s2">[</span><span class="s3">0</span><span class="s2">] = </span><span class="s1">initial</span>
        <span class="s1">x</span><span class="s2">[</span><span class="s3">1</span><span class="s2">] = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span>
        <span class="s1">kernel</span><span class="s2">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">](</span><span class="s1">x</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">np</span><span class="s2">.</span><span class="s1">isnan</span><span class="s2">(</span><span class="s1">initial</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertFalse</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">isnan</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s3">0</span><span class="s2">]))</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">isnan</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s3">1</span><span class="s2">]))</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s3">1</span><span class="s2">], </span><span class="s1">initial</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_nanmax_returns_old_no_replace</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s2">@</span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span>
        <span class="s0">def </span><span class="s1">kernel</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s1">x</span><span class="s2">[</span><span class="s3">1</span><span class="s2">] = </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">nanmax</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_atomic_nan_returns_old</span><span class="s2">(</span><span class="s1">kernel</span><span class="s2">, </span><span class="s3">10</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_nanmax_returns_old_replace</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s2">@</span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span>
        <span class="s0">def </span><span class="s1">kernel</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s1">x</span><span class="s2">[</span><span class="s3">1</span><span class="s2">] = </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">nanmax</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">10</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_atomic_nan_returns_old</span><span class="s2">(</span><span class="s1">kernel</span><span class="s2">, </span><span class="s3">1</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_nanmax_returns_old_nan_in_array</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s2">@</span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span>
        <span class="s0">def </span><span class="s1">kernel</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s1">x</span><span class="s2">[</span><span class="s3">1</span><span class="s2">] = </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">nanmax</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_atomic_nan_returns_old</span><span class="s2">(</span><span class="s1">kernel</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_nanmax_returns_old_nan_val</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s2">@</span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span>
        <span class="s0">def </span><span class="s1">kernel</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s1">x</span><span class="s2">[</span><span class="s3">1</span><span class="s2">] = </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">nanmax</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_atomic_nan_returns_old</span><span class="s2">(</span><span class="s1">kernel</span><span class="s2">, </span><span class="s3">10</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_nanmin_returns_old_no_replace</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s2">@</span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span>
        <span class="s0">def </span><span class="s1">kernel</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s1">x</span><span class="s2">[</span><span class="s3">1</span><span class="s2">] = </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">nanmin</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">11</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_atomic_nan_returns_old</span><span class="s2">(</span><span class="s1">kernel</span><span class="s2">, </span><span class="s3">10</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_nanmin_returns_old_replace</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s2">@</span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span>
        <span class="s0">def </span><span class="s1">kernel</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s1">x</span><span class="s2">[</span><span class="s3">1</span><span class="s2">] = </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">nanmin</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">10</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_atomic_nan_returns_old</span><span class="s2">(</span><span class="s1">kernel</span><span class="s2">, </span><span class="s3">11</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_nanmin_returns_old_nan_in_array</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s2">@</span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span>
        <span class="s0">def </span><span class="s1">kernel</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s1">x</span><span class="s2">[</span><span class="s3">1</span><span class="s2">] = </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">nanmin</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">11</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_atomic_nan_returns_old</span><span class="s2">(</span><span class="s1">kernel</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_atomic_nanmin_returns_old_nan_val</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s2">@</span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">jit</span>
        <span class="s0">def </span><span class="s1">kernel</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s1">x</span><span class="s2">[</span><span class="s3">1</span><span class="s2">] = </span><span class="s1">cuda</span><span class="s2">.</span><span class="s1">atomic</span><span class="s2">.</span><span class="s1">nanmin</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_atomic_nan_returns_old</span><span class="s2">(</span><span class="s1">kernel</span><span class="s2">, </span><span class="s3">11</span><span class="s2">)</span>


<span class="s0">if </span><span class="s1">__name__ </span><span class="s2">== </span><span class="s4">'__main__'</span><span class="s2">:</span>
    <span class="s1">unittest</span><span class="s2">.</span><span class="s1">main</span><span class="s2">()</span>
</pre>
</body>
</html>