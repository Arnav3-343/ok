<html>
<head>
<title>cuda_fp16.hpp</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #6aab73;}
.s4 { color: #2aacb8;}
.s5 { color: #c77dbb;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
cuda_fp16.hpp</font>
</center></td></tr></table>
<pre><span class="s0">/* 
* Copyright 1993-2020 NVIDIA Corporation.  All rights reserved. 
* 
* NOTICE TO LICENSEE: 
* 
* This source code and/or documentation (&quot;Licensed Deliverables&quot;) are 
* subject to NVIDIA intellectual property rights under U.S. and 
* international Copyright laws. 
* 
* These Licensed Deliverables contained herein is PROPRIETARY and 
* CONFIDENTIAL to NVIDIA and is being provided under the terms and 
* conditions of a form of NVIDIA software license agreement by and 
* between NVIDIA and Licensee (&quot;License Agreement&quot;) or electronically 
* accepted by Licensee.  Notwithstanding any terms or conditions to 
* the contrary in the License Agreement, reproduction or disclosure 
* of the Licensed Deliverables to any third party without the express 
* written consent of NVIDIA is prohibited. 
* 
* NOTWITHSTANDING ANY TERMS OR CONDITIONS TO THE CONTRARY IN THE 
* LICENSE AGREEMENT, NVIDIA MAKES NO REPRESENTATION ABOUT THE 
* SUITABILITY OF THESE LICENSED DELIVERABLES FOR ANY PURPOSE.  IT IS 
* PROVIDED &quot;AS IS&quot; WITHOUT EXPRESS OR IMPLIED WARRANTY OF ANY KIND. 
* NVIDIA DISCLAIMS ALL WARRANTIES WITH REGARD TO THESE LICENSED 
* DELIVERABLES, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY, 
* NONINFRINGEMENT, AND FITNESS FOR A PARTICULAR PURPOSE. 
* NOTWITHSTANDING ANY TERMS OR CONDITIONS TO THE CONTRARY IN THE 
* LICENSE AGREEMENT, IN NO EVENT SHALL NVIDIA BE LIABLE FOR ANY 
* SPECIAL, INDIRECT, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, OR ANY 
* DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, 
* WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS 
* ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE 
* OF THESE LICENSED DELIVERABLES. 
* 
* U.S. Government End Users.  These Licensed Deliverables are a 
* &quot;commercial item&quot; as that term is defined at 48 C.F.R. 2.101 (OCT 
* 1995), consisting of &quot;commercial computer software&quot; and &quot;commercial 
* computer software documentation&quot; as such terms are used in 48 
* C.F.R. 12.212 (SEPT 1995) and is provided to the U.S. Government 
* only as a commercial end item.  Consistent with 48 C.F.R.12.212 and 
* 48 C.F.R. 227.7202-1 through 227.7202-4 (JUNE 1995), all 
* U.S. Government End Users acquire the Licensed Deliverables with 
* only those rights set forth herein. 
* 
* Any use of the Licensed Deliverables in individual and commercial 
* software must include, in the user documentation and internal 
* comments to the code, the above Disclaimer and U.S. Government End 
* Users Notice. 
*/</span>

<span class="s2">#if </span><span class="s1">!defined(__CUDA_FP16_HPP__)</span>
<span class="s2">#define </span><span class="s1">__CUDA_FP16_HPP__</span>

<span class="s2">#if </span><span class="s1">!defined(__CUDA_FP16_H__)</span>
<span class="s2">#error </span><span class="s3">&quot;Do not include this file directly. Instead, include cuda_fp16.h.&quot;</span>
<span class="s2">#endif</span>

<span class="s2">#if </span><span class="s1">!defined(_MSC_VER) &amp;&amp; __cplusplus &gt;= </span><span class="s4">201103</span><span class="s1">L</span>
<span class="s1">#   define __CPP_VERSION_AT_LEAST_11_FP16</span>
<span class="s1">#elif _MSC_FULL_VER &gt;= </span><span class="s4">190024210 </span><span class="s1">&amp;&amp; _MSVC_LANG &gt;= </span><span class="s4">201103</span><span class="s1">L</span>
<span class="s1">#   define __CPP_VERSION_AT_LEAST_11_FP16</span>
<span class="s2">#endif</span>

<span class="s0">/* C++11 header for std::move.  
 * In RTC mode, std::move is provided implicitly; don't include the header 
 */</span>
<span class="s2">#if </span><span class="s1">defined(__CPP_VERSION_AT_LEAST_11_FP16) &amp;&amp; !defined(__CUDACC_RTC__)</span>
<span class="s2">#include </span><span class="s1">&lt;utility&gt;</span>
<span class="s2">#endif </span><span class="s0">/* __cplusplus &gt;= 201103L &amp;&amp; !defined(__CUDACC_RTC__) */</span>

<span class="s0">/* C++ header for std::memcpy (used for type punning in host-side implementations). 
 * When compiling as a CUDA source file memcpy is provided implicitly. 
 * !defined(__CUDACC__) implies !defined(__CUDACC_RTC__). 
 */</span>
<span class="s2">#if </span><span class="s1">defined(__cplusplus) &amp;&amp; !defined(__CUDACC__)</span>
<span class="s2">#include </span><span class="s1">&lt;cstring&gt;</span>
<span class="s2">#endif </span><span class="s0">/* defined(__cplusplus) &amp;&amp; !defined(__CUDACC__) */</span>


<span class="s0">/* Set up function decorations */</span>
<span class="s2">#if </span><span class="s1">defined(__CUDACC__)</span>
<span class="s2">#define </span><span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">static </span><span class="s1">__device__ __inline__</span>
<span class="s2">#define </span><span class="s1">__CUDA_HOSTDEVICE_FP16_DECL__ </span><span class="s2">static </span><span class="s1">__host__ __device__ __inline__</span>
<span class="s2">#define </span><span class="s1">__VECTOR_FUNCTIONS_DECL__ </span><span class="s2">static </span><span class="s1">__inline__ __host__ __device__</span>
<span class="s2">#define </span><span class="s1">__CUDA_HOSTDEVICE__ __host__ __device__</span>
<span class="s2">#else </span><span class="s0">/* !defined(__CUDACC__) */</span>
<span class="s2">#if </span><span class="s1">defined(__GNUC__)</span>
<span class="s2">#define </span><span class="s1">__CUDA_HOSTDEVICE_FP16_DECL__ </span><span class="s2">static </span><span class="s1">__attribute__ ((unused))</span>
<span class="s2">#else</span>
<span class="s2">#define </span><span class="s1">__CUDA_HOSTDEVICE_FP16_DECL__ </span><span class="s2">static</span>
<span class="s2">#endif </span><span class="s0">/* defined(__GNUC__) */</span>
<span class="s2">#define </span><span class="s1">__CUDA_HOSTDEVICE__</span>
<span class="s2">#endif </span><span class="s0">/* defined(__CUDACC_) */</span>

<span class="s0">/* Set up structure-alignment attribute */</span>
<span class="s2">#if </span><span class="s1">defined(__CUDACC__)</span>
<span class="s2">#define </span><span class="s1">__CUDA_ALIGN__(align) __align__(align)</span>
<span class="s2">#else</span>
<span class="s0">/* Define alignment macro based on compiler type (cannot assume C11 &quot;_Alignas&quot; is available) */</span>
<span class="s2">#if </span><span class="s1">__cplusplus &gt;= </span><span class="s4">201103</span><span class="s1">L</span>
<span class="s2">#define </span><span class="s1">__CUDA_ALIGN__(n) alignas(n)    </span><span class="s0">/* C++11 kindly gives us a keyword for this */</span>
<span class="s2">#else </span><span class="s0">/* !defined(__CPP_VERSION_AT_LEAST_11_FP16)*/</span>
<span class="s2">#if </span><span class="s1">defined(__GNUC__)</span>
<span class="s2">#define </span><span class="s1">__CUDA_ALIGN__(n) __attribute__ ((aligned(n)))</span>
<span class="s1">#elif defined(_MSC_VER)</span>
<span class="s2">#define </span><span class="s1">__CUDA_ALIGN__(n) __declspec(align(n))</span>
<span class="s2">#else</span>
<span class="s2">#define </span><span class="s1">__CUDA_ALIGN__(n)</span>
<span class="s2">#endif </span><span class="s0">/* defined(__GNUC__) */</span>
<span class="s2">#endif </span><span class="s0">/* defined(__CPP_VERSION_AT_LEAST_11_FP16) */</span>
<span class="s2">#endif </span><span class="s0">/* defined(__CUDACC__) */</span>

<span class="s0">/* Macros to allow half &amp; half2 to be used by inline assembly */</span>
<span class="s2">#define </span><span class="s1">__HALF_TO_US(var) *(</span><span class="s5">reinterpret_cast</span><span class="s1">&lt;</span><span class="s2">unsigned short </span><span class="s1">*&gt;(&amp;(var)))</span>
<span class="s2">#define </span><span class="s1">__HALF_TO_CUS(var) *(</span><span class="s5">reinterpret_cast</span><span class="s1">&lt;</span><span class="s2">const unsigned short </span><span class="s1">*&gt;(&amp;(var)))</span>
<span class="s2">#define </span><span class="s1">__HALF2_TO_UI(var) *(</span><span class="s5">reinterpret_cast</span><span class="s1">&lt;</span><span class="s2">unsigned int </span><span class="s1">*&gt;(&amp;(var)))</span>
<span class="s2">#define </span><span class="s1">__HALF2_TO_CUI(var) *(</span><span class="s5">reinterpret_cast</span><span class="s1">&lt;</span><span class="s2">const unsigned int </span><span class="s1">*&gt;(&amp;(var)))</span>

<span class="s0">/* Macros for half &amp; half2 binary arithmetic */</span>
<span class="s2">#define </span><span class="s1">__BINARY_OP_HALF_MACRO(name) </span><span class="s0">/* do */ </span><span class="s1">{\</span>
   <span class="s1">__half val; \</span>
   <span class="s5">asm</span><span class="s1">( </span><span class="s3">&quot;{&quot;</span><span class="s1">#name</span><span class="s3">&quot;.f16 %0,%1,%2;</span><span class="s2">\n</span><span class="s3">}&quot; </span><span class="s1">\</span>
        <span class="s1">:</span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(val)) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(a)),</span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(b))); \</span>
   <span class="s2">return </span><span class="s1">val; \</span>
<span class="s1">} </span><span class="s0">/* while(0) */</span>
<span class="s2">#define </span><span class="s1">__BINARY_OP_HALF2_MACRO(name) </span><span class="s0">/* do */ </span><span class="s1">{\</span>
   <span class="s1">__half2 val; \</span>
   <span class="s5">asm</span><span class="s1">( </span><span class="s3">&quot;{&quot;</span><span class="s1">#name</span><span class="s3">&quot;.f16x2 %0,%1,%2;</span><span class="s2">\n</span><span class="s3">}&quot; </span><span class="s1">\</span>
        <span class="s1">:</span><span class="s3">&quot;=r&quot;</span><span class="s1">(__HALF2_TO_UI(val)) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(a)),</span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(b))); \</span>
   <span class="s2">return </span><span class="s1">val; \</span>
<span class="s1">} </span><span class="s0">/* while(0) */</span>
<span class="s2">#define </span><span class="s1">__TERNARY_OP_HALF_MACRO(name) </span><span class="s0">/* do */ </span><span class="s1">{\</span>
   <span class="s1">__half val; \</span>
   <span class="s5">asm</span><span class="s1">( </span><span class="s3">&quot;{&quot;</span><span class="s1">#name</span><span class="s3">&quot;.f16 %0,%1,%2,%3;</span><span class="s2">\n</span><span class="s3">}&quot; </span><span class="s1">\</span>
        <span class="s1">:</span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(val)) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(a)),</span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(b)),</span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(c))); \</span>
   <span class="s2">return </span><span class="s1">val; \</span>
<span class="s1">} </span><span class="s0">/* while(0) */</span>
<span class="s2">#define </span><span class="s1">__TERNARY_OP_HALF2_MACRO(name) </span><span class="s0">/* do */ </span><span class="s1">{\</span>
   <span class="s1">__half2 val; \</span>
   <span class="s5">asm</span><span class="s1">( </span><span class="s3">&quot;{&quot;</span><span class="s1">#name</span><span class="s3">&quot;.f16x2 %0,%1,%2,%3;</span><span class="s2">\n</span><span class="s3">}&quot; </span><span class="s1">\</span>
        <span class="s1">:</span><span class="s3">&quot;=r&quot;</span><span class="s1">(__HALF2_TO_UI(val)) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(a)),</span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(b)),</span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(c))); \</span>
   <span class="s2">return </span><span class="s1">val; \</span>
<span class="s1">} </span><span class="s0">/* while(0) */</span>

<span class="s0">/** 
* Types which allow static initialization of &quot;half&quot; and &quot;half2&quot; until 
* these become an actual builtin. Note this initialization is as a 
* bitfield representation of &quot;half&quot;, and not a conversion from short-&gt;half. 
* Such a representation will be deprecated in a future version of CUDA.  
* (Note these are visible to non-nvcc compilers, including C-only compilation) 
*/</span>
<span class="s2">typedef struct </span><span class="s1">__CUDA_ALIGN__(</span><span class="s4">2</span><span class="s1">) {</span>
    <span class="s2">unsigned short </span><span class="s1">x;</span>
<span class="s1">} __half_raw;</span>

<span class="s2">typedef struct </span><span class="s1">__CUDA_ALIGN__(</span><span class="s4">4</span><span class="s1">) {</span>
    <span class="s2">unsigned short </span><span class="s1">x;</span>
    <span class="s2">unsigned short </span><span class="s1">y;</span>
<span class="s1">} __half2_raw;</span>

<span class="s0">/* All other definitions in this file are only visible to C++ compilers */</span>
<span class="s2">#if </span><span class="s1">defined(__cplusplus)</span>

<span class="s0">/* Hide GCC member initialization list warnings because of host/device in-function init requirement */</span>
<span class="s2">#if </span><span class="s1">defined(__GNUC__)</span>
<span class="s2">#if </span><span class="s1">__GNUC__ &gt; </span><span class="s4">4 </span><span class="s1">|| (__GNUC__ == </span><span class="s4">4 </span><span class="s1">&amp;&amp; __GNUC_MINOR__ &gt;= </span><span class="s4">6</span><span class="s1">)</span>
<span class="s1">#pragma GCC diagnostic push</span>
<span class="s1">#pragma GCC diagnostic ignored </span><span class="s3">&quot;-Wstrict-aliasing&quot;</span>
<span class="s1">#pragma GCC diagnostic ignored </span><span class="s3">&quot;-Weffc++&quot;</span>
<span class="s2">#endif </span><span class="s0">/* __GNUC__ &gt; 4 || (__GNUC__ == 4 &amp;&amp; __GNUC_MINOR__ &gt;= 6) */</span>
<span class="s2">#endif </span><span class="s0">/* defined(__GNUC__) */</span>

<span class="s0">/* class' : multiple assignment operators specified 
   The class has multiple assignment operators of a single type. This warning is informational */</span>
<span class="s2">#if </span><span class="s1">defined(_MSC_VER) &amp;&amp; _MSC_VER &gt;= </span><span class="s4">1500</span>
<span class="s1">#pragma warning( push )</span>
<span class="s1">#pragma warning( disable:</span><span class="s4">4522 </span><span class="s1">)</span>
<span class="s2">#endif </span><span class="s0">/* defined(__GNUC__) */</span>

<span class="s2">struct </span><span class="s1">__CUDA_ALIGN__(</span><span class="s4">2</span><span class="s1">) __half {</span>
<span class="s5">protected</span><span class="s1">:</span>
    <span class="s2">unsigned short </span><span class="s1">__x;</span>

<span class="s5">public</span><span class="s1">:</span>
<span class="s2">#if </span><span class="s1">defined(__CPP_VERSION_AT_LEAST_11_FP16)</span>
    <span class="s1">__half() = </span><span class="s2">default</span><span class="s1">;</span>
<span class="s2">#else</span>
    <span class="s1">__CUDA_HOSTDEVICE__ __half() { }</span>
<span class="s2">#endif </span><span class="s0">/* defined(__CPP_VERSION_AT_LEAST_11_FP16) */</span>

    <span class="s0">/* Convert to/from __half_raw */</span>
    <span class="s1">__CUDA_HOSTDEVICE__ __half(</span><span class="s2">const </span><span class="s1">__half_raw &amp;hr) : __x(hr.x) { }</span>
    <span class="s1">__CUDA_HOSTDEVICE__ __half &amp;</span><span class="s5">operator</span><span class="s1">=(</span><span class="s2">const </span><span class="s1">__half_raw &amp;hr) { __x = hr.x; </span><span class="s2">return </span><span class="s1">*</span><span class="s5">this</span><span class="s1">; }</span>
    <span class="s1">__CUDA_HOSTDEVICE__ </span><span class="s2">volatile </span><span class="s1">__half &amp;</span><span class="s5">operator</span><span class="s1">=(</span><span class="s2">const </span><span class="s1">__half_raw &amp;hr) </span><span class="s2">volatile </span><span class="s1">{ __x = hr.x; </span><span class="s2">return </span><span class="s1">*</span><span class="s5">this</span><span class="s1">; }</span>
    <span class="s1">__CUDA_HOSTDEVICE__ </span><span class="s2">volatile </span><span class="s1">__half &amp;</span><span class="s5">operator</span><span class="s1">=(</span><span class="s2">const volatile </span><span class="s1">__half_raw &amp;hr) </span><span class="s2">volatile </span><span class="s1">{ __x = hr.x; </span><span class="s2">return </span><span class="s1">*</span><span class="s5">this</span><span class="s1">; }</span>
    <span class="s1">__CUDA_HOSTDEVICE__ </span><span class="s5">operator </span><span class="s1">__half_raw() </span><span class="s2">const </span><span class="s1">{ __half_raw ret; ret.x = __x; </span><span class="s2">return </span><span class="s1">ret; }</span>
    <span class="s1">__CUDA_HOSTDEVICE__ </span><span class="s5">operator </span><span class="s1">__half_raw() </span><span class="s2">const volatile </span><span class="s1">{ __half_raw ret; ret.x = __x; </span><span class="s2">return </span><span class="s1">ret; }</span>

<span class="s2">#if </span><span class="s1">!defined(__CUDA_NO_HALF_CONVERSIONS__)</span>

    <span class="s0">/* Construct from float/double */</span>
    <span class="s1">__CUDA_HOSTDEVICE__ __half(</span><span class="s2">const float </span><span class="s1">f) { __x = __float2half(f).__x;  }</span>
    <span class="s1">__CUDA_HOSTDEVICE__ __half(</span><span class="s2">const double </span><span class="s1">f) { __x = __double2half(f).__x;  }</span>

    <span class="s1">__CUDA_HOSTDEVICE__ </span><span class="s5">operator </span><span class="s2">float</span><span class="s1">() </span><span class="s2">const </span><span class="s1">{ </span><span class="s2">return </span><span class="s1">__half2float(*</span><span class="s5">this</span><span class="s1">); }</span>
    <span class="s1">__CUDA_HOSTDEVICE__ __half &amp;</span><span class="s5">operator</span><span class="s1">=(</span><span class="s2">const float </span><span class="s1">f) { __x = __float2half(f).__x; </span><span class="s2">return </span><span class="s1">*</span><span class="s5">this</span><span class="s1">; }</span>

    <span class="s0">/* We omit &quot;cast to double&quot; operator, so as to not be ambiguous about up-cast */</span>
    <span class="s1">__CUDA_HOSTDEVICE__ __half &amp;</span><span class="s5">operator</span><span class="s1">=(</span><span class="s2">const double </span><span class="s1">f) { __x = __double2half(f).__x; </span><span class="s2">return </span><span class="s1">*</span><span class="s5">this</span><span class="s1">; }</span>

<span class="s0">/* Member functions only available to nvcc compilation so far */</span>
<span class="s2">#if </span><span class="s1">defined(__CUDACC__)</span>
    <span class="s0">/* Allow automatic construction from types supported natively in hardware */</span>
    <span class="s0">/* Note we do avoid constructor init-list because of special host/device compilation rules */</span>
    <span class="s1">__CUDA_HOSTDEVICE__ __half(</span><span class="s2">const short </span><span class="s1">val) { __x = __short2half_rn(val).__x;  }</span>
    <span class="s1">__CUDA_HOSTDEVICE__ __half(</span><span class="s2">const unsigned short </span><span class="s1">val) { __x = __ushort2half_rn(val).__x;  }</span>
    <span class="s1">__CUDA_HOSTDEVICE__ __half(</span><span class="s2">const int </span><span class="s1">val) { __x = __int2half_rn(val).__x;  }</span>
    <span class="s1">__CUDA_HOSTDEVICE__ __half(</span><span class="s2">const unsigned int </span><span class="s1">val) { __x = __uint2half_rn(val).__x;  }</span>
    <span class="s1">__CUDA_HOSTDEVICE__ __half(</span><span class="s2">const long long </span><span class="s1">val) { __x = __ll2half_rn(val).__x;  }</span>
    <span class="s1">__CUDA_HOSTDEVICE__ __half(</span><span class="s2">const unsigned long long </span><span class="s1">val) { __x = __ull2half_rn(val).__x; }</span>

    <span class="s0">/* Allow automatic casts to supported builtin types, matching all that are permitted with float */</span>
    <span class="s1">__CUDA_HOSTDEVICE__ </span><span class="s5">operator </span><span class="s2">short</span><span class="s1">() </span><span class="s2">const </span><span class="s1">{ </span><span class="s2">return </span><span class="s1">__half2short_rz(*</span><span class="s5">this</span><span class="s1">); }</span>
    <span class="s1">__CUDA_HOSTDEVICE__ __half &amp;</span><span class="s5">operator</span><span class="s1">=(</span><span class="s2">const short </span><span class="s1">val) { __x = __short2half_rn(val).__x; </span><span class="s2">return </span><span class="s1">*</span><span class="s5">this</span><span class="s1">; }</span>

    <span class="s1">__CUDA_HOSTDEVICE__ </span><span class="s5">operator </span><span class="s2">unsigned short</span><span class="s1">() </span><span class="s2">const </span><span class="s1">{ </span><span class="s2">return </span><span class="s1">__half2ushort_rz(*</span><span class="s5">this</span><span class="s1">); }</span>
    <span class="s1">__CUDA_HOSTDEVICE__ __half &amp;</span><span class="s5">operator</span><span class="s1">=(</span><span class="s2">const unsigned short </span><span class="s1">val) { __x = __ushort2half_rn(val).__x; </span><span class="s2">return </span><span class="s1">*</span><span class="s5">this</span><span class="s1">; }</span>

    <span class="s1">__CUDA_HOSTDEVICE__ </span><span class="s5">operator </span><span class="s2">int</span><span class="s1">() </span><span class="s2">const </span><span class="s1">{ </span><span class="s2">return </span><span class="s1">__half2int_rz(*</span><span class="s5">this</span><span class="s1">); }</span>
    <span class="s1">__CUDA_HOSTDEVICE__ __half &amp;</span><span class="s5">operator</span><span class="s1">=(</span><span class="s2">const int </span><span class="s1">val) { __x = __int2half_rn(val).__x; </span><span class="s2">return </span><span class="s1">*</span><span class="s5">this</span><span class="s1">; }</span>

    <span class="s1">__CUDA_HOSTDEVICE__ </span><span class="s5">operator </span><span class="s2">unsigned int</span><span class="s1">() </span><span class="s2">const </span><span class="s1">{ </span><span class="s2">return </span><span class="s1">__half2uint_rz(*</span><span class="s5">this</span><span class="s1">); }</span>
    <span class="s1">__CUDA_HOSTDEVICE__ __half &amp;</span><span class="s5">operator</span><span class="s1">=(</span><span class="s2">const unsigned int </span><span class="s1">val) { __x = __uint2half_rn(val).__x; </span><span class="s2">return </span><span class="s1">*</span><span class="s5">this</span><span class="s1">; }</span>

    <span class="s1">__CUDA_HOSTDEVICE__ </span><span class="s5">operator </span><span class="s2">long long</span><span class="s1">() </span><span class="s2">const </span><span class="s1">{ </span><span class="s2">return </span><span class="s1">__half2ll_rz(*</span><span class="s5">this</span><span class="s1">); }</span>
    <span class="s1">__CUDA_HOSTDEVICE__ __half &amp;</span><span class="s5">operator</span><span class="s1">=(</span><span class="s2">const long long </span><span class="s1">val) { __x = __ll2half_rn(val).__x; </span><span class="s2">return </span><span class="s1">*</span><span class="s5">this</span><span class="s1">; }</span>

    <span class="s1">__CUDA_HOSTDEVICE__ </span><span class="s5">operator </span><span class="s2">unsigned long long</span><span class="s1">() </span><span class="s2">const </span><span class="s1">{ </span><span class="s2">return </span><span class="s1">__half2ull_rz(*</span><span class="s5">this</span><span class="s1">); }</span>
    <span class="s1">__CUDA_HOSTDEVICE__ __half &amp;</span><span class="s5">operator</span><span class="s1">=(</span><span class="s2">const unsigned long long </span><span class="s1">val) { __x = __ull2half_rn(val).__x; </span><span class="s2">return </span><span class="s1">*</span><span class="s5">this</span><span class="s1">; }</span>

    <span class="s0">/* Boolean conversion - note both 0 and -0 must return false */</span>
    <span class="s1">__CUDA_HOSTDEVICE__ </span><span class="s5">operator </span><span class="s2">bool</span><span class="s1">() </span><span class="s2">const </span><span class="s1">{ </span><span class="s2">return </span><span class="s1">(__x &amp; </span><span class="s4">0x7FFF</span><span class="s1">U) != </span><span class="s4">0</span><span class="s1">U; }</span>
<span class="s2">#endif </span><span class="s0">/* defined(__CUDACC__) */</span>
<span class="s2">#endif </span><span class="s0">/* !defined(__CUDA_NO_HALF_CONVERSIONS__) */</span>
<span class="s1">};</span>

<span class="s0">/* Global-space operator functions are only available to nvcc compilation */</span>
<span class="s2">#if </span><span class="s1">defined(__CUDACC__)</span>

<span class="s0">/* Arithmetic FP16 operations only supported on arch &gt;= 5.3 */</span>
<span class="s2">#if </span><span class="s1">__CUDA_ARCH__ &gt;= </span><span class="s4">530 </span><span class="s1">|| !defined(__CUDA_ARCH__)</span>
<span class="s2">#if </span><span class="s1">!defined(__CUDA_NO_HALF_OPERATORS__)</span>
<span class="s0">/* Some basic arithmetic operations expected of a builtin */</span>
<span class="s1">__device__ __forceinline__ __half </span><span class="s5">operator</span><span class="s1">+(</span><span class="s2">const </span><span class="s1">__half &amp;lh, </span><span class="s2">const </span><span class="s1">__half &amp;rh) { </span><span class="s2">return </span><span class="s1">__hadd(lh, rh); }</span>
<span class="s1">__device__ __forceinline__ __half </span><span class="s5">operator</span><span class="s1">-(</span><span class="s2">const </span><span class="s1">__half &amp;lh, </span><span class="s2">const </span><span class="s1">__half &amp;rh) { </span><span class="s2">return </span><span class="s1">__hsub(lh, rh); }</span>
<span class="s1">__device__ __forceinline__ __half </span><span class="s5">operator</span><span class="s1">*(</span><span class="s2">const </span><span class="s1">__half &amp;lh, </span><span class="s2">const </span><span class="s1">__half &amp;rh) { </span><span class="s2">return </span><span class="s1">__hmul(lh, rh); }</span>
<span class="s1">__device__ __forceinline__ __half </span><span class="s5">operator</span><span class="s1">/(</span><span class="s2">const </span><span class="s1">__half &amp;lh, </span><span class="s2">const </span><span class="s1">__half &amp;rh) { </span><span class="s2">return </span><span class="s1">__hdiv(lh, rh); }</span>

<span class="s1">__device__ __forceinline__ __half &amp;</span><span class="s5">operator</span><span class="s1">+=(__half &amp;lh, </span><span class="s2">const </span><span class="s1">__half &amp;rh) { lh = __hadd(lh, rh); </span><span class="s2">return </span><span class="s1">lh; }</span>
<span class="s1">__device__ __forceinline__ __half &amp;</span><span class="s5">operator</span><span class="s1">-=(__half &amp;lh, </span><span class="s2">const </span><span class="s1">__half &amp;rh) { lh = __hsub(lh, rh); </span><span class="s2">return </span><span class="s1">lh; }</span>
<span class="s1">__device__ __forceinline__ __half &amp;</span><span class="s5">operator</span><span class="s1">*=(__half &amp;lh, </span><span class="s2">const </span><span class="s1">__half &amp;rh) { lh = __hmul(lh, rh); </span><span class="s2">return </span><span class="s1">lh; }</span>
<span class="s1">__device__ __forceinline__ __half &amp;</span><span class="s5">operator</span><span class="s1">/=(__half &amp;lh, </span><span class="s2">const </span><span class="s1">__half &amp;rh) { lh = __hdiv(lh, rh); </span><span class="s2">return </span><span class="s1">lh; }</span>

<span class="s0">/* Note for increment and decrement we use the raw value 0x3C00U equating to half(1.0F), to avoid the extra conversion */</span>
<span class="s1">__device__ __forceinline__ __half &amp;</span><span class="s5">operator</span><span class="s1">++(__half &amp;h)      { __half_raw one; one.x = </span><span class="s4">0x3C00</span><span class="s1">U; h += one; </span><span class="s2">return </span><span class="s1">h; }</span>
<span class="s1">__device__ __forceinline__ __half &amp;</span><span class="s5">operator</span><span class="s1">--(__half &amp;h)      { __half_raw one; one.x = </span><span class="s4">0x3C00</span><span class="s1">U; h -= one; </span><span class="s2">return </span><span class="s1">h; }</span>
<span class="s1">__device__ __forceinline__ __half  </span><span class="s5">operator</span><span class="s1">++(__half &amp;h, </span><span class="s2">const int </span><span class="s1">ignored) { </span><span class="s2">const </span><span class="s1">__half ret = h; __half_raw one; one.x = </span><span class="s4">0x3C00</span><span class="s1">U; h += one; </span><span class="s2">return </span><span class="s1">ret; }</span>
<span class="s1">__device__ __forceinline__ __half  </span><span class="s5">operator</span><span class="s1">--(__half &amp;h, </span><span class="s2">const int </span><span class="s1">ignored) { </span><span class="s2">const </span><span class="s1">__half ret = h; __half_raw one; one.x = </span><span class="s4">0x3C00</span><span class="s1">U; h -= one; </span><span class="s2">return </span><span class="s1">ret; }</span>

<span class="s0">/* Unary plus and inverse operators */</span>
<span class="s1">__device__ __forceinline__ __half </span><span class="s5">operator</span><span class="s1">+(</span><span class="s2">const </span><span class="s1">__half &amp;h) { </span><span class="s2">return </span><span class="s1">h; }</span>
<span class="s1">__device__ __forceinline__ __half </span><span class="s5">operator</span><span class="s1">-(</span><span class="s2">const </span><span class="s1">__half &amp;h) { </span><span class="s2">return </span><span class="s1">__hneg(h); }</span>

<span class="s0">/* Some basic comparison operations to make it look like a builtin */</span>
<span class="s1">__device__ __forceinline__ </span><span class="s2">bool </span><span class="s5">operator</span><span class="s1">==(</span><span class="s2">const </span><span class="s1">__half &amp;lh, </span><span class="s2">const </span><span class="s1">__half &amp;rh) { </span><span class="s2">return </span><span class="s1">__heq(lh, rh); }</span>
<span class="s1">__device__ __forceinline__ </span><span class="s2">bool </span><span class="s5">operator</span><span class="s1">!=(</span><span class="s2">const </span><span class="s1">__half &amp;lh, </span><span class="s2">const </span><span class="s1">__half &amp;rh) { </span><span class="s2">return </span><span class="s1">__hneu(lh, rh); }</span>
<span class="s1">__device__ __forceinline__ </span><span class="s2">bool </span><span class="s5">operator</span><span class="s1">&gt; (</span><span class="s2">const </span><span class="s1">__half &amp;lh, </span><span class="s2">const </span><span class="s1">__half &amp;rh) { </span><span class="s2">return </span><span class="s1">__hgt(lh, rh); }</span>
<span class="s1">__device__ __forceinline__ </span><span class="s2">bool </span><span class="s5">operator</span><span class="s1">&lt; (</span><span class="s2">const </span><span class="s1">__half &amp;lh, </span><span class="s2">const </span><span class="s1">__half &amp;rh) { </span><span class="s2">return </span><span class="s1">__hlt(lh, rh); }</span>
<span class="s1">__device__ __forceinline__ </span><span class="s2">bool </span><span class="s5">operator</span><span class="s1">&gt;=(</span><span class="s2">const </span><span class="s1">__half &amp;lh, </span><span class="s2">const </span><span class="s1">__half &amp;rh) { </span><span class="s2">return </span><span class="s1">__hge(lh, rh); }</span>
<span class="s1">__device__ __forceinline__ </span><span class="s2">bool </span><span class="s5">operator</span><span class="s1">&lt;=(</span><span class="s2">const </span><span class="s1">__half &amp;lh, </span><span class="s2">const </span><span class="s1">__half &amp;rh) { </span><span class="s2">return </span><span class="s1">__hle(lh, rh); }</span>
<span class="s2">#endif </span><span class="s0">/* !defined(__CUDA_NO_HALF_OPERATORS__) */</span>
<span class="s2">#endif </span><span class="s0">/* __CUDA_ARCH__ &gt;= 530 || !defined(__CUDA_ARCH__) */</span>
<span class="s2">#endif </span><span class="s0">/* defined(__CUDACC__) */</span>

<span class="s0">/* __half2 is visible to non-nvcc host compilers */</span>
<span class="s2">struct </span><span class="s1">__CUDA_ALIGN__(</span><span class="s4">4</span><span class="s1">) __half2 {</span>
    <span class="s1">__half x;</span>
    <span class="s1">__half y;</span>

    <span class="s0">// All construct/copy/assign/move</span>
<span class="s5">public</span><span class="s1">:</span>
<span class="s2">#if </span><span class="s1">defined(__CPP_VERSION_AT_LEAST_11_FP16)</span>
    <span class="s1">__half2() = </span><span class="s2">default</span><span class="s1">;</span>
    <span class="s1">__CUDA_HOSTDEVICE__ __half2(</span><span class="s2">const </span><span class="s1">__half2 &amp;&amp;src) { __HALF2_TO_UI(*</span><span class="s5">this</span><span class="s1">) = std::move(__HALF2_TO_CUI(src)); }</span>
    <span class="s1">__CUDA_HOSTDEVICE__ __half2 &amp;</span><span class="s5">operator</span><span class="s1">=(</span><span class="s2">const </span><span class="s1">__half2 &amp;&amp;src) { __HALF2_TO_UI(*</span><span class="s5">this</span><span class="s1">) = std::move(__HALF2_TO_CUI(src)); </span><span class="s2">return </span><span class="s1">*</span><span class="s5">this</span><span class="s1">; }</span>
<span class="s2">#else</span>
    <span class="s1">__CUDA_HOSTDEVICE__ __half2() { }</span>
<span class="s2">#endif </span><span class="s0">/* defined(__CPP_VERSION_AT_LEAST_11_FP16) */</span>
    <span class="s1">__CUDA_HOSTDEVICE__ __half2(</span><span class="s2">const </span><span class="s1">__half &amp;a, </span><span class="s2">const </span><span class="s1">__half &amp;b) : x(a), y(b) { }</span>
    <span class="s1">__CUDA_HOSTDEVICE__ __half2(</span><span class="s2">const </span><span class="s1">__half2 &amp;src) { __HALF2_TO_UI(*</span><span class="s5">this</span><span class="s1">) = __HALF2_TO_CUI(src); }</span>
    <span class="s1">__CUDA_HOSTDEVICE__ __half2 &amp;</span><span class="s5">operator</span><span class="s1">=(</span><span class="s2">const </span><span class="s1">__half2 &amp;src) { __HALF2_TO_UI(*</span><span class="s5">this</span><span class="s1">) = __HALF2_TO_CUI(src); </span><span class="s2">return </span><span class="s1">*</span><span class="s5">this</span><span class="s1">; }</span>

    <span class="s0">/* Convert to/from __half2_raw */</span>
    <span class="s1">__CUDA_HOSTDEVICE__ __half2(</span><span class="s2">const </span><span class="s1">__half2_raw &amp;h2r ) { __HALF2_TO_UI(*</span><span class="s5">this</span><span class="s1">) = __HALF2_TO_CUI(h2r); }</span>
    <span class="s1">__CUDA_HOSTDEVICE__ __half2 &amp;</span><span class="s5">operator</span><span class="s1">=(</span><span class="s2">const </span><span class="s1">__half2_raw &amp;h2r) { __HALF2_TO_UI(*</span><span class="s5">this</span><span class="s1">) = __HALF2_TO_CUI(h2r); </span><span class="s2">return </span><span class="s1">*</span><span class="s5">this</span><span class="s1">; }</span>
    <span class="s1">__CUDA_HOSTDEVICE__ </span><span class="s5">operator </span><span class="s1">__half2_raw() </span><span class="s2">const </span><span class="s1">{ __half2_raw ret; ret.x = </span><span class="s4">0</span><span class="s1">U; ret.y = </span><span class="s4">0</span><span class="s1">U; __HALF2_TO_UI(ret) = __HALF2_TO_CUI(*</span><span class="s5">this</span><span class="s1">); </span><span class="s2">return </span><span class="s1">ret; }</span>
<span class="s1">};</span>

<span class="s0">/* Global-space operator functions are only available to nvcc compilation */</span>
<span class="s2">#if </span><span class="s1">defined(__CUDACC__)</span>

<span class="s0">/* Arithmetic FP16x2 operations only supported on arch &gt;= 5.3 */</span>
<span class="s2">#if </span><span class="s1">(__CUDA_ARCH__ &gt;= </span><span class="s4">530 </span><span class="s1">|| !defined(__CUDA_ARCH__)) &amp;&amp; !defined(__CUDA_NO_HALF2_OPERATORS__)</span>

<span class="s1">__device__ __forceinline__ __half2 </span><span class="s5">operator</span><span class="s1">+(</span><span class="s2">const </span><span class="s1">__half2 &amp;lh, </span><span class="s2">const </span><span class="s1">__half2 &amp;rh) { </span><span class="s2">return </span><span class="s1">__hadd2(lh, rh); }</span>
<span class="s1">__device__ __forceinline__ __half2 </span><span class="s5">operator</span><span class="s1">-(</span><span class="s2">const </span><span class="s1">__half2 &amp;lh, </span><span class="s2">const </span><span class="s1">__half2 &amp;rh) { </span><span class="s2">return </span><span class="s1">__hsub2(lh, rh); }</span>
<span class="s1">__device__ __forceinline__ __half2 </span><span class="s5">operator</span><span class="s1">*(</span><span class="s2">const </span><span class="s1">__half2 &amp;lh, </span><span class="s2">const </span><span class="s1">__half2 &amp;rh) { </span><span class="s2">return </span><span class="s1">__hmul2(lh, rh); }</span>
<span class="s1">__device__ __forceinline__ __half2 </span><span class="s5">operator</span><span class="s1">/(</span><span class="s2">const </span><span class="s1">__half2 &amp;lh, </span><span class="s2">const </span><span class="s1">__half2 &amp;rh) { </span><span class="s2">return </span><span class="s1">__h2div(lh, rh); }</span>

<span class="s1">__device__ __forceinline__ __half2&amp; </span><span class="s5">operator</span><span class="s1">+=(__half2 &amp;lh, </span><span class="s2">const </span><span class="s1">__half2 &amp;rh) { lh = __hadd2(lh, rh); </span><span class="s2">return </span><span class="s1">lh; }</span>
<span class="s1">__device__ __forceinline__ __half2&amp; </span><span class="s5">operator</span><span class="s1">-=(__half2 &amp;lh, </span><span class="s2">const </span><span class="s1">__half2 &amp;rh) { lh = __hsub2(lh, rh); </span><span class="s2">return </span><span class="s1">lh; }</span>
<span class="s1">__device__ __forceinline__ __half2&amp; </span><span class="s5">operator</span><span class="s1">*=(__half2 &amp;lh, </span><span class="s2">const </span><span class="s1">__half2 &amp;rh) { lh = __hmul2(lh, rh); </span><span class="s2">return </span><span class="s1">lh; }</span>
<span class="s1">__device__ __forceinline__ __half2&amp; </span><span class="s5">operator</span><span class="s1">/=(__half2 &amp;lh, </span><span class="s2">const </span><span class="s1">__half2 &amp;rh) { lh = __h2div(lh, rh); </span><span class="s2">return </span><span class="s1">lh; }</span>

<span class="s1">__device__ __forceinline__ __half2 &amp;</span><span class="s5">operator</span><span class="s1">++(__half2 &amp;h)      { __half2_raw one; one.x = </span><span class="s4">0x3C00</span><span class="s1">U; one.y = </span><span class="s4">0x3C00</span><span class="s1">U; h = __hadd2(h, one); </span><span class="s2">return </span><span class="s1">h; }</span>
<span class="s1">__device__ __forceinline__ __half2 &amp;</span><span class="s5">operator</span><span class="s1">--(__half2 &amp;h)      { __half2_raw one; one.x = </span><span class="s4">0x3C00</span><span class="s1">U; one.y = </span><span class="s4">0x3C00</span><span class="s1">U; h = __hsub2(h, one); </span><span class="s2">return </span><span class="s1">h; }</span>
<span class="s1">__device__ __forceinline__ __half2  </span><span class="s5">operator</span><span class="s1">++(__half2 &amp;h, </span><span class="s2">const int </span><span class="s1">ignored) { </span><span class="s2">const </span><span class="s1">__half2 ret = h; __half2_raw one; one.x = </span><span class="s4">0x3C00</span><span class="s1">U; one.y = </span><span class="s4">0x3C00</span><span class="s1">U; h = __hadd2(h, one); </span><span class="s2">return </span><span class="s1">ret; }</span>
<span class="s1">__device__ __forceinline__ __half2  </span><span class="s5">operator</span><span class="s1">--(__half2 &amp;h, </span><span class="s2">const int </span><span class="s1">ignored) { </span><span class="s2">const </span><span class="s1">__half2 ret = h; __half2_raw one; one.x = </span><span class="s4">0x3C00</span><span class="s1">U; one.y = </span><span class="s4">0x3C00</span><span class="s1">U; h = __hsub2(h, one); </span><span class="s2">return </span><span class="s1">ret; }</span>

<span class="s1">__device__ __forceinline__ __half2 </span><span class="s5">operator</span><span class="s1">+(</span><span class="s2">const </span><span class="s1">__half2 &amp;h) { </span><span class="s2">return </span><span class="s1">h; }</span>
<span class="s1">__device__ __forceinline__ __half2 </span><span class="s5">operator</span><span class="s1">-(</span><span class="s2">const </span><span class="s1">__half2 &amp;h) { </span><span class="s2">return </span><span class="s1">__hneg2(h); }</span>

<span class="s1">__device__ __forceinline__ </span><span class="s2">bool </span><span class="s5">operator</span><span class="s1">==(</span><span class="s2">const </span><span class="s1">__half2 &amp;lh, </span><span class="s2">const </span><span class="s1">__half2 &amp;rh) { </span><span class="s2">return </span><span class="s1">__hbeq2(lh, rh); }</span>
<span class="s1">__device__ __forceinline__ </span><span class="s2">bool </span><span class="s5">operator</span><span class="s1">!=(</span><span class="s2">const </span><span class="s1">__half2 &amp;lh, </span><span class="s2">const </span><span class="s1">__half2 &amp;rh) { </span><span class="s2">return </span><span class="s1">__hbneu2(lh, rh); }</span>
<span class="s1">__device__ __forceinline__ </span><span class="s2">bool </span><span class="s5">operator</span><span class="s1">&gt;(</span><span class="s2">const </span><span class="s1">__half2 &amp;lh, </span><span class="s2">const </span><span class="s1">__half2 &amp;rh) { </span><span class="s2">return </span><span class="s1">__hbgt2(lh, rh); }</span>
<span class="s1">__device__ __forceinline__ </span><span class="s2">bool </span><span class="s5">operator</span><span class="s1">&lt;(</span><span class="s2">const </span><span class="s1">__half2 &amp;lh, </span><span class="s2">const </span><span class="s1">__half2 &amp;rh) { </span><span class="s2">return </span><span class="s1">__hblt2(lh, rh); }</span>
<span class="s1">__device__ __forceinline__ </span><span class="s2">bool </span><span class="s5">operator</span><span class="s1">&gt;=(</span><span class="s2">const </span><span class="s1">__half2 &amp;lh, </span><span class="s2">const </span><span class="s1">__half2 &amp;rh) { </span><span class="s2">return </span><span class="s1">__hbge2(lh, rh); }</span>
<span class="s1">__device__ __forceinline__ </span><span class="s2">bool </span><span class="s5">operator</span><span class="s1">&lt;=(</span><span class="s2">const </span><span class="s1">__half2 &amp;lh, </span><span class="s2">const </span><span class="s1">__half2 &amp;rh) { </span><span class="s2">return </span><span class="s1">__hble2(lh, rh); }</span>

<span class="s2">#endif </span><span class="s0">/* __CUDA_ARCH__ &gt;= 530 || !defined(__CUDA_ARCH__) */</span>
<span class="s2">#endif </span><span class="s0">/* defined(__CUDACC__) */</span>

<span class="s0">/* Restore warning for multiple assignment operators */</span>
<span class="s2">#if </span><span class="s1">defined(_MSC_VER) &amp;&amp; _MSC_VER &gt;= </span><span class="s4">1500</span>
<span class="s1">#pragma warning( pop )</span>
<span class="s2">#endif </span><span class="s0">/* defined(_MSC_VER) &amp;&amp; _MSC_VER &gt;= 1500 */</span>

<span class="s0">/* Restore -Weffc++ warnings from here on */</span>
<span class="s2">#if </span><span class="s1">defined(__GNUC__)</span>
<span class="s2">#if </span><span class="s1">__GNUC__ &gt; </span><span class="s4">4 </span><span class="s1">|| (__GNUC__ == </span><span class="s4">4 </span><span class="s1">&amp;&amp; __GNUC_MINOR__ &gt;= </span><span class="s4">6</span><span class="s1">)</span>
<span class="s1">#pragma GCC diagnostic pop</span>
<span class="s2">#endif </span><span class="s0">/* __GNUC__ &gt; 4 || (__GNUC__ == 4 &amp;&amp; __GNUC_MINOR__ &gt;= 6) */</span>
<span class="s2">#endif </span><span class="s0">/* defined(__GNUC__) */</span>

<span class="s2">#undef </span><span class="s1">__CUDA_HOSTDEVICE__</span>
<span class="s2">#undef </span><span class="s1">__CUDA_ALIGN__</span>

<span class="s2">#ifndef </span><span class="s1">__CUDACC_RTC__  </span><span class="s0">/* no host functions in NVRTC mode */</span>
<span class="s2">static </span><span class="s5">inline </span><span class="s2">unsigned short </span><span class="s1">__internal_float2half(</span><span class="s2">const float </span><span class="s1">f, </span><span class="s2">unsigned int </span><span class="s1">&amp;sign, </span><span class="s2">unsigned int </span><span class="s1">&amp;remainder)</span>
<span class="s1">{</span>
    <span class="s2">unsigned int </span><span class="s1">x;</span>
    <span class="s2">unsigned int </span><span class="s1">u;</span>
    <span class="s2">unsigned int </span><span class="s1">result;</span>
<span class="s2">#if </span><span class="s1">defined(__CUDACC__)</span>
    <span class="s1">(</span><span class="s2">void</span><span class="s1">)memcpy(&amp;x, &amp;f, </span><span class="s2">sizeof</span><span class="s1">(f));</span>
<span class="s2">#else</span>
    <span class="s1">(</span><span class="s2">void</span><span class="s1">)std::memcpy(&amp;x, &amp;f, </span><span class="s2">sizeof</span><span class="s1">(f));</span>
<span class="s2">#endif</span>
    <span class="s1">u = (x &amp; </span><span class="s4">0x7fffffff</span><span class="s1">U);</span>
    <span class="s1">sign = ((x &gt;&gt; </span><span class="s4">16</span><span class="s1">U) &amp; </span><span class="s4">0x8000</span><span class="s1">U);</span>
    <span class="s0">// NaN/+Inf/-Inf</span>
    <span class="s2">if </span><span class="s1">(u &gt;= </span><span class="s4">0x7f800000</span><span class="s1">U) {</span>
        <span class="s1">remainder = </span><span class="s4">0</span><span class="s1">U;</span>
        <span class="s1">result = ((u == </span><span class="s4">0x7f800000</span><span class="s1">U) ? (sign | </span><span class="s4">0x7c00</span><span class="s1">U) : </span><span class="s4">0x7fff</span><span class="s1">U);</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(u &gt; </span><span class="s4">0x477fefff</span><span class="s1">U) { </span><span class="s0">// Overflows</span>
        <span class="s1">remainder = </span><span class="s4">0x80000000</span><span class="s1">U;</span>
        <span class="s1">result = (sign | </span><span class="s4">0x7bff</span><span class="s1">U);</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(u &gt;= </span><span class="s4">0x38800000</span><span class="s1">U) { </span><span class="s0">// Normal numbers</span>
        <span class="s1">remainder = u &lt;&lt; </span><span class="s4">19</span><span class="s1">U;</span>
        <span class="s1">u -= </span><span class="s4">0x38000000</span><span class="s1">U;</span>
        <span class="s1">result = (sign | (u &gt;&gt; </span><span class="s4">13</span><span class="s1">U));</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(u &lt; </span><span class="s4">0x33000001</span><span class="s1">U) { </span><span class="s0">// +0/-0</span>
        <span class="s1">remainder = u;</span>
        <span class="s1">result = sign;</span>
    <span class="s1">} </span><span class="s2">else </span><span class="s1">{ </span><span class="s0">// Denormal numbers</span>
        <span class="s2">const unsigned int </span><span class="s1">exponent = u &gt;&gt; </span><span class="s4">23</span><span class="s1">U;</span>
        <span class="s2">const unsigned int </span><span class="s1">shift = </span><span class="s4">0x7e</span><span class="s1">U - exponent;</span>
        <span class="s2">unsigned int </span><span class="s1">mantissa = (u &amp; </span><span class="s4">0x7fffff</span><span class="s1">U);</span>
        <span class="s1">mantissa |= </span><span class="s4">0x800000</span><span class="s1">U;</span>
        <span class="s1">remainder = mantissa &lt;&lt; (</span><span class="s4">32</span><span class="s1">U - shift);</span>
        <span class="s1">result = (sign | (mantissa &gt;&gt; shift));</span>
    <span class="s1">}</span>
    <span class="s2">return </span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">unsigned short</span><span class="s1">&gt;(result);</span>
<span class="s1">}</span>
<span class="s2">#endif  </span><span class="s0">/* #if !defined(__CUDACC_RTC__) */</span>

<span class="s1">__CUDA_HOSTDEVICE_FP16_DECL__ __half __double2half(</span><span class="s2">const double </span><span class="s1">a)</span>
<span class="s1">{</span>
<span class="s2">#if </span><span class="s1">defined(__CUDA_ARCH__)</span>
    <span class="s1">__half val;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{  cvt.rn.f16.f64 %0, %1;}</span><span class="s2">\n</span><span class="s3">&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(val)) : </span><span class="s3">&quot;d&quot;</span><span class="s1">(a));</span>
    <span class="s2">return </span><span class="s1">val;</span>
<span class="s2">#else</span>
    <span class="s1">__half result;</span>
    <span class="s0">// Perform rounding to 11 bits of precision, convert value</span>
    <span class="s0">// to float and call existing float to half conversion.</span>
    <span class="s0">// By pre-rounding to 11 bits we avoid additional rounding</span>
    <span class="s0">// in float to half conversion.</span>
    <span class="s2">unsigned long long int </span><span class="s1">absa;</span>
    <span class="s2">unsigned long long int </span><span class="s1">ua;</span>
    <span class="s2">#if </span><span class="s1">defined(__CUDACC__)</span>
        <span class="s1">(</span><span class="s2">void</span><span class="s1">)memcpy(&amp;ua, &amp;a, </span><span class="s2">sizeof</span><span class="s1">(a));</span>
    <span class="s2">#else</span>
        <span class="s1">(</span><span class="s2">void</span><span class="s1">)std::memcpy(&amp;ua, &amp;a, </span><span class="s2">sizeof</span><span class="s1">(a));</span>
    <span class="s2">#endif</span>
    <span class="s1">absa = (ua &amp; </span><span class="s4">0x7fffffffffffffff</span><span class="s1">ULL);</span>
    <span class="s2">if </span><span class="s1">((absa &gt;= </span><span class="s4">0x40f0000000000000</span><span class="s1">ULL) || (absa &lt;= </span><span class="s4">0x3e60000000000000</span><span class="s1">ULL))</span>
    <span class="s1">{</span>
        <span class="s0">// |a| &gt;= 2^16 or NaN or |a| &lt;= 2^(-25)</span>
        <span class="s0">// double-rounding is not a problem</span>
        <span class="s1">result = __float2half(</span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">float</span><span class="s1">&gt;(a));</span>
    <span class="s1">}</span>
    <span class="s2">else</span>
    <span class="s1">{</span>
        <span class="s0">// here 2^(-25) &lt; |a| &lt; 2^16</span>
        <span class="s0">// prepare shifter value such that a + shifter</span>
        <span class="s0">// done in double precision performs round-to-nearest-even</span>
        <span class="s0">// and (a + shifter) - shifter results in a rounded to</span>
        <span class="s0">// 11 bits of precision. Shifter needs to have exponent of</span>
        <span class="s0">// a plus 53 - 11 = 42 and a leading bit in mantissa to guard</span>
        <span class="s0">// against negative values.</span>
        <span class="s0">// So need to have |a| capped to avoid overflow in exponent.</span>
        <span class="s0">// For inputs that are smaller than half precision minnorm</span>
        <span class="s0">// we prepare fixed shifter exponent.</span>
        <span class="s2">unsigned long long </span><span class="s1">shifterBits;</span>
        <span class="s2">if </span><span class="s1">(absa &gt;= </span><span class="s4">0x3f10000000000000</span><span class="s1">ULL)</span>
        <span class="s1">{   </span><span class="s0">// Here if |a| &gt;= 2^(-14)</span>
            <span class="s0">// add 42 to exponent bits</span>
            <span class="s1">shifterBits  = (ua &amp; </span><span class="s4">0x7ff0000000000000</span><span class="s1">ULL) + </span><span class="s4">0x02A0000000000000</span><span class="s1">ULL;</span>
        <span class="s1">}</span>
        <span class="s2">else</span>
        <span class="s1">{   </span><span class="s0">// 2^(-25) &lt; |a| &lt; 2^(-14), potentially results in denormal</span>
            <span class="s0">// set exponent bits to 42 - 14 + bias</span>
            <span class="s1">shifterBits = </span><span class="s4">0x41B0000000000000</span><span class="s1">ULL;</span>
        <span class="s1">}</span>
        <span class="s0">// set leading mantissa bit to protect against negative inputs</span>
        <span class="s1">shifterBits |= </span><span class="s4">0x0008000000000000</span><span class="s1">ULL;</span>
        <span class="s2">double </span><span class="s1">shifter;</span>
        <span class="s2">#if </span><span class="s1">defined(__CUDACC__)</span>
            <span class="s1">(</span><span class="s2">void</span><span class="s1">)memcpy(&amp;shifter, &amp;shifterBits, </span><span class="s2">sizeof</span><span class="s1">(shifterBits));</span>
        <span class="s2">#else</span>
            <span class="s1">(</span><span class="s2">void</span><span class="s1">)std::memcpy(&amp;shifter, &amp;shifterBits, </span><span class="s2">sizeof</span><span class="s1">(shifterBits));</span>
        <span class="s2">#endif</span>
        <span class="s2">double </span><span class="s1">aShiftRound = a + shifter;</span>

        <span class="s0">// Prevent the compiler from optimizing away a + shifter - shifter</span>
        <span class="s0">// by doing intermediate memcopy and harmless bitwize operation</span>
        <span class="s2">unsigned long long int </span><span class="s1">aShiftRoundBits;</span>
        <span class="s2">#if </span><span class="s1">defined(__CUDACC__)</span>
            <span class="s1">(</span><span class="s2">void</span><span class="s1">)memcpy(&amp;aShiftRoundBits, &amp;aShiftRound, </span><span class="s2">sizeof</span><span class="s1">(aShiftRound));</span>
        <span class="s2">#else</span>
            <span class="s1">(</span><span class="s2">void</span><span class="s1">)std::memcpy(&amp;aShiftRoundBits, &amp;aShiftRound, </span><span class="s2">sizeof</span><span class="s1">(aShiftRound));</span>
        <span class="s2">#endif</span>

        <span class="s0">// the value is positive, so this operation doesn't change anything</span>
        <span class="s1">aShiftRoundBits &amp;= </span><span class="s4">0x7fffffffffffffff</span><span class="s1">ULL;</span>

        <span class="s2">#if </span><span class="s1">defined(__CUDACC__)</span>
            <span class="s1">(</span><span class="s2">void</span><span class="s1">)memcpy(&amp;aShiftRound, &amp;aShiftRoundBits, </span><span class="s2">sizeof</span><span class="s1">(aShiftRound));</span>
        <span class="s2">#else</span>
            <span class="s1">(</span><span class="s2">void</span><span class="s1">)std::memcpy(&amp;aShiftRound, &amp;aShiftRoundBits, </span><span class="s2">sizeof</span><span class="s1">(aShiftRound));</span>
        <span class="s2">#endif</span>

        <span class="s1">result = __float2half(</span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">float</span><span class="s1">&gt;(aShiftRound - shifter));</span>
    <span class="s1">}</span>

    <span class="s2">return </span><span class="s1">result;</span>
<span class="s2">#endif</span>
<span class="s1">}</span>

<span class="s1">__CUDA_HOSTDEVICE_FP16_DECL__ __half __float2half(</span><span class="s2">const float </span><span class="s1">a)</span>
<span class="s1">{</span>
    <span class="s1">__half val;</span>
<span class="s2">#if </span><span class="s1">defined(__CUDA_ARCH__)</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{  cvt.rn.f16.f32 %0, %1;}</span><span class="s2">\n</span><span class="s3">&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(val)) : </span><span class="s3">&quot;f&quot;</span><span class="s1">(a));</span>
<span class="s2">#else</span>
    <span class="s1">__half_raw r;</span>
    <span class="s2">unsigned int </span><span class="s1">sign = </span><span class="s4">0</span><span class="s1">U;</span>
    <span class="s2">unsigned int </span><span class="s1">remainder = </span><span class="s4">0</span><span class="s1">U;</span>
    <span class="s1">r.x = __internal_float2half(a, sign, remainder);</span>
    <span class="s2">if </span><span class="s1">((remainder &gt; </span><span class="s4">0x80000000</span><span class="s1">U) || ((remainder == </span><span class="s4">0x80000000</span><span class="s1">U) &amp;&amp; ((r.x &amp; </span><span class="s4">0x1</span><span class="s1">U) != </span><span class="s4">0</span><span class="s1">U))) {</span>
        <span class="s1">r.x++;</span>
    <span class="s1">}</span>
    <span class="s1">val = r;</span>
<span class="s2">#endif</span>
    <span class="s2">return </span><span class="s1">val;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_HOSTDEVICE_FP16_DECL__ __half __float2half_rn(</span><span class="s2">const float </span><span class="s1">a)</span>
<span class="s1">{</span>
    <span class="s1">__half val;</span>
<span class="s2">#if </span><span class="s1">defined(__CUDA_ARCH__)</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{  cvt.rn.f16.f32 %0, %1;}</span><span class="s2">\n</span><span class="s3">&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(val)) : </span><span class="s3">&quot;f&quot;</span><span class="s1">(a));</span>
<span class="s2">#else</span>
    <span class="s1">__half_raw r;</span>
    <span class="s2">unsigned int </span><span class="s1">sign = </span><span class="s4">0</span><span class="s1">U;</span>
    <span class="s2">unsigned int </span><span class="s1">remainder = </span><span class="s4">0</span><span class="s1">U;</span>
    <span class="s1">r.x = __internal_float2half(a, sign, remainder);</span>
    <span class="s2">if </span><span class="s1">((remainder &gt; </span><span class="s4">0x80000000</span><span class="s1">U) || ((remainder == </span><span class="s4">0x80000000</span><span class="s1">U) &amp;&amp; ((r.x &amp; </span><span class="s4">0x1</span><span class="s1">U) != </span><span class="s4">0</span><span class="s1">U))) {</span>
        <span class="s1">r.x++;</span>
    <span class="s1">}</span>
    <span class="s1">val = r;</span>
<span class="s2">#endif</span>
    <span class="s2">return </span><span class="s1">val;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_HOSTDEVICE_FP16_DECL__ __half __float2half_rz(</span><span class="s2">const float </span><span class="s1">a)</span>
<span class="s1">{</span>
    <span class="s1">__half val;</span>
<span class="s2">#if </span><span class="s1">defined(__CUDA_ARCH__)</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{  cvt.rz.f16.f32 %0, %1;}</span><span class="s2">\n</span><span class="s3">&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(val)) : </span><span class="s3">&quot;f&quot;</span><span class="s1">(a));</span>
<span class="s2">#else</span>
    <span class="s1">__half_raw r;</span>
    <span class="s2">unsigned int </span><span class="s1">sign = </span><span class="s4">0</span><span class="s1">U;</span>
    <span class="s2">unsigned int </span><span class="s1">remainder = </span><span class="s4">0</span><span class="s1">U;</span>
    <span class="s1">r.x = __internal_float2half(a, sign, remainder);</span>
    <span class="s1">val = r;</span>
<span class="s2">#endif</span>
    <span class="s2">return </span><span class="s1">val;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_HOSTDEVICE_FP16_DECL__ __half __float2half_rd(</span><span class="s2">const float </span><span class="s1">a)</span>
<span class="s1">{</span>
    <span class="s1">__half val;</span>
<span class="s2">#if </span><span class="s1">defined(__CUDA_ARCH__)</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{  cvt.rm.f16.f32 %0, %1;}</span><span class="s2">\n</span><span class="s3">&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(val)) : </span><span class="s3">&quot;f&quot;</span><span class="s1">(a));</span>
<span class="s2">#else</span>
    <span class="s1">__half_raw r;</span>
    <span class="s2">unsigned int </span><span class="s1">sign = </span><span class="s4">0</span><span class="s1">U;</span>
    <span class="s2">unsigned int </span><span class="s1">remainder = </span><span class="s4">0</span><span class="s1">U;</span>
    <span class="s1">r.x = __internal_float2half(a, sign, remainder);</span>
    <span class="s2">if </span><span class="s1">((remainder != </span><span class="s4">0</span><span class="s1">U) &amp;&amp; (sign != </span><span class="s4">0</span><span class="s1">U)) {</span>
        <span class="s1">r.x++;</span>
    <span class="s1">}</span>
    <span class="s1">val = r;</span>
<span class="s2">#endif</span>
    <span class="s2">return </span><span class="s1">val;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_HOSTDEVICE_FP16_DECL__ __half __float2half_ru(</span><span class="s2">const float </span><span class="s1">a)</span>
<span class="s1">{</span>
    <span class="s1">__half val;</span>
<span class="s2">#if </span><span class="s1">defined(__CUDA_ARCH__)</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{  cvt.rp.f16.f32 %0, %1;}</span><span class="s2">\n</span><span class="s3">&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(val)) : </span><span class="s3">&quot;f&quot;</span><span class="s1">(a));</span>
<span class="s2">#else</span>
    <span class="s1">__half_raw r;</span>
    <span class="s2">unsigned int </span><span class="s1">sign = </span><span class="s4">0</span><span class="s1">U;</span>
    <span class="s2">unsigned int </span><span class="s1">remainder = </span><span class="s4">0</span><span class="s1">U;</span>
    <span class="s1">r.x = __internal_float2half(a, sign, remainder);</span>
    <span class="s2">if </span><span class="s1">((remainder != </span><span class="s4">0</span><span class="s1">U) &amp;&amp; (sign == </span><span class="s4">0</span><span class="s1">U)) {</span>
        <span class="s1">r.x++;</span>
    <span class="s1">}</span>
    <span class="s1">val = r;</span>
<span class="s2">#endif</span>
    <span class="s2">return </span><span class="s1">val;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_HOSTDEVICE_FP16_DECL__ __half2 __float2half2_rn(</span><span class="s2">const float </span><span class="s1">a)</span>
<span class="s1">{</span>
    <span class="s1">__half2 val;</span>
<span class="s2">#if </span><span class="s1">defined(__CUDA_ARCH__)</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{.reg .f16 low;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.rn.f16.f32 low, %1;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32 %0, {low,low};}</span><span class="s2">\n</span><span class="s3">&quot; </span><span class="s1">: </span><span class="s3">&quot;=r&quot;</span><span class="s1">(__HALF2_TO_UI(val)) : </span><span class="s3">&quot;f&quot;</span><span class="s1">(a));</span>
<span class="s2">#else</span>
    <span class="s1">val = __half2(__float2half_rn(a), __float2half_rn(a));</span>
<span class="s2">#endif</span>
    <span class="s2">return </span><span class="s1">val;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_HOSTDEVICE_FP16_DECL__ __half2 __floats2half2_rn(</span><span class="s2">const float </span><span class="s1">a, </span><span class="s2">const float </span><span class="s1">b)</span>
<span class="s1">{</span>
    <span class="s1">__half2 val;</span>
<span class="s2">#if </span><span class="s1">defined(__CUDA_ARCH__)</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{.reg .f16 low,high;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.rn.f16.f32 low, %1;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.rn.f16.f32 high, %2;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32 %0, {low,high};}</span><span class="s2">\n</span><span class="s3">&quot; </span><span class="s1">: </span><span class="s3">&quot;=r&quot;</span><span class="s1">(__HALF2_TO_UI(val)) : </span><span class="s3">&quot;f&quot;</span><span class="s1">(a), </span><span class="s3">&quot;f&quot;</span><span class="s1">(b));</span>
<span class="s2">#else</span>
    <span class="s1">val = __half2(__float2half_rn(a), __float2half_rn(b));</span>
<span class="s2">#endif</span>
    <span class="s2">return </span><span class="s1">val;</span>
<span class="s1">}</span>

<span class="s2">#ifndef </span><span class="s1">__CUDACC_RTC__  </span><span class="s0">/* no host functions in NVRTC mode */</span>
<span class="s2">static </span><span class="s5">inline </span><span class="s2">float </span><span class="s1">__internal_half2float(</span><span class="s2">const unsigned short </span><span class="s1">h)</span>
<span class="s1">{</span>
    <span class="s2">unsigned int </span><span class="s1">sign = ((</span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">unsigned int</span><span class="s1">&gt;(h) &gt;&gt; </span><span class="s4">15</span><span class="s1">U) &amp; </span><span class="s4">1</span><span class="s1">U);</span>
    <span class="s2">unsigned int </span><span class="s1">exponent = ((</span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">unsigned int</span><span class="s1">&gt;(h) &gt;&gt; </span><span class="s4">10</span><span class="s1">U) &amp; </span><span class="s4">0x1f</span><span class="s1">U);</span>
    <span class="s2">unsigned int </span><span class="s1">mantissa = ((</span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">unsigned int</span><span class="s1">&gt;(h) &amp; </span><span class="s4">0x3ff</span><span class="s1">U) &lt;&lt; </span><span class="s4">13</span><span class="s1">U);</span>
    <span class="s2">float </span><span class="s1">f;</span>
    <span class="s2">if </span><span class="s1">(exponent == </span><span class="s4">0x1f</span><span class="s1">U) { </span><span class="s0">/* NaN or Inf */</span>
        <span class="s0">/* discard sign of a NaN */</span>
        <span class="s1">sign = ((mantissa != </span><span class="s4">0</span><span class="s1">U) ? (sign &gt;&gt; </span><span class="s4">1</span><span class="s1">U) : sign);</span>
        <span class="s1">mantissa = ((mantissa != </span><span class="s4">0</span><span class="s1">U) ? </span><span class="s4">0x7fffff</span><span class="s1">U : </span><span class="s4">0</span><span class="s1">U);</span>
        <span class="s1">exponent = </span><span class="s4">0xff</span><span class="s1">U;</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(exponent == </span><span class="s4">0</span><span class="s1">U) { </span><span class="s0">/* Denorm or Zero */</span>
        <span class="s2">if </span><span class="s1">(mantissa != </span><span class="s4">0</span><span class="s1">U) {</span>
            <span class="s2">unsigned int </span><span class="s1">msb;</span>
            <span class="s1">exponent = </span><span class="s4">0x71</span><span class="s1">U;</span>
            <span class="s2">do </span><span class="s1">{</span>
                <span class="s1">msb = (mantissa &amp; </span><span class="s4">0x400000</span><span class="s1">U);</span>
                <span class="s1">mantissa &lt;&lt;= </span><span class="s4">1</span><span class="s1">U; </span><span class="s0">/* normalize */</span>
                <span class="s1">--exponent;</span>
            <span class="s1">} </span><span class="s2">while </span><span class="s1">(msb == </span><span class="s4">0</span><span class="s1">U);</span>
            <span class="s1">mantissa &amp;= </span><span class="s4">0x7fffff</span><span class="s1">U; </span><span class="s0">/* 1.mantissa is implicit */</span>
        <span class="s1">}</span>
    <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
        <span class="s1">exponent += </span><span class="s4">0x70</span><span class="s1">U;</span>
    <span class="s1">}</span>
    <span class="s2">unsigned int </span><span class="s1">u = ((sign &lt;&lt; </span><span class="s4">31</span><span class="s1">U) | (exponent &lt;&lt; </span><span class="s4">23</span><span class="s1">U) | mantissa);</span>
<span class="s2">#if </span><span class="s1">defined(__CUDACC__)</span>
    <span class="s1">(</span><span class="s2">void</span><span class="s1">)memcpy(&amp;f, &amp;u, </span><span class="s2">sizeof</span><span class="s1">(u));</span>
<span class="s2">#else</span>
    <span class="s1">(</span><span class="s2">void</span><span class="s1">)std::memcpy(&amp;f, &amp;u, </span><span class="s2">sizeof</span><span class="s1">(u));</span>
<span class="s2">#endif</span>
    <span class="s2">return </span><span class="s1">f;</span>
<span class="s1">}</span>
<span class="s2">#endif  </span><span class="s0">/* !defined(__CUDACC_RTC__) */</span>

<span class="s1">__CUDA_HOSTDEVICE_FP16_DECL__ </span><span class="s2">float </span><span class="s1">__half2float(</span><span class="s2">const </span><span class="s1">__half a)</span>
<span class="s1">{</span>
    <span class="s2">float </span><span class="s1">val;</span>
<span class="s2">#if </span><span class="s1">defined(__CUDA_ARCH__)</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{  cvt.f32.f16 %0, %1;}</span><span class="s2">\n</span><span class="s3">&quot; </span><span class="s1">: </span><span class="s3">&quot;=f&quot;</span><span class="s1">(val) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(a)));</span>
<span class="s2">#else</span>
    <span class="s1">val = __internal_half2float(</span><span class="s5">static_cast</span><span class="s1">&lt;__half_raw&gt;(a).x);</span>
<span class="s2">#endif</span>
    <span class="s2">return </span><span class="s1">val;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_HOSTDEVICE_FP16_DECL__ </span><span class="s2">float </span><span class="s1">__low2float(</span><span class="s2">const </span><span class="s1">__half2 a)</span>
<span class="s1">{</span>
    <span class="s2">float </span><span class="s1">val;</span>
<span class="s2">#if </span><span class="s1">defined(__CUDA_ARCH__)</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{.reg .f16 low,high;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32 {low,high},%1;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.f32.f16 %0, low;}</span><span class="s2">\n</span><span class="s3">&quot; </span><span class="s1">: </span><span class="s3">&quot;=f&quot;</span><span class="s1">(val) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(a)));</span>
<span class="s2">#else</span>
    <span class="s1">val = __internal_half2float(</span><span class="s5">static_cast</span><span class="s1">&lt;__half2_raw&gt;(a).x);</span>
<span class="s2">#endif</span>
    <span class="s2">return </span><span class="s1">val;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_HOSTDEVICE_FP16_DECL__ </span><span class="s2">float </span><span class="s1">__high2float(</span><span class="s2">const </span><span class="s1">__half2 a)</span>
<span class="s1">{</span>
    <span class="s2">float </span><span class="s1">val;</span>
<span class="s2">#if </span><span class="s1">defined(__CUDA_ARCH__)</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{.reg .f16 low,high;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32 {low,high},%1;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.f32.f16 %0, high;}</span><span class="s2">\n</span><span class="s3">&quot; </span><span class="s1">: </span><span class="s3">&quot;=f&quot;</span><span class="s1">(val) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(a)));</span>
<span class="s2">#else</span>
    <span class="s1">val = __internal_half2float(</span><span class="s5">static_cast</span><span class="s1">&lt;__half2_raw&gt;(a).y);</span>
<span class="s2">#endif</span>
    <span class="s2">return </span><span class="s1">val;</span>
<span class="s1">}</span>

<span class="s0">/* Intrinsic functions only available to nvcc compilers */</span>
<span class="s2">#if </span><span class="s1">defined(__CUDACC__)</span>

<span class="s0">/* CUDA vector-types compatible vector creation function (note returns __half2, not half2) */</span>
<span class="s1">__VECTOR_FUNCTIONS_DECL__ __half2 make_half2(</span><span class="s2">const </span><span class="s1">__half x, </span><span class="s2">const </span><span class="s1">__half y)</span>
<span class="s1">{</span>
    <span class="s1">__half2 t; t.x = x; t.y = y; </span><span class="s2">return </span><span class="s1">t;</span>
<span class="s1">}</span>
<span class="s2">#undef </span><span class="s1">__VECTOR_FUNCTIONS_DECL__</span>


<span class="s0">/* Definitions of intrinsics */</span>
<span class="s1">__CUDA_HOSTDEVICE_FP16_DECL__ __half2 __float22half2_rn(</span><span class="s2">const </span><span class="s1">float2 a)</span>
<span class="s1">{</span>
    <span class="s2">const </span><span class="s1">__half2 val = __floats2half2_rn(a.x, a.y);</span>
    <span class="s2">return </span><span class="s1">val;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_HOSTDEVICE_FP16_DECL__ float2 __half22float2(</span><span class="s2">const </span><span class="s1">__half2 a)</span>
<span class="s1">{</span>
    <span class="s2">float </span><span class="s1">hi_float;</span>
    <span class="s2">float </span><span class="s1">lo_float;</span>
<span class="s2">#if </span><span class="s1">defined(__CUDA_ARCH__)</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{.reg .f16 low,high;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32 {low,high},%1;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.f32.f16 %0, low;}</span><span class="s2">\n</span><span class="s3">&quot; </span><span class="s1">: </span><span class="s3">&quot;=f&quot;</span><span class="s1">(lo_float) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(a)));</span>

    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{.reg .f16 low,high;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32 {low,high},%1;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.f32.f16 %0, high;}</span><span class="s2">\n</span><span class="s3">&quot; </span><span class="s1">: </span><span class="s3">&quot;=f&quot;</span><span class="s1">(hi_float) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(a)));</span>
<span class="s2">#else</span>
    <span class="s1">lo_float = __internal_half2float(((__half2_raw)a).x);</span>
    <span class="s1">hi_float = __internal_half2float(((__half2_raw)a).y);</span>
<span class="s2">#endif</span>
    <span class="s2">return </span><span class="s1">make_float2(lo_float, hi_float);</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">int </span><span class="s1">__half2int_rn(</span><span class="s2">const </span><span class="s1">__half h)</span>
<span class="s1">{</span>
    <span class="s2">int </span><span class="s1">i;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rni.s32.f16 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=r&quot;</span><span class="s1">(i) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(h)));</span>
    <span class="s2">return </span><span class="s1">i;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_HOSTDEVICE_FP16_DECL__ </span><span class="s2">int </span><span class="s1">__half2int_rz(</span><span class="s2">const </span><span class="s1">__half h)</span>
<span class="s1">{</span>
    <span class="s2">int </span><span class="s1">i;</span>
<span class="s2">#if </span><span class="s1">defined __CUDA_ARCH__</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rzi.s32.f16 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=r&quot;</span><span class="s1">(i) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(h)));</span>
<span class="s2">#else</span>
    <span class="s2">const float </span><span class="s1">f = __half2float(h);</span>
                <span class="s1">i = </span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">int</span><span class="s1">&gt;(f);</span>
    <span class="s2">const int </span><span class="s1">max_val = (</span><span class="s2">int</span><span class="s1">)</span><span class="s4">0x7fffffff</span><span class="s1">U;</span>
    <span class="s2">const int </span><span class="s1">min_val = (</span><span class="s2">int</span><span class="s1">)</span><span class="s4">0x80000000</span><span class="s1">U;</span>
    <span class="s0">// saturation fixup</span>
    <span class="s2">if </span><span class="s1">(f != f) {</span>
        <span class="s0">// NaN</span>
        <span class="s1">i = </span><span class="s4">0</span><span class="s1">;</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(f &gt; </span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">float</span><span class="s1">&gt;(max_val)) {</span>
        <span class="s0">// saturate maximum</span>
        <span class="s1">i = max_val;</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(f &lt; </span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">float</span><span class="s1">&gt;(min_val)) {</span>
        <span class="s0">// saturate minimum</span>
        <span class="s1">i = min_val;</span>
    <span class="s1">}</span>
<span class="s2">#endif</span>
    <span class="s2">return </span><span class="s1">i;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">int </span><span class="s1">__half2int_rd(</span><span class="s2">const </span><span class="s1">__half h)</span>
<span class="s1">{</span>
    <span class="s2">int </span><span class="s1">i;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rmi.s32.f16 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=r&quot;</span><span class="s1">(i) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(h)));</span>
    <span class="s2">return </span><span class="s1">i;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">int </span><span class="s1">__half2int_ru(</span><span class="s2">const </span><span class="s1">__half h)</span>
<span class="s1">{</span>
    <span class="s2">int </span><span class="s1">i;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rpi.s32.f16 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=r&quot;</span><span class="s1">(i) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(h)));</span>
    <span class="s2">return </span><span class="s1">i;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_HOSTDEVICE_FP16_DECL__ __half __int2half_rn(</span><span class="s2">const int </span><span class="s1">i)</span>
<span class="s1">{</span>
    <span class="s1">__half h;</span>
<span class="s2">#if </span><span class="s1">defined(__CUDA_ARCH__)</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rn.f16.s32 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(h)) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(i));</span>
<span class="s2">#else</span>
    <span class="s0">// double-rounding is not a problem here: if integer</span>
    <span class="s0">// has more than 24 bits, it is already too large to</span>
    <span class="s0">// be represented in half precision, and result will</span>
    <span class="s0">// be infinity.</span>
    <span class="s2">const float  </span><span class="s1">f = </span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">float</span><span class="s1">&gt;(i);</span>
                 <span class="s1">h = __float2half_rn(f);</span>
<span class="s2">#endif</span>
    <span class="s2">return </span><span class="s1">h;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __int2half_rz(</span><span class="s2">const int </span><span class="s1">i)</span>
<span class="s1">{</span>
    <span class="s1">__half h;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rz.f16.s32 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(h)) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(i));</span>
    <span class="s2">return </span><span class="s1">h;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __int2half_rd(</span><span class="s2">const int </span><span class="s1">i)</span>
<span class="s1">{</span>
    <span class="s1">__half h;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rm.f16.s32 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(h)) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(i));</span>
    <span class="s2">return </span><span class="s1">h;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __int2half_ru(</span><span class="s2">const int </span><span class="s1">i)</span>
<span class="s1">{</span>
    <span class="s1">__half h;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rp.f16.s32 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(h)) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(i));</span>
    <span class="s2">return </span><span class="s1">h;</span>
<span class="s1">}</span>

<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">short int </span><span class="s1">__half2short_rn(</span><span class="s2">const </span><span class="s1">__half h)</span>
<span class="s1">{</span>
    <span class="s2">short int </span><span class="s1">i;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rni.s16.f16 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(i) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(h)));</span>
    <span class="s2">return </span><span class="s1">i;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_HOSTDEVICE_FP16_DECL__ </span><span class="s2">short int </span><span class="s1">__half2short_rz(</span><span class="s2">const </span><span class="s1">__half h)</span>
<span class="s1">{</span>
    <span class="s2">short int </span><span class="s1">i;</span>
<span class="s2">#if </span><span class="s1">defined __CUDA_ARCH__</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rzi.s16.f16 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(i) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(h)));</span>
<span class="s2">#else</span>
    <span class="s2">const float </span><span class="s1">f = __half2float(h);</span>
                <span class="s1">i = </span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">short int</span><span class="s1">&gt;(f);</span>
    <span class="s2">const short int </span><span class="s1">max_val = (</span><span class="s2">short int</span><span class="s1">)</span><span class="s4">0x7fff</span><span class="s1">U;</span>
    <span class="s2">const short int </span><span class="s1">min_val = (</span><span class="s2">short int</span><span class="s1">)</span><span class="s4">0x8000</span><span class="s1">U;</span>
    <span class="s0">// saturation fixup</span>
    <span class="s2">if </span><span class="s1">(f != f) {</span>
        <span class="s0">// NaN</span>
        <span class="s1">i = </span><span class="s4">0</span><span class="s1">;</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(f &gt; </span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">float</span><span class="s1">&gt;(max_val)) {</span>
        <span class="s0">// saturate maximum</span>
        <span class="s1">i = max_val;</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(f &lt; </span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">float</span><span class="s1">&gt;(min_val)) {</span>
        <span class="s0">// saturate minimum</span>
        <span class="s1">i = min_val;</span>
    <span class="s1">}</span>
<span class="s2">#endif</span>
    <span class="s2">return </span><span class="s1">i;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">short int </span><span class="s1">__half2short_rd(</span><span class="s2">const </span><span class="s1">__half h)</span>
<span class="s1">{</span>
    <span class="s2">short int </span><span class="s1">i;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rmi.s16.f16 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(i) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(h)));</span>
    <span class="s2">return </span><span class="s1">i;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">short int </span><span class="s1">__half2short_ru(</span><span class="s2">const </span><span class="s1">__half h)</span>
<span class="s1">{</span>
    <span class="s2">short int </span><span class="s1">i;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rpi.s16.f16 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(i) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(h)));</span>
    <span class="s2">return </span><span class="s1">i;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_HOSTDEVICE_FP16_DECL__ __half __short2half_rn(</span><span class="s2">const short int </span><span class="s1">i)</span>
<span class="s1">{</span>
    <span class="s1">__half h;</span>
<span class="s2">#if </span><span class="s1">defined __CUDA_ARCH__</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rn.f16.s16 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(h)) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(i));</span>
<span class="s2">#else</span>
    <span class="s2">const float  </span><span class="s1">f = </span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">float</span><span class="s1">&gt;(i);</span>
                 <span class="s1">h = __float2half_rn(f);</span>
<span class="s2">#endif</span>
    <span class="s2">return </span><span class="s1">h;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __short2half_rz(</span><span class="s2">const short int </span><span class="s1">i)</span>
<span class="s1">{</span>
    <span class="s1">__half h;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rz.f16.s16 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(h)) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(i));</span>
    <span class="s2">return </span><span class="s1">h;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __short2half_rd(</span><span class="s2">const short int </span><span class="s1">i)</span>
<span class="s1">{</span>
    <span class="s1">__half h;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rm.f16.s16 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(h)) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(i));</span>
    <span class="s2">return </span><span class="s1">h;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __short2half_ru(</span><span class="s2">const short int </span><span class="s1">i)</span>
<span class="s1">{</span>
    <span class="s1">__half h;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rp.f16.s16 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(h)) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(i));</span>
    <span class="s2">return </span><span class="s1">h;</span>
<span class="s1">}</span>

<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">unsigned int </span><span class="s1">__half2uint_rn(</span><span class="s2">const </span><span class="s1">__half h)</span>
<span class="s1">{</span>
    <span class="s2">unsigned int </span><span class="s1">i;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rni.u32.f16 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=r&quot;</span><span class="s1">(i) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(h)));</span>
    <span class="s2">return </span><span class="s1">i;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_HOSTDEVICE_FP16_DECL__ </span><span class="s2">unsigned int </span><span class="s1">__half2uint_rz(</span><span class="s2">const </span><span class="s1">__half h)</span>
<span class="s1">{</span>
    <span class="s2">unsigned int </span><span class="s1">i;</span>
<span class="s2">#if </span><span class="s1">defined __CUDA_ARCH__</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rzi.u32.f16 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=r&quot;</span><span class="s1">(i) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(h)));</span>
<span class="s2">#else</span>
    <span class="s2">const float </span><span class="s1">f = __half2float(h);</span>
                <span class="s1">i = </span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">unsigned int</span><span class="s1">&gt;(f);</span>
    <span class="s2">const unsigned int </span><span class="s1">max_val = </span><span class="s4">0xffffffff</span><span class="s1">U;</span>
    <span class="s2">const unsigned int </span><span class="s1">min_val = </span><span class="s4">0</span><span class="s1">U;</span>
    <span class="s0">// saturation fixup</span>
    <span class="s2">if </span><span class="s1">(f != f) {</span>
        <span class="s0">// NaN</span>
        <span class="s1">i = </span><span class="s4">0</span><span class="s1">U;</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(f &gt; </span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">float</span><span class="s1">&gt;(max_val)) {</span>
        <span class="s0">// saturate maximum</span>
        <span class="s1">i = max_val;</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(f &lt; </span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">float</span><span class="s1">&gt;(min_val)) {</span>
        <span class="s0">// saturate minimum</span>
        <span class="s1">i = min_val;</span>
    <span class="s1">}</span>
<span class="s2">#endif</span>
    <span class="s2">return </span><span class="s1">i;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">unsigned int </span><span class="s1">__half2uint_rd(</span><span class="s2">const </span><span class="s1">__half h)</span>
<span class="s1">{</span>
    <span class="s2">unsigned int </span><span class="s1">i;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rmi.u32.f16 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=r&quot;</span><span class="s1">(i) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(h)));</span>
    <span class="s2">return </span><span class="s1">i;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">unsigned int </span><span class="s1">__half2uint_ru(</span><span class="s2">const </span><span class="s1">__half h)</span>
<span class="s1">{</span>
    <span class="s2">unsigned int </span><span class="s1">i;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rpi.u32.f16 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=r&quot;</span><span class="s1">(i) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(h)));</span>
    <span class="s2">return </span><span class="s1">i;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_HOSTDEVICE_FP16_DECL__ __half __uint2half_rn(</span><span class="s2">const unsigned int </span><span class="s1">i)</span>
<span class="s1">{</span>
    <span class="s1">__half h;</span>
<span class="s2">#if </span><span class="s1">defined __CUDA_ARCH__</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rn.f16.u32 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(h)) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(i));</span>
<span class="s2">#else</span>
    <span class="s0">// double-rounding is not a problem here: if integer</span>
    <span class="s0">// has more than 24 bits, it is already too large to</span>
    <span class="s0">// be represented in half precision, and result will</span>
    <span class="s0">// be infinity.</span>
    <span class="s2">const float  </span><span class="s1">f = </span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">float</span><span class="s1">&gt;(i);</span>
                 <span class="s1">h = __float2half_rn(f);</span>
<span class="s2">#endif</span>
    <span class="s2">return </span><span class="s1">h;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __uint2half_rz(</span><span class="s2">const unsigned int </span><span class="s1">i)</span>
<span class="s1">{</span>
    <span class="s1">__half h;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rz.f16.u32 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(h)) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(i));</span>
    <span class="s2">return </span><span class="s1">h;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __uint2half_rd(</span><span class="s2">const unsigned int </span><span class="s1">i)</span>
<span class="s1">{</span>
    <span class="s1">__half h;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rm.f16.u32 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(h)) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(i));</span>
    <span class="s2">return </span><span class="s1">h;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __uint2half_ru(</span><span class="s2">const unsigned int </span><span class="s1">i)</span>
<span class="s1">{</span>
    <span class="s1">__half h;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rp.f16.u32 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(h)) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(i));</span>
    <span class="s2">return </span><span class="s1">h;</span>
<span class="s1">}</span>

<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">unsigned short int </span><span class="s1">__half2ushort_rn(</span><span class="s2">const </span><span class="s1">__half h)</span>
<span class="s1">{</span>
    <span class="s2">unsigned short int </span><span class="s1">i;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rni.u16.f16 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(i) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(h)));</span>
    <span class="s2">return </span><span class="s1">i;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_HOSTDEVICE_FP16_DECL__ </span><span class="s2">unsigned short int </span><span class="s1">__half2ushort_rz(</span><span class="s2">const </span><span class="s1">__half h)</span>
<span class="s1">{</span>
    <span class="s2">unsigned short int </span><span class="s1">i;</span>
<span class="s2">#if </span><span class="s1">defined __CUDA_ARCH__</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rzi.u16.f16 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(i) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(h)));</span>
<span class="s2">#else</span>
    <span class="s2">const float </span><span class="s1">f = __half2float(h);</span>
                <span class="s1">i = </span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">unsigned short int</span><span class="s1">&gt;(f);</span>
    <span class="s2">const unsigned short int </span><span class="s1">max_val = </span><span class="s4">0xffff</span><span class="s1">U;</span>
    <span class="s2">const unsigned short int </span><span class="s1">min_val = </span><span class="s4">0</span><span class="s1">U;</span>
    <span class="s0">// saturation fixup</span>
    <span class="s2">if </span><span class="s1">(f != f) {</span>
        <span class="s0">// NaN</span>
        <span class="s1">i = </span><span class="s4">0</span><span class="s1">U;</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(f &gt; </span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">float</span><span class="s1">&gt;(max_val)) {</span>
        <span class="s0">// saturate maximum</span>
        <span class="s1">i = max_val;</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(f &lt; </span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">float</span><span class="s1">&gt;(min_val)) {</span>
        <span class="s0">// saturate minimum</span>
        <span class="s1">i = min_val;</span>
    <span class="s1">}</span>
<span class="s2">#endif</span>
    <span class="s2">return </span><span class="s1">i;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">unsigned short int </span><span class="s1">__half2ushort_rd(</span><span class="s2">const </span><span class="s1">__half h)</span>
<span class="s1">{</span>
    <span class="s2">unsigned short int </span><span class="s1">i;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rmi.u16.f16 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(i) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(h)));</span>
    <span class="s2">return </span><span class="s1">i;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">unsigned short int </span><span class="s1">__half2ushort_ru(</span><span class="s2">const </span><span class="s1">__half h)</span>
<span class="s1">{</span>
    <span class="s2">unsigned short int </span><span class="s1">i;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rpi.u16.f16 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(i) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(h)));</span>
    <span class="s2">return </span><span class="s1">i;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_HOSTDEVICE_FP16_DECL__ __half __ushort2half_rn(</span><span class="s2">const unsigned short int </span><span class="s1">i)</span>
<span class="s1">{</span>
    <span class="s1">__half h;</span>
<span class="s2">#if </span><span class="s1">defined __CUDA_ARCH__</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rn.f16.u16 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(h)) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(i));</span>
<span class="s2">#else</span>
    <span class="s2">const float  </span><span class="s1">f = </span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">float</span><span class="s1">&gt;(i);</span>
                 <span class="s1">h = __float2half_rn(f);</span>
<span class="s2">#endif</span>
    <span class="s2">return </span><span class="s1">h;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __ushort2half_rz(</span><span class="s2">const unsigned short int </span><span class="s1">i)</span>
<span class="s1">{</span>
    <span class="s1">__half h;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rz.f16.u16 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(h)) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(i));</span>
    <span class="s2">return </span><span class="s1">h;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __ushort2half_rd(</span><span class="s2">const unsigned short int </span><span class="s1">i)</span>
<span class="s1">{</span>
    <span class="s1">__half h;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rm.f16.u16 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(h)) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(i));</span>
    <span class="s2">return </span><span class="s1">h;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __ushort2half_ru(</span><span class="s2">const unsigned short int </span><span class="s1">i)</span>
<span class="s1">{</span>
    <span class="s1">__half h;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rp.f16.u16 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(h)) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(i));</span>
    <span class="s2">return </span><span class="s1">h;</span>
<span class="s1">}</span>

<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">unsigned long long int </span><span class="s1">__half2ull_rn(</span><span class="s2">const </span><span class="s1">__half h)</span>
<span class="s1">{</span>
    <span class="s2">unsigned long long int </span><span class="s1">i;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rni.u64.f16 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=l&quot;</span><span class="s1">(i) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(h)));</span>
    <span class="s2">return </span><span class="s1">i;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_HOSTDEVICE_FP16_DECL__ </span><span class="s2">unsigned long long int </span><span class="s1">__half2ull_rz(</span><span class="s2">const </span><span class="s1">__half h)</span>
<span class="s1">{</span>
    <span class="s2">unsigned long long int </span><span class="s1">i;</span>
<span class="s2">#if </span><span class="s1">defined __CUDA_ARCH__</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rzi.u64.f16 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=l&quot;</span><span class="s1">(i) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(h)));</span>
<span class="s2">#else</span>
    <span class="s2">const float </span><span class="s1">f = __half2float(h);</span>
                <span class="s1">i = </span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">unsigned long long int</span><span class="s1">&gt;(f);</span>
    <span class="s2">const unsigned long long int </span><span class="s1">max_val = </span><span class="s4">0xffffffffffffffff</span><span class="s1">ULL;</span>
    <span class="s2">const unsigned long long int </span><span class="s1">min_val = </span><span class="s4">0</span><span class="s1">ULL;</span>
    <span class="s0">// saturation fixup</span>
    <span class="s2">if </span><span class="s1">(f != f) {</span>
        <span class="s0">// NaN</span>
        <span class="s1">i = </span><span class="s4">0x8000000000000000</span><span class="s1">ULL;</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(f &gt; </span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">float</span><span class="s1">&gt;(max_val)) {</span>
        <span class="s0">// saturate maximum</span>
        <span class="s1">i = max_val;</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(f &lt; </span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">float</span><span class="s1">&gt;(min_val)) {</span>
        <span class="s0">// saturate minimum</span>
        <span class="s1">i = min_val;</span>
    <span class="s1">}</span>
<span class="s2">#endif</span>
    <span class="s2">return </span><span class="s1">i;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">unsigned long long int </span><span class="s1">__half2ull_rd(</span><span class="s2">const </span><span class="s1">__half h)</span>
<span class="s1">{</span>
    <span class="s2">unsigned long long int </span><span class="s1">i;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rmi.u64.f16 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=l&quot;</span><span class="s1">(i) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(h)));</span>
    <span class="s2">return </span><span class="s1">i;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">unsigned long long int </span><span class="s1">__half2ull_ru(</span><span class="s2">const </span><span class="s1">__half h)</span>
<span class="s1">{</span>
    <span class="s2">unsigned long long int </span><span class="s1">i;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rpi.u64.f16 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=l&quot;</span><span class="s1">(i) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(h)));</span>
    <span class="s2">return </span><span class="s1">i;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_HOSTDEVICE_FP16_DECL__ __half __ull2half_rn(</span><span class="s2">const unsigned long long int </span><span class="s1">i)</span>
<span class="s1">{</span>
    <span class="s1">__half h;</span>
<span class="s2">#if </span><span class="s1">defined(__CUDA_ARCH__)</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rn.f16.u64 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(h)) : </span><span class="s3">&quot;l&quot;</span><span class="s1">(i));</span>
<span class="s2">#else</span>
    <span class="s0">// double-rounding is not a problem here: if integer</span>
    <span class="s0">// has more than 24 bits, it is already too large to</span>
    <span class="s0">// be represented in half precision, and result will</span>
    <span class="s0">// be infinity.</span>
    <span class="s2">const float  </span><span class="s1">f = </span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">float</span><span class="s1">&gt;(i);</span>
                 <span class="s1">h = __float2half_rn(f);</span>
<span class="s2">#endif</span>
    <span class="s2">return </span><span class="s1">h;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __ull2half_rz(</span><span class="s2">const unsigned long long int </span><span class="s1">i)</span>
<span class="s1">{</span>
    <span class="s1">__half h;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rz.f16.u64 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(h)) : </span><span class="s3">&quot;l&quot;</span><span class="s1">(i));</span>
    <span class="s2">return </span><span class="s1">h;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __ull2half_rd(</span><span class="s2">const unsigned long long int </span><span class="s1">i)</span>
<span class="s1">{</span>
    <span class="s1">__half h;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rm.f16.u64 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(h)) : </span><span class="s3">&quot;l&quot;</span><span class="s1">(i));</span>
    <span class="s2">return </span><span class="s1">h;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __ull2half_ru(</span><span class="s2">const unsigned long long int </span><span class="s1">i)</span>
<span class="s1">{</span>
    <span class="s1">__half h;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rp.f16.u64 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(h)) : </span><span class="s3">&quot;l&quot;</span><span class="s1">(i));</span>
    <span class="s2">return </span><span class="s1">h;</span>
<span class="s1">}</span>

<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">long long int </span><span class="s1">__half2ll_rn(</span><span class="s2">const </span><span class="s1">__half h)</span>
<span class="s1">{</span>
    <span class="s2">long long int </span><span class="s1">i;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rni.s64.f16 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=l&quot;</span><span class="s1">(i) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(h)));</span>
    <span class="s2">return </span><span class="s1">i;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_HOSTDEVICE_FP16_DECL__ </span><span class="s2">long long int </span><span class="s1">__half2ll_rz(</span><span class="s2">const </span><span class="s1">__half h)</span>
<span class="s1">{</span>
    <span class="s2">long long int </span><span class="s1">i;</span>
<span class="s2">#if </span><span class="s1">defined __CUDA_ARCH__</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rzi.s64.f16 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=l&quot;</span><span class="s1">(i) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(h)));</span>
<span class="s2">#else</span>
    <span class="s2">const float </span><span class="s1">f = __half2float(h);</span>
                <span class="s1">i = </span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">long long int</span><span class="s1">&gt;(f);</span>
    <span class="s2">const long long int </span><span class="s1">max_val = (</span><span class="s2">long long int</span><span class="s1">)</span><span class="s4">0x7fffffffffffffff</span><span class="s1">ULL;</span>
    <span class="s2">const long long int </span><span class="s1">min_val = (</span><span class="s2">long long int</span><span class="s1">)</span><span class="s4">0x8000000000000000</span><span class="s1">ULL;</span>
    <span class="s0">// saturation fixup</span>
    <span class="s2">if </span><span class="s1">(f != f) {</span>
        <span class="s0">// NaN</span>
        <span class="s1">i = min_val;</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(f &gt; </span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">float</span><span class="s1">&gt;(max_val)) {</span>
        <span class="s0">// saturate maximum</span>
        <span class="s1">i = max_val;</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(f &lt; </span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">float</span><span class="s1">&gt;(min_val)) {</span>
        <span class="s0">// saturate minimum</span>
        <span class="s1">i = min_val;</span>
    <span class="s1">}</span>
<span class="s2">#endif</span>
    <span class="s2">return </span><span class="s1">i;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">long long int </span><span class="s1">__half2ll_rd(</span><span class="s2">const </span><span class="s1">__half h)</span>
<span class="s1">{</span>
    <span class="s2">long long int </span><span class="s1">i;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rmi.s64.f16 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=l&quot;</span><span class="s1">(i) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(h)));</span>
    <span class="s2">return </span><span class="s1">i;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">long long int </span><span class="s1">__half2ll_ru(</span><span class="s2">const </span><span class="s1">__half h)</span>
<span class="s1">{</span>
    <span class="s2">long long int </span><span class="s1">i;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rpi.s64.f16 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=l&quot;</span><span class="s1">(i) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(h)));</span>
    <span class="s2">return </span><span class="s1">i;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_HOSTDEVICE_FP16_DECL__ __half __ll2half_rn(</span><span class="s2">const long long int </span><span class="s1">i)</span>
<span class="s1">{</span>
    <span class="s1">__half h;</span>
<span class="s2">#if </span><span class="s1">defined(__CUDA_ARCH__)</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rn.f16.s64 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(h)) : </span><span class="s3">&quot;l&quot;</span><span class="s1">(i));</span>
<span class="s2">#else</span>
    <span class="s0">// double-rounding is not a problem here: if integer</span>
    <span class="s0">// has more than 24 bits, it is already too large to</span>
    <span class="s0">// be represented in half precision, and result will</span>
    <span class="s0">// be infinity.</span>
    <span class="s2">const float  </span><span class="s1">f = </span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">float</span><span class="s1">&gt;(i);</span>
                 <span class="s1">h = __float2half_rn(f);</span>
<span class="s2">#endif</span>
    <span class="s2">return </span><span class="s1">h;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __ll2half_rz(</span><span class="s2">const long long int </span><span class="s1">i)</span>
<span class="s1">{</span>
    <span class="s1">__half h;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rz.f16.s64 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(h)) : </span><span class="s3">&quot;l&quot;</span><span class="s1">(i));</span>
    <span class="s2">return </span><span class="s1">h;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __ll2half_rd(</span><span class="s2">const long long int </span><span class="s1">i)</span>
<span class="s1">{</span>
    <span class="s1">__half h;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rm.f16.s64 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(h)) : </span><span class="s3">&quot;l&quot;</span><span class="s1">(i));</span>
    <span class="s2">return </span><span class="s1">h;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __ll2half_ru(</span><span class="s2">const long long int </span><span class="s1">i)</span>
<span class="s1">{</span>
    <span class="s1">__half h;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rp.f16.s64 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(h)) : </span><span class="s3">&quot;l&quot;</span><span class="s1">(i));</span>
    <span class="s2">return </span><span class="s1">h;</span>
<span class="s1">}</span>

<span class="s1">__CUDA_FP16_DECL__ __half htrunc(</span><span class="s2">const </span><span class="s1">__half h)</span>
<span class="s1">{</span>
    <span class="s1">__half r;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rzi.f16.f16 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(r)) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(h)));</span>
    <span class="s2">return </span><span class="s1">r;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half hceil(</span><span class="s2">const </span><span class="s1">__half h)</span>
<span class="s1">{</span>
    <span class="s1">__half r;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rpi.f16.f16 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(r)) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(h)));</span>
    <span class="s2">return </span><span class="s1">r;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half hfloor(</span><span class="s2">const </span><span class="s1">__half h)</span>
<span class="s1">{</span>
    <span class="s1">__half r;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rmi.f16.f16 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(r)) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(h)));</span>
    <span class="s2">return </span><span class="s1">r;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half hrint(</span><span class="s2">const </span><span class="s1">__half h)</span>
<span class="s1">{</span>
    <span class="s1">__half r;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;cvt.rni.f16.f16 %0, %1;&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(r)) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(h)));</span>
    <span class="s2">return </span><span class="s1">r;</span>
<span class="s1">}</span>

<span class="s1">__CUDA_FP16_DECL__ __half2 h2trunc(</span><span class="s2">const </span><span class="s1">__half2 h)</span>
<span class="s1">{</span>
    <span class="s1">__half2 val;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{.reg .f16 low,high;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32 {low,high}, %1;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.rzi.f16.f16 low, low;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.rzi.f16.f16 high, high;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32 %0, {low,high};}</span><span class="s2">\n</span><span class="s3">&quot; </span><span class="s1">: </span><span class="s3">&quot;=r&quot;</span><span class="s1">(__HALF2_TO_UI(val)) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(h)));</span>
    <span class="s2">return </span><span class="s1">val;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 h2ceil(</span><span class="s2">const </span><span class="s1">__half2 h)</span>
<span class="s1">{</span>
    <span class="s1">__half2 val;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{.reg .f16 low,high;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32 {low,high}, %1;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.rpi.f16.f16 low, low;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.rpi.f16.f16 high, high;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32 %0, {low,high};}</span><span class="s2">\n</span><span class="s3">&quot; </span><span class="s1">: </span><span class="s3">&quot;=r&quot;</span><span class="s1">(__HALF2_TO_UI(val)) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(h)));</span>
    <span class="s2">return </span><span class="s1">val;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 h2floor(</span><span class="s2">const </span><span class="s1">__half2 h)</span>
<span class="s1">{</span>
    <span class="s1">__half2 val;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{.reg .f16 low,high;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32 {low,high}, %1;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.rmi.f16.f16 low, low;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.rmi.f16.f16 high, high;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32 %0, {low,high};}</span><span class="s2">\n</span><span class="s3">&quot; </span><span class="s1">: </span><span class="s3">&quot;=r&quot;</span><span class="s1">(__HALF2_TO_UI(val)) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(h)));</span>
    <span class="s2">return </span><span class="s1">val;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 h2rint(</span><span class="s2">const </span><span class="s1">__half2 h)</span>
<span class="s1">{</span>
    <span class="s1">__half2 val;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{.reg .f16 low,high;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32 {low,high}, %1;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.rni.f16.f16 low, low;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.rni.f16.f16 high, high;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32 %0, {low,high};}</span><span class="s2">\n</span><span class="s3">&quot; </span><span class="s1">: </span><span class="s3">&quot;=r&quot;</span><span class="s1">(__HALF2_TO_UI(val)) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(h)));</span>
    <span class="s2">return </span><span class="s1">val;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __lows2half2(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b)</span>
<span class="s1">{</span>
    <span class="s1">__half2 val;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{.reg .f16 alow,ahigh,blow,bhigh;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32 {alow,ahigh}, %1;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32 {blow,bhigh}, %2;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32 %0, {alow,blow};}</span><span class="s2">\n</span><span class="s3">&quot; </span><span class="s1">: </span><span class="s3">&quot;=r&quot;</span><span class="s1">(__HALF2_TO_UI(val)) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(a)), </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(b)));</span>
    <span class="s2">return </span><span class="s1">val;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __highs2half2(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b)</span>
<span class="s1">{</span>
    <span class="s1">__half2 val;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{.reg .f16 alow,ahigh,blow,bhigh;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32 {alow,ahigh}, %1;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32 {blow,bhigh}, %2;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32 %0, {ahigh,bhigh};}</span><span class="s2">\n</span><span class="s3">&quot; </span><span class="s1">: </span><span class="s3">&quot;=r&quot;</span><span class="s1">(__HALF2_TO_UI(val)) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(a)), </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(b)));</span>
    <span class="s2">return </span><span class="s1">val;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __low2half(</span><span class="s2">const </span><span class="s1">__half2 a)</span>
<span class="s1">{</span>
    <span class="s1">__half ret;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{.reg .f16 low,high;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot; mov.b32 {low,high}, %1;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot; mov.b16 %0, low;}&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(ret)) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(a)));</span>
    <span class="s2">return </span><span class="s1">ret;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">int </span><span class="s1">__hisinf(</span><span class="s2">const </span><span class="s1">__half a)</span>
<span class="s1">{</span>
    <span class="s2">int </span><span class="s1">retval;</span>
    <span class="s2">if </span><span class="s1">(__HALF_TO_CUS(a) == </span><span class="s4">0xFC00</span><span class="s1">U) {</span>
        <span class="s1">retval = -</span><span class="s4">1</span><span class="s1">;</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(__HALF_TO_CUS(a) == </span><span class="s4">0x7C00</span><span class="s1">U) {</span>
        <span class="s1">retval = </span><span class="s4">1</span><span class="s1">;</span>
    <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
        <span class="s1">retval = </span><span class="s4">0</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s2">return </span><span class="s1">retval;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __low2half2(</span><span class="s2">const </span><span class="s1">__half2 a)</span>
<span class="s1">{</span>
    <span class="s1">__half2 val;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{.reg .f16 low,high;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32 {low,high}, %1;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32 %0, {low,low};}</span><span class="s2">\n</span><span class="s3">&quot; </span><span class="s1">: </span><span class="s3">&quot;=r&quot;</span><span class="s1">(__HALF2_TO_UI(val)) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(a)));</span>
    <span class="s2">return </span><span class="s1">val;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __high2half2(</span><span class="s2">const </span><span class="s1">__half2 a)</span>
<span class="s1">{</span>
    <span class="s1">__half2 val;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{.reg .f16 low,high;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32 {low,high}, %1;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32 %0, {high,high};}</span><span class="s2">\n</span><span class="s3">&quot; </span><span class="s1">: </span><span class="s3">&quot;=r&quot;</span><span class="s1">(__HALF2_TO_UI(val)) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(a)));</span>
    <span class="s2">return </span><span class="s1">val;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __high2half(</span><span class="s2">const </span><span class="s1">__half2 a)</span>
<span class="s1">{</span>
    <span class="s1">__half ret;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{.reg .f16 low,high;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot; mov.b32 {low,high}, %1;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot; mov.b16 %0, high;}&quot; </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(ret)) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(a)));</span>
    <span class="s2">return </span><span class="s1">ret;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __halves2half2(</span><span class="s2">const </span><span class="s1">__half a, </span><span class="s2">const </span><span class="s1">__half b)</span>
<span class="s1">{</span>
    <span class="s1">__half2 val;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{  mov.b32 %0, {%1,%2};}</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s1">: </span><span class="s3">&quot;=r&quot;</span><span class="s1">(__HALF2_TO_UI(val)) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(a)), </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(b)));</span>
    <span class="s2">return </span><span class="s1">val;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __half2half2(</span><span class="s2">const </span><span class="s1">__half a)</span>
<span class="s1">{</span>
    <span class="s1">__half2 val;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{  mov.b32 %0, {%1,%1};}</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s1">: </span><span class="s3">&quot;=r&quot;</span><span class="s1">(__HALF2_TO_UI(val)) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(a)));</span>
    <span class="s2">return </span><span class="s1">val;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __lowhigh2highlow(</span><span class="s2">const </span><span class="s1">__half2 a)</span>
<span class="s1">{</span>
    <span class="s1">__half2 val;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{.reg .f16 low,high;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32 {low,high}, %1;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32 %0, {high,low};}</span><span class="s2">\n</span><span class="s3">&quot; </span><span class="s1">: </span><span class="s3">&quot;=r&quot;</span><span class="s1">(__HALF2_TO_UI(val)) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(a)));</span>
    <span class="s2">return </span><span class="s1">val;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">short int </span><span class="s1">__half_as_short(</span><span class="s2">const </span><span class="s1">__half h)</span>
<span class="s1">{</span>
    <span class="s2">return </span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">short int</span><span class="s1">&gt;(__HALF_TO_CUS(h));</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">unsigned short int </span><span class="s1">__half_as_ushort(</span><span class="s2">const </span><span class="s1">__half h)</span>
<span class="s1">{</span>
    <span class="s2">return </span><span class="s1">__HALF_TO_CUS(h);</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __short_as_half(</span><span class="s2">const short int </span><span class="s1">i)</span>
<span class="s1">{</span>
    <span class="s1">__half h;</span>
    <span class="s1">__HALF_TO_US(h) = </span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">unsigned short int</span><span class="s1">&gt;(i);</span>
    <span class="s2">return </span><span class="s1">h;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __ushort_as_half(</span><span class="s2">const unsigned short int </span><span class="s1">i)</span>
<span class="s1">{</span>
    <span class="s1">__half h;</span>
    <span class="s1">__HALF_TO_US(h) = i;</span>
    <span class="s2">return </span><span class="s1">h;</span>
<span class="s1">}</span>

<span class="s2">#if </span><span class="s1">__CUDA_ARCH__ &gt;= </span><span class="s4">300 </span><span class="s1">|| !defined(__CUDA_ARCH__)</span>
<span class="s0">/****************************************************************************** 
*                           __half, __half2 warp shuffle                     * 
******************************************************************************/</span>
<span class="s2">#define </span><span class="s1">__SHUFFLE_HALF2_MACRO(name) </span><span class="s0">/* do */ </span><span class="s1">{\</span>
   <span class="s1">__half2 r; \</span>
   <span class="s5">asm </span><span class="s2">volatile </span><span class="s1">(</span><span class="s3">&quot;{&quot;</span><span class="s1">#name</span><span class="s3">&quot; %0,%1,%2,%3;</span><span class="s2">\n</span><span class="s3">}&quot; </span><span class="s1">\</span>
       <span class="s1">:</span><span class="s3">&quot;=r&quot;</span><span class="s1">(__HALF2_TO_UI(r)): </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(var)), </span><span class="s3">&quot;r&quot;</span><span class="s1">(delta), </span><span class="s3">&quot;r&quot;</span><span class="s1">(c)); \</span>
   <span class="s2">return </span><span class="s1">r; \</span>
<span class="s1">} </span><span class="s0">/* while(0) */</span>

<span class="s2">#define </span><span class="s1">__SHUFFLE_SYNC_HALF2_MACRO(name) </span><span class="s0">/* do */ </span><span class="s1">{\</span>
   <span class="s1">__half2 r; \</span>
   <span class="s5">asm </span><span class="s2">volatile </span><span class="s1">(</span><span class="s3">&quot;{&quot;</span><span class="s1">#name</span><span class="s3">&quot; %0,%1,%2,%3,%4;</span><span class="s2">\n</span><span class="s3">}&quot; </span><span class="s1">\</span>
       <span class="s1">:</span><span class="s3">&quot;=r&quot;</span><span class="s1">(__HALF2_TO_UI(r)): </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(var)), </span><span class="s3">&quot;r&quot;</span><span class="s1">(delta), </span><span class="s3">&quot;r&quot;</span><span class="s1">(c), </span><span class="s3">&quot;r&quot;</span><span class="s1">(mask)); \</span>
   <span class="s2">return </span><span class="s1">r; \</span>
<span class="s1">} </span><span class="s0">/* while(0) */</span>

<span class="s2">#if </span><span class="s1">!defined(__CUDA_ARCH__) || __CUDA_ARCH__ &lt; </span><span class="s4">700</span>

<span class="s1">__CUDA_FP16_DECL__ __half2 __shfl(</span><span class="s2">const </span><span class="s1">__half2 var, </span><span class="s2">const int </span><span class="s1">delta, </span><span class="s2">const int </span><span class="s1">width)</span>
<span class="s1">{</span>
    <span class="s2">unsigned int </span><span class="s1">warp_size;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{mov.u32 %0, WARP_SZ;</span><span class="s2">\n</span><span class="s3">}&quot; </span><span class="s1">: </span><span class="s3">&quot;=r&quot;</span><span class="s1">(warp_size));</span>
    <span class="s2">const unsigned int </span><span class="s1">c = ((warp_size - </span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">unsigned</span><span class="s1">&gt;(width)) &lt;&lt; </span><span class="s4">8</span><span class="s1">U) | </span><span class="s4">0x1f</span><span class="s1">U;</span>
    <span class="s1">__SHUFFLE_HALF2_MACRO(shfl.idx.b32)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __shfl_up(</span><span class="s2">const </span><span class="s1">__half2 var, </span><span class="s2">const unsigned int </span><span class="s1">delta, </span><span class="s2">const int </span><span class="s1">width)</span>
<span class="s1">{</span>
    <span class="s2">unsigned int </span><span class="s1">warp_size;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{mov.u32 %0, WARP_SZ;</span><span class="s2">\n</span><span class="s3">}&quot; </span><span class="s1">: </span><span class="s3">&quot;=r&quot;</span><span class="s1">(warp_size));</span>
    <span class="s2">const unsigned int </span><span class="s1">c = (warp_size - </span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">unsigned</span><span class="s1">&gt;(width)) &lt;&lt; </span><span class="s4">8</span><span class="s1">U;</span>
    <span class="s1">__SHUFFLE_HALF2_MACRO(shfl.up.b32)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __shfl_down(</span><span class="s2">const </span><span class="s1">__half2 var, </span><span class="s2">const unsigned int </span><span class="s1">delta, </span><span class="s2">const int </span><span class="s1">width)</span>
<span class="s1">{</span>
    <span class="s2">unsigned int </span><span class="s1">warp_size;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{mov.u32 %0, WARP_SZ;</span><span class="s2">\n</span><span class="s3">}&quot; </span><span class="s1">: </span><span class="s3">&quot;=r&quot;</span><span class="s1">(warp_size));</span>
    <span class="s2">const unsigned int </span><span class="s1">c = ((warp_size - </span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">unsigned</span><span class="s1">&gt;(width)) &lt;&lt; </span><span class="s4">8</span><span class="s1">U) | </span><span class="s4">0x1f</span><span class="s1">U;</span>
    <span class="s1">__SHUFFLE_HALF2_MACRO(shfl.down.b32)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __shfl_xor(</span><span class="s2">const </span><span class="s1">__half2 var, </span><span class="s2">const int </span><span class="s1">delta, </span><span class="s2">const int </span><span class="s1">width)</span>
<span class="s1">{</span>
    <span class="s2">unsigned int </span><span class="s1">warp_size;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{mov.u32 %0, WARP_SZ;</span><span class="s2">\n</span><span class="s3">}&quot; </span><span class="s1">: </span><span class="s3">&quot;=r&quot;</span><span class="s1">(warp_size));</span>
    <span class="s2">const unsigned int </span><span class="s1">c = ((warp_size - </span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">unsigned</span><span class="s1">&gt;(width)) &lt;&lt; </span><span class="s4">8</span><span class="s1">U) | </span><span class="s4">0x1f</span><span class="s1">U;</span>
    <span class="s1">__SHUFFLE_HALF2_MACRO(shfl.bfly.b32)</span>
<span class="s1">}</span>

<span class="s2">#endif </span><span class="s0">/* !defined(__CUDA_ARCH__) || __CUDA_ARCH__ &lt; 700 */</span>

<span class="s1">__CUDA_FP16_DECL__ __half2 __shfl_sync(</span><span class="s2">const unsigned </span><span class="s1">mask, </span><span class="s2">const </span><span class="s1">__half2 var, </span><span class="s2">const int </span><span class="s1">delta, </span><span class="s2">const int </span><span class="s1">width)</span>
<span class="s1">{</span>
    <span class="s2">unsigned int </span><span class="s1">warp_size;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{mov.u32 %0, WARP_SZ;</span><span class="s2">\n</span><span class="s3">}&quot; </span><span class="s1">: </span><span class="s3">&quot;=r&quot;</span><span class="s1">(warp_size));</span>
    <span class="s2">const unsigned int </span><span class="s1">c = ((warp_size - </span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">unsigned</span><span class="s1">&gt;(width)) &lt;&lt; </span><span class="s4">8</span><span class="s1">U) | </span><span class="s4">0x1f</span><span class="s1">U;</span>
    <span class="s1">__SHUFFLE_SYNC_HALF2_MACRO(shfl.sync.idx.b32)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __shfl_up_sync(</span><span class="s2">const unsigned </span><span class="s1">mask, </span><span class="s2">const </span><span class="s1">__half2 var, </span><span class="s2">const unsigned int </span><span class="s1">delta, </span><span class="s2">const int </span><span class="s1">width)</span>
<span class="s1">{</span>
    <span class="s2">unsigned int </span><span class="s1">warp_size;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{mov.u32 %0, WARP_SZ;</span><span class="s2">\n</span><span class="s3">}&quot; </span><span class="s1">: </span><span class="s3">&quot;=r&quot;</span><span class="s1">(warp_size));</span>
    <span class="s2">const unsigned int </span><span class="s1">c = (warp_size - </span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">unsigned</span><span class="s1">&gt;(width)) &lt;&lt; </span><span class="s4">8</span><span class="s1">U;</span>
    <span class="s1">__SHUFFLE_SYNC_HALF2_MACRO(shfl.sync.up.b32)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __shfl_down_sync(</span><span class="s2">const unsigned </span><span class="s1">mask, </span><span class="s2">const </span><span class="s1">__half2 var, </span><span class="s2">const unsigned int </span><span class="s1">delta, </span><span class="s2">const int </span><span class="s1">width)</span>
<span class="s1">{</span>
    <span class="s2">unsigned int </span><span class="s1">warp_size;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{mov.u32 %0, WARP_SZ;</span><span class="s2">\n</span><span class="s3">}&quot; </span><span class="s1">: </span><span class="s3">&quot;=r&quot;</span><span class="s1">(warp_size));</span>
    <span class="s2">const unsigned int </span><span class="s1">c = ((warp_size - </span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">unsigned</span><span class="s1">&gt;(width)) &lt;&lt; </span><span class="s4">8</span><span class="s1">U) | </span><span class="s4">0x1f</span><span class="s1">U;</span>
    <span class="s1">__SHUFFLE_SYNC_HALF2_MACRO(shfl.sync.down.b32)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __shfl_xor_sync(</span><span class="s2">const unsigned </span><span class="s1">mask, </span><span class="s2">const </span><span class="s1">__half2 var, </span><span class="s2">const int </span><span class="s1">delta, </span><span class="s2">const int </span><span class="s1">width)</span>
<span class="s1">{</span>
    <span class="s2">unsigned int </span><span class="s1">warp_size;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{mov.u32 %0, WARP_SZ;</span><span class="s2">\n</span><span class="s3">}&quot; </span><span class="s1">: </span><span class="s3">&quot;=r&quot;</span><span class="s1">(warp_size));</span>
    <span class="s2">const unsigned int </span><span class="s1">c = ((warp_size - </span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">unsigned</span><span class="s1">&gt;(width)) &lt;&lt; </span><span class="s4">8</span><span class="s1">U) | </span><span class="s4">0x1f</span><span class="s1">U;</span>
    <span class="s1">__SHUFFLE_SYNC_HALF2_MACRO(shfl.sync.bfly.b32)</span>
<span class="s1">}</span>

<span class="s2">#undef </span><span class="s1">__SHUFFLE_HALF2_MACRO</span>
<span class="s2">#undef </span><span class="s1">__SHUFFLE_SYNC_HALF2_MACRO</span>

<span class="s2">#if </span><span class="s1">!defined(__CUDA_ARCH__) || __CUDA_ARCH__ &lt; </span><span class="s4">700</span>

<span class="s1">__CUDA_FP16_DECL__ __half __shfl(</span><span class="s2">const </span><span class="s1">__half var, </span><span class="s2">const int </span><span class="s1">delta, </span><span class="s2">const int </span><span class="s1">width)</span>
<span class="s1">{</span>
    <span class="s2">const </span><span class="s1">__half2 temp1 = __halves2half2(var, var);</span>
    <span class="s2">const </span><span class="s1">__half2 temp2 = __shfl(temp1, delta, width);</span>
    <span class="s2">return </span><span class="s1">__low2half(temp2);</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __shfl_up(</span><span class="s2">const </span><span class="s1">__half var, </span><span class="s2">const unsigned int </span><span class="s1">delta, </span><span class="s2">const int </span><span class="s1">width)</span>
<span class="s1">{</span>
    <span class="s2">const </span><span class="s1">__half2 temp1 = __halves2half2(var, var);</span>
    <span class="s2">const </span><span class="s1">__half2 temp2 = __shfl_up(temp1, delta, width);</span>
    <span class="s2">return </span><span class="s1">__low2half(temp2);</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __shfl_down(</span><span class="s2">const </span><span class="s1">__half var, </span><span class="s2">const unsigned int </span><span class="s1">delta, </span><span class="s2">const int </span><span class="s1">width)</span>
<span class="s1">{</span>
    <span class="s2">const </span><span class="s1">__half2 temp1 = __halves2half2(var, var);</span>
    <span class="s2">const </span><span class="s1">__half2 temp2 = __shfl_down(temp1, delta, width);</span>
    <span class="s2">return </span><span class="s1">__low2half(temp2);</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __shfl_xor(</span><span class="s2">const </span><span class="s1">__half var, </span><span class="s2">const int </span><span class="s1">delta, </span><span class="s2">const int </span><span class="s1">width)</span>
<span class="s1">{</span>
    <span class="s2">const </span><span class="s1">__half2 temp1 = __halves2half2(var, var);</span>
    <span class="s2">const </span><span class="s1">__half2 temp2 = __shfl_xor(temp1, delta, width);</span>
    <span class="s2">return </span><span class="s1">__low2half(temp2);</span>
<span class="s1">}</span>

<span class="s2">#endif </span><span class="s0">/* !defined(__CUDA_ARCH__) || __CUDA_ARCH__ &lt; 700 */</span>

<span class="s1">__CUDA_FP16_DECL__ __half __shfl_sync(</span><span class="s2">const unsigned </span><span class="s1">mask, </span><span class="s2">const </span><span class="s1">__half var, </span><span class="s2">const int </span><span class="s1">delta, </span><span class="s2">const int </span><span class="s1">width)</span>
<span class="s1">{</span>
    <span class="s2">const </span><span class="s1">__half2 temp1 = __halves2half2(var, var);</span>
    <span class="s2">const </span><span class="s1">__half2 temp2 = __shfl_sync(mask, temp1, delta, width);</span>
    <span class="s2">return </span><span class="s1">__low2half(temp2);</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __shfl_up_sync(</span><span class="s2">const unsigned </span><span class="s1">mask, </span><span class="s2">const </span><span class="s1">__half var, </span><span class="s2">const unsigned int </span><span class="s1">delta, </span><span class="s2">const int </span><span class="s1">width)</span>
<span class="s1">{</span>
    <span class="s2">const </span><span class="s1">__half2 temp1 = __halves2half2(var, var);</span>
    <span class="s2">const </span><span class="s1">__half2 temp2 = __shfl_up_sync(mask, temp1, delta, width);</span>
    <span class="s2">return </span><span class="s1">__low2half(temp2);</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __shfl_down_sync(</span><span class="s2">const unsigned </span><span class="s1">mask, </span><span class="s2">const </span><span class="s1">__half var, </span><span class="s2">const unsigned int </span><span class="s1">delta, </span><span class="s2">const int </span><span class="s1">width)</span>
<span class="s1">{</span>
    <span class="s2">const </span><span class="s1">__half2 temp1 = __halves2half2(var, var);</span>
    <span class="s2">const </span><span class="s1">__half2 temp2 = __shfl_down_sync(mask, temp1, delta, width);</span>
    <span class="s2">return </span><span class="s1">__low2half(temp2);</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __shfl_xor_sync(</span><span class="s2">const unsigned </span><span class="s1">mask, </span><span class="s2">const </span><span class="s1">__half var, </span><span class="s2">const int </span><span class="s1">delta, </span><span class="s2">const int </span><span class="s1">width)</span>
<span class="s1">{</span>
    <span class="s2">const </span><span class="s1">__half2 temp1 = __halves2half2(var, var);</span>
    <span class="s2">const </span><span class="s1">__half2 temp2 = __shfl_xor_sync(mask, temp1, delta, width);</span>
    <span class="s2">return </span><span class="s1">__low2half(temp2);</span>
<span class="s1">}</span>

<span class="s2">#endif </span><span class="s0">/*__CUDA_ARCH__ &gt;= 300 || !defined(__CUDA_ARCH__)*/</span>
<span class="s0">/****************************************************************************** 
*               __half and __half2 __ldg,__ldcg,__ldca,__ldcs                * 
******************************************************************************/</span>

<span class="s2">#if </span><span class="s1">defined(__cplusplus) &amp;&amp; (__CUDA_ARCH__ &gt;= </span><span class="s4">320 </span><span class="s1">|| !defined(__CUDA_ARCH__))</span>
<span class="s2">#if </span><span class="s1">(defined(_MSC_VER) &amp;&amp; defined(_WIN64)) || defined(__LP64__) || defined(__CUDACC_RTC__)</span>
<span class="s2">#define </span><span class="s1">__LDG_PTR   </span><span class="s3">&quot;l&quot;</span>
<span class="s2">#else</span>
<span class="s2">#define </span><span class="s1">__LDG_PTR   </span><span class="s3">&quot;r&quot;</span>
<span class="s2">#endif </span><span class="s0">/*(defined(_MSC_VER) &amp;&amp; defined(_WIN64)) || defined(__LP64__) || defined(__CUDACC_RTC__)*/</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __ldg(</span><span class="s2">const  </span><span class="s1">__half2 *</span><span class="s2">const </span><span class="s1">ptr)</span>
<span class="s1">{</span>
    <span class="s1">__half2 ret;</span>
    <span class="s5">asm </span><span class="s1">(</span><span class="s3">&quot;ld.global.nc.b32 %0, [%1];&quot;  </span><span class="s1">: </span><span class="s3">&quot;=r&quot;</span><span class="s1">(__HALF2_TO_UI(ret)) : __LDG_PTR(ptr));</span>
    <span class="s2">return </span><span class="s1">ret;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __ldg(</span><span class="s2">const </span><span class="s1">__half *</span><span class="s2">const </span><span class="s1">ptr)</span>
<span class="s1">{</span>
    <span class="s1">__half ret;</span>
    <span class="s5">asm </span><span class="s1">(</span><span class="s3">&quot;ld.global.nc.b16 %0, [%1];&quot;  </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(ret)) : __LDG_PTR(ptr));</span>
    <span class="s2">return </span><span class="s1">ret;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __ldcg(</span><span class="s2">const  </span><span class="s1">__half2 *</span><span class="s2">const </span><span class="s1">ptr)</span>
<span class="s1">{</span>
    <span class="s1">__half2 ret;</span>
    <span class="s5">asm </span><span class="s1">(</span><span class="s3">&quot;ld.global.cg.b32 %0, [%1];&quot;  </span><span class="s1">: </span><span class="s3">&quot;=r&quot;</span><span class="s1">(__HALF2_TO_UI(ret)) : __LDG_PTR(ptr));</span>
    <span class="s2">return </span><span class="s1">ret;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __ldcg(</span><span class="s2">const </span><span class="s1">__half *</span><span class="s2">const </span><span class="s1">ptr)</span>
<span class="s1">{</span>
    <span class="s1">__half ret;</span>
    <span class="s5">asm </span><span class="s1">(</span><span class="s3">&quot;ld.global.cg.b16 %0, [%1];&quot;  </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(ret)) : __LDG_PTR(ptr));</span>
    <span class="s2">return </span><span class="s1">ret;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __ldca(</span><span class="s2">const  </span><span class="s1">__half2 *</span><span class="s2">const </span><span class="s1">ptr)</span>
<span class="s1">{</span>
    <span class="s1">__half2 ret;</span>
    <span class="s5">asm </span><span class="s1">(</span><span class="s3">&quot;ld.global.ca.b32 %0, [%1];&quot;  </span><span class="s1">: </span><span class="s3">&quot;=r&quot;</span><span class="s1">(__HALF2_TO_UI(ret)) : __LDG_PTR(ptr));</span>
    <span class="s2">return </span><span class="s1">ret;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __ldca(</span><span class="s2">const </span><span class="s1">__half *</span><span class="s2">const </span><span class="s1">ptr)</span>
<span class="s1">{</span>
    <span class="s1">__half ret;</span>
    <span class="s5">asm </span><span class="s1">(</span><span class="s3">&quot;ld.global.ca.b16 %0, [%1];&quot;  </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(ret)) : __LDG_PTR(ptr));</span>
    <span class="s2">return </span><span class="s1">ret;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __ldcs(</span><span class="s2">const  </span><span class="s1">__half2 *</span><span class="s2">const </span><span class="s1">ptr)</span>
<span class="s1">{</span>
    <span class="s1">__half2 ret;</span>
    <span class="s5">asm </span><span class="s1">(</span><span class="s3">&quot;ld.global.cs.b32 %0, [%1];&quot;  </span><span class="s1">: </span><span class="s3">&quot;=r&quot;</span><span class="s1">(__HALF2_TO_UI(ret)) : __LDG_PTR(ptr));</span>
    <span class="s2">return </span><span class="s1">ret;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __ldcs(</span><span class="s2">const </span><span class="s1">__half *</span><span class="s2">const </span><span class="s1">ptr)</span>
<span class="s1">{</span>
    <span class="s1">__half ret;</span>
    <span class="s5">asm </span><span class="s1">(</span><span class="s3">&quot;ld.global.cs.b16 %0, [%1];&quot;  </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(ret)) : __LDG_PTR(ptr));</span>
    <span class="s2">return </span><span class="s1">ret;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __ldlu(</span><span class="s2">const  </span><span class="s1">__half2 *</span><span class="s2">const </span><span class="s1">ptr)</span>
<span class="s1">{</span>
    <span class="s1">__half2 ret;</span>
    <span class="s5">asm </span><span class="s1">(</span><span class="s3">&quot;ld.global.lu.b32 %0, [%1];&quot;  </span><span class="s1">: </span><span class="s3">&quot;=r&quot;</span><span class="s1">(__HALF2_TO_UI(ret)) : __LDG_PTR(ptr) : </span><span class="s3">&quot;memory&quot;</span><span class="s1">);</span>
    <span class="s2">return </span><span class="s1">ret;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __ldlu(</span><span class="s2">const </span><span class="s1">__half *</span><span class="s2">const </span><span class="s1">ptr)</span>
<span class="s1">{</span>
    <span class="s1">__half ret;</span>
    <span class="s5">asm </span><span class="s1">(</span><span class="s3">&quot;ld.global.lu.b16 %0, [%1];&quot;  </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(ret)) : __LDG_PTR(ptr) : </span><span class="s3">&quot;memory&quot;</span><span class="s1">);</span>
    <span class="s2">return </span><span class="s1">ret;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __ldcv(</span><span class="s2">const  </span><span class="s1">__half2 *</span><span class="s2">const </span><span class="s1">ptr)</span>
<span class="s1">{</span>
    <span class="s1">__half2 ret;</span>
    <span class="s5">asm </span><span class="s1">(</span><span class="s3">&quot;ld.global.cv.b32 %0, [%1];&quot;  </span><span class="s1">: </span><span class="s3">&quot;=r&quot;</span><span class="s1">(__HALF2_TO_UI(ret)) : __LDG_PTR(ptr) : </span><span class="s3">&quot;memory&quot;</span><span class="s1">);</span>
    <span class="s2">return </span><span class="s1">ret;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __ldcv(</span><span class="s2">const </span><span class="s1">__half *</span><span class="s2">const </span><span class="s1">ptr)</span>
<span class="s1">{</span>
    <span class="s1">__half ret;</span>
    <span class="s5">asm </span><span class="s1">(</span><span class="s3">&quot;ld.global.cv.b16 %0, [%1];&quot;  </span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(ret)) : __LDG_PTR(ptr) : </span><span class="s3">&quot;memory&quot;</span><span class="s1">);</span>
    <span class="s2">return </span><span class="s1">ret;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">void </span><span class="s1">__stwb(__half2 *</span><span class="s2">const </span><span class="s1">ptr, </span><span class="s2">const </span><span class="s1">__half2 value)</span>
<span class="s1">{</span>
    <span class="s5">asm </span><span class="s1">(</span><span class="s3">&quot;st.global.wb.b32 [%0], %1;&quot;  </span><span class="s1">:: __LDG_PTR(ptr), </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(value)) : </span><span class="s3">&quot;memory&quot;</span><span class="s1">);</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">void </span><span class="s1">__stwb(__half *</span><span class="s2">const </span><span class="s1">ptr, </span><span class="s2">const </span><span class="s1">__half value)</span>
<span class="s1">{</span>
    <span class="s5">asm </span><span class="s1">(</span><span class="s3">&quot;st.global.wb.b16 [%0], %1;&quot;  </span><span class="s1">:: __LDG_PTR(ptr),  </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(value)) : </span><span class="s3">&quot;memory&quot;</span><span class="s1">);</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">void </span><span class="s1">__stcg(__half2 *</span><span class="s2">const </span><span class="s1">ptr, </span><span class="s2">const </span><span class="s1">__half2 value)</span>
<span class="s1">{</span>
    <span class="s5">asm </span><span class="s1">(</span><span class="s3">&quot;st.global.cg.b32 [%0], %1;&quot;  </span><span class="s1">:: __LDG_PTR(ptr), </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(value)) : </span><span class="s3">&quot;memory&quot;</span><span class="s1">);</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">void </span><span class="s1">__stcg(__half *</span><span class="s2">const </span><span class="s1">ptr, </span><span class="s2">const </span><span class="s1">__half value)</span>
<span class="s1">{</span>
    <span class="s5">asm </span><span class="s1">(</span><span class="s3">&quot;st.global.cg.b16 [%0], %1;&quot;  </span><span class="s1">:: __LDG_PTR(ptr),  </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(value)) : </span><span class="s3">&quot;memory&quot;</span><span class="s1">);</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">void </span><span class="s1">__stcs(__half2 *</span><span class="s2">const </span><span class="s1">ptr, </span><span class="s2">const </span><span class="s1">__half2 value)</span>
<span class="s1">{</span>
    <span class="s5">asm </span><span class="s1">(</span><span class="s3">&quot;st.global.cs.b32 [%0], %1;&quot;  </span><span class="s1">:: __LDG_PTR(ptr), </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(value)) : </span><span class="s3">&quot;memory&quot;</span><span class="s1">);</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">void </span><span class="s1">__stcs(__half *</span><span class="s2">const </span><span class="s1">ptr, </span><span class="s2">const </span><span class="s1">__half value)</span>
<span class="s1">{</span>
    <span class="s5">asm </span><span class="s1">(</span><span class="s3">&quot;st.global.cs.b16 [%0], %1;&quot;  </span><span class="s1">:: __LDG_PTR(ptr),  </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(value)) : </span><span class="s3">&quot;memory&quot;</span><span class="s1">);</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">void </span><span class="s1">__stwt(__half2 *</span><span class="s2">const </span><span class="s1">ptr, </span><span class="s2">const </span><span class="s1">__half2 value)</span>
<span class="s1">{</span>
    <span class="s5">asm </span><span class="s1">(</span><span class="s3">&quot;st.global.wt.b32 [%0], %1;&quot;  </span><span class="s1">:: __LDG_PTR(ptr), </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(value)) : </span><span class="s3">&quot;memory&quot;</span><span class="s1">);</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">void </span><span class="s1">__stwt(__half *</span><span class="s2">const </span><span class="s1">ptr, </span><span class="s2">const </span><span class="s1">__half value)</span>
<span class="s1">{</span>
    <span class="s5">asm </span><span class="s1">(</span><span class="s3">&quot;st.global.wt.b16 [%0], %1;&quot;  </span><span class="s1">:: __LDG_PTR(ptr),  </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(value)) : </span><span class="s3">&quot;memory&quot;</span><span class="s1">);</span>
<span class="s1">}</span>
<span class="s2">#undef </span><span class="s1">__LDG_PTR</span>
<span class="s2">#endif </span><span class="s0">/*defined(__cplusplus) &amp;&amp; (__CUDA_ARCH__ &gt;= 320 || !defined(__CUDA_ARCH__))*/</span>
<span class="s2">#if </span><span class="s1">__CUDA_ARCH__ &gt;= </span><span class="s4">530 </span><span class="s1">|| !defined(__CUDA_ARCH__)</span>
<span class="s0">/****************************************************************************** 
*                             __half2 comparison                             * 
******************************************************************************/</span>
<span class="s2">#define </span><span class="s1">__COMPARISON_OP_HALF2_MACRO(name) </span><span class="s0">/* do */ </span><span class="s1">{\</span>
   <span class="s1">__half2 val; \</span>
   <span class="s5">asm</span><span class="s1">( </span><span class="s3">&quot;{ &quot;</span><span class="s1">#name</span><span class="s3">&quot;.f16x2.f16x2 %0,%1,%2;</span><span class="s2">\n</span><span class="s3">}&quot; </span><span class="s1">\</span>
        <span class="s1">:</span><span class="s3">&quot;=r&quot;</span><span class="s1">(__HALF2_TO_UI(val)) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(a)),</span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(b))); \</span>
   <span class="s2">return </span><span class="s1">val; \</span>
<span class="s1">} </span><span class="s0">/* while(0) */</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __heq2(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b)</span>
<span class="s1">{</span>
    <span class="s1">__COMPARISON_OP_HALF2_MACRO(set.eq)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __hne2(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b)</span>
<span class="s1">{</span>
    <span class="s1">__COMPARISON_OP_HALF2_MACRO(set.ne)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __hle2(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b)</span>
<span class="s1">{</span>
    <span class="s1">__COMPARISON_OP_HALF2_MACRO(set.le)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __hge2(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b)</span>
<span class="s1">{</span>
    <span class="s1">__COMPARISON_OP_HALF2_MACRO(set.ge)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __hlt2(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b)</span>
<span class="s1">{</span>
    <span class="s1">__COMPARISON_OP_HALF2_MACRO(set.lt)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __hgt2(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b)</span>
<span class="s1">{</span>
    <span class="s1">__COMPARISON_OP_HALF2_MACRO(set.gt)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __hequ2(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b)</span>
<span class="s1">{</span>
    <span class="s1">__COMPARISON_OP_HALF2_MACRO(set.equ)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __hneu2(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b)</span>
<span class="s1">{</span>
    <span class="s1">__COMPARISON_OP_HALF2_MACRO(set.neu)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __hleu2(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b)</span>
<span class="s1">{</span>
    <span class="s1">__COMPARISON_OP_HALF2_MACRO(set.leu)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __hgeu2(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b)</span>
<span class="s1">{</span>
    <span class="s1">__COMPARISON_OP_HALF2_MACRO(set.geu)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __hltu2(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b)</span>
<span class="s1">{</span>
    <span class="s1">__COMPARISON_OP_HALF2_MACRO(set.ltu)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __hgtu2(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b)</span>
<span class="s1">{</span>
    <span class="s1">__COMPARISON_OP_HALF2_MACRO(set.gtu)</span>
<span class="s1">}</span>
<span class="s2">#undef </span><span class="s1">__COMPARISON_OP_HALF2_MACRO</span>
<span class="s2">#define </span><span class="s1">__BOOL_COMPARISON_OP_HALF2_MACRO(name) </span><span class="s0">/* do */ </span><span class="s1">{\</span>
   <span class="s1">__half2 val; \</span>
   <span class="s2">bool </span><span class="s1">retval; \</span>
   <span class="s5">asm</span><span class="s1">( </span><span class="s3">&quot;{ &quot;</span><span class="s1">#name</span><span class="s3">&quot;.f16x2.f16x2 %0,%1,%2;</span><span class="s2">\n</span><span class="s3">}&quot; </span><span class="s1">\</span>
        <span class="s1">:</span><span class="s3">&quot;=r&quot;</span><span class="s1">(__HALF2_TO_UI(val)) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(a)),</span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(b))); \</span>
   <span class="s2">if </span><span class="s1">(__HALF2_TO_CUI(val) == </span><span class="s4">0x3C003C00</span><span class="s1">U) {\</span>
      <span class="s1">retval = </span><span class="s5">true</span><span class="s1">; \</span>
   <span class="s1">} </span><span class="s2">else </span><span class="s1">{ \</span>
      <span class="s1">retval = </span><span class="s2">false</span><span class="s1">; \</span>
   <span class="s1">}\</span>
   <span class="s2">return </span><span class="s1">retval;\</span>
<span class="s1">} </span><span class="s0">/* while(0) */</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">bool </span><span class="s1">__hbeq2(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b)</span>
<span class="s1">{</span>
    <span class="s1">__BOOL_COMPARISON_OP_HALF2_MACRO(set.eq)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">bool </span><span class="s1">__hbne2(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b)</span>
<span class="s1">{</span>
    <span class="s1">__BOOL_COMPARISON_OP_HALF2_MACRO(set.ne)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">bool </span><span class="s1">__hble2(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b)</span>
<span class="s1">{</span>
    <span class="s1">__BOOL_COMPARISON_OP_HALF2_MACRO(set.le)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">bool </span><span class="s1">__hbge2(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b)</span>
<span class="s1">{</span>
    <span class="s1">__BOOL_COMPARISON_OP_HALF2_MACRO(set.ge)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">bool </span><span class="s1">__hblt2(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b)</span>
<span class="s1">{</span>
    <span class="s1">__BOOL_COMPARISON_OP_HALF2_MACRO(set.lt)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">bool </span><span class="s1">__hbgt2(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b)</span>
<span class="s1">{</span>
    <span class="s1">__BOOL_COMPARISON_OP_HALF2_MACRO(set.gt)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">bool </span><span class="s1">__hbequ2(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b)</span>
<span class="s1">{</span>
    <span class="s1">__BOOL_COMPARISON_OP_HALF2_MACRO(set.equ)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">bool </span><span class="s1">__hbneu2(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b)</span>
<span class="s1">{</span>
    <span class="s1">__BOOL_COMPARISON_OP_HALF2_MACRO(set.neu)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">bool </span><span class="s1">__hbleu2(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b)</span>
<span class="s1">{</span>
    <span class="s1">__BOOL_COMPARISON_OP_HALF2_MACRO(set.leu)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">bool </span><span class="s1">__hbgeu2(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b)</span>
<span class="s1">{</span>
    <span class="s1">__BOOL_COMPARISON_OP_HALF2_MACRO(set.geu)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">bool </span><span class="s1">__hbltu2(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b)</span>
<span class="s1">{</span>
    <span class="s1">__BOOL_COMPARISON_OP_HALF2_MACRO(set.ltu)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">bool </span><span class="s1">__hbgtu2(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b)</span>
<span class="s1">{</span>
    <span class="s1">__BOOL_COMPARISON_OP_HALF2_MACRO(set.gtu)</span>
<span class="s1">}</span>
<span class="s2">#undef </span><span class="s1">__BOOL_COMPARISON_OP_HALF2_MACRO</span>
<span class="s0">/****************************************************************************** 
*                             __half comparison                              * 
******************************************************************************/</span>
<span class="s2">#define </span><span class="s1">__COMPARISON_OP_HALF_MACRO(name) </span><span class="s0">/* do */ </span><span class="s1">{\</span>
   <span class="s2">unsigned short </span><span class="s1">val; \</span>
   <span class="s5">asm</span><span class="s1">( </span><span class="s3">&quot;{ .reg .pred __$temp3;</span><span class="s2">\n</span><span class="s3">&quot; </span><span class="s1">\</span>
        <span class="s3">&quot;  setp.&quot;</span><span class="s1">#name</span><span class="s3">&quot;.f16  __$temp3, %1, %2;</span><span class="s2">\n</span><span class="s3">&quot; </span><span class="s1">\</span>
        <span class="s3">&quot;  selp.u16 %0, 1, 0, __$temp3;}&quot; </span><span class="s1">\</span>
        <span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(val) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(a)), </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(b))); \</span>
   <span class="s2">return </span><span class="s1">(val != </span><span class="s4">0</span><span class="s1">U) ? </span><span class="s5">true </span><span class="s1">: </span><span class="s2">false</span><span class="s1">; \</span>
<span class="s1">} </span><span class="s0">/* while(0) */</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">bool </span><span class="s1">__heq(</span><span class="s2">const </span><span class="s1">__half a, </span><span class="s2">const </span><span class="s1">__half b)</span>
<span class="s1">{</span>
    <span class="s1">__COMPARISON_OP_HALF_MACRO(eq)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">bool </span><span class="s1">__hne(</span><span class="s2">const </span><span class="s1">__half a, </span><span class="s2">const </span><span class="s1">__half b)</span>
<span class="s1">{</span>
    <span class="s1">__COMPARISON_OP_HALF_MACRO(ne)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">bool </span><span class="s1">__hle(</span><span class="s2">const </span><span class="s1">__half a, </span><span class="s2">const </span><span class="s1">__half b)</span>
<span class="s1">{</span>
    <span class="s1">__COMPARISON_OP_HALF_MACRO(le)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">bool </span><span class="s1">__hge(</span><span class="s2">const </span><span class="s1">__half a, </span><span class="s2">const </span><span class="s1">__half b)</span>
<span class="s1">{</span>
    <span class="s1">__COMPARISON_OP_HALF_MACRO(ge)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">bool </span><span class="s1">__hlt(</span><span class="s2">const </span><span class="s1">__half a, </span><span class="s2">const </span><span class="s1">__half b)</span>
<span class="s1">{</span>
    <span class="s1">__COMPARISON_OP_HALF_MACRO(lt)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">bool </span><span class="s1">__hgt(</span><span class="s2">const </span><span class="s1">__half a, </span><span class="s2">const </span><span class="s1">__half b)</span>
<span class="s1">{</span>
    <span class="s1">__COMPARISON_OP_HALF_MACRO(gt)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">bool </span><span class="s1">__hequ(</span><span class="s2">const </span><span class="s1">__half a, </span><span class="s2">const </span><span class="s1">__half b)</span>
<span class="s1">{</span>
    <span class="s1">__COMPARISON_OP_HALF_MACRO(equ)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">bool </span><span class="s1">__hneu(</span><span class="s2">const </span><span class="s1">__half a, </span><span class="s2">const </span><span class="s1">__half b)</span>
<span class="s1">{</span>
    <span class="s1">__COMPARISON_OP_HALF_MACRO(neu)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">bool </span><span class="s1">__hleu(</span><span class="s2">const </span><span class="s1">__half a, </span><span class="s2">const </span><span class="s1">__half b)</span>
<span class="s1">{</span>
    <span class="s1">__COMPARISON_OP_HALF_MACRO(leu)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">bool </span><span class="s1">__hgeu(</span><span class="s2">const </span><span class="s1">__half a, </span><span class="s2">const </span><span class="s1">__half b)</span>
<span class="s1">{</span>
    <span class="s1">__COMPARISON_OP_HALF_MACRO(geu)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">bool </span><span class="s1">__hltu(</span><span class="s2">const </span><span class="s1">__half a, </span><span class="s2">const </span><span class="s1">__half b)</span>
<span class="s1">{</span>
    <span class="s1">__COMPARISON_OP_HALF_MACRO(ltu)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">bool </span><span class="s1">__hgtu(</span><span class="s2">const </span><span class="s1">__half a, </span><span class="s2">const </span><span class="s1">__half b)</span>
<span class="s1">{</span>
    <span class="s1">__COMPARISON_OP_HALF_MACRO(gtu)</span>
<span class="s1">}</span>
<span class="s2">#undef </span><span class="s1">__COMPARISON_OP_HALF_MACRO</span>
<span class="s0">/****************************************************************************** 
*                            __half2 arithmetic                             * 
******************************************************************************/</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __hadd2(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b)</span>
<span class="s1">{</span>
    <span class="s1">__BINARY_OP_HALF2_MACRO(add)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __hsub2(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b)</span>
<span class="s1">{</span>
    <span class="s1">__BINARY_OP_HALF2_MACRO(sub)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __hmul2(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b)</span>
<span class="s1">{</span>
    <span class="s1">__BINARY_OP_HALF2_MACRO(mul)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __hadd2_sat(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b)</span>
<span class="s1">{</span>
    <span class="s1">__BINARY_OP_HALF2_MACRO(add.sat)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __hsub2_sat(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b)</span>
<span class="s1">{</span>
    <span class="s1">__BINARY_OP_HALF2_MACRO(sub.sat)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __hmul2_sat(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b)</span>
<span class="s1">{</span>
    <span class="s1">__BINARY_OP_HALF2_MACRO(mul.sat)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __hfma2(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b, </span><span class="s2">const </span><span class="s1">__half2 c)</span>
<span class="s1">{</span>
    <span class="s1">__TERNARY_OP_HALF2_MACRO(fma.rn)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __hfma2_sat(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b, </span><span class="s2">const </span><span class="s1">__half2 c)</span>
<span class="s1">{</span>
    <span class="s1">__TERNARY_OP_HALF2_MACRO(fma.rn.sat)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __h2div(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b) {</span>
    <span class="s1">__half ha = __low2half(a);</span>
    <span class="s1">__half hb = __low2half(b);</span>

    <span class="s2">const </span><span class="s1">__half v1 = __hdiv(ha, hb);</span>

    <span class="s1">ha = __high2half(a);</span>
    <span class="s1">hb = __high2half(b);</span>

    <span class="s2">const </span><span class="s1">__half v2 = __hdiv(ha, hb);</span>

    <span class="s2">return </span><span class="s1">__halves2half2(v1, v2);</span>
<span class="s1">}</span>
<span class="s0">/****************************************************************************** 
*                             __half arithmetic                             * 
******************************************************************************/</span>
<span class="s1">__CUDA_FP16_DECL__ __half __hadd(</span><span class="s2">const </span><span class="s1">__half a, </span><span class="s2">const </span><span class="s1">__half b)</span>
<span class="s1">{</span>
    <span class="s1">__BINARY_OP_HALF_MACRO(add)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __hsub(</span><span class="s2">const </span><span class="s1">__half a, </span><span class="s2">const </span><span class="s1">__half b)</span>
<span class="s1">{</span>
    <span class="s1">__BINARY_OP_HALF_MACRO(sub)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __hmul(</span><span class="s2">const </span><span class="s1">__half a, </span><span class="s2">const </span><span class="s1">__half b)</span>
<span class="s1">{</span>
    <span class="s1">__BINARY_OP_HALF_MACRO(mul)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __hadd_sat(</span><span class="s2">const </span><span class="s1">__half a, </span><span class="s2">const </span><span class="s1">__half b)</span>
<span class="s1">{</span>
    <span class="s1">__BINARY_OP_HALF_MACRO(add.sat)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __hsub_sat(</span><span class="s2">const </span><span class="s1">__half a, </span><span class="s2">const </span><span class="s1">__half b)</span>
<span class="s1">{</span>
    <span class="s1">__BINARY_OP_HALF_MACRO(sub.sat)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __hmul_sat(</span><span class="s2">const </span><span class="s1">__half a, </span><span class="s2">const </span><span class="s1">__half b)</span>
<span class="s1">{</span>
    <span class="s1">__BINARY_OP_HALF_MACRO(mul.sat)</span>
<span class="s1">}</span>

<span class="s1">__CUDA_FP16_DECL__ __half __hfma(</span><span class="s2">const </span><span class="s1">__half a, </span><span class="s2">const </span><span class="s1">__half b, </span><span class="s2">const </span><span class="s1">__half c)</span>
<span class="s1">{</span>
    <span class="s1">__TERNARY_OP_HALF_MACRO(fma.rn)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __hfma_sat(</span><span class="s2">const </span><span class="s1">__half a, </span><span class="s2">const </span><span class="s1">__half b, </span><span class="s2">const </span><span class="s1">__half c)</span>
<span class="s1">{</span>
    <span class="s1">__TERNARY_OP_HALF_MACRO(fma.rn.sat)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __hdiv(</span><span class="s2">const </span><span class="s1">__half a, </span><span class="s2">const </span><span class="s1">__half b) {</span>
    <span class="s1">__half v;</span>
    <span class="s1">__half abs;</span>
    <span class="s1">__half den;</span>
    <span class="s1">__HALF_TO_US(den) = </span><span class="s4">0x008F</span><span class="s1">U;</span>

    <span class="s2">float </span><span class="s1">rcp;</span>
    <span class="s2">const float </span><span class="s1">fa = __half2float(a);</span>
    <span class="s2">const float </span><span class="s1">fb = __half2float(b);</span>

    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{rcp.approx.ftz.f32 %0, %1;</span><span class="s2">\n</span><span class="s3">}&quot; </span><span class="s1">:</span><span class="s3">&quot;=f&quot;</span><span class="s1">(rcp) : </span><span class="s3">&quot;f&quot;</span><span class="s1">(fb));</span>

    <span class="s2">float </span><span class="s1">fv = rcp * fa;</span>

    <span class="s1">v = __float2half(fv);</span>
    <span class="s1">__HALF_TO_US(abs) = </span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">unsigned short</span><span class="s1">&gt;(</span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">unsigned int</span><span class="s1">&gt;(__HALF_TO_CUS(v)) &amp; </span><span class="s4">0x00007FFF</span><span class="s1">U);</span>
    <span class="s2">if </span><span class="s1">(__hlt(abs, den) &amp;&amp; (!(__HALF_TO_CUS(abs) == </span><span class="s4">0x0000</span><span class="s1">U))) {</span>
        <span class="s2">const float </span><span class="s1">err = __fmaf_rn(-fb, fv, fa);</span>
        <span class="s1">fv = __fmaf_rn(rcp, err, fv);</span>
        <span class="s1">v = __float2half(fv);</span>
    <span class="s1">}</span>
    <span class="s2">return </span><span class="s1">v;</span>
<span class="s1">}</span>

<span class="s0">/****************************************************************************** 
*                             __half2 functions                  * 
******************************************************************************/</span>
<span class="s2">#define </span><span class="s1">__SPEC_CASE2(i,r, spc, ulp) \</span>
   <span class="s3">&quot;{.reg.b32 spc, ulp, p;</span><span class="s2">\n</span><span class="s3">&quot;</span><span class="s1">\</span>
   <span class="s3">&quot;  mov.b32 spc,&quot;</span><span class="s1">#spc</span><span class="s3">&quot;;</span><span class="s2">\n</span><span class="s3">&quot;</span><span class="s1">\</span>
   <span class="s3">&quot;  mov.b32 ulp,&quot;</span><span class="s1">#ulp</span><span class="s3">&quot;;</span><span class="s2">\n</span><span class="s3">&quot;</span><span class="s1">\</span>
   <span class="s3">&quot;  set.eq.f16x2.f16x2 p,&quot;</span><span class="s1">#i</span><span class="s3">&quot;, spc;</span><span class="s2">\n</span><span class="s3">&quot;</span><span class="s1">\</span>
   <span class="s3">&quot;  fma.rn.f16x2 &quot;</span><span class="s1">#r</span><span class="s3">&quot;,p,ulp,&quot;</span><span class="s1">#r</span><span class="s3">&quot;;</span><span class="s2">\n</span><span class="s3">}</span><span class="s2">\n</span><span class="s3">&quot;</span>
<span class="s2">#define </span><span class="s1">__SPEC_CASE(i,r, spc, ulp) \</span>
   <span class="s3">&quot;{.reg.b16 spc, ulp, p;</span><span class="s2">\n</span><span class="s3">&quot;</span><span class="s1">\</span>
   <span class="s3">&quot;  mov.b16 spc,&quot;</span><span class="s1">#spc</span><span class="s3">&quot;;</span><span class="s2">\n</span><span class="s3">&quot;</span><span class="s1">\</span>
   <span class="s3">&quot;  mov.b16 ulp,&quot;</span><span class="s1">#ulp</span><span class="s3">&quot;;</span><span class="s2">\n</span><span class="s3">&quot;</span><span class="s1">\</span>
   <span class="s3">&quot;  set.eq.f16.f16 p,&quot;</span><span class="s1">#i</span><span class="s3">&quot;, spc;</span><span class="s2">\n</span><span class="s3">&quot;</span><span class="s1">\</span>
   <span class="s3">&quot;  fma.rn.f16 &quot;</span><span class="s1">#r</span><span class="s3">&quot;,p,ulp,&quot;</span><span class="s1">#r</span><span class="s3">&quot;;</span><span class="s2">\n</span><span class="s3">}</span><span class="s2">\n</span><span class="s3">&quot;</span>
<span class="s2">#define </span><span class="s1">__APPROX_FCAST(fun) </span><span class="s0">/* do */ </span><span class="s1">{\</span>
   <span class="s1">__half val;\</span>
   <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{.reg.b32         f;        </span><span class="s2">\n</span><span class="s3">&quot;</span><span class="s1">\</span>
                <span class="s3">&quot; .reg.b16         r;        </span><span class="s2">\n</span><span class="s3">&quot;</span><span class="s1">\</span>
                <span class="s3">&quot;  mov.b16         r,%1;     </span><span class="s2">\n</span><span class="s3">&quot;</span><span class="s1">\</span>
                <span class="s3">&quot;  cvt.f32.f16     f,r;      </span><span class="s2">\n</span><span class="s3">&quot;</span><span class="s1">\</span>
                <span class="s3">&quot;  &quot;</span><span class="s1">#fun</span><span class="s3">&quot;.approx.f32   f,f;  </span><span class="s2">\n</span><span class="s3">&quot;</span><span class="s1">\</span>
                <span class="s3">&quot;  cvt.rn.f16.f32      r,f;  </span><span class="s2">\n</span><span class="s3">&quot;</span><span class="s1">\</span>
                <span class="s3">&quot;  mov.b16         %0,r;     </span><span class="s2">\n</span><span class="s3">&quot;</span><span class="s1">\</span>
                <span class="s3">&quot;}&quot;</span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(val)) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(a)));\</span>
   <span class="s2">return </span><span class="s1">val;\</span>
<span class="s1">} </span><span class="s0">/* while(0) */</span>
<span class="s2">#define </span><span class="s1">__APPROX_FCAST2(fun) </span><span class="s0">/* do */ </span><span class="s1">{\</span>
   <span class="s1">__half2 val;\</span>
   <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{.reg.b16         hl, hu;         </span><span class="s2">\n</span><span class="s3">&quot;</span><span class="s1">\</span>
                <span class="s3">&quot; .reg.b32         fl, fu;         </span><span class="s2">\n</span><span class="s3">&quot;</span><span class="s1">\</span>
                <span class="s3">&quot;  mov.b32         {hl, hu}, %1;   </span><span class="s2">\n</span><span class="s3">&quot;</span><span class="s1">\</span>
                <span class="s3">&quot;  cvt.f32.f16     fl, hl;         </span><span class="s2">\n</span><span class="s3">&quot;</span><span class="s1">\</span>
                <span class="s3">&quot;  cvt.f32.f16     fu, hu;         </span><span class="s2">\n</span><span class="s3">&quot;</span><span class="s1">\</span>
                <span class="s3">&quot;  &quot;</span><span class="s1">#fun</span><span class="s3">&quot;.approx.f32   fl, fl;     </span><span class="s2">\n</span><span class="s3">&quot;</span><span class="s1">\</span>
                <span class="s3">&quot;  &quot;</span><span class="s1">#fun</span><span class="s3">&quot;.approx.f32   fu, fu;     </span><span class="s2">\n</span><span class="s3">&quot;</span><span class="s1">\</span>
                <span class="s3">&quot;  cvt.rn.f16.f32      hl, fl;     </span><span class="s2">\n</span><span class="s3">&quot;</span><span class="s1">\</span>
                <span class="s3">&quot;  cvt.rn.f16.f32      hu, fu;     </span><span class="s2">\n</span><span class="s3">&quot;</span><span class="s1">\</span>
                <span class="s3">&quot;  mov.b32         %0, {hl, hu};   </span><span class="s2">\n</span><span class="s3">&quot;</span><span class="s1">\</span>
                <span class="s3">&quot;}&quot;</span><span class="s1">:</span><span class="s3">&quot;=r&quot;</span><span class="s1">(__HALF2_TO_UI(val)) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(a)));       \</span>
   <span class="s2">return </span><span class="s1">val;\</span>
<span class="s1">} </span><span class="s0">/* while(0) */</span>
<span class="s2">static </span><span class="s1">__device__ __forceinline__ </span><span class="s2">float </span><span class="s1">__float_simpl_sinf(</span><span class="s2">float </span><span class="s1">a);</span>
<span class="s2">static </span><span class="s1">__device__ __forceinline__ </span><span class="s2">float </span><span class="s1">__float_simpl_cosf(</span><span class="s2">float </span><span class="s1">a);</span>
<span class="s1">__CUDA_FP16_DECL__ __half __hsin_internal(</span><span class="s2">const </span><span class="s1">__half a) {</span>
    <span class="s2">float </span><span class="s1">f = __half2float(a);</span>
    <span class="s1">f = __float_simpl_sinf(f);</span>
    <span class="s2">return </span><span class="s1">__float2half_rn(f);</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half hsin(</span><span class="s2">const </span><span class="s1">__half a) {</span>
    <span class="s1">__half r = __hsin_internal(a);</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{</span><span class="s2">\n\t</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  .reg.b16 i,r,t;     </span><span class="s2">\n\t</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b16 r, %0;      </span><span class="s2">\n\t</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b16 i, %1;      </span><span class="s2">\n\t</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b16 t, 0x8000U;  </span><span class="s2">\n\t</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  and.b16 t,r,t;      </span><span class="s2">\n\t</span><span class="s3">&quot;</span>
        <span class="s1">__SPEC_CASE(i, r, </span><span class="s4">0</span><span class="s1">X32B3U, </span><span class="s4">0x0800</span><span class="s1">U)</span>
        <span class="s1">__SPEC_CASE(i, r, </span><span class="s4">0</span><span class="s1">X5CB0U, </span><span class="s4">0x1000</span><span class="s1">U)</span>
        <span class="s1">__SPEC_CASE(i, r, </span><span class="s4">0</span><span class="s1">XB2B3U, </span><span class="s4">0x8800</span><span class="s1">U)</span>
        <span class="s1">__SPEC_CASE(i, r, </span><span class="s4">0</span><span class="s1">XDCB0U, </span><span class="s4">0x9000</span><span class="s1">U)</span>
        <span class="s3">&quot;  or.b16  r,r,t;      </span><span class="s2">\n\t</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b16 %0, r;      </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;}</span><span class="s2">\n</span><span class="s3">&quot; </span><span class="s1">: </span><span class="s3">&quot;+h&quot;</span><span class="s1">(__HALF_TO_US(r)) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(a)));</span>
    <span class="s2">return </span><span class="s1">r;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 h2sin(</span><span class="s2">const </span><span class="s1">__half2 a) {</span>
    <span class="s2">const </span><span class="s1">__half l = __low2half(a);</span>
    <span class="s2">const </span><span class="s1">__half h = __high2half(a);</span>
    <span class="s2">const </span><span class="s1">__half sl = __hsin_internal(l);</span>
    <span class="s2">const </span><span class="s1">__half sh = __hsin_internal(h);</span>
    <span class="s1">__half2 r = __halves2half2(sl, sh);</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{</span><span class="s2">\n\t</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  .reg.b32 i,r,t;             </span><span class="s2">\n\t</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32 r, %0;              </span><span class="s2">\n\t</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32 i, %1;              </span><span class="s2">\n\t</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  and.b32 t, r, 0x80008000U;   </span><span class="s2">\n\t</span><span class="s3">&quot;</span>
        <span class="s1">__SPEC_CASE2(i, r, </span><span class="s4">0</span><span class="s1">X32B332B3U, </span><span class="s4">0x08000800</span><span class="s1">U)</span>
        <span class="s1">__SPEC_CASE2(i, r, </span><span class="s4">0</span><span class="s1">X5CB05CB0U, </span><span class="s4">0x10001000</span><span class="s1">U)</span>
        <span class="s1">__SPEC_CASE2(i, r, </span><span class="s4">0</span><span class="s1">XB2B3B2B3U, </span><span class="s4">0x88008800</span><span class="s1">U)</span>
        <span class="s1">__SPEC_CASE2(i, r, </span><span class="s4">0</span><span class="s1">XDCB0DCB0U, </span><span class="s4">0x90009000</span><span class="s1">U)</span>
        <span class="s3">&quot;  or.b32  r, r, t;            </span><span class="s2">\n\t</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32 %0, r;              </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;}</span><span class="s2">\n</span><span class="s3">&quot; </span><span class="s1">: </span><span class="s3">&quot;+r&quot;</span><span class="s1">(__HALF2_TO_UI(r)) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(a)));</span>
    <span class="s2">return </span><span class="s1">r;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __hcos_internal(</span><span class="s2">const </span><span class="s1">__half a) {</span>
    <span class="s2">float </span><span class="s1">f = __half2float(a);</span>
    <span class="s1">f = __float_simpl_cosf(f);</span>
    <span class="s2">return </span><span class="s1">__float2half_rn(f);</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half hcos(</span><span class="s2">const </span><span class="s1">__half a) {</span>
    <span class="s1">__half r = __hcos_internal(a);</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{</span><span class="s2">\n\t</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  .reg.b16 i,r;        </span><span class="s2">\n\t</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b16 r, %0;       </span><span class="s2">\n\t</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b16 i, %1;       </span><span class="s2">\n\t</span><span class="s3">&quot;</span>
        <span class="s1">__SPEC_CASE(i, r, </span><span class="s4">0</span><span class="s1">X2B7CU, </span><span class="s4">0x1000</span><span class="s1">U)</span>
        <span class="s1">__SPEC_CASE(i, r, </span><span class="s4">0</span><span class="s1">XAB7CU, </span><span class="s4">0x1000</span><span class="s1">U)</span>
        <span class="s3">&quot;  mov.b16 %0, r;       </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;}</span><span class="s2">\n</span><span class="s3">&quot; </span><span class="s1">: </span><span class="s3">&quot;+h&quot;</span><span class="s1">(__HALF_TO_US(r)) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(a)));</span>
    <span class="s2">return </span><span class="s1">r;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 h2cos(</span><span class="s2">const </span><span class="s1">__half2 a) {</span>
    <span class="s2">const </span><span class="s1">__half l = __low2half(a);</span>
    <span class="s2">const </span><span class="s1">__half h = __high2half(a);</span>
    <span class="s2">const </span><span class="s1">__half cl = __hcos_internal(l);</span>
    <span class="s2">const </span><span class="s1">__half ch = __hcos_internal(h);</span>
    <span class="s1">__half2 r = __halves2half2(cl, ch);</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{</span><span class="s2">\n\t</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  .reg.b32 i,r;   </span><span class="s2">\n\t</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32 r, %0;  </span><span class="s2">\n\t</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32 i, %1;  </span><span class="s2">\n\t</span><span class="s3">&quot;</span>
        <span class="s1">__SPEC_CASE2(i, r, </span><span class="s4">0</span><span class="s1">X2B7C2B7CU, </span><span class="s4">0x10001000</span><span class="s1">U)</span>
        <span class="s1">__SPEC_CASE2(i, r, </span><span class="s4">0</span><span class="s1">XAB7CAB7CU, </span><span class="s4">0x10001000</span><span class="s1">U)</span>
        <span class="s3">&quot;  mov.b32 %0, r;  </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;}</span><span class="s2">\n</span><span class="s3">&quot; </span><span class="s1">: </span><span class="s3">&quot;+r&quot;</span><span class="s1">(__HALF2_TO_UI(r)) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(a)));</span>
    <span class="s2">return </span><span class="s1">r;</span>
<span class="s1">}</span>
<span class="s2">static </span><span class="s1">__device__ __forceinline__ </span><span class="s2">float </span><span class="s1">__internal_trig_reduction_kernel(</span><span class="s2">const float </span><span class="s1">a, </span><span class="s2">int </span><span class="s1">*quadrant)</span>
<span class="s1">{</span>
    <span class="s2">const int </span><span class="s1">q = __float2int_rn(a * </span><span class="s4">0</span><span class="s1">.</span><span class="s4">636619772</span><span class="s1">F);</span>
    <span class="s2">const float </span><span class="s1">j = </span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">float</span><span class="s1">&gt;(q);</span>
    <span class="s2">float </span><span class="s1">t = __fmaf_rn(-j, </span><span class="s4">1</span><span class="s1">.</span><span class="s4">5707962512969971</span><span class="s1">e+</span><span class="s4">000</span><span class="s1">F, a);</span>
    <span class="s1">t = __fmaf_rn(-j, </span><span class="s4">7</span><span class="s1">.</span><span class="s4">5497894158615964</span><span class="s1">e-008F, t);</span>
    <span class="s1">*quadrant = q;</span>
    <span class="s2">return </span><span class="s1">t;</span>
<span class="s1">}</span>
<span class="s2">static </span><span class="s1">__device__ __forceinline__ </span><span class="s2">float </span><span class="s1">__internal_sin_cos_kernel(</span><span class="s2">float </span><span class="s1">x, </span><span class="s2">const int </span><span class="s1">i)</span>
<span class="s1">{</span>
    <span class="s2">float </span><span class="s1">z;</span>
    <span class="s2">const float </span><span class="s1">x2 = x*x;</span>

    <span class="s2">if </span><span class="s1">((</span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">unsigned</span><span class="s1">&gt;(i) &amp; </span><span class="s4">1</span><span class="s1">U) != </span><span class="s4">0</span><span class="s1">U) {</span>
        <span class="s1">z = </span><span class="s4">2</span><span class="s1">.</span><span class="s4">44331571</span><span class="s1">e-5F;</span>
        <span class="s1">z = __fmaf_rn(z, x2, -</span><span class="s4">1</span><span class="s1">.</span><span class="s4">38873163</span><span class="s1">e-3F);</span>
    <span class="s1">}</span>
    <span class="s2">else </span><span class="s1">{</span>
        <span class="s1">z = -</span><span class="s4">1</span><span class="s1">.</span><span class="s4">95152959</span><span class="s1">e-4F;</span>
        <span class="s1">z = __fmaf_rn(z, x2, </span><span class="s4">8</span><span class="s1">.</span><span class="s4">33216087</span><span class="s1">e-3F);</span>
    <span class="s1">}</span>
    <span class="s2">if </span><span class="s1">((</span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">unsigned</span><span class="s1">&gt;(i) &amp; </span><span class="s4">1</span><span class="s1">U) != </span><span class="s4">0</span><span class="s1">U) {</span>
        <span class="s1">z = __fmaf_rn(z, x2, </span><span class="s4">4</span><span class="s1">.</span><span class="s4">16666457</span><span class="s1">e-2F);</span>
        <span class="s1">z = __fmaf_rn(z, x2, -</span><span class="s4">5</span><span class="s1">.</span><span class="s4">00000000</span><span class="s1">e-1F);</span>
    <span class="s1">}</span>
    <span class="s2">else </span><span class="s1">{</span>
        <span class="s1">z = __fmaf_rn(z, x2, -</span><span class="s4">1</span><span class="s1">.</span><span class="s4">66666546</span><span class="s1">e-1F);</span>
        <span class="s1">z = __fmaf_rn(z, x2, </span><span class="s4">0</span><span class="s1">.</span><span class="s4">0</span><span class="s1">F);</span>
    <span class="s1">}</span>
    <span class="s2">if </span><span class="s1">((</span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">unsigned</span><span class="s1">&gt;(i) &amp; </span><span class="s4">1</span><span class="s1">U) != </span><span class="s4">0</span><span class="s1">U) {</span>
        <span class="s1">x = __fmaf_rn(z, x2, </span><span class="s4">1</span><span class="s1">.</span><span class="s4">0</span><span class="s1">F);</span>
    <span class="s1">}</span>
    <span class="s2">else </span><span class="s1">{</span>
        <span class="s1">x = __fmaf_rn(z, x, x);</span>
    <span class="s1">}</span>
    <span class="s2">if </span><span class="s1">((</span><span class="s5">static_cast</span><span class="s1">&lt;</span><span class="s2">unsigned</span><span class="s1">&gt;(i) &amp; </span><span class="s4">2</span><span class="s1">U) != </span><span class="s4">0</span><span class="s1">U) {</span>
        <span class="s1">x = __fmaf_rn(x, -</span><span class="s4">1</span><span class="s1">.</span><span class="s4">0</span><span class="s1">F, </span><span class="s4">0</span><span class="s1">.</span><span class="s4">0</span><span class="s1">F);</span>
    <span class="s1">}</span>
    <span class="s2">return </span><span class="s1">x;</span>
<span class="s1">}</span>
<span class="s2">static </span><span class="s1">__device__ __forceinline__ </span><span class="s2">float </span><span class="s1">__float_simpl_sinf(</span><span class="s2">float </span><span class="s1">a)</span>
<span class="s1">{</span>
    <span class="s2">float </span><span class="s1">z;</span>
    <span class="s2">int </span><span class="s1">i;</span>
    <span class="s2">if </span><span class="s1">(::isinf(a)) {</span>
        <span class="s1">a = a * </span><span class="s4">0</span><span class="s1">.</span><span class="s4">0</span><span class="s1">F;</span>
    <span class="s1">}</span>
    <span class="s1">a = __internal_trig_reduction_kernel(a, &amp;i);</span>
    <span class="s1">z = __internal_sin_cos_kernel(a, i);</span>
    <span class="s2">return </span><span class="s1">z;</span>
<span class="s1">}</span>
<span class="s2">static </span><span class="s1">__device__ __forceinline__ </span><span class="s2">float </span><span class="s1">__float_simpl_cosf(</span><span class="s2">float </span><span class="s1">a)</span>
<span class="s1">{</span>
    <span class="s2">float </span><span class="s1">z;</span>
    <span class="s2">int </span><span class="s1">i;</span>
    <span class="s2">if </span><span class="s1">(::isinf(a)) {</span>
        <span class="s1">a = a * </span><span class="s4">0</span><span class="s1">.</span><span class="s4">0</span><span class="s1">F;</span>
    <span class="s1">}</span>
    <span class="s1">a = __internal_trig_reduction_kernel(a, &amp;i);</span>
    <span class="s1">i++;</span>
    <span class="s1">z = __internal_sin_cos_kernel(a, i);</span>
    <span class="s2">return </span><span class="s1">z;</span>
<span class="s1">}</span>

<span class="s1">__CUDA_FP16_DECL__ __half hexp(</span><span class="s2">const </span><span class="s1">__half a) {</span>
    <span class="s1">__half val;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{.reg.b32         f, C;           </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot; .reg.b16         h,r;            </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b16         h,%1;           </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.f32.f16     f,h;            </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32         C, 0x3fb8aa3bU;  </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mul.f32         f,f,C;          </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  ex2.approx.f32      f,f;        </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.rn.f16.f32      r,f;        </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s1">__SPEC_CASE(h, r, </span><span class="s4">0</span><span class="s1">X1F79U, </span><span class="s4">0x9400</span><span class="s1">U)</span>
        <span class="s1">__SPEC_CASE(h, r, </span><span class="s4">0</span><span class="s1">X25CFU, </span><span class="s4">0x9400</span><span class="s1">U)</span>
        <span class="s1">__SPEC_CASE(h, r, </span><span class="s4">0</span><span class="s1">XC13BU, </span><span class="s4">0x0400</span><span class="s1">U)</span>
        <span class="s1">__SPEC_CASE(h, r, </span><span class="s4">0</span><span class="s1">XC1EFU, </span><span class="s4">0x0200</span><span class="s1">U)</span>
        <span class="s3">&quot;  mov.b16         %0,r;           </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;}&quot;</span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(val)) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(a)));</span>
    <span class="s2">return </span><span class="s1">val;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 h2exp(</span><span class="s2">const </span><span class="s1">__half2 a) {</span>
    <span class="s1">__half2 val;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{.reg.b16         hl, hu;         </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot; .reg.b32         h,r,fl,fu, C;   </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32         {hl, hu}, %1;   </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32         h, %1;          </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.f32.f16     fl, hl;         </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.f32.f16     fu, hu;         </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32         C, 0x3fb8aa3bU;  </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mul.f32         fl,fl,C;        </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mul.f32         fu,fu,C;        </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  ex2.approx.f32      fl, fl;     </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  ex2.approx.f32      fu, fu;     </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.rn.f16.f32      hl, fl;     </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.rn.f16.f32      hu, fu;     </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32         r, {hl, hu};    </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s1">__SPEC_CASE2(h, r, </span><span class="s4">0</span><span class="s1">X1F791F79U, </span><span class="s4">0x94009400</span><span class="s1">U)</span>
        <span class="s1">__SPEC_CASE2(h, r, </span><span class="s4">0</span><span class="s1">X25CF25CFU, </span><span class="s4">0x94009400</span><span class="s1">U)</span>
        <span class="s1">__SPEC_CASE2(h, r, </span><span class="s4">0</span><span class="s1">XC13BC13BU, </span><span class="s4">0x04000400</span><span class="s1">U)</span>
        <span class="s1">__SPEC_CASE2(h, r, </span><span class="s4">0</span><span class="s1">XC1EFC1EFU, </span><span class="s4">0x02000200</span><span class="s1">U)</span>
        <span class="s3">&quot;  mov.b32         %0, r;  </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;}&quot;</span><span class="s1">:</span><span class="s3">&quot;=r&quot;</span><span class="s1">(__HALF2_TO_UI(val)) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(a)));</span>
    <span class="s2">return </span><span class="s1">val;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half hexp2(</span><span class="s2">const </span><span class="s1">__half a) {</span>
    <span class="s1">__half val;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{.reg.b32         f, ULP;         </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot; .reg.b16         r;              </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b16         r,%1;           </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.f32.f16     f,r;            </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  ex2.approx.f32      f,f;        </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32         ULP, 0x33800000U;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  fma.rn.f32      f,f,ULP,f;      </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.rn.f16.f32      r,f;        </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b16         %0,r;           </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;}&quot;</span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(val)) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(a)));</span>
    <span class="s2">return </span><span class="s1">val;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 h2exp2(</span><span class="s2">const </span><span class="s1">__half2 a) {</span>
    <span class="s1">__half2 val;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{.reg.b16         hl, hu;         </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot; .reg.b32         fl, fu, ULP;    </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32         {hl, hu}, %1;   </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.f32.f16     fl, hl;         </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.f32.f16     fu, hu;         </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  ex2.approx.f32      fl, fl;     </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  ex2.approx.f32      fu, fu;     </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32         ULP, 0x33800000U;</span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  fma.rn.f32      fl,fl,ULP,fl;   </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  fma.rn.f32      fu,fu,ULP,fu;   </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.rn.f16.f32      hl, fl;     </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.rn.f16.f32      hu, fu;     </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32         %0, {hl, hu};   </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;}&quot;</span><span class="s1">:</span><span class="s3">&quot;=r&quot;</span><span class="s1">(__HALF2_TO_UI(val)) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(a)));</span>
    <span class="s2">return </span><span class="s1">val;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half hexp10(</span><span class="s2">const </span><span class="s1">__half a) {</span>
    <span class="s1">__half val;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{.reg.b16         h,r;            </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot; .reg.b32         f, C;           </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b16         h, %1;          </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.f32.f16     f, h;           </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32         C, 0x40549A78U;  </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mul.f32         f,f,C;          </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  ex2.approx.f32      f, f;       </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.rn.f16.f32      r, f;       </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s1">__SPEC_CASE(h, r, </span><span class="s4">0x34DE</span><span class="s1">U, </span><span class="s4">0x9800</span><span class="s1">U)</span>
        <span class="s1">__SPEC_CASE(h, r, </span><span class="s4">0x9766</span><span class="s1">U, </span><span class="s4">0x9000</span><span class="s1">U)</span>
        <span class="s1">__SPEC_CASE(h, r, </span><span class="s4">0x9972</span><span class="s1">U, </span><span class="s4">0x1000</span><span class="s1">U)</span>
        <span class="s1">__SPEC_CASE(h, r, </span><span class="s4">0xA5C4</span><span class="s1">U, </span><span class="s4">0x1000</span><span class="s1">U)</span>
        <span class="s1">__SPEC_CASE(h, r, </span><span class="s4">0xBF0A</span><span class="s1">U, </span><span class="s4">0x8100</span><span class="s1">U)</span>
        <span class="s3">&quot;  mov.b16         %0, r;          </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;}&quot;</span><span class="s1">:</span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(val)) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(a)));</span>
    <span class="s2">return </span><span class="s1">val;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 h2exp10(</span><span class="s2">const </span><span class="s1">__half2 a) {</span>
    <span class="s1">__half2 val;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{.reg.b16         hl, hu;         </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot; .reg.b32         h,r,fl,fu, C;   </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32         {hl, hu}, %1;   </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32         h, %1;          </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.f32.f16     fl, hl;         </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.f32.f16     fu, hu;         </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32         C, 0x40549A78U;  </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mul.f32         fl,fl,C;        </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mul.f32         fu,fu,C;        </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  ex2.approx.f32      fl, fl;     </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  ex2.approx.f32      fu, fu;     </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.rn.f16.f32      hl, fl;     </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.rn.f16.f32      hu, fu;     </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32         r, {hl, hu};    </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s1">__SPEC_CASE2(h, r, </span><span class="s4">0x34DE34DE</span><span class="s1">U, </span><span class="s4">0x98009800</span><span class="s1">U)</span>
        <span class="s1">__SPEC_CASE2(h, r, </span><span class="s4">0x97669766</span><span class="s1">U, </span><span class="s4">0x90009000</span><span class="s1">U)</span>
        <span class="s1">__SPEC_CASE2(h, r, </span><span class="s4">0x99729972</span><span class="s1">U, </span><span class="s4">0x10001000</span><span class="s1">U)</span>
        <span class="s1">__SPEC_CASE2(h, r, </span><span class="s4">0xA5C4A5C4</span><span class="s1">U, </span><span class="s4">0x10001000</span><span class="s1">U)</span>
        <span class="s1">__SPEC_CASE2(h, r, </span><span class="s4">0xBF0ABF0A</span><span class="s1">U, </span><span class="s4">0x81008100</span><span class="s1">U)</span>
        <span class="s3">&quot;  mov.b32         %0, r;  </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;}&quot;</span><span class="s1">:</span><span class="s3">&quot;=r&quot;</span><span class="s1">(__HALF2_TO_UI(val)) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(a)));</span>
    <span class="s2">return </span><span class="s1">val;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half hlog2(</span><span class="s2">const </span><span class="s1">__half a) {</span>
    <span class="s1">__half val;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{.reg.b16         h, r;           </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot; .reg.b32         f;              </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b16         h, %1;          </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.f32.f16     f, h;           </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  lg2.approx.f32      f, f;       </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.rn.f16.f32      r, f;       </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s1">__SPEC_CASE(r, r, </span><span class="s4">0xA2E2</span><span class="s1">U, </span><span class="s4">0x8080</span><span class="s1">U)</span>
        <span class="s1">__SPEC_CASE(r, r, </span><span class="s4">0xBF46</span><span class="s1">U, </span><span class="s4">0x9400</span><span class="s1">U)</span>
        <span class="s3">&quot;  mov.b16         %0, r;          </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;}&quot;</span><span class="s1">:</span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(val)) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(a)));</span>
    <span class="s2">return </span><span class="s1">val;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 h2log2(</span><span class="s2">const </span><span class="s1">__half2 a) {</span>
    <span class="s1">__half2 val;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{.reg.b16         hl, hu;         </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot; .reg.b32         fl, fu, r, p;   </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32         {hl, hu}, %1;   </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.f32.f16     fl, hl;         </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.f32.f16     fu, hu;         </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  lg2.approx.f32      fl, fl;     </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  lg2.approx.f32      fu, fu;     </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.rn.f16.f32      hl, fl;     </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.rn.f16.f32      hu, fu;     </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32         r, {hl, hu};    </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s1">__SPEC_CASE2(r, r, </span><span class="s4">0xA2E2A2E2</span><span class="s1">U, </span><span class="s4">0x80808080</span><span class="s1">U)</span>
        <span class="s1">__SPEC_CASE2(r, r, </span><span class="s4">0xBF46BF46</span><span class="s1">U, </span><span class="s4">0x94009400</span><span class="s1">U)</span>
        <span class="s3">&quot;  mov.b32         %0, r;          </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;}&quot;</span><span class="s1">:</span><span class="s3">&quot;=r&quot;</span><span class="s1">(__HALF2_TO_UI(val)) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(a)));</span>
    <span class="s2">return </span><span class="s1">val;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half hlog(</span><span class="s2">const </span><span class="s1">__half a) {</span>
    <span class="s1">__half val;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{.reg.b32         f, C;           </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot; .reg.b16         r,h;            </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b16         h,%1;           </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.f32.f16     f,h;            </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  lg2.approx.f32      f,f;        </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32         C, 0x3f317218U;  </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mul.f32         f,f,C;          </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.rn.f16.f32      r,f;        </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s1">__SPEC_CASE(h, r, </span><span class="s4">0</span><span class="s1">X160DU, </span><span class="s4">0x9C00</span><span class="s1">U)</span>
        <span class="s1">__SPEC_CASE(h, r, </span><span class="s4">0</span><span class="s1">X3BFEU, </span><span class="s4">0x8010</span><span class="s1">U)</span>
        <span class="s1">__SPEC_CASE(h, r, </span><span class="s4">0</span><span class="s1">X3C0BU, </span><span class="s4">0x8080</span><span class="s1">U)</span>
        <span class="s1">__SPEC_CASE(h, r, </span><span class="s4">0</span><span class="s1">X6051U, </span><span class="s4">0x1C00</span><span class="s1">U)</span>
        <span class="s3">&quot;  mov.b16         %0,r;           </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;}&quot;</span><span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(val)) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(a)));</span>
    <span class="s2">return </span><span class="s1">val;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 h2log(</span><span class="s2">const </span><span class="s1">__half2 a) {</span>
    <span class="s1">__half2 val;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{.reg.b16         hl, hu;             </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot; .reg.b32         r, fl, fu, C, h;    </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32         {hl, hu}, %1;       </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32         h, %1;              </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.f32.f16     fl, hl;             </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.f32.f16     fu, hu;             </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  lg2.approx.f32      fl, fl;         </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  lg2.approx.f32      fu, fu;         </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32         C, 0x3f317218U;     </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mul.f32         fl,fl,C;            </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mul.f32         fu,fu,C;            </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.rn.f16.f32      hl, fl;         </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.rn.f16.f32      hu, fu;         </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32         r, {hl, hu};        </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s1">__SPEC_CASE2(h, r, </span><span class="s4">0</span><span class="s1">X160D160DU, </span><span class="s4">0x9C009C00</span><span class="s1">U)</span>
        <span class="s1">__SPEC_CASE2(h, r, </span><span class="s4">0</span><span class="s1">X3BFE3BFEU, </span><span class="s4">0x80108010</span><span class="s1">U)</span>
        <span class="s1">__SPEC_CASE2(h, r, </span><span class="s4">0</span><span class="s1">X3C0B3C0BU, </span><span class="s4">0x80808080</span><span class="s1">U)</span>
        <span class="s1">__SPEC_CASE2(h, r, </span><span class="s4">0</span><span class="s1">X60516051U, </span><span class="s4">0x1C001C00</span><span class="s1">U)</span>
        <span class="s3">&quot;  mov.b32         %0, r;              </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;}&quot;</span><span class="s1">:</span><span class="s3">&quot;=r&quot;</span><span class="s1">(__HALF2_TO_UI(val)) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(a)));</span>
    <span class="s2">return </span><span class="s1">val;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half hlog10(</span><span class="s2">const </span><span class="s1">__half a) {</span>
    <span class="s1">__half val;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{.reg.b16         h, r;           </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot; .reg.b32         f, C;           </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b16         h, %1;          </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.f32.f16     f, h;           </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  lg2.approx.f32      f, f;       </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32         C, 0x3E9A209BU; </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mul.f32         f,f,C;          </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.rn.f16.f32      r, f;       </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s1">__SPEC_CASE(h, r, </span><span class="s4">0x338F</span><span class="s1">U, </span><span class="s4">0x1000</span><span class="s1">U)</span>
        <span class="s1">__SPEC_CASE(h, r, </span><span class="s4">0x33F8</span><span class="s1">U, </span><span class="s4">0x9000</span><span class="s1">U)</span>
        <span class="s1">__SPEC_CASE(h, r, </span><span class="s4">0x57E1</span><span class="s1">U, </span><span class="s4">0x9800</span><span class="s1">U)</span>
        <span class="s1">__SPEC_CASE(h, r, </span><span class="s4">0x719D</span><span class="s1">U, </span><span class="s4">0x9C00</span><span class="s1">U)</span>
        <span class="s3">&quot;  mov.b16         %0, r;          </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;}&quot;</span><span class="s1">:</span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(val)) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(a)));</span>
    <span class="s2">return </span><span class="s1">val;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 h2log10(</span><span class="s2">const </span><span class="s1">__half2 a) {</span>
    <span class="s1">__half2 val;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{.reg.b16         hl, hu;             </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot; .reg.b32         r, fl, fu, C, h;    </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32         {hl, hu}, %1;       </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32         h, %1;              </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.f32.f16     fl, hl;             </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.f32.f16     fu, hu;             </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  lg2.approx.f32      fl, fl;         </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  lg2.approx.f32      fu, fu;         </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32         C, 0x3E9A209BU;     </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mul.f32         fl,fl,C;            </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mul.f32         fu,fu,C;            </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.rn.f16.f32      hl, fl;         </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  cvt.rn.f16.f32      hu, fu;         </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;  mov.b32         r, {hl, hu};        </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s1">__SPEC_CASE2(h, r, </span><span class="s4">0x338F338F</span><span class="s1">U, </span><span class="s4">0x10001000</span><span class="s1">U)</span>
        <span class="s1">__SPEC_CASE2(h, r, </span><span class="s4">0x33F833F8</span><span class="s1">U, </span><span class="s4">0x90009000</span><span class="s1">U)</span>
        <span class="s1">__SPEC_CASE2(h, r, </span><span class="s4">0x57E157E1</span><span class="s1">U, </span><span class="s4">0x98009800</span><span class="s1">U)</span>
        <span class="s1">__SPEC_CASE2(h, r, </span><span class="s4">0x719D719D</span><span class="s1">U, </span><span class="s4">0x9C009C00</span><span class="s1">U)</span>
        <span class="s3">&quot;  mov.b32         %0, r;              </span><span class="s2">\n</span><span class="s3">&quot;</span>
        <span class="s3">&quot;}&quot;</span><span class="s1">:</span><span class="s3">&quot;=r&quot;</span><span class="s1">(__HALF2_TO_UI(val)) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(a)));</span>
    <span class="s2">return </span><span class="s1">val;</span>
<span class="s1">}</span>
<span class="s2">#undef </span><span class="s1">__SPEC_CASE2</span>
<span class="s2">#undef </span><span class="s1">__SPEC_CASE</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 h2rcp(</span><span class="s2">const </span><span class="s1">__half2 a) {</span>
    <span class="s1">__APPROX_FCAST2(rcp)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half hrcp(</span><span class="s2">const </span><span class="s1">__half a) {</span>
    <span class="s1">__APPROX_FCAST(rcp)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 h2rsqrt(</span><span class="s2">const </span><span class="s1">__half2 a) {</span>
    <span class="s1">__APPROX_FCAST2(rsqrt)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half hrsqrt(</span><span class="s2">const </span><span class="s1">__half a) {</span>
    <span class="s1">__APPROX_FCAST(rsqrt)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 h2sqrt(</span><span class="s2">const </span><span class="s1">__half2 a) {</span>
    <span class="s1">__APPROX_FCAST2(sqrt)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half hsqrt(</span><span class="s2">const </span><span class="s1">__half a) {</span>
    <span class="s1">__APPROX_FCAST(sqrt)</span>
<span class="s1">}</span>
<span class="s2">#undef </span><span class="s1">__APPROX_FCAST</span>
<span class="s2">#undef </span><span class="s1">__APPROX_FCAST2</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __hisnan2(</span><span class="s2">const </span><span class="s1">__half2 a)</span>
<span class="s1">{</span>
    <span class="s1">__half2 r;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{set.nan.f16x2.f16x2 %0,%1,%2;</span><span class="s2">\n</span><span class="s3">}&quot;</span>
        <span class="s1">:</span><span class="s3">&quot;=r&quot;</span><span class="s1">(__HALF2_TO_UI(r)) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(a)), </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(a)));</span>
    <span class="s2">return </span><span class="s1">r;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ </span><span class="s2">bool </span><span class="s1">__hisnan(</span><span class="s2">const </span><span class="s1">__half a)</span>
<span class="s1">{</span>
    <span class="s1">__half r;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{set.nan.f16.f16 %0,%1,%2;</span><span class="s2">\n</span><span class="s3">}&quot;</span>
        <span class="s1">:</span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(r)) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(a)), </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(a)));</span>
    <span class="s2">return </span><span class="s1">__HALF_TO_CUS(r) != </span><span class="s4">0</span><span class="s1">U;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __hneg2(</span><span class="s2">const </span><span class="s1">__half2 a)</span>
<span class="s1">{</span>
    <span class="s1">__half2 r;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{neg.f16x2 %0,%1;</span><span class="s2">\n</span><span class="s3">}&quot;</span>
        <span class="s1">:</span><span class="s3">&quot;=r&quot;</span><span class="s1">(__HALF2_TO_UI(r)) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(a)));</span>
    <span class="s2">return </span><span class="s1">r;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __hneg(</span><span class="s2">const </span><span class="s1">__half a)</span>
<span class="s1">{</span>
    <span class="s1">__half r;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{neg.f16 %0,%1;</span><span class="s2">\n</span><span class="s3">}&quot;</span>
        <span class="s1">:</span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(r)) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(a)));</span>
    <span class="s2">return </span><span class="s1">r;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __habs2(</span><span class="s2">const </span><span class="s1">__half2 a)</span>
<span class="s1">{</span>
    <span class="s1">__half2 r;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{abs.f16x2 %0,%1;</span><span class="s2">\n</span><span class="s3">}&quot;</span>
        <span class="s1">:</span><span class="s3">&quot;=r&quot;</span><span class="s1">(__HALF2_TO_UI(r)) : </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(a)));</span>
    <span class="s2">return </span><span class="s1">r;</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __habs(</span><span class="s2">const </span><span class="s1">__half a)</span>
<span class="s1">{</span>
    <span class="s1">__half r;</span>
    <span class="s5">asm</span><span class="s1">(</span><span class="s3">&quot;{abs.f16 %0,%1;</span><span class="s2">\n</span><span class="s3">}&quot;</span>
        <span class="s1">:</span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(r)) : </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(a)));</span>
    <span class="s2">return </span><span class="s1">r;</span>
<span class="s1">}</span>

<span class="s1">__CUDA_FP16_DECL__ __half2 __hcmadd(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b, </span><span class="s2">const </span><span class="s1">__half2 c)</span>
<span class="s1">{</span>
    <span class="s0">// fast version of complex multiply-accumulate</span>
    <span class="s0">// (a.re, a.im) * (b.re, b.im) + (c.re, c.im)</span>
    <span class="s0">// acc.re = (c.re + a.re*b.re) - a.im*b.im</span>
    <span class="s0">// acc.im = (c.im + a.re*b.im) + a.im*b.re</span>
    <span class="s2">const </span><span class="s1">__half2 a_re = __half2half2(a.x);</span>
          <span class="s1">__half2 acc  = __hfma2(a_re, b, c);</span>
    <span class="s2">const </span><span class="s1">__half2 a_im = __half2half2(a.y);</span>
    <span class="s2">const </span><span class="s1">__half2 ib   = __halves2half2(__hneg(b.y), b.x);</span>
                  <span class="s1">acc  = __hfma2(a_im, ib, acc);</span>
    <span class="s2">return </span><span class="s1">acc;</span>
<span class="s1">}</span>
<span class="s2">#endif </span><span class="s0">/*__CUDA_ARCH__ &gt;= 530 || !defined(__CUDA_ARCH__)*/</span>

<span class="s2">#if </span><span class="s1">__CUDA_ARCH__ &gt;= </span><span class="s4">800 </span><span class="s1">|| !defined(__CUDA_ARCH__)</span>
<span class="s0">/****************************************************************************** 
*                             __half arithmetic                             * 
******************************************************************************/</span>
<span class="s1">__CUDA_FP16_DECL__ __half __hmax(</span><span class="s2">const </span><span class="s1">__half a, </span><span class="s2">const </span><span class="s1">__half b)</span>
<span class="s1">{</span>
    <span class="s1">__BINARY_OP_HALF_MACRO(max)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __hmin(</span><span class="s2">const </span><span class="s1">__half a, </span><span class="s2">const </span><span class="s1">__half b)</span>
<span class="s1">{</span>
    <span class="s1">__BINARY_OP_HALF_MACRO(min)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __hmax_nan(</span><span class="s2">const </span><span class="s1">__half a, </span><span class="s2">const </span><span class="s1">__half b)</span>
<span class="s1">{</span>
    <span class="s1">__BINARY_OP_HALF_MACRO(max.NaN)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __hmin_nan(</span><span class="s2">const </span><span class="s1">__half a, </span><span class="s2">const </span><span class="s1">__half b)</span>
<span class="s1">{</span>
    <span class="s1">__BINARY_OP_HALF_MACRO(min.NaN)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half __hfma_relu(</span><span class="s2">const </span><span class="s1">__half a, </span><span class="s2">const </span><span class="s1">__half b, </span><span class="s2">const </span><span class="s1">__half c)</span>
<span class="s1">{</span>
    <span class="s1">__TERNARY_OP_HALF_MACRO(fma.rn.relu)</span>
<span class="s1">}</span>
<span class="s0">/****************************************************************************** 
*                            __half2 arithmetic                             * 
******************************************************************************/</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __hmax2(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b)</span>
<span class="s1">{</span>
    <span class="s1">__BINARY_OP_HALF2_MACRO(max)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __hmin2(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b)</span>
<span class="s1">{</span>
    <span class="s1">__BINARY_OP_HALF2_MACRO(min)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __hmax2_nan(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b)</span>
<span class="s1">{</span>
    <span class="s1">__BINARY_OP_HALF2_MACRO(max.NaN)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __hmin2_nan(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b)</span>
<span class="s1">{</span>
    <span class="s1">__BINARY_OP_HALF2_MACRO(min.NaN)</span>
<span class="s1">}</span>
<span class="s1">__CUDA_FP16_DECL__ __half2 __hfma2_relu(</span><span class="s2">const </span><span class="s1">__half2 a, </span><span class="s2">const </span><span class="s1">__half2 b, </span><span class="s2">const </span><span class="s1">__half2 c)</span>
<span class="s1">{</span>
    <span class="s1">__TERNARY_OP_HALF2_MACRO(fma.rn.relu)</span>
<span class="s1">}</span>
<span class="s2">#endif </span><span class="s0">/*__CUDA_ARCH__ &gt;= 800 || !defined(__CUDA_ARCH__)*/</span>

<span class="s0">/* Define __PTR for atomicAdd prototypes below, undef after done */</span>
<span class="s2">#if </span><span class="s1">(defined(_MSC_VER) &amp;&amp; defined(_WIN64)) || defined(__LP64__) || defined(__CUDACC_RTC__)</span>
<span class="s2">#define </span><span class="s1">__PTR   </span><span class="s3">&quot;l&quot;</span>
<span class="s2">#else</span>
<span class="s2">#define </span><span class="s1">__PTR   </span><span class="s3">&quot;r&quot;</span>
<span class="s2">#endif </span><span class="s0">/*(defined(_MSC_VER) &amp;&amp; defined(_WIN64)) || defined(__LP64__) || defined(__CUDACC_RTC__)*/</span>

<span class="s2">#if </span><span class="s1">!defined(__CUDA_ARCH__) || __CUDA_ARCH__ &gt;= </span><span class="s4">600</span>

<span class="s1">__CUDA_FP16_DECL__  __half2 atomicAdd(__half2 *</span><span class="s2">const </span><span class="s1">address, </span><span class="s2">const </span><span class="s1">__half2 val) {</span>
    <span class="s1">__half2 r;</span>
    <span class="s5">asm </span><span class="s2">volatile </span><span class="s1">(</span><span class="s3">&quot;{ atom.add.noftz.f16x2 %0,[%1],%2; }</span><span class="s2">\n</span><span class="s3">&quot;</span>
                  <span class="s1">: </span><span class="s3">&quot;=r&quot;</span><span class="s1">(__HALF2_TO_UI(r)) : __PTR(address), </span><span class="s3">&quot;r&quot;</span><span class="s1">(__HALF2_TO_CUI(val))</span>
                  <span class="s1">: </span><span class="s3">&quot;memory&quot;</span><span class="s1">);</span>
   <span class="s2">return </span><span class="s1">r;</span>
<span class="s1">}</span>

<span class="s2">#endif </span><span class="s0">/*!defined(__CUDA_ARCH__) || __CUDA_ARCH__ &gt;= 600*/</span>

<span class="s2">#if </span><span class="s1">!defined(__CUDA_ARCH__) || __CUDA_ARCH__ &gt;= </span><span class="s4">700</span>

<span class="s1">__CUDA_FP16_DECL__  __half atomicAdd(__half *</span><span class="s2">const </span><span class="s1">address, </span><span class="s2">const </span><span class="s1">__half val) {</span>
    <span class="s1">__half r;</span>
    <span class="s5">asm </span><span class="s2">volatile </span><span class="s1">(</span><span class="s3">&quot;{ atom.add.noftz.f16 %0,[%1],%2; }</span><span class="s2">\n</span><span class="s3">&quot;</span>
                  <span class="s1">: </span><span class="s3">&quot;=h&quot;</span><span class="s1">(__HALF_TO_US(r))</span>
                  <span class="s1">: __PTR(address), </span><span class="s3">&quot;h&quot;</span><span class="s1">(__HALF_TO_CUS(val))</span>
                  <span class="s1">: </span><span class="s3">&quot;memory&quot;</span><span class="s1">);</span>
   <span class="s2">return </span><span class="s1">r;</span>
<span class="s1">}</span>

<span class="s2">#endif </span><span class="s0">/*!defined(__CUDA_ARCH__) || __CUDA_ARCH__ &gt;= 700*/</span>

<span class="s2">#undef </span><span class="s1">__PTR</span>

<span class="s2">#undef </span><span class="s1">__CUDA_FP16_DECL__</span>
<span class="s2">#endif </span><span class="s0">/* defined(__CUDACC__) */</span>
<span class="s2">#endif </span><span class="s0">/* defined(__cplusplus) */</span>

<span class="s2">#undef </span><span class="s1">__TERNARY_OP_HALF2_MACRO</span>
<span class="s2">#undef </span><span class="s1">__TERNARY_OP_HALF_MACRO</span>
<span class="s2">#undef </span><span class="s1">__BINARY_OP_HALF2_MACRO</span>
<span class="s2">#undef </span><span class="s1">__BINARY_OP_HALF_MACRO</span>

<span class="s2">#undef </span><span class="s1">__CUDA_HOSTDEVICE_FP16_DECL__</span>
<span class="s2">#undef </span><span class="s1">__CUDA_FP16_DECL__</span>
 
<span class="s0">/* Define first-class types &quot;half&quot; and &quot;half2&quot;, unless user specifies otherwise via &quot;#define CUDA_NO_HALF&quot; */</span>
<span class="s0">/* C cannot ever have these types defined here, because __half and __half2 are C++ classes */</span>
<span class="s2">#if </span><span class="s1">defined(__cplusplus) &amp;&amp; !defined(CUDA_NO_HALF)</span>
<span class="s2">typedef </span><span class="s1">__half half;</span>
<span class="s2">typedef </span><span class="s1">__half2 half2;</span>
<span class="s0">// for consistency with __nv_bfloat16</span>
<span class="s2">typedef </span><span class="s1">__half      __nv_half;</span>
<span class="s2">typedef </span><span class="s1">__half2     __nv_half2;</span>
<span class="s2">typedef </span><span class="s1">__half_raw  __nv_half_raw;</span>
<span class="s2">typedef </span><span class="s1">__half2_raw __nv_half2_raw;</span>
<span class="s2">typedef </span><span class="s1">__half        nv_half;</span>
<span class="s2">typedef </span><span class="s1">__half2       nv_half2;</span>
<span class="s2">#endif </span><span class="s0">/* defined(__cplusplus) &amp;&amp; !defined(CUDA_NO_HALF) */</span>

<span class="s2">#if </span><span class="s1">defined(__CPP_VERSION_AT_LEAST_11_FP16)</span>
<span class="s2">#undef </span><span class="s1">__CPP_VERSION_AT_LEAST_11_FP16</span>
<span class="s2">#endif </span><span class="s0">/* defined(__CPP_VERSION_AT_LEAST_11_FP16) */</span>

<span class="s2">#endif </span><span class="s0">/* end of include guard: __CUDA_FP16_HPP__ */</span>
</pre>
</body>
</html>