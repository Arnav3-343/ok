<html>
<head>
<title>test_types.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #6aab73;}
.s5 { color: #2aacb8;}
.s6 { color: #7a7e85;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_types.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot; 
Tests for numba.types. 
&quot;&quot;&quot;</span>


<span class="s2">from </span><span class="s1">collections </span><span class="s2">import </span><span class="s1">namedtuple</span>
<span class="s2">import </span><span class="s1">gc</span>
<span class="s2">import </span><span class="s1">os</span>
<span class="s2">import </span><span class="s1">operator</span>
<span class="s2">import </span><span class="s1">sys</span>
<span class="s2">import </span><span class="s1">weakref</span>

<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>

<span class="s2">from </span><span class="s1">numba</span><span class="s3">.</span><span class="s1">core </span><span class="s2">import </span><span class="s1">types</span><span class="s3">, </span><span class="s1">typing</span><span class="s3">, </span><span class="s1">errors</span><span class="s3">, </span><span class="s1">sigutils</span>
<span class="s2">from </span><span class="s1">numba</span><span class="s3">.</span><span class="s1">core</span><span class="s3">.</span><span class="s1">types</span><span class="s3">.</span><span class="s1">abstract </span><span class="s2">import </span><span class="s1">_typecache</span>
<span class="s2">from </span><span class="s1">numba</span><span class="s3">.</span><span class="s1">core</span><span class="s3">.</span><span class="s1">types</span><span class="s3">.</span><span class="s1">functions </span><span class="s2">import </span><span class="s1">_header_lead</span>
<span class="s2">from </span><span class="s1">numba</span><span class="s3">.</span><span class="s1">core</span><span class="s3">.</span><span class="s1">typing</span><span class="s3">.</span><span class="s1">templates </span><span class="s2">import </span><span class="s1">make_overload_template</span>
<span class="s2">from </span><span class="s1">numba </span><span class="s2">import </span><span class="s1">jit</span><span class="s3">, </span><span class="s1">njit</span><span class="s3">, </span><span class="s1">typeof</span>
<span class="s2">from </span><span class="s1">numba</span><span class="s3">.</span><span class="s1">core</span><span class="s3">.</span><span class="s1">extending </span><span class="s2">import </span><span class="s3">(</span><span class="s1">overload</span><span class="s3">, </span><span class="s1">register_model</span><span class="s3">, </span><span class="s1">models</span><span class="s3">, </span><span class="s1">unbox</span><span class="s3">,</span>
                                  <span class="s1">NativeValue</span><span class="s3">, </span><span class="s1">typeof_impl</span><span class="s3">)</span>
<span class="s2">from </span><span class="s1">numba</span><span class="s3">.</span><span class="s1">tests</span><span class="s3">.</span><span class="s1">support </span><span class="s2">import </span><span class="s1">TestCase</span><span class="s3">, </span><span class="s1">create_temp_module</span>
<span class="s2">from </span><span class="s1">numba</span><span class="s3">.</span><span class="s1">tests</span><span class="s3">.</span><span class="s1">enum_usecases </span><span class="s2">import </span><span class="s1">Color</span><span class="s3">, </span><span class="s1">Shake</span><span class="s3">, </span><span class="s1">Shape</span>
<span class="s2">import </span><span class="s1">unittest</span>
<span class="s2">from </span><span class="s1">numba</span><span class="s3">.</span><span class="s1">np </span><span class="s2">import </span><span class="s1">numpy_support</span>


<span class="s2">try</span><span class="s3">:</span>
    <span class="s2">import </span><span class="s1">cPickle </span><span class="s2">as </span><span class="s1">pickle</span>
<span class="s2">except </span><span class="s1">ImportError</span><span class="s3">:</span>
    <span class="s2">import </span><span class="s1">pickle</span>


<span class="s1">Point </span><span class="s3">= </span><span class="s1">namedtuple</span><span class="s3">(</span><span class="s4">'Point'</span><span class="s3">, (</span><span class="s4">'x'</span><span class="s3">, </span><span class="s4">'y'</span><span class="s3">))</span>

<span class="s1">Rect </span><span class="s3">= </span><span class="s1">namedtuple</span><span class="s3">(</span><span class="s4">'Rect'</span><span class="s3">, (</span><span class="s4">'width'</span><span class="s3">, </span><span class="s4">'height'</span><span class="s3">))</span>


<span class="s2">def </span><span class="s1">gen</span><span class="s3">(</span><span class="s1">x</span><span class="s3">):</span>
    <span class="s2">yield </span><span class="s1">x </span><span class="s3">+ </span><span class="s5">1</span>


<span class="s2">class </span><span class="s1">Dummy</span><span class="s3">(</span><span class="s1">object</span><span class="s3">):</span>
    <span class="s2">pass</span>


<span class="s2">class </span><span class="s1">TestTypes</span><span class="s3">(</span><span class="s1">TestCase</span><span class="s3">):</span>

    <span class="s2">def </span><span class="s1">test_equality</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">int32</span><span class="s3">, </span><span class="s1">types</span><span class="s3">.</span><span class="s1">int32</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">uint32</span><span class="s3">, </span><span class="s1">types</span><span class="s3">.</span><span class="s1">uint32</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">complex64</span><span class="s3">, </span><span class="s1">types</span><span class="s3">.</span><span class="s1">complex64</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">float32</span><span class="s3">, </span><span class="s1">types</span><span class="s3">.</span><span class="s1">float32</span><span class="s3">)</span>
        <span class="s6"># Different signedness</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertNotEqual</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">int32</span><span class="s3">, </span><span class="s1">types</span><span class="s3">.</span><span class="s1">uint32</span><span class="s3">)</span>
        <span class="s6"># Different width</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertNotEqual</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">int64</span><span class="s3">, </span><span class="s1">types</span><span class="s3">.</span><span class="s1">int32</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertNotEqual</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">float64</span><span class="s3">, </span><span class="s1">types</span><span class="s3">.</span><span class="s1">float32</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertNotEqual</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">complex64</span><span class="s3">, </span><span class="s1">types</span><span class="s3">.</span><span class="s1">complex128</span><span class="s3">)</span>
        <span class="s6"># Different domain</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertNotEqual</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">int64</span><span class="s3">, </span><span class="s1">types</span><span class="s3">.</span><span class="s1">float64</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertNotEqual</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">uint64</span><span class="s3">, </span><span class="s1">types</span><span class="s3">.</span><span class="s1">float64</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertNotEqual</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">complex64</span><span class="s3">, </span><span class="s1">types</span><span class="s3">.</span><span class="s1">float64</span><span class="s3">)</span>
        <span class="s6"># Same arguments but different return types</span>
        <span class="s1">get_pointer </span><span class="s3">= </span><span class="s2">None</span>
        <span class="s1">sig_a </span><span class="s3">= </span><span class="s1">typing</span><span class="s3">.</span><span class="s1">signature</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">intp</span><span class="s3">, </span><span class="s1">types</span><span class="s3">.</span><span class="s1">intp</span><span class="s3">)</span>
        <span class="s1">sig_b </span><span class="s3">= </span><span class="s1">typing</span><span class="s3">.</span><span class="s1">signature</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">voidptr</span><span class="s3">, </span><span class="s1">types</span><span class="s3">.</span><span class="s1">intp</span><span class="s3">)</span>
        <span class="s1">a </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">ExternalFunctionPointer</span><span class="s3">(</span><span class="s1">sig</span><span class="s3">=</span><span class="s1">sig_a</span><span class="s3">, </span><span class="s1">get_pointer</span><span class="s3">=</span><span class="s1">get_pointer</span><span class="s3">)</span>
        <span class="s1">b </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">ExternalFunctionPointer</span><span class="s3">(</span><span class="s1">sig</span><span class="s3">=</span><span class="s1">sig_b</span><span class="s3">, </span><span class="s1">get_pointer</span><span class="s3">=</span><span class="s1">get_pointer</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertNotEqual</span><span class="s3">(</span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">)</span>
        <span class="s6"># Different call convention</span>
        <span class="s1">a </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">ExternalFunctionPointer</span><span class="s3">(</span><span class="s1">sig</span><span class="s3">=</span><span class="s1">sig_a</span><span class="s3">, </span><span class="s1">get_pointer</span><span class="s3">=</span><span class="s1">get_pointer</span><span class="s3">)</span>
        <span class="s1">b </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">ExternalFunctionPointer</span><span class="s3">(</span><span class="s1">sig</span><span class="s3">=</span><span class="s1">sig_a</span><span class="s3">, </span><span class="s1">get_pointer</span><span class="s3">=</span><span class="s1">get_pointer</span><span class="s3">,</span>
                                          <span class="s1">cconv</span><span class="s3">=</span><span class="s4">'stdcall'</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertNotEqual</span><span class="s3">(</span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">)</span>
        <span class="s6"># Different get_pointer</span>
        <span class="s1">a </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">ExternalFunctionPointer</span><span class="s3">(</span><span class="s1">sig</span><span class="s3">=</span><span class="s1">sig_a</span><span class="s3">, </span><span class="s1">get_pointer</span><span class="s3">=</span><span class="s1">get_pointer</span><span class="s3">)</span>
        <span class="s1">b </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">ExternalFunctionPointer</span><span class="s3">(</span><span class="s1">sig</span><span class="s3">=</span><span class="s1">sig_a</span><span class="s3">, </span><span class="s1">get_pointer</span><span class="s3">=</span><span class="s1">object</span><span class="s3">())</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertNotEqual</span><span class="s3">(</span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">)</span>

        <span class="s6"># Different template classes bearing the same name</span>
        <span class="s2">class </span><span class="s1">DummyTemplate</span><span class="s3">(</span><span class="s1">object</span><span class="s3">):</span>
            <span class="s1">key </span><span class="s3">= </span><span class="s4">&quot;foo&quot;</span>
        <span class="s1">a </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">BoundFunction</span><span class="s3">(</span><span class="s1">DummyTemplate</span><span class="s3">, </span><span class="s1">types</span><span class="s3">.</span><span class="s1">int32</span><span class="s3">)</span>

        <span class="s2">class </span><span class="s1">DummyTemplate</span><span class="s3">(</span><span class="s1">object</span><span class="s3">):</span>
            <span class="s1">key </span><span class="s3">= </span><span class="s4">&quot;bar&quot;</span>
        <span class="s1">b </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">BoundFunction</span><span class="s3">(</span><span class="s1">DummyTemplate</span><span class="s3">, </span><span class="s1">types</span><span class="s3">.</span><span class="s1">int32</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertNotEqual</span><span class="s3">(</span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">)</span>

        <span class="s6"># Different dtypes</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertNotEqual</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">DType</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">int32</span><span class="s3">), </span><span class="s1">types</span><span class="s3">.</span><span class="s1">DType</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">int64</span><span class="s3">))</span>

        <span class="s6"># CPointer with same addrspace</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">CPointer</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">float32</span><span class="s3">),</span>
                         <span class="s1">types</span><span class="s3">.</span><span class="s1">CPointer</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">float32</span><span class="s3">))</span>

        <span class="s6"># CPointer with different addrspace</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertNotEqual</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">CPointer</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">float32</span><span class="s3">, </span><span class="s5">0</span><span class="s3">),</span>
                            <span class="s1">types</span><span class="s3">.</span><span class="s1">CPointer</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">float32</span><span class="s3">, </span><span class="s5">1</span><span class="s3">))</span>

    <span class="s2">def </span><span class="s1">test_weaktype</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">d </span><span class="s3">= </span><span class="s1">Dummy</span><span class="s3">()</span>
        <span class="s1">e </span><span class="s3">= </span><span class="s1">Dummy</span><span class="s3">()</span>
        <span class="s1">a </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">Dispatcher</span><span class="s3">(</span><span class="s1">d</span><span class="s3">)</span>
        <span class="s1">b </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">Dispatcher</span><span class="s3">(</span><span class="s1">d</span><span class="s3">)</span>
        <span class="s1">c </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">Dispatcher</span><span class="s3">(</span><span class="s1">e</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertIs</span><span class="s3">(</span><span class="s1">a</span><span class="s3">.</span><span class="s1">dispatcher</span><span class="s3">, </span><span class="s1">d</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertIs</span><span class="s3">(</span><span class="s1">b</span><span class="s3">.</span><span class="s1">dispatcher</span><span class="s3">, </span><span class="s1">d</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertIs</span><span class="s3">(</span><span class="s1">c</span><span class="s3">.</span><span class="s1">dispatcher</span><span class="s3">, </span><span class="s1">e</span><span class="s3">)</span>
        <span class="s6"># Equality of alive references</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertTrue</span><span class="s3">(</span><span class="s1">a </span><span class="s3">== </span><span class="s1">b</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertFalse</span><span class="s3">(</span><span class="s1">a </span><span class="s3">!= </span><span class="s1">b</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertTrue</span><span class="s3">(</span><span class="s1">a </span><span class="s3">!= </span><span class="s1">c</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertFalse</span><span class="s3">(</span><span class="s1">a </span><span class="s3">== </span><span class="s1">c</span><span class="s3">)</span>
        <span class="s1">z </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">int8</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertFalse</span><span class="s3">(</span><span class="s1">a </span><span class="s3">== </span><span class="s1">z</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertFalse</span><span class="s3">(</span><span class="s1">b </span><span class="s3">== </span><span class="s1">z</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertFalse</span><span class="s3">(</span><span class="s1">c </span><span class="s3">== </span><span class="s1">z</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertTrue</span><span class="s3">(</span><span class="s1">a </span><span class="s3">!= </span><span class="s1">z</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertTrue</span><span class="s3">(</span><span class="s1">b </span><span class="s3">!= </span><span class="s1">z</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertTrue</span><span class="s3">(</span><span class="s1">c </span><span class="s3">!= </span><span class="s1">z</span><span class="s3">)</span>
        <span class="s6"># Hashing and mappings</span>
        <span class="s1">s </span><span class="s3">= </span><span class="s1">set</span><span class="s3">([</span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">, </span><span class="s1">c</span><span class="s3">])</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">len</span><span class="s3">(</span><span class="s1">s</span><span class="s3">), </span><span class="s5">2</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertIn</span><span class="s3">(</span><span class="s1">a</span><span class="s3">, </span><span class="s1">s</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertIn</span><span class="s3">(</span><span class="s1">b</span><span class="s3">, </span><span class="s1">s</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertIn</span><span class="s3">(</span><span class="s1">c</span><span class="s3">, </span><span class="s1">s</span><span class="s3">)</span>
        <span class="s6"># Kill the references</span>
        <span class="s1">d </span><span class="s3">= </span><span class="s1">e </span><span class="s3">= </span><span class="s2">None</span>
        <span class="s1">gc</span><span class="s3">.</span><span class="s1">collect</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">self</span><span class="s3">.</span><span class="s1">assertRaises</span><span class="s3">(</span><span class="s1">ReferenceError</span><span class="s3">):</span>
            <span class="s1">a</span><span class="s3">.</span><span class="s1">dispatcher</span>
        <span class="s2">with </span><span class="s1">self</span><span class="s3">.</span><span class="s1">assertRaises</span><span class="s3">(</span><span class="s1">ReferenceError</span><span class="s3">):</span>
            <span class="s1">b</span><span class="s3">.</span><span class="s1">dispatcher</span>
        <span class="s2">with </span><span class="s1">self</span><span class="s3">.</span><span class="s1">assertRaises</span><span class="s3">(</span><span class="s1">ReferenceError</span><span class="s3">):</span>
            <span class="s1">c</span><span class="s3">.</span><span class="s1">dispatcher</span>
        <span class="s6"># Dead references are always unequal</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertFalse</span><span class="s3">(</span><span class="s1">a </span><span class="s3">== </span><span class="s1">b</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertFalse</span><span class="s3">(</span><span class="s1">a </span><span class="s3">== </span><span class="s1">c</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertFalse</span><span class="s3">(</span><span class="s1">b </span><span class="s3">== </span><span class="s1">c</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertFalse</span><span class="s3">(</span><span class="s1">a </span><span class="s3">== </span><span class="s1">z</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertTrue</span><span class="s3">(</span><span class="s1">a </span><span class="s3">!= </span><span class="s1">b</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertTrue</span><span class="s3">(</span><span class="s1">a </span><span class="s3">!= </span><span class="s1">c</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertTrue</span><span class="s3">(</span><span class="s1">b </span><span class="s3">!= </span><span class="s1">c</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertTrue</span><span class="s3">(</span><span class="s1">a </span><span class="s3">!= </span><span class="s1">z</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_interning</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s6"># Test interning and lifetime of dynamic types.</span>
        <span class="s1">a </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">Dummy</span><span class="s3">(</span><span class="s4">'xyzzyx'</span><span class="s3">)</span>
        <span class="s1">code </span><span class="s3">= </span><span class="s1">a</span><span class="s3">.</span><span class="s1">_code</span>
        <span class="s1">b </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">Dummy</span><span class="s3">(</span><span class="s4">'xyzzyx'</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertIs</span><span class="s3">(</span><span class="s1">b</span><span class="s3">, </span><span class="s1">a</span><span class="s3">)</span>
        <span class="s1">wr </span><span class="s3">= </span><span class="s1">weakref</span><span class="s3">.</span><span class="s1">ref</span><span class="s3">(</span><span class="s1">a</span><span class="s3">)</span>
        <span class="s2">del </span><span class="s1">a</span>
        <span class="s1">gc</span><span class="s3">.</span><span class="s1">collect</span><span class="s3">()</span>
        <span class="s1">c </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">Dummy</span><span class="s3">(</span><span class="s4">'xyzzyx'</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertIs</span><span class="s3">(</span><span class="s1">c</span><span class="s3">, </span><span class="s1">b</span><span class="s3">)</span>
        <span class="s6"># The code is always the same</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">c</span><span class="s3">.</span><span class="s1">_code</span><span class="s3">, </span><span class="s1">code</span><span class="s3">)</span>
        <span class="s2">del </span><span class="s1">b</span><span class="s3">, </span><span class="s1">c</span>
        <span class="s1">gc</span><span class="s3">.</span><span class="s1">collect</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertIs</span><span class="s3">(</span><span class="s1">wr</span><span class="s3">(), </span><span class="s2">None</span><span class="s3">)</span>
        <span class="s1">d </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">Dummy</span><span class="s3">(</span><span class="s4">'xyzzyx'</span><span class="s3">)</span>
        <span class="s6"># The original code wasn't reused.</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertNotEqual</span><span class="s3">(</span><span class="s1">d</span><span class="s3">.</span><span class="s1">_code</span><span class="s3">, </span><span class="s1">code</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_cache_trimming</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s6"># Test that the cache doesn't grow in size when types are</span>
        <span class="s6"># created and disposed of.</span>
        <span class="s1">cache </span><span class="s3">= </span><span class="s1">_typecache</span>
        <span class="s1">gc</span><span class="s3">.</span><span class="s1">collect</span><span class="s3">()</span>
        <span class="s6"># Keep strong references to existing types, to avoid spurious failures</span>
        <span class="s1">existing_types </span><span class="s3">= [</span><span class="s1">wr</span><span class="s3">() </span><span class="s2">for </span><span class="s1">wr </span><span class="s2">in </span><span class="s1">cache</span><span class="s3">]  </span><span class="s6"># noqa: F841</span>
        <span class="s1">cache_len </span><span class="s3">= </span><span class="s1">len</span><span class="s3">(</span><span class="s1">cache</span><span class="s3">)</span>
        <span class="s1">a </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">Dummy</span><span class="s3">(</span><span class="s4">'xyzzyx'</span><span class="s3">)</span>
        <span class="s1">b </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">Dummy</span><span class="s3">(</span><span class="s4">'foox'</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">len</span><span class="s3">(</span><span class="s1">cache</span><span class="s3">), </span><span class="s1">cache_len </span><span class="s3">+ </span><span class="s5">2</span><span class="s3">)</span>
        <span class="s2">del </span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span>
        <span class="s1">gc</span><span class="s3">.</span><span class="s1">collect</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">len</span><span class="s3">(</span><span class="s1">cache</span><span class="s3">), </span><span class="s1">cache_len</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_array_notation</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">def </span><span class="s1">check</span><span class="s3">(</span><span class="s1">arrty</span><span class="s3">, </span><span class="s1">scalar</span><span class="s3">, </span><span class="s1">ndim</span><span class="s3">, </span><span class="s1">layout</span><span class="s3">):</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">assertIs</span><span class="s3">(</span><span class="s1">arrty</span><span class="s3">.</span><span class="s1">dtype</span><span class="s3">, </span><span class="s1">scalar</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">arrty</span><span class="s3">.</span><span class="s1">ndim</span><span class="s3">, </span><span class="s1">ndim</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">arrty</span><span class="s3">.</span><span class="s1">layout</span><span class="s3">, </span><span class="s1">layout</span><span class="s3">)</span>

        <span class="s2">def </span><span class="s1">check_index_error</span><span class="s3">(</span><span class="s1">callable</span><span class="s3">):</span>
            <span class="s2">with </span><span class="s1">self</span><span class="s3">.</span><span class="s1">assertRaises</span><span class="s3">(</span><span class="s1">KeyError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">raises</span><span class="s3">:</span>
                <span class="s1">callable</span><span class="s3">()</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">assertIn</span><span class="s3">(</span>
                <span class="s4">&quot;Can only index numba types with slices with no start or &quot;</span>
                <span class="s4">&quot;stop, got&quot;</span><span class="s3">, </span><span class="s1">str</span><span class="s3">(</span><span class="s1">raises</span><span class="s3">.</span><span class="s1">exception</span><span class="s3">))</span>

        <span class="s1">scalar </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">int32</span>
        <span class="s1">check</span><span class="s3">(</span><span class="s1">scalar</span><span class="s3">[:], </span><span class="s1">scalar</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s4">'A'</span><span class="s3">)</span>
        <span class="s1">check</span><span class="s3">(</span><span class="s1">scalar</span><span class="s3">[::</span><span class="s5">1</span><span class="s3">], </span><span class="s1">scalar</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s4">'C'</span><span class="s3">)</span>
        <span class="s1">check</span><span class="s3">(</span><span class="s1">scalar</span><span class="s3">[:, :], </span><span class="s1">scalar</span><span class="s3">, </span><span class="s5">2</span><span class="s3">, </span><span class="s4">'A'</span><span class="s3">)</span>
        <span class="s1">check</span><span class="s3">(</span><span class="s1">scalar</span><span class="s3">[:, ::</span><span class="s5">1</span><span class="s3">], </span><span class="s1">scalar</span><span class="s3">, </span><span class="s5">2</span><span class="s3">, </span><span class="s4">'C'</span><span class="s3">)</span>
        <span class="s1">check</span><span class="s3">(</span><span class="s1">scalar</span><span class="s3">[::</span><span class="s5">1</span><span class="s3">, :], </span><span class="s1">scalar</span><span class="s3">, </span><span class="s5">2</span><span class="s3">, </span><span class="s4">'F'</span><span class="s3">)</span>

        <span class="s1">check_index_error</span><span class="s3">(</span><span class="s2">lambda</span><span class="s3">: </span><span class="s1">scalar</span><span class="s3">[</span><span class="s5">0</span><span class="s3">])</span>
        <span class="s1">check_index_error</span><span class="s3">(</span><span class="s2">lambda</span><span class="s3">: </span><span class="s1">scalar</span><span class="s3">[:, </span><span class="s5">4</span><span class="s3">])</span>
        <span class="s1">check_index_error</span><span class="s3">(</span><span class="s2">lambda</span><span class="s3">: </span><span class="s1">scalar</span><span class="s3">[::</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">:])</span>
        <span class="s1">check_index_error</span><span class="s3">(</span><span class="s2">lambda</span><span class="s3">: </span><span class="s1">scalar</span><span class="s3">[:</span><span class="s5">2</span><span class="s3">])</span>
        <span class="s1">check_index_error</span><span class="s3">(</span><span class="s2">lambda</span><span class="s3">: </span><span class="s1">list</span><span class="s3">(</span><span class="s1">scalar</span><span class="s3">))</span>

    <span class="s2">def </span><span class="s1">test_array_notation_for_dtype</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">def </span><span class="s1">check</span><span class="s3">(</span><span class="s1">arrty</span><span class="s3">, </span><span class="s1">scalar</span><span class="s3">, </span><span class="s1">ndim</span><span class="s3">, </span><span class="s1">layout</span><span class="s3">):</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">assertIs</span><span class="s3">(</span><span class="s1">arrty</span><span class="s3">.</span><span class="s1">dtype</span><span class="s3">, </span><span class="s1">scalar</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">arrty</span><span class="s3">.</span><span class="s1">ndim</span><span class="s3">, </span><span class="s1">ndim</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">arrty</span><span class="s3">.</span><span class="s1">layout</span><span class="s3">, </span><span class="s1">layout</span><span class="s3">)</span>
        <span class="s1">scalar </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">int32</span>
        <span class="s1">dtyped </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">DType</span><span class="s3">(</span><span class="s1">scalar</span><span class="s3">)</span>
        <span class="s1">check</span><span class="s3">(</span><span class="s1">dtyped</span><span class="s3">[:], </span><span class="s1">scalar</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s4">'A'</span><span class="s3">)</span>
        <span class="s1">check</span><span class="s3">(</span><span class="s1">dtyped</span><span class="s3">[::</span><span class="s5">1</span><span class="s3">], </span><span class="s1">scalar</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s4">'C'</span><span class="s3">)</span>
        <span class="s1">check</span><span class="s3">(</span><span class="s1">dtyped</span><span class="s3">[:, :], </span><span class="s1">scalar</span><span class="s3">, </span><span class="s5">2</span><span class="s3">, </span><span class="s4">'A'</span><span class="s3">)</span>
        <span class="s1">check</span><span class="s3">(</span><span class="s1">dtyped</span><span class="s3">[:, ::</span><span class="s5">1</span><span class="s3">], </span><span class="s1">scalar</span><span class="s3">, </span><span class="s5">2</span><span class="s3">, </span><span class="s4">'C'</span><span class="s3">)</span>
        <span class="s1">check</span><span class="s3">(</span><span class="s1">dtyped</span><span class="s3">[::</span><span class="s5">1</span><span class="s3">, :], </span><span class="s1">scalar</span><span class="s3">, </span><span class="s5">2</span><span class="s3">, </span><span class="s4">'F'</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_call_notation</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s6"># Function call signature</span>
        <span class="s1">i </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">int32</span>
        <span class="s1">d </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">double</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">i</span><span class="s3">(), </span><span class="s1">typing</span><span class="s3">.</span><span class="s1">signature</span><span class="s3">(</span><span class="s1">i</span><span class="s3">))</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">i</span><span class="s3">(</span><span class="s1">d</span><span class="s3">), </span><span class="s1">typing</span><span class="s3">.</span><span class="s1">signature</span><span class="s3">(</span><span class="s1">i</span><span class="s3">, </span><span class="s1">d</span><span class="s3">))</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">i</span><span class="s3">(</span><span class="s1">d</span><span class="s3">, </span><span class="s1">d</span><span class="s3">), </span><span class="s1">typing</span><span class="s3">.</span><span class="s1">signature</span><span class="s3">(</span><span class="s1">i</span><span class="s3">, </span><span class="s1">d</span><span class="s3">, </span><span class="s1">d</span><span class="s3">))</span>
        <span class="s6"># Value cast</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertPreciseEqual</span><span class="s3">(</span><span class="s1">i</span><span class="s3">(</span><span class="s5">42.5</span><span class="s3">), </span><span class="s5">42</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertPreciseEqual</span><span class="s3">(</span><span class="s1">d</span><span class="s3">(-</span><span class="s5">5</span><span class="s3">), -</span><span class="s5">5.0</span><span class="s3">)</span>
        <span class="s1">ty </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">NPDatetime</span><span class="s3">(</span><span class="s4">'Y'</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertPreciseEqual</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">(</span><span class="s4">'1900'</span><span class="s3">), </span><span class="s1">np</span><span class="s3">.</span><span class="s1">datetime64</span><span class="s3">(</span><span class="s4">'1900'</span><span class="s3">, </span><span class="s4">'Y'</span><span class="s3">))</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertPreciseEqual</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">(</span><span class="s4">'NaT'</span><span class="s3">), </span><span class="s1">np</span><span class="s3">.</span><span class="s1">datetime64</span><span class="s3">(</span><span class="s4">'NaT'</span><span class="s3">, </span><span class="s4">'Y'</span><span class="s3">))</span>
        <span class="s1">ty </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">NPTimedelta</span><span class="s3">(</span><span class="s4">'s'</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertPreciseEqual</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">(</span><span class="s5">5</span><span class="s3">), </span><span class="s1">np</span><span class="s3">.</span><span class="s1">timedelta64</span><span class="s3">(</span><span class="s5">5</span><span class="s3">, </span><span class="s4">'s'</span><span class="s3">))</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertPreciseEqual</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">(</span><span class="s4">'NaT'</span><span class="s3">), </span><span class="s1">np</span><span class="s3">.</span><span class="s1">timedelta64</span><span class="s3">(</span><span class="s4">'NaT'</span><span class="s3">, </span><span class="s4">'s'</span><span class="s3">))</span>
        <span class="s1">ty </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">NPTimedelta</span><span class="s3">(</span><span class="s4">''</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertPreciseEqual</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">(</span><span class="s5">5</span><span class="s3">), </span><span class="s1">np</span><span class="s3">.</span><span class="s1">timedelta64</span><span class="s3">(</span><span class="s5">5</span><span class="s3">))</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertPreciseEqual</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">(</span><span class="s4">'NaT'</span><span class="s3">), </span><span class="s1">np</span><span class="s3">.</span><span class="s1">timedelta64</span><span class="s3">(</span><span class="s4">'NaT'</span><span class="s3">))</span>

    <span class="s2">def </span><span class="s1">test_list_type_getitem</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">for </span><span class="s1">listty </span><span class="s2">in </span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">int64</span><span class="s3">, </span><span class="s1">types</span><span class="s3">.</span><span class="s1">Array</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">float64</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s4">'C'</span><span class="s3">)):</span>
            <span class="s1">l_int </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">List</span><span class="s3">(</span><span class="s1">listty</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">assertTrue</span><span class="s3">(</span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">l_int</span><span class="s3">, </span><span class="s1">types</span><span class="s3">.</span><span class="s1">List</span><span class="s3">))</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">assertTrue</span><span class="s3">(</span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">l_int</span><span class="s3">[</span><span class="s5">0</span><span class="s3">], </span><span class="s1">type</span><span class="s3">(</span><span class="s1">listty</span><span class="s3">)))</span>

    <span class="s2">def </span><span class="s1">test_function_incompatible_templates</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s6"># issue 4345</span>
        <span class="s2">def </span><span class="s1">func_stub</span><span class="s3">():</span>
            <span class="s2">pass</span>

        <span class="s2">def </span><span class="s1">func_stub2</span><span class="s3">():</span>
            <span class="s2">pass</span>

        <span class="s2">def </span><span class="s1">ol</span><span class="s3">():</span>
            <span class="s2">pass</span>

        <span class="s1">template1 </span><span class="s3">= </span><span class="s1">make_overload_template</span><span class="s3">(</span><span class="s1">func_stub</span><span class="s3">, </span><span class="s1">ol</span><span class="s3">, {}, </span><span class="s2">True</span><span class="s3">, </span><span class="s4">'never'</span><span class="s3">)</span>
        <span class="s1">template2 </span><span class="s3">= </span><span class="s1">make_overload_template</span><span class="s3">(</span><span class="s1">func_stub2</span><span class="s3">, </span><span class="s1">ol</span><span class="s3">, {}, </span><span class="s2">True</span><span class="s3">, </span><span class="s4">'never'</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">self</span><span class="s3">.</span><span class="s1">assertRaises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">raises</span><span class="s3">:</span>
            <span class="s1">types</span><span class="s3">.</span><span class="s1">Function</span><span class="s3">((</span><span class="s1">template1</span><span class="s3">, </span><span class="s1">template2</span><span class="s3">))</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertIn</span><span class="s3">(</span><span class="s4">&quot;incompatible templates:&quot;</span><span class="s3">, </span><span class="s1">str</span><span class="s3">(</span><span class="s1">raises</span><span class="s3">.</span><span class="s1">exception</span><span class="s3">))</span>


<span class="s2">class </span><span class="s1">TestNumbers</span><span class="s3">(</span><span class="s1">TestCase</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot; 
    Tests for number types. 
    &quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">test_bitwidth</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0">&quot;&quot;&quot; 
        All numeric types have bitwidth attribute 
        &quot;&quot;&quot;</span>
        <span class="s2">for </span><span class="s1">ty </span><span class="s2">in </span><span class="s1">types</span><span class="s3">.</span><span class="s1">number_domain</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">assertTrue</span><span class="s3">(</span><span class="s1">hasattr</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">, </span><span class="s4">&quot;bitwidth&quot;</span><span class="s3">))</span>

    <span class="s2">def </span><span class="s1">test_minval_maxval</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">int8</span><span class="s3">.</span><span class="s1">maxval</span><span class="s3">, </span><span class="s5">127</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">int8</span><span class="s3">.</span><span class="s1">minval</span><span class="s3">, -</span><span class="s5">128</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">uint8</span><span class="s3">.</span><span class="s1">maxval</span><span class="s3">, </span><span class="s5">255</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">uint8</span><span class="s3">.</span><span class="s1">minval</span><span class="s3">, </span><span class="s5">0</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">int64</span><span class="s3">.</span><span class="s1">maxval</span><span class="s3">, (</span><span class="s5">1 </span><span class="s3">&lt;&lt; </span><span class="s5">63</span><span class="s3">) - </span><span class="s5">1</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">int64</span><span class="s3">.</span><span class="s1">minval</span><span class="s3">, -(</span><span class="s5">1 </span><span class="s3">&lt;&lt; </span><span class="s5">63</span><span class="s3">))</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">uint64</span><span class="s3">.</span><span class="s1">maxval</span><span class="s3">, (</span><span class="s5">1 </span><span class="s3">&lt;&lt; </span><span class="s5">64</span><span class="s3">) - </span><span class="s5">1</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">uint64</span><span class="s3">.</span><span class="s1">minval</span><span class="s3">, </span><span class="s5">0</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_from_bidwidth</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">f </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">Integer</span><span class="s3">.</span><span class="s1">from_bitwidth</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertIs</span><span class="s3">(</span><span class="s1">f</span><span class="s3">(</span><span class="s5">32</span><span class="s3">), </span><span class="s1">types</span><span class="s3">.</span><span class="s1">int32</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertIs</span><span class="s3">(</span><span class="s1">f</span><span class="s3">(</span><span class="s5">8</span><span class="s3">, </span><span class="s1">signed</span><span class="s3">=</span><span class="s2">False</span><span class="s3">), </span><span class="s1">types</span><span class="s3">.</span><span class="s1">uint8</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_ordering</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">def </span><span class="s1">check_order</span><span class="s3">(</span><span class="s1">values</span><span class="s3">):</span>
            <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s1">len</span><span class="s3">(</span><span class="s1">values</span><span class="s3">)):</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">assertLessEqual</span><span class="s3">(</span><span class="s1">values</span><span class="s3">[</span><span class="s1">i</span><span class="s3">], </span><span class="s1">values</span><span class="s3">[</span><span class="s1">i</span><span class="s3">])</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">assertGreaterEqual</span><span class="s3">(</span><span class="s1">values</span><span class="s3">[</span><span class="s1">i</span><span class="s3">], </span><span class="s1">values</span><span class="s3">[</span><span class="s1">i</span><span class="s3">])</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">assertFalse</span><span class="s3">(</span><span class="s1">values</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] &lt; </span><span class="s1">values</span><span class="s3">[</span><span class="s1">i</span><span class="s3">])</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">assertFalse</span><span class="s3">(</span><span class="s1">values</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] &gt; </span><span class="s1">values</span><span class="s3">[</span><span class="s1">i</span><span class="s3">])</span>
                <span class="s2">for </span><span class="s1">j </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s1">i</span><span class="s3">):</span>
                    <span class="s1">self</span><span class="s3">.</span><span class="s1">assertLess</span><span class="s3">(</span><span class="s1">values</span><span class="s3">[</span><span class="s1">j</span><span class="s3">], </span><span class="s1">values</span><span class="s3">[</span><span class="s1">i</span><span class="s3">])</span>
                    <span class="s1">self</span><span class="s3">.</span><span class="s1">assertLessEqual</span><span class="s3">(</span><span class="s1">values</span><span class="s3">[</span><span class="s1">j</span><span class="s3">], </span><span class="s1">values</span><span class="s3">[</span><span class="s1">i</span><span class="s3">])</span>
                    <span class="s1">self</span><span class="s3">.</span><span class="s1">assertGreater</span><span class="s3">(</span><span class="s1">values</span><span class="s3">[</span><span class="s1">i</span><span class="s3">], </span><span class="s1">values</span><span class="s3">[</span><span class="s1">j</span><span class="s3">])</span>
                    <span class="s1">self</span><span class="s3">.</span><span class="s1">assertGreaterEqual</span><span class="s3">(</span><span class="s1">values</span><span class="s3">[</span><span class="s1">i</span><span class="s3">], </span><span class="s1">values</span><span class="s3">[</span><span class="s1">j</span><span class="s3">])</span>
                    <span class="s1">self</span><span class="s3">.</span><span class="s1">assertFalse</span><span class="s3">(</span><span class="s1">values</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] &lt; </span><span class="s1">values</span><span class="s3">[</span><span class="s1">j</span><span class="s3">])</span>
                    <span class="s1">self</span><span class="s3">.</span><span class="s1">assertFalse</span><span class="s3">(</span><span class="s1">values</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] &lt;= </span><span class="s1">values</span><span class="s3">[</span><span class="s1">j</span><span class="s3">])</span>
                    <span class="s1">self</span><span class="s3">.</span><span class="s1">assertFalse</span><span class="s3">(</span><span class="s1">values</span><span class="s3">[</span><span class="s1">j</span><span class="s3">] &gt; </span><span class="s1">values</span><span class="s3">[</span><span class="s1">i</span><span class="s3">])</span>
                    <span class="s1">self</span><span class="s3">.</span><span class="s1">assertFalse</span><span class="s3">(</span><span class="s1">values</span><span class="s3">[</span><span class="s1">j</span><span class="s3">] &gt;= </span><span class="s1">values</span><span class="s3">[</span><span class="s1">i</span><span class="s3">])</span>

        <span class="s1">check_order</span><span class="s3">([</span><span class="s1">types</span><span class="s3">.</span><span class="s1">int8</span><span class="s3">, </span><span class="s1">types</span><span class="s3">.</span><span class="s1">int16</span><span class="s3">, </span><span class="s1">types</span><span class="s3">.</span><span class="s1">int32</span><span class="s3">, </span><span class="s1">types</span><span class="s3">.</span><span class="s1">int64</span><span class="s3">])</span>
        <span class="s1">check_order</span><span class="s3">([</span><span class="s1">types</span><span class="s3">.</span><span class="s1">uint8</span><span class="s3">, </span><span class="s1">types</span><span class="s3">.</span><span class="s1">uint16</span><span class="s3">, </span><span class="s1">types</span><span class="s3">.</span><span class="s1">uint32</span><span class="s3">, </span><span class="s1">types</span><span class="s3">.</span><span class="s1">uint64</span><span class="s3">])</span>
        <span class="s1">check_order</span><span class="s3">([</span><span class="s1">types</span><span class="s3">.</span><span class="s1">float32</span><span class="s3">, </span><span class="s1">types</span><span class="s3">.</span><span class="s1">float64</span><span class="s3">])</span>
        <span class="s1">check_order</span><span class="s3">([</span><span class="s1">types</span><span class="s3">.</span><span class="s1">complex64</span><span class="s3">, </span><span class="s1">types</span><span class="s3">.</span><span class="s1">complex128</span><span class="s3">])</span>

        <span class="s2">with </span><span class="s1">self</span><span class="s3">.</span><span class="s1">assertRaises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">):</span>
            <span class="s1">types</span><span class="s3">.</span><span class="s1">int8 </span><span class="s3">&lt;= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">uint32</span>
        <span class="s2">with </span><span class="s1">self</span><span class="s3">.</span><span class="s1">assertRaises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">):</span>
            <span class="s1">types</span><span class="s3">.</span><span class="s1">int8 </span><span class="s3">&lt;= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">float32</span>
        <span class="s2">with </span><span class="s1">self</span><span class="s3">.</span><span class="s1">assertRaises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">):</span>
            <span class="s1">types</span><span class="s3">.</span><span class="s1">float64 </span><span class="s3">&lt;= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">complex128</span>


<span class="s2">class </span><span class="s1">TestNdIter</span><span class="s3">(</span><span class="s1">TestCase</span><span class="s3">):</span>

    <span class="s2">def </span><span class="s1">test_properties</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">def </span><span class="s1">check</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">, </span><span class="s1">dtypes</span><span class="s3">, </span><span class="s1">ndim</span><span class="s3">, </span><span class="s1">layout</span><span class="s3">, </span><span class="s1">indexers</span><span class="s3">=</span><span class="s2">None</span><span class="s3">):</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">.</span><span class="s1">ndim</span><span class="s3">, </span><span class="s1">ndim</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">.</span><span class="s1">layout</span><span class="s3">, </span><span class="s1">layout</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">.</span><span class="s1">dtypes</span><span class="s3">, </span><span class="s1">dtypes</span><span class="s3">)</span>
            <span class="s1">views </span><span class="s3">= [</span><span class="s1">types</span><span class="s3">.</span><span class="s1">Array</span><span class="s3">(</span><span class="s1">dtype</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s4">&quot;C&quot;</span><span class="s3">) </span><span class="s2">for </span><span class="s1">dtype </span><span class="s2">in </span><span class="s1">dtypes</span><span class="s3">]</span>
            <span class="s2">if </span><span class="s1">len</span><span class="s3">(</span><span class="s1">views</span><span class="s3">) &gt; </span><span class="s5">1</span><span class="s3">:</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span>
                    <span class="s1">ty</span><span class="s3">.</span><span class="s1">yield_type</span><span class="s3">,</span>
                    <span class="s1">types</span><span class="s3">.</span><span class="s1">BaseTuple</span><span class="s3">.</span><span class="s1">from_types</span><span class="s3">(</span><span class="s1">views</span><span class="s3">))</span>
            <span class="s2">else</span><span class="s3">:</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">.</span><span class="s1">yield_type</span><span class="s3">, </span><span class="s1">views</span><span class="s3">[</span><span class="s5">0</span><span class="s3">])</span>
            <span class="s2">if </span><span class="s1">indexers </span><span class="s2">is not None</span><span class="s3">:</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">.</span><span class="s1">indexers</span><span class="s3">, </span><span class="s1">indexers</span><span class="s3">)</span>

        <span class="s1">f32 </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">float32</span>
        <span class="s1">c64 </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">complex64</span>
        <span class="s1">i16 </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">int16</span>
        <span class="s1">a </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">Array</span><span class="s3">(</span><span class="s1">f32</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s4">&quot;C&quot;</span><span class="s3">)</span>
        <span class="s1">b </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">Array</span><span class="s3">(</span><span class="s1">f32</span><span class="s3">, </span><span class="s5">2</span><span class="s3">, </span><span class="s4">&quot;C&quot;</span><span class="s3">)</span>
        <span class="s1">c </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">Array</span><span class="s3">(</span><span class="s1">c64</span><span class="s3">, </span><span class="s5">2</span><span class="s3">, </span><span class="s4">&quot;F&quot;</span><span class="s3">)</span>
        <span class="s1">d </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">Array</span><span class="s3">(</span><span class="s1">i16</span><span class="s3">, </span><span class="s5">2</span><span class="s3">, </span><span class="s4">&quot;A&quot;</span><span class="s3">)</span>
        <span class="s1">e </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">Array</span><span class="s3">(</span><span class="s1">i16</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s4">&quot;C&quot;</span><span class="s3">)</span>
        <span class="s1">f </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">Array</span><span class="s3">(</span><span class="s1">f32</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s4">&quot;A&quot;</span><span class="s3">)</span>
        <span class="s1">g </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">Array</span><span class="s3">(</span><span class="s1">f32</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s4">&quot;C&quot;</span><span class="s3">)</span>

        <span class="s6"># 0-dim iterator</span>
        <span class="s1">ty </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">NumpyNdIterType</span><span class="s3">((</span><span class="s1">e</span><span class="s3">,))</span>
        <span class="s1">check</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">, (</span><span class="s1">i16</span><span class="s3">,), </span><span class="s5">0</span><span class="s3">, </span><span class="s4">&quot;C&quot;</span><span class="s3">, [(</span><span class="s4">'0d'</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, [</span><span class="s5">0</span><span class="s3">])])</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertFalse</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">.</span><span class="s1">need_shaped_indexing</span><span class="s3">)</span>
        <span class="s1">ty </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">NumpyNdIterType</span><span class="s3">((</span><span class="s1">e</span><span class="s3">, </span><span class="s1">g</span><span class="s3">))</span>
        <span class="s1">check</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">, (</span><span class="s1">i16</span><span class="s3">, </span><span class="s1">f32</span><span class="s3">), </span><span class="s5">0</span><span class="s3">, </span><span class="s4">&quot;C&quot;</span><span class="s3">, [(</span><span class="s4">'0d'</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, [</span><span class="s5">0</span><span class="s3">, </span><span class="s5">1</span><span class="s3">])])</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertFalse</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">.</span><span class="s1">need_shaped_indexing</span><span class="s3">)</span>
        <span class="s1">ty </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">NumpyNdIterType</span><span class="s3">((</span><span class="s1">e</span><span class="s3">, </span><span class="s1">c64</span><span class="s3">))</span>
        <span class="s1">check</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">, (</span><span class="s1">i16</span><span class="s3">, </span><span class="s1">c64</span><span class="s3">), </span><span class="s5">0</span><span class="s3">, </span><span class="s4">&quot;C&quot;</span><span class="s3">,</span>
              <span class="s3">[(</span><span class="s4">'0d'</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, [</span><span class="s5">0</span><span class="s3">]), (</span><span class="s4">'scalar'</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, [</span><span class="s5">1</span><span class="s3">])])</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertFalse</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">.</span><span class="s1">need_shaped_indexing</span><span class="s3">)</span>

        <span class="s6"># 1-dim iterator</span>
        <span class="s1">ty </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">NumpyNdIterType</span><span class="s3">((</span><span class="s1">a</span><span class="s3">,))</span>
        <span class="s1">check</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">, (</span><span class="s1">f32</span><span class="s3">,), </span><span class="s5">1</span><span class="s3">, </span><span class="s4">&quot;C&quot;</span><span class="s3">,</span>
              <span class="s3">[(</span><span class="s4">'flat'</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, [</span><span class="s5">0</span><span class="s3">])])</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertFalse</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">.</span><span class="s1">need_shaped_indexing</span><span class="s3">)</span>
        <span class="s1">ty </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">NumpyNdIterType</span><span class="s3">((</span><span class="s1">a</span><span class="s3">, </span><span class="s1">a</span><span class="s3">))</span>
        <span class="s1">check</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">, (</span><span class="s1">f32</span><span class="s3">, </span><span class="s1">f32</span><span class="s3">), </span><span class="s5">1</span><span class="s3">, </span><span class="s4">&quot;C&quot;</span><span class="s3">,</span>
              <span class="s3">[(</span><span class="s4">'flat'</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, [</span><span class="s5">0</span><span class="s3">, </span><span class="s5">1</span><span class="s3">])])</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertFalse</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">.</span><span class="s1">need_shaped_indexing</span><span class="s3">)</span>
        <span class="s1">ty </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">NumpyNdIterType</span><span class="s3">((</span><span class="s1">a</span><span class="s3">, </span><span class="s1">e</span><span class="s3">, </span><span class="s1">e</span><span class="s3">, </span><span class="s1">c64</span><span class="s3">))</span>
        <span class="s1">check</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">, (</span><span class="s1">f32</span><span class="s3">, </span><span class="s1">i16</span><span class="s3">, </span><span class="s1">i16</span><span class="s3">, </span><span class="s1">c64</span><span class="s3">), </span><span class="s5">1</span><span class="s3">, </span><span class="s4">&quot;C&quot;</span><span class="s3">,</span>
              <span class="s3">[(</span><span class="s4">'flat'</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, [</span><span class="s5">0</span><span class="s3">]),  </span><span class="s6"># a</span>
               <span class="s3">(</span><span class="s4">'0d'</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, [</span><span class="s5">1</span><span class="s3">, </span><span class="s5">2</span><span class="s3">]),  </span><span class="s6"># e, e</span>
               <span class="s3">(</span><span class="s4">'scalar'</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, [</span><span class="s5">3</span><span class="s3">]),  </span><span class="s6"># c64</span>
               <span class="s3">])</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertFalse</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">.</span><span class="s1">need_shaped_indexing</span><span class="s3">)</span>
        <span class="s1">ty </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">NumpyNdIterType</span><span class="s3">((</span><span class="s1">a</span><span class="s3">, </span><span class="s1">f</span><span class="s3">))</span>
        <span class="s1">check</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">, (</span><span class="s1">f32</span><span class="s3">, </span><span class="s1">f32</span><span class="s3">), </span><span class="s5">1</span><span class="s3">, </span><span class="s4">&quot;C&quot;</span><span class="s3">,</span>
              <span class="s3">[(</span><span class="s4">'flat'</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, [</span><span class="s5">0</span><span class="s3">]), (</span><span class="s4">'indexed'</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, [</span><span class="s5">1</span><span class="s3">])])</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertTrue</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">.</span><span class="s1">need_shaped_indexing</span><span class="s3">)</span>
        <span class="s1">ty </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">NumpyNdIterType</span><span class="s3">((</span><span class="s1">f</span><span class="s3">,))</span>
        <span class="s1">check</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">, (</span><span class="s1">f32</span><span class="s3">,), </span><span class="s5">1</span><span class="s3">, </span><span class="s4">&quot;C&quot;</span><span class="s3">, [(</span><span class="s4">'indexed'</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, [</span><span class="s5">0</span><span class="s3">])])</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertTrue</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">.</span><span class="s1">need_shaped_indexing</span><span class="s3">)</span>

        <span class="s6"># 2-dim C-order iterator</span>
        <span class="s1">ty </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">NumpyNdIterType</span><span class="s3">((</span><span class="s1">b</span><span class="s3">,))</span>
        <span class="s1">check</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">, (</span><span class="s1">f32</span><span class="s3">,), </span><span class="s5">2</span><span class="s3">, </span><span class="s4">&quot;C&quot;</span><span class="s3">, [(</span><span class="s4">'flat'</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">2</span><span class="s3">, [</span><span class="s5">0</span><span class="s3">])])</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertFalse</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">.</span><span class="s1">need_shaped_indexing</span><span class="s3">)</span>
        <span class="s1">ty </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">NumpyNdIterType</span><span class="s3">((</span><span class="s1">b</span><span class="s3">, </span><span class="s1">c</span><span class="s3">))</span>
        <span class="s1">check</span><span class="s3">(</span>
            <span class="s1">ty</span><span class="s3">, (</span><span class="s1">f32</span><span class="s3">, </span><span class="s1">c64</span><span class="s3">), </span><span class="s5">2</span><span class="s3">, </span><span class="s4">&quot;C&quot;</span><span class="s3">, [</span>
                <span class="s3">(</span><span class="s4">'flat'</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">2</span><span class="s3">, [</span><span class="s5">0</span><span class="s3">]), (</span><span class="s4">'indexed'</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">2</span><span class="s3">, [</span><span class="s5">1</span><span class="s3">])])</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertTrue</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">.</span><span class="s1">need_shaped_indexing</span><span class="s3">)</span>
        <span class="s1">ty </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">NumpyNdIterType</span><span class="s3">((</span><span class="s1">d</span><span class="s3">,))</span>
        <span class="s1">check</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">, (</span><span class="s1">i16</span><span class="s3">,), </span><span class="s5">2</span><span class="s3">, </span><span class="s4">&quot;C&quot;</span><span class="s3">, [(</span><span class="s4">'indexed'</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">2</span><span class="s3">, [</span><span class="s5">0</span><span class="s3">])])</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertTrue</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">.</span><span class="s1">need_shaped_indexing</span><span class="s3">)</span>
        <span class="s1">ty </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">NumpyNdIterType</span><span class="s3">((</span><span class="s1">b</span><span class="s3">, </span><span class="s1">c</span><span class="s3">, </span><span class="s1">d</span><span class="s3">, </span><span class="s1">d</span><span class="s3">, </span><span class="s1">e</span><span class="s3">))</span>
        <span class="s1">check</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">, (</span><span class="s1">f32</span><span class="s3">, </span><span class="s1">c64</span><span class="s3">, </span><span class="s1">i16</span><span class="s3">, </span><span class="s1">i16</span><span class="s3">, </span><span class="s1">i16</span><span class="s3">), </span><span class="s5">2</span><span class="s3">, </span><span class="s4">&quot;C&quot;</span><span class="s3">,</span>
              <span class="s3">[(</span><span class="s4">'flat'</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">2</span><span class="s3">, [</span><span class="s5">0</span><span class="s3">]),  </span><span class="s6"># b</span>
               <span class="s3">(</span><span class="s4">'indexed'</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">2</span><span class="s3">, [</span><span class="s5">1</span><span class="s3">, </span><span class="s5">2</span><span class="s3">, </span><span class="s5">3</span><span class="s3">]),  </span><span class="s6"># c, d, d</span>
               <span class="s3">(</span><span class="s4">'0d'</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, [</span><span class="s5">4</span><span class="s3">]),  </span><span class="s6"># e</span>
               <span class="s3">])</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertTrue</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">.</span><span class="s1">need_shaped_indexing</span><span class="s3">)</span>
        <span class="s1">ty </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">NumpyNdIterType</span><span class="s3">((</span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">, </span><span class="s1">c</span><span class="s3">, </span><span class="s1">d</span><span class="s3">, </span><span class="s1">d</span><span class="s3">, </span><span class="s1">f</span><span class="s3">))</span>
        <span class="s1">check</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">, (</span><span class="s1">f32</span><span class="s3">, </span><span class="s1">f32</span><span class="s3">, </span><span class="s1">c64</span><span class="s3">, </span><span class="s1">i16</span><span class="s3">, </span><span class="s1">i16</span><span class="s3">, </span><span class="s1">f32</span><span class="s3">), </span><span class="s5">2</span><span class="s3">, </span><span class="s4">&quot;C&quot;</span><span class="s3">,</span>
              <span class="s3">[(</span><span class="s4">'flat'</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">2</span><span class="s3">, [</span><span class="s5">0</span><span class="s3">]),  </span><span class="s6"># a</span>
               <span class="s3">(</span><span class="s4">'flat'</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">2</span><span class="s3">, [</span><span class="s5">1</span><span class="s3">]),  </span><span class="s6"># b</span>
               <span class="s3">(</span><span class="s4">'indexed'</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">2</span><span class="s3">, [</span><span class="s5">2</span><span class="s3">, </span><span class="s5">3</span><span class="s3">, </span><span class="s5">4</span><span class="s3">]),  </span><span class="s6"># c, d, d</span>
               <span class="s3">(</span><span class="s4">'indexed'</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">2</span><span class="s3">, [</span><span class="s5">5</span><span class="s3">]),  </span><span class="s6"># f</span>
               <span class="s3">])</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertTrue</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">.</span><span class="s1">need_shaped_indexing</span><span class="s3">)</span>

        <span class="s6"># 2-dim F-order iterator</span>
        <span class="s1">ty </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">NumpyNdIterType</span><span class="s3">((</span><span class="s1">c</span><span class="s3">,))</span>
        <span class="s1">check</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">, (</span><span class="s1">c64</span><span class="s3">,), </span><span class="s5">2</span><span class="s3">, </span><span class="s4">&quot;F&quot;</span><span class="s3">, [(</span><span class="s4">'flat'</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">2</span><span class="s3">, [</span><span class="s5">0</span><span class="s3">])])</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertFalse</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">.</span><span class="s1">need_shaped_indexing</span><span class="s3">)</span>
        <span class="s1">ty </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">NumpyNdIterType</span><span class="s3">((</span><span class="s1">c</span><span class="s3">, </span><span class="s1">b</span><span class="s3">, </span><span class="s1">c</span><span class="s3">, </span><span class="s1">f</span><span class="s3">))</span>
        <span class="s1">check</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">, (</span><span class="s1">c64</span><span class="s3">, </span><span class="s1">f32</span><span class="s3">, </span><span class="s1">c64</span><span class="s3">, </span><span class="s1">f32</span><span class="s3">), </span><span class="s5">2</span><span class="s3">, </span><span class="s4">&quot;F&quot;</span><span class="s3">,</span>
              <span class="s3">[(</span><span class="s4">'flat'</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">2</span><span class="s3">, [</span><span class="s5">0</span><span class="s3">, </span><span class="s5">2</span><span class="s3">]),  </span><span class="s6"># c, c</span>
               <span class="s3">(</span><span class="s4">'indexed'</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">2</span><span class="s3">, [</span><span class="s5">1</span><span class="s3">]),  </span><span class="s6"># b</span>
               <span class="s3">(</span><span class="s4">'indexed'</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, [</span><span class="s5">3</span><span class="s3">]),  </span><span class="s6"># f</span>
               <span class="s3">])</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertTrue</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">.</span><span class="s1">need_shaped_indexing</span><span class="s3">)</span>
        <span class="s1">ty </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">NumpyNdIterType</span><span class="s3">((</span><span class="s1">b</span><span class="s3">, </span><span class="s1">c</span><span class="s3">, </span><span class="s1">c</span><span class="s3">, </span><span class="s1">d</span><span class="s3">, </span><span class="s1">d</span><span class="s3">, </span><span class="s1">a</span><span class="s3">, </span><span class="s1">e</span><span class="s3">))</span>
        <span class="s1">check</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">, (</span><span class="s1">f32</span><span class="s3">, </span><span class="s1">c64</span><span class="s3">, </span><span class="s1">c64</span><span class="s3">, </span><span class="s1">i16</span><span class="s3">, </span><span class="s1">i16</span><span class="s3">, </span><span class="s1">f32</span><span class="s3">, </span><span class="s1">i16</span><span class="s3">), </span><span class="s5">2</span><span class="s3">, </span><span class="s4">&quot;F&quot;</span><span class="s3">,</span>
              <span class="s3">[(</span><span class="s4">'indexed'</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">2</span><span class="s3">, [</span><span class="s5">0</span><span class="s3">, </span><span class="s5">3</span><span class="s3">, </span><span class="s5">4</span><span class="s3">]),  </span><span class="s6"># b, d, d</span>
               <span class="s3">(</span><span class="s4">'flat'</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">2</span><span class="s3">, [</span><span class="s5">1</span><span class="s3">, </span><span class="s5">2</span><span class="s3">]),  </span><span class="s6"># c, c</span>
               <span class="s3">(</span><span class="s4">'flat'</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, [</span><span class="s5">5</span><span class="s3">]),  </span><span class="s6"># a</span>
               <span class="s3">(</span><span class="s4">'0d'</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, [</span><span class="s5">6</span><span class="s3">]),  </span><span class="s6"># e</span>
               <span class="s3">])</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertTrue</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">.</span><span class="s1">need_shaped_indexing</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">TestPickling</span><span class="s3">(</span><span class="s1">TestCase</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot; 
    Pickling and unpickling should preserve type identity (singleton-ness) 
    and the _code attribute.  This is only a requirement for types that 
    can be part of function signatures. 
    &quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">predefined_types</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0">&quot;&quot;&quot; 
        Yield all predefined type instances 
        &quot;&quot;&quot;</span>
        <span class="s2">for </span><span class="s1">ty </span><span class="s2">in </span><span class="s1">types</span><span class="s3">.</span><span class="s1">__dict__</span><span class="s3">.</span><span class="s1">values</span><span class="s3">():</span>
            <span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">, </span><span class="s1">types</span><span class="s3">.</span><span class="s1">Type</span><span class="s3">):</span>
                <span class="s2">yield </span><span class="s1">ty</span>

    <span class="s2">def </span><span class="s1">check_pickling</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">orig</span><span class="s3">):</span>
        <span class="s1">pickled </span><span class="s3">= </span><span class="s1">pickle</span><span class="s3">.</span><span class="s1">dumps</span><span class="s3">(</span><span class="s1">orig</span><span class="s3">, </span><span class="s1">protocol</span><span class="s3">=-</span><span class="s5">1</span><span class="s3">)</span>
        <span class="s1">ty </span><span class="s3">= </span><span class="s1">pickle</span><span class="s3">.</span><span class="s1">loads</span><span class="s3">(</span><span class="s1">pickled</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertIs</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">, </span><span class="s1">orig</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertGreaterEqual</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">.</span><span class="s1">_code</span><span class="s3">, </span><span class="s5">0</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_predefined_types</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">tys </span><span class="s3">= </span><span class="s1">list</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">predefined_types</span><span class="s3">())</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertIn</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">int16</span><span class="s3">, </span><span class="s1">tys</span><span class="s3">)</span>
        <span class="s2">for </span><span class="s1">ty </span><span class="s2">in </span><span class="s1">tys</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">check_pickling</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_atomic_types</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">for </span><span class="s1">unit </span><span class="s2">in </span><span class="s3">(</span><span class="s4">'M'</span><span class="s3">, </span><span class="s4">'ms'</span><span class="s3">):</span>
            <span class="s1">ty </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">NPDatetime</span><span class="s3">(</span><span class="s1">unit</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">check_pickling</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">)</span>
            <span class="s1">ty </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">NPTimedelta</span><span class="s3">(</span><span class="s1">unit</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">check_pickling</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_arrays</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">for </span><span class="s1">ndim </span><span class="s2">in </span><span class="s3">(</span><span class="s5">0</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">2</span><span class="s3">):</span>
            <span class="s2">for </span><span class="s1">layout </span><span class="s2">in </span><span class="s3">(</span><span class="s4">'A'</span><span class="s3">, </span><span class="s4">'C'</span><span class="s3">, </span><span class="s4">'F'</span><span class="s3">):</span>
                <span class="s1">ty </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">Array</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">int16</span><span class="s3">, </span><span class="s1">ndim</span><span class="s3">, </span><span class="s1">layout</span><span class="s3">)</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">check_pickling</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_records</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">recordtype </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">dtype</span><span class="s3">([(</span><span class="s4">'a'</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">float64</span><span class="s3">),</span>
                               <span class="s3">(</span><span class="s4">'b'</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">int32</span><span class="s3">),</span>
                               <span class="s3">(</span><span class="s4">'c'</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">complex64</span><span class="s3">),</span>
                               <span class="s3">(</span><span class="s4">'d'</span><span class="s3">, (</span><span class="s1">np</span><span class="s3">.</span><span class="s1">str_</span><span class="s3">, </span><span class="s5">5</span><span class="s3">))])</span>
        <span class="s1">ty </span><span class="s3">= </span><span class="s1">numpy_support</span><span class="s3">.</span><span class="s1">from_dtype</span><span class="s3">(</span><span class="s1">recordtype</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">check_pickling</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">check_pickling</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">Array</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s4">'A'</span><span class="s3">))</span>

    <span class="s2">def </span><span class="s1">test_optional</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">ty </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">Optional</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">int32</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">check_pickling</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_tuples</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">ty1 </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">UniTuple</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">int32</span><span class="s3">, </span><span class="s5">3</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">check_pickling</span><span class="s3">(</span><span class="s1">ty1</span><span class="s3">)</span>
        <span class="s1">ty2 </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">Tuple</span><span class="s3">((</span><span class="s1">types</span><span class="s3">.</span><span class="s1">int32</span><span class="s3">, </span><span class="s1">ty1</span><span class="s3">))</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">check_pickling</span><span class="s3">(</span><span class="s1">ty2</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_namedtuples</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">ty1 </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">NamedUniTuple</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">intp</span><span class="s3">, </span><span class="s5">2</span><span class="s3">, </span><span class="s1">Point</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">check_pickling</span><span class="s3">(</span><span class="s1">ty1</span><span class="s3">)</span>
        <span class="s1">ty2 </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">NamedTuple</span><span class="s3">((</span><span class="s1">types</span><span class="s3">.</span><span class="s1">intp</span><span class="s3">, </span><span class="s1">types</span><span class="s3">.</span><span class="s1">float64</span><span class="s3">), </span><span class="s1">Point</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">check_pickling</span><span class="s3">(</span><span class="s1">ty2</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_enums</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">ty1 </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">EnumMember</span><span class="s3">(</span><span class="s1">Color</span><span class="s3">, </span><span class="s1">types</span><span class="s3">.</span><span class="s1">int32</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">check_pickling</span><span class="s3">(</span><span class="s1">ty1</span><span class="s3">)</span>
        <span class="s1">ty2 </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">EnumMember</span><span class="s3">(</span><span class="s1">Shake</span><span class="s3">, </span><span class="s1">types</span><span class="s3">.</span><span class="s1">int64</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">check_pickling</span><span class="s3">(</span><span class="s1">ty2</span><span class="s3">)</span>
        <span class="s1">ty3 </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">IntEnumMember</span><span class="s3">(</span><span class="s1">Shape</span><span class="s3">, </span><span class="s1">types</span><span class="s3">.</span><span class="s1">int64</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">check_pickling</span><span class="s3">(</span><span class="s1">ty3</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_lists</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">ty </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">List</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">int32</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">check_pickling</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_generator</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">cfunc </span><span class="s3">= </span><span class="s1">jit</span><span class="s3">(</span><span class="s4">&quot;(int32,)&quot;</span><span class="s3">, </span><span class="s1">nopython</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)(</span><span class="s1">gen</span><span class="s3">)</span>
        <span class="s1">sigs </span><span class="s3">= </span><span class="s1">list</span><span class="s3">(</span><span class="s1">cfunc</span><span class="s3">.</span><span class="s1">nopython_signatures</span><span class="s3">)</span>
        <span class="s1">ty </span><span class="s3">= </span><span class="s1">sigs</span><span class="s3">[</span><span class="s5">0</span><span class="s3">].</span><span class="s1">return_type</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertIsInstance</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">, </span><span class="s1">types</span><span class="s3">.</span><span class="s1">Generator</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">check_pickling</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">)</span>

    <span class="s6"># call templates are not picklable</span>
    <span class="s3">@</span><span class="s1">unittest</span><span class="s3">.</span><span class="s1">expectedFailure</span>
    <span class="s2">def </span><span class="s1">test_external_function_pointers</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">from </span><span class="s1">numba</span><span class="s3">.</span><span class="s1">core</span><span class="s3">.</span><span class="s1">typing </span><span class="s2">import </span><span class="s1">ctypes_utils</span>
        <span class="s2">from </span><span class="s1">numba</span><span class="s3">.</span><span class="s1">tests</span><span class="s3">.</span><span class="s1">ctypes_usecases </span><span class="s2">import </span><span class="s1">c_sin</span><span class="s3">, </span><span class="s1">c_cos</span>
        <span class="s2">for </span><span class="s1">fnptr </span><span class="s2">in </span><span class="s3">(</span><span class="s1">c_sin</span><span class="s3">, </span><span class="s1">c_cos</span><span class="s3">):</span>
            <span class="s1">ty </span><span class="s3">= </span><span class="s1">ctypes_utils</span><span class="s3">.</span><span class="s1">make_function_type</span><span class="s3">(</span><span class="s1">fnptr</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">assertIsInstance</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">, </span><span class="s1">types</span><span class="s3">.</span><span class="s1">ExternalFunctionPointer</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">check_pickling</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">TestSignatures</span><span class="s3">(</span><span class="s1">TestCase</span><span class="s3">):</span>

    <span class="s2">def </span><span class="s1">test_normalize_signature</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">f </span><span class="s3">= </span><span class="s1">sigutils</span><span class="s3">.</span><span class="s1">normalize_signature</span>

        <span class="s2">def </span><span class="s1">check</span><span class="s3">(</span><span class="s1">sig</span><span class="s3">, </span><span class="s1">args</span><span class="s3">, </span><span class="s1">return_type</span><span class="s3">):</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">f</span><span class="s3">(</span><span class="s1">sig</span><span class="s3">), (</span><span class="s1">args</span><span class="s3">, </span><span class="s1">return_type</span><span class="s3">))</span>

        <span class="s2">def </span><span class="s1">check_error</span><span class="s3">(</span><span class="s1">sig</span><span class="s3">, </span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s2">with </span><span class="s1">self</span><span class="s3">.</span><span class="s1">assertRaises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">raises</span><span class="s3">:</span>
                <span class="s1">f</span><span class="s3">(</span><span class="s1">sig</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">assertIn</span><span class="s3">(</span><span class="s1">msg</span><span class="s3">, </span><span class="s1">str</span><span class="s3">(</span><span class="s1">raises</span><span class="s3">.</span><span class="s1">exception</span><span class="s3">))</span>

        <span class="s1">f32 </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">float32</span>
        <span class="s1">c64 </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">complex64</span>
        <span class="s1">i16 </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">int16</span>
        <span class="s1">a </span><span class="s3">= </span><span class="s1">types</span><span class="s3">.</span><span class="s1">Array</span><span class="s3">(</span><span class="s1">f32</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s4">&quot;C&quot;</span><span class="s3">)</span>

        <span class="s1">check</span><span class="s3">((</span><span class="s1">c64</span><span class="s3">,), (</span><span class="s1">c64</span><span class="s3">,), </span><span class="s2">None</span><span class="s3">)</span>
        <span class="s1">check</span><span class="s3">((</span><span class="s1">f32</span><span class="s3">, </span><span class="s1">i16</span><span class="s3">), (</span><span class="s1">f32</span><span class="s3">, </span><span class="s1">i16</span><span class="s3">), </span><span class="s2">None</span><span class="s3">)</span>
        <span class="s1">check</span><span class="s3">(</span><span class="s1">a</span><span class="s3">(</span><span class="s1">i16</span><span class="s3">), (</span><span class="s1">i16</span><span class="s3">,), </span><span class="s1">a</span><span class="s3">)</span>
        <span class="s1">check</span><span class="s3">(</span><span class="s4">&quot;int16(complex64)&quot;</span><span class="s3">, (</span><span class="s1">c64</span><span class="s3">,), </span><span class="s1">i16</span><span class="s3">)</span>
        <span class="s1">check</span><span class="s3">(</span><span class="s4">&quot;(complex64, int16)&quot;</span><span class="s3">, (</span><span class="s1">c64</span><span class="s3">, </span><span class="s1">i16</span><span class="s3">), </span><span class="s2">None</span><span class="s3">)</span>
        <span class="s1">check</span><span class="s3">(</span><span class="s1">typing</span><span class="s3">.</span><span class="s1">signature</span><span class="s3">(</span><span class="s1">i16</span><span class="s3">, </span><span class="s1">c64</span><span class="s3">), (</span><span class="s1">c64</span><span class="s3">,), </span><span class="s1">i16</span><span class="s3">)</span>

        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;invalid type in signature: expected a type instance&quot;</span>
        <span class="s1">check_error</span><span class="s3">((</span><span class="s1">types</span><span class="s3">.</span><span class="s1">Integer</span><span class="s3">,), </span><span class="s1">msg</span><span class="s3">)</span>
        <span class="s1">check_error</span><span class="s3">((</span><span class="s2">None</span><span class="s3">,), </span><span class="s1">msg</span><span class="s3">)</span>
        <span class="s1">check_error</span><span class="s3">([], </span><span class="s4">&quot;invalid signature&quot;</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">TestRecordDtype</span><span class="s3">(</span><span class="s1">unittest</span><span class="s3">.</span><span class="s1">TestCase</span><span class="s3">):</span>
    <span class="s2">def </span><span class="s1">test_record_type_equiv</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">rec_dt </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">dtype</span><span class="s3">([(</span><span class="s4">'a'</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">int32</span><span class="s3">), (</span><span class="s4">'b'</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">float32</span><span class="s3">)])</span>
        <span class="s1">rec_ty </span><span class="s3">= </span><span class="s1">typeof</span><span class="s3">(</span><span class="s1">rec_dt</span><span class="s3">)</span>
        <span class="s1">art1 </span><span class="s3">= </span><span class="s1">rec_ty</span><span class="s3">[::</span><span class="s5">1</span><span class="s3">]</span>
        <span class="s1">arr </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">zeros</span><span class="s3">(</span><span class="s5">5</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">rec_dt</span><span class="s3">)</span>
        <span class="s1">art2 </span><span class="s3">= </span><span class="s1">typeof</span><span class="s3">(</span><span class="s1">arr</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">art2</span><span class="s3">.</span><span class="s1">dtype</span><span class="s3">.</span><span class="s1">dtype</span><span class="s3">, </span><span class="s1">rec_ty</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">art1</span><span class="s3">, </span><span class="s1">art2</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_user_specified</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">rec_dt </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">dtype</span><span class="s3">([(</span><span class="s4">'a'</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">int32</span><span class="s3">), (</span><span class="s4">'b'</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">float32</span><span class="s3">)])</span>
        <span class="s1">rec_type </span><span class="s3">= </span><span class="s1">typeof</span><span class="s3">(</span><span class="s1">rec_dt</span><span class="s3">)</span>

        <span class="s3">@</span><span class="s1">jit</span><span class="s3">((</span><span class="s1">rec_type</span><span class="s3">[:],), </span><span class="s1">nopython</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
        <span class="s2">def </span><span class="s1">foo</span><span class="s3">(</span><span class="s1">x</span><span class="s3">):</span>
            <span class="s2">return </span><span class="s1">x</span><span class="s3">[</span><span class="s4">'a'</span><span class="s3">], </span><span class="s1">x</span><span class="s3">[</span><span class="s4">'b'</span><span class="s3">]</span>

        <span class="s1">arr </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">zeros</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">rec_dt</span><span class="s3">)</span>
        <span class="s1">arr</span><span class="s3">[</span><span class="s5">0</span><span class="s3">][</span><span class="s4">'a'</span><span class="s3">] = </span><span class="s5">123</span>
        <span class="s1">arr</span><span class="s3">[</span><span class="s5">0</span><span class="s3">][</span><span class="s4">'b'</span><span class="s3">] = </span><span class="s5">32.1</span>

        <span class="s1">a</span><span class="s3">, </span><span class="s1">b </span><span class="s3">= </span><span class="s1">foo</span><span class="s3">(</span><span class="s1">arr</span><span class="s3">)</span>

        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">a</span><span class="s3">, </span><span class="s1">arr</span><span class="s3">[</span><span class="s5">0</span><span class="s3">][</span><span class="s4">'a'</span><span class="s3">])</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">b</span><span class="s3">, </span><span class="s1">arr</span><span class="s3">[</span><span class="s5">0</span><span class="s3">][</span><span class="s4">'b'</span><span class="s3">])</span>


<span class="s2">class </span><span class="s1">TestDType</span><span class="s3">(</span><span class="s1">TestCase</span><span class="s3">):</span>
    <span class="s2">def </span><span class="s1">test_type_attr</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s6"># Test .type attribute of dtype</span>
        <span class="s2">def </span><span class="s1">conv</span><span class="s3">(</span><span class="s1">arr</span><span class="s3">, </span><span class="s1">val</span><span class="s3">):</span>
            <span class="s2">return </span><span class="s1">arr</span><span class="s3">.</span><span class="s1">dtype</span><span class="s3">.</span><span class="s1">type</span><span class="s3">(</span><span class="s1">val</span><span class="s3">)</span>

        <span class="s1">jit_conv </span><span class="s3">= </span><span class="s1">jit</span><span class="s3">(</span><span class="s1">nopython</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)(</span><span class="s1">conv</span><span class="s3">)</span>

        <span class="s2">def </span><span class="s1">assert_matches</span><span class="s3">(</span><span class="s1">arr</span><span class="s3">, </span><span class="s1">val</span><span class="s3">, </span><span class="s1">exact</span><span class="s3">):</span>
            <span class="s1">expect </span><span class="s3">= </span><span class="s1">conv</span><span class="s3">(</span><span class="s1">arr</span><span class="s3">, </span><span class="s1">val</span><span class="s3">)</span>
            <span class="s1">got </span><span class="s3">= </span><span class="s1">jit_conv</span><span class="s3">(</span><span class="s1">arr</span><span class="s3">, </span><span class="s1">val</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">assertPreciseEqual</span><span class="s3">(</span><span class="s1">expect</span><span class="s3">, </span><span class="s1">exact</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">assertPreciseEqual</span><span class="s3">(</span><span class="s1">typeof</span><span class="s3">(</span><span class="s1">expect</span><span class="s3">), </span><span class="s1">typeof</span><span class="s3">(</span><span class="s1">got</span><span class="s3">))</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">assertPreciseEqual</span><span class="s3">(</span><span class="s1">expect</span><span class="s3">, </span><span class="s1">got</span><span class="s3">)</span>

        <span class="s1">arr </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">zeros</span><span class="s3">(</span><span class="s5">5</span><span class="s3">)</span>
        <span class="s1">assert_matches</span><span class="s3">(</span><span class="s1">arr</span><span class="s3">.</span><span class="s1">astype</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">intp</span><span class="s3">), </span><span class="s5">1.2</span><span class="s3">, </span><span class="s5">1</span><span class="s3">)</span>
        <span class="s1">assert_matches</span><span class="s3">(</span><span class="s1">arr</span><span class="s3">.</span><span class="s1">astype</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">float64</span><span class="s3">), </span><span class="s5">1.2</span><span class="s3">, </span><span class="s5">1.2</span><span class="s3">)</span>
        <span class="s1">assert_matches</span><span class="s3">(</span><span class="s1">arr</span><span class="s3">.</span><span class="s1">astype</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">complex128</span><span class="s3">), </span><span class="s5">1.2</span><span class="s3">, (</span><span class="s5">1.2 </span><span class="s3">+ </span><span class="s5">0j</span><span class="s3">))</span>
        <span class="s1">assert_matches</span><span class="s3">(</span><span class="s1">arr</span><span class="s3">.</span><span class="s1">astype</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">complex128</span><span class="s3">), </span><span class="s5">1.2j</span><span class="s3">, </span><span class="s5">1.2j</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_kind</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">def </span><span class="s1">tkind</span><span class="s3">(</span><span class="s1">A</span><span class="s3">):</span>
            <span class="s2">return </span><span class="s1">A</span><span class="s3">.</span><span class="s1">dtype</span><span class="s3">.</span><span class="s1">kind </span><span class="s3">== </span><span class="s4">'f'</span>
        <span class="s1">jit_tkind </span><span class="s3">= </span><span class="s1">jit</span><span class="s3">(</span><span class="s1">nopython</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)(</span><span class="s1">tkind</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">tkind</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">ones</span><span class="s3">(</span><span class="s5">3</span><span class="s3">)), </span><span class="s1">jit_tkind</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">ones</span><span class="s3">(</span><span class="s5">3</span><span class="s3">)))</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">tkind</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">ones</span><span class="s3">(</span><span class="s5">3</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">np</span><span class="s3">.</span><span class="s1">intp</span><span class="s3">)),</span>
                         <span class="s1">jit_tkind</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">ones</span><span class="s3">(</span><span class="s5">3</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">np</span><span class="s3">.</span><span class="s1">intp</span><span class="s3">)))</span>

    <span class="s2">def </span><span class="s1">test_dtype_with_type</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">def </span><span class="s1">impl</span><span class="s3">():</span>
            <span class="s1">a </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">dtype</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">float64</span><span class="s3">)</span>
            <span class="s2">return </span><span class="s1">a</span><span class="s3">.</span><span class="s1">type</span><span class="s3">(</span><span class="s5">0</span><span class="s3">)</span>
        <span class="s1">jit_impl </span><span class="s3">= </span><span class="s1">jit</span><span class="s3">(</span><span class="s1">nopython</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)(</span><span class="s1">impl</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">impl</span><span class="s3">(), </span><span class="s1">jit_impl</span><span class="s3">())</span>

    <span class="s2">def </span><span class="s1">test_dtype_with_string</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">def </span><span class="s1">impl</span><span class="s3">():</span>
            <span class="s1">a </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">dtype</span><span class="s3">(</span><span class="s4">'float64'</span><span class="s3">)</span>
            <span class="s2">return </span><span class="s1">a</span><span class="s3">.</span><span class="s1">type</span><span class="s3">(</span><span class="s5">0</span><span class="s3">)</span>
        <span class="s1">jit_impl </span><span class="s3">= </span><span class="s1">jit</span><span class="s3">(</span><span class="s1">nopython</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)(</span><span class="s1">impl</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">impl</span><span class="s3">(), </span><span class="s1">jit_impl</span><span class="s3">())</span>


<span class="s2">class </span><span class="s1">TestIsInternalTypeMarker</span><span class="s3">(</span><span class="s1">TestCase</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;Tests the use of the Type metaclass init correctly setting the flag on 
    the `is_internal` attr of a concrete Type class 
    &quot;&quot;&quot;</span>
    <span class="s1">source_lines </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot; 
from numba.core import types 
 
class FooType(types.Type): 
    def __init__(self): 
        super(FooType, self).__init__(name='Foo') 
&quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">test_create_temp_module</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">sys_path_original </span><span class="s3">= </span><span class="s1">list</span><span class="s3">(</span><span class="s1">sys</span><span class="s3">.</span><span class="s1">path</span><span class="s3">)</span>
        <span class="s1">sys_modules_original </span><span class="s3">= </span><span class="s1">dict</span><span class="s3">(</span><span class="s1">sys</span><span class="s3">.</span><span class="s1">modules</span><span class="s3">)</span>
        <span class="s2">with </span><span class="s1">create_temp_module</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">source_lines</span><span class="s3">) </span><span class="s2">as </span><span class="s1">test_module</span><span class="s3">:</span>
            <span class="s1">temp_module_dir </span><span class="s3">= </span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">dirname</span><span class="s3">(</span><span class="s1">test_module</span><span class="s3">.</span><span class="s1">__file__</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">temp_module_dir</span><span class="s3">, </span><span class="s1">sys</span><span class="s3">.</span><span class="s1">path</span><span class="s3">[</span><span class="s5">0</span><span class="s3">])</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">sys</span><span class="s3">.</span><span class="s1">path</span><span class="s3">[</span><span class="s5">1</span><span class="s3">:], </span><span class="s1">sys_path_original</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">assertTrue</span><span class="s3">(</span><span class="s1">test_module</span><span class="s3">.</span><span class="s1">__name__ </span><span class="s2">in </span><span class="s1">sys</span><span class="s3">.</span><span class="s1">modules</span><span class="s3">)</span>
        <span class="s6"># Test that modifications to sys.path / sys.modules are reverted</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">sys</span><span class="s3">.</span><span class="s1">path</span><span class="s3">, </span><span class="s1">sys_path_original</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">sys</span><span class="s3">.</span><span class="s1">modules</span><span class="s3">, </span><span class="s1">sys_modules_original</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_create_temp_module_with_exception</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">try</span><span class="s3">:</span>
            <span class="s1">sys_path_original </span><span class="s3">= </span><span class="s1">list</span><span class="s3">(</span><span class="s1">sys</span><span class="s3">.</span><span class="s1">path</span><span class="s3">)</span>
            <span class="s1">sys_modules_original </span><span class="s3">= </span><span class="s1">dict</span><span class="s3">(</span><span class="s1">sys</span><span class="s3">.</span><span class="s1">modules</span><span class="s3">)</span>
            <span class="s2">with </span><span class="s1">create_temp_module</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">source_lines</span><span class="s3">):</span>
                <span class="s2">raise </span><span class="s1">ValueError</span><span class="s3">(</span><span class="s4">&quot;Something went wrong!&quot;</span><span class="s3">)</span>
        <span class="s2">except </span><span class="s1">ValueError</span><span class="s3">:</span>
            <span class="s6"># Test that modifications to sys.path / sys.modules are reverted</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">sys</span><span class="s3">.</span><span class="s1">path</span><span class="s3">, </span><span class="s1">sys_path_original</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">sys</span><span class="s3">.</span><span class="s1">modules</span><span class="s3">, </span><span class="s1">sys_modules_original</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_externally_defined_type_is_external</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>

        <span class="s2">with </span><span class="s1">create_temp_module</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">source_lines</span><span class="s3">) </span><span class="s2">as </span><span class="s1">test_module</span><span class="s3">:</span>
            <span class="s1">FooType </span><span class="s3">= </span><span class="s1">test_module</span><span class="s3">.</span><span class="s1">FooType</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">assertFalse</span><span class="s3">(</span><span class="s1">FooType</span><span class="s3">().</span><span class="s1">is_internal</span><span class="s3">)</span>

            <span class="s6"># set up an extension type</span>
            <span class="s2">class </span><span class="s1">Foo</span><span class="s3">(</span><span class="s1">object</span><span class="s3">):</span>
                <span class="s2">pass</span>

            <span class="s1">register_model</span><span class="s3">(</span><span class="s1">FooType</span><span class="s3">)(</span><span class="s1">models</span><span class="s3">.</span><span class="s1">OpaqueModel</span><span class="s3">)</span>

            <span class="s3">@</span><span class="s1">typeof_impl</span><span class="s3">.</span><span class="s1">register</span><span class="s3">(</span><span class="s1">Foo</span><span class="s3">)</span>
            <span class="s2">def </span><span class="s1">_typ_foo</span><span class="s3">(</span><span class="s1">val</span><span class="s3">, </span><span class="s1">c</span><span class="s3">):</span>
                <span class="s2">return </span><span class="s1">FooType</span><span class="s3">()</span>

            <span class="s3">@</span><span class="s1">unbox</span><span class="s3">(</span><span class="s1">FooType</span><span class="s3">)</span>
            <span class="s2">def </span><span class="s1">unbox_foo</span><span class="s3">(</span><span class="s1">typ</span><span class="s3">, </span><span class="s1">obj</span><span class="s3">, </span><span class="s1">c</span><span class="s3">):</span>
                <span class="s2">return </span><span class="s1">NativeValue</span><span class="s3">(</span><span class="s1">c</span><span class="s3">.</span><span class="s1">context</span><span class="s3">.</span><span class="s1">get_dummy_value</span><span class="s3">())</span>

            <span class="s6"># function to overload</span>
            <span class="s2">def </span><span class="s1">false_if_not_array</span><span class="s3">(</span><span class="s1">a</span><span class="s3">):</span>
                <span class="s2">pass</span>

            <span class="s6"># Set up an overload which will accept all types irrespective of</span>
            <span class="s6"># whether they are from Numba's closed type system</span>
            <span class="s3">@</span><span class="s1">overload</span><span class="s3">(</span><span class="s1">false_if_not_array</span><span class="s3">)</span>
            <span class="s2">def </span><span class="s1">ol_false_if_not_array</span><span class="s3">(</span><span class="s1">a</span><span class="s3">):</span>
                <span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">a</span><span class="s3">, </span><span class="s1">types</span><span class="s3">.</span><span class="s1">Array</span><span class="s3">):</span>
                    <span class="s2">return lambda </span><span class="s1">a </span><span class="s3">: </span><span class="s2">True</span>
                <span class="s2">else</span><span class="s3">:</span>
                    <span class="s2">return lambda </span><span class="s1">a </span><span class="s3">: </span><span class="s2">False</span>

            <span class="s3">@</span><span class="s1">njit</span>
            <span class="s2">def </span><span class="s1">call_false_if_not_array</span><span class="s3">(</span><span class="s1">a</span><span class="s3">):</span>
                <span class="s2">return </span><span class="s1">false_if_not_array</span><span class="s3">(</span><span class="s1">a</span><span class="s3">)</span>

            <span class="s1">self</span><span class="s3">.</span><span class="s1">assertTrue</span><span class="s3">(</span><span class="s1">call_false_if_not_array</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">zeros</span><span class="s3">(</span><span class="s5">10</span><span class="s3">)))</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">assertFalse</span><span class="s3">(</span><span class="s1">call_false_if_not_array</span><span class="s3">(</span><span class="s5">10</span><span class="s3">))</span>

            <span class="s6"># The extension type was accepted</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">assertFalse</span><span class="s3">(</span><span class="s1">call_false_if_not_array</span><span class="s3">(</span><span class="s1">Foo</span><span class="s3">()))</span>

            <span class="s6"># Now do the same sort of overload but put in a guard based on the</span>
            <span class="s6"># use of internal types</span>

            <span class="s2">def </span><span class="s1">false_if_not_array_closed_system</span><span class="s3">(</span><span class="s1">a</span><span class="s3">):</span>
                <span class="s2">pass</span>

            <span class="s3">@</span><span class="s1">overload</span><span class="s3">(</span><span class="s1">false_if_not_array_closed_system</span><span class="s3">)</span>
            <span class="s2">def </span><span class="s1">ol_false_if_not_array_closed_system</span><span class="s3">(</span><span class="s1">a</span><span class="s3">):</span>
                <span class="s2">if </span><span class="s1">a</span><span class="s3">.</span><span class="s1">is_internal</span><span class="s3">:  </span><span class="s6"># guard</span>
                    <span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">a</span><span class="s3">, </span><span class="s1">types</span><span class="s3">.</span><span class="s1">Array</span><span class="s3">):</span>
                        <span class="s2">return lambda </span><span class="s1">a </span><span class="s3">: </span><span class="s2">True</span>
                    <span class="s2">else</span><span class="s3">:</span>
                        <span class="s2">return lambda </span><span class="s1">a </span><span class="s3">: </span><span class="s2">False</span>

            <span class="s3">@</span><span class="s1">njit</span>
            <span class="s2">def </span><span class="s1">call_false_if_not_array_closed_system</span><span class="s3">(</span><span class="s1">a</span><span class="s3">):</span>
                <span class="s2">return </span><span class="s1">false_if_not_array_closed_system</span><span class="s3">(</span><span class="s1">a</span><span class="s3">)</span>

            <span class="s1">self</span><span class="s3">.</span><span class="s1">assertTrue</span><span class="s3">(</span><span class="s1">call_false_if_not_array_closed_system</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">zeros</span><span class="s3">(</span><span class="s5">10</span><span class="s3">)))</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">assertFalse</span><span class="s3">(</span><span class="s1">call_false_if_not_array_closed_system</span><span class="s3">(</span><span class="s5">10</span><span class="s3">))</span>

            <span class="s2">with </span><span class="s1">self</span><span class="s3">.</span><span class="s1">assertRaises</span><span class="s3">(</span><span class="s1">errors</span><span class="s3">.</span><span class="s1">TypingError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">raises</span><span class="s3">:</span>
                <span class="s1">call_false_if_not_array_closed_system</span><span class="s3">(</span><span class="s1">Foo</span><span class="s3">())</span>
            <span class="s1">estr </span><span class="s3">= </span><span class="s1">str</span><span class="s3">(</span><span class="s1">raises</span><span class="s3">.</span><span class="s1">exception</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">assertIn</span><span class="s3">(</span><span class="s1">_header_lead</span><span class="s3">, </span><span class="s1">estr</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">assertIn</span><span class="s3">(</span><span class="s4">&quot;false_if_not_array_closed_system&quot;</span><span class="s3">, </span><span class="s1">estr</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">assertIn</span><span class="s3">(</span><span class="s4">&quot;(Foo)&quot;</span><span class="s3">, </span><span class="s1">estr</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_mixin_against_real_example</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s6"># See issue #4970, this checks that unicode eq/ne now ignores extension</span>
        <span class="s6"># types.</span>

        <span class="s2">with </span><span class="s1">create_temp_module</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">source_lines</span><span class="s3">) </span><span class="s2">as </span><span class="s1">test_module</span><span class="s3">:</span>
            <span class="s1">FooType </span><span class="s3">= </span><span class="s1">test_module</span><span class="s3">.</span><span class="s1">FooType</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">assertFalse</span><span class="s3">(</span><span class="s1">FooType</span><span class="s3">().</span><span class="s1">is_internal</span><span class="s3">)</span>

            <span class="s6"># set up an extension type</span>
            <span class="s2">class </span><span class="s1">Foo</span><span class="s3">(</span><span class="s1">object</span><span class="s3">):</span>
                <span class="s2">pass</span>

            <span class="s1">register_model</span><span class="s3">(</span><span class="s1">FooType</span><span class="s3">)(</span><span class="s1">models</span><span class="s3">.</span><span class="s1">OpaqueModel</span><span class="s3">)</span>

            <span class="s3">@</span><span class="s1">typeof_impl</span><span class="s3">.</span><span class="s1">register</span><span class="s3">(</span><span class="s1">Foo</span><span class="s3">)</span>
            <span class="s2">def </span><span class="s1">_typ_foo</span><span class="s3">(</span><span class="s1">val</span><span class="s3">, </span><span class="s1">c</span><span class="s3">):</span>
                <span class="s2">return </span><span class="s1">FooType</span><span class="s3">()</span>

            <span class="s3">@</span><span class="s1">unbox</span><span class="s3">(</span><span class="s1">FooType</span><span class="s3">)</span>
            <span class="s2">def </span><span class="s1">unbox_foo</span><span class="s3">(</span><span class="s1">typ</span><span class="s3">, </span><span class="s1">obj</span><span class="s3">, </span><span class="s1">c</span><span class="s3">):</span>
                <span class="s2">return </span><span class="s1">NativeValue</span><span class="s3">(</span><span class="s1">c</span><span class="s3">.</span><span class="s1">context</span><span class="s3">.</span><span class="s1">get_dummy_value</span><span class="s3">())</span>

            <span class="s3">@</span><span class="s1">overload</span><span class="s3">(</span><span class="s1">operator</span><span class="s3">.</span><span class="s1">eq</span><span class="s3">)</span>
            <span class="s2">def </span><span class="s1">foo_eq</span><span class="s3">(</span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">):</span>
                <span class="s2">if </span><span class="s1">a </span><span class="s3">== </span><span class="s1">FooType</span><span class="s3">():</span>
                    <span class="s2">return lambda </span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">: </span><span class="s4">&quot;RAN CUSTOM EQ OVERLOAD&quot;</span>

            <span class="s3">@</span><span class="s1">overload</span><span class="s3">(</span><span class="s1">operator</span><span class="s3">.</span><span class="s1">ne</span><span class="s3">)</span>
            <span class="s2">def </span><span class="s1">foo_ne</span><span class="s3">(</span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">):</span>
                <span class="s2">if </span><span class="s1">a </span><span class="s3">== </span><span class="s1">FooType</span><span class="s3">():</span>
                    <span class="s2">return lambda </span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">: </span><span class="s4">&quot;RAN CUSTOM NE OVERLOAD&quot;</span>

            <span class="s3">@</span><span class="s1">njit</span>
            <span class="s2">def </span><span class="s1">f</span><span class="s3">(</span><span class="s1">a</span><span class="s3">):</span>
                <span class="s2">return </span><span class="s1">a </span><span class="s3">== </span><span class="s4">&quot;A&quot;</span><span class="s3">, </span><span class="s1">a </span><span class="s3">!= </span><span class="s4">&quot;A&quot;</span>

            <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">((</span><span class="s4">&quot;RAN CUSTOM EQ OVERLOAD&quot;</span><span class="s3">,</span>
                              <span class="s4">&quot;RAN CUSTOM NE OVERLOAD&quot;</span><span class="s3">),</span>
                             <span class="s1">f</span><span class="s3">(</span><span class="s1">Foo</span><span class="s3">()))</span>


<span class="s2">class </span><span class="s1">TestIssues</span><span class="s3">(</span><span class="s1">TestCase</span><span class="s3">):</span>
    <span class="s2">def </span><span class="s1">test_omitted_type</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s6"># issue https://github.com/numba/numba/issues/5471</span>
        <span class="s2">def </span><span class="s1">inner</span><span class="s3">(</span><span class="s1">a</span><span class="s3">):</span>
            <span class="s2">pass</span>

        <span class="s3">@</span><span class="s1">overload</span><span class="s3">(</span><span class="s1">inner</span><span class="s3">)</span>
        <span class="s2">def </span><span class="s1">inner_overload</span><span class="s3">(</span><span class="s1">a</span><span class="s3">):</span>
            <span class="s2">if not </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">a</span><span class="s3">, </span><span class="s1">types</span><span class="s3">.</span><span class="s1">Literal</span><span class="s3">):</span>
                <span class="s2">return</span>
            <span class="s2">return lambda </span><span class="s1">a</span><span class="s3">: </span><span class="s1">a</span>

        <span class="s3">@</span><span class="s1">njit</span>
        <span class="s2">def </span><span class="s1">my_func</span><span class="s3">(</span><span class="s1">a</span><span class="s3">=</span><span class="s4">'a'</span><span class="s3">):</span>
            <span class="s2">return </span><span class="s1">inner</span><span class="s3">(</span><span class="s1">a</span><span class="s3">)</span>

        <span class="s3">@</span><span class="s1">njit</span>
        <span class="s2">def </span><span class="s1">f</span><span class="s3">():</span>
            <span class="s2">return </span><span class="s1">my_func</span><span class="s3">()</span>

        <span class="s3">@</span><span class="s1">njit</span>
        <span class="s2">def </span><span class="s1">g</span><span class="s3">():</span>
            <span class="s2">return </span><span class="s1">my_func</span><span class="s3">(</span><span class="s4">'b'</span><span class="s3">)</span>

        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">f</span><span class="s3">(), </span><span class="s4">'a'</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">g</span><span class="s3">(), </span><span class="s4">'b'</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_type_of_literal</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s6"># type(val) where val is a literal should not give a literal type.</span>
        <span class="s2">def </span><span class="s1">inner</span><span class="s3">(</span><span class="s1">a</span><span class="s3">):</span>
            <span class="s2">pass</span>

        <span class="s3">@</span><span class="s1">overload</span><span class="s3">(</span><span class="s1">inner</span><span class="s3">)</span>
        <span class="s2">def </span><span class="s1">inner_overload</span><span class="s3">(</span><span class="s1">a</span><span class="s3">):</span>
            <span class="s2">if not </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">a</span><span class="s3">, </span><span class="s1">types</span><span class="s3">.</span><span class="s1">Literal</span><span class="s3">):</span>
                <span class="s2">return</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">assertIsInstance</span><span class="s3">(</span><span class="s1">a</span><span class="s3">, </span><span class="s1">types</span><span class="s3">.</span><span class="s1">Literal</span><span class="s3">)</span>
            <span class="s6"># NOTE: using 1.23 to ensure that the result is indeed an int.</span>
            <span class="s2">return lambda </span><span class="s1">a</span><span class="s3">: </span><span class="s1">type</span><span class="s3">(</span><span class="s1">a</span><span class="s3">)(</span><span class="s1">a </span><span class="s3">+ </span><span class="s5">1.23</span><span class="s3">)</span>

        <span class="s3">@</span><span class="s1">njit</span>
        <span class="s2">def </span><span class="s1">my_func</span><span class="s3">(</span><span class="s1">a</span><span class="s3">=</span><span class="s5">1</span><span class="s3">):</span>
            <span class="s2">return </span><span class="s1">inner</span><span class="s3">(</span><span class="s1">a</span><span class="s3">)</span>

        <span class="s3">@</span><span class="s1">njit</span>
        <span class="s2">def </span><span class="s1">f</span><span class="s3">():</span>
            <span class="s2">return </span><span class="s1">my_func</span><span class="s3">()</span>

        <span class="s3">@</span><span class="s1">njit</span>
        <span class="s2">def </span><span class="s1">g</span><span class="s3">():</span>
            <span class="s2">return </span><span class="s1">my_func</span><span class="s3">(</span><span class="s5">100</span><span class="s3">)</span>

        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">f</span><span class="s3">(), </span><span class="s5">2</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">g</span><span class="s3">(), </span><span class="s5">101</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_issue_typeref_key</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s6"># issue https://github.com/numba/numba/issues/6336</span>
        <span class="s2">class </span><span class="s1">NoUniqueNameType</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">Dummy</span><span class="s3">):</span>
            <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">param</span><span class="s3">):</span>
                <span class="s1">super</span><span class="s3">(</span><span class="s1">NoUniqueNameType</span><span class="s3">, </span><span class="s1">self</span><span class="s3">).</span><span class="s1">__init__</span><span class="s3">(</span><span class="s4">'NoUniqueNameType'</span><span class="s3">)</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">param </span><span class="s3">= </span><span class="s1">param</span>

            <span class="s3">@</span><span class="s1">property</span>
            <span class="s2">def </span><span class="s1">key</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
                <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">param</span>

        <span class="s1">no_unique_name_type_1 </span><span class="s3">= </span><span class="s1">NoUniqueNameType</span><span class="s3">(</span><span class="s5">1</span><span class="s3">)</span>
        <span class="s1">no_unique_name_type_2 </span><span class="s3">= </span><span class="s1">NoUniqueNameType</span><span class="s3">(</span><span class="s5">2</span><span class="s3">)</span>

        <span class="s2">for </span><span class="s1">ty1 </span><span class="s2">in </span><span class="s3">(</span><span class="s1">no_unique_name_type_1</span><span class="s3">, </span><span class="s1">no_unique_name_type_2</span><span class="s3">):</span>
            <span class="s2">for </span><span class="s1">ty2 </span><span class="s2">in </span><span class="s3">(</span><span class="s1">no_unique_name_type_1</span><span class="s3">, </span><span class="s1">no_unique_name_type_2</span><span class="s3">):</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">assertIs</span><span class="s3">(</span>
                    <span class="s1">types</span><span class="s3">.</span><span class="s1">TypeRef</span><span class="s3">(</span><span class="s1">ty1</span><span class="s3">) == </span><span class="s1">types</span><span class="s3">.</span><span class="s1">TypeRef</span><span class="s3">(</span><span class="s1">ty2</span><span class="s3">), </span><span class="s1">ty1 </span><span class="s3">== </span><span class="s1">ty2</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_issue_list_type_key</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s6"># https://github.com/numba/numba/issues/6397</span>
        <span class="s2">class </span><span class="s1">NoUniqueNameType</span><span class="s3">(</span><span class="s1">types</span><span class="s3">.</span><span class="s1">Dummy</span><span class="s3">):</span>
            <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">param</span><span class="s3">):</span>
                <span class="s1">super</span><span class="s3">(</span><span class="s1">NoUniqueNameType</span><span class="s3">, </span><span class="s1">self</span><span class="s3">).</span><span class="s1">__init__</span><span class="s3">(</span><span class="s4">'NoUniqueNameType'</span><span class="s3">)</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">param </span><span class="s3">= </span><span class="s1">param</span>

            <span class="s3">@</span><span class="s1">property</span>
            <span class="s2">def </span><span class="s1">key</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
                <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">param</span>

        <span class="s1">no_unique_name_type_1 </span><span class="s3">= </span><span class="s1">NoUniqueNameType</span><span class="s3">(</span><span class="s5">1</span><span class="s3">)</span>
        <span class="s1">no_unique_name_type_2 </span><span class="s3">= </span><span class="s1">NoUniqueNameType</span><span class="s3">(</span><span class="s5">2</span><span class="s3">)</span>

        <span class="s2">for </span><span class="s1">ty1 </span><span class="s2">in </span><span class="s3">(</span><span class="s1">no_unique_name_type_1</span><span class="s3">, </span><span class="s1">no_unique_name_type_2</span><span class="s3">):</span>
            <span class="s2">for </span><span class="s1">ty2 </span><span class="s2">in </span><span class="s3">(</span><span class="s1">no_unique_name_type_1</span><span class="s3">, </span><span class="s1">no_unique_name_type_2</span><span class="s3">):</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">assertIs</span><span class="s3">(</span>
                    <span class="s1">types</span><span class="s3">.</span><span class="s1">ListType</span><span class="s3">(</span><span class="s1">ty1</span><span class="s3">) == </span><span class="s1">types</span><span class="s3">.</span><span class="s1">ListType</span><span class="s3">(</span><span class="s1">ty2</span><span class="s3">),  </span><span class="s6"># noqa: E721</span>
                    <span class="s1">ty1 </span><span class="s3">== </span><span class="s1">ty2</span>
                <span class="s3">)</span>


<span class="s2">if </span><span class="s1">__name__ </span><span class="s3">== </span><span class="s4">'__main__'</span><span class="s3">:</span>
    <span class="s1">unittest</span><span class="s3">.</span><span class="s1">main</span><span class="s3">()</span>
</pre>
</body>
</html>