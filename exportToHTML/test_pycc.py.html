<html>
<head>
<title>test_pycc.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #5f826b; font-style: italic;}
.s5 { color: #7a7e85;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_pycc.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">contextlib</span>
<span class="s0">import </span><span class="s1">importlib</span>
<span class="s0">import </span><span class="s1">os</span>
<span class="s0">import </span><span class="s1">shutil</span>
<span class="s0">import </span><span class="s1">subprocess</span>
<span class="s0">import </span><span class="s1">sys</span>
<span class="s0">import </span><span class="s1">tempfile</span>
<span class="s0">from </span><span class="s1">unittest </span><span class="s0">import </span><span class="s1">skip</span>
<span class="s0">from </span><span class="s1">ctypes </span><span class="s0">import </span><span class="s2">*</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>

<span class="s0">import </span><span class="s1">llvmlite</span><span class="s2">.</span><span class="s1">binding </span><span class="s0">as </span><span class="s1">ll</span>

<span class="s0">from </span><span class="s1">numba</span><span class="s2">.</span><span class="s1">core </span><span class="s0">import </span><span class="s1">utils</span>
<span class="s0">from </span><span class="s1">numba</span><span class="s2">.</span><span class="s1">tests</span><span class="s2">.</span><span class="s1">support </span><span class="s0">import </span><span class="s2">(</span><span class="s1">TestCase</span><span class="s2">, </span><span class="s1">tag</span><span class="s2">, </span><span class="s1">import_dynamic</span><span class="s2">, </span><span class="s1">temp_directory</span><span class="s2">,</span>
                                 <span class="s1">has_blas</span><span class="s2">, </span><span class="s1">needs_setuptools</span><span class="s2">)</span>

<span class="s0">import </span><span class="s1">unittest</span>


<span class="s1">_skip_reason </span><span class="s2">= </span><span class="s3">'windows only'</span>
<span class="s1">_windows_only </span><span class="s2">= </span><span class="s1">unittest</span><span class="s2">.</span><span class="s1">skipIf</span><span class="s2">(</span><span class="s0">not </span><span class="s1">sys</span><span class="s2">.</span><span class="s1">platform</span><span class="s2">.</span><span class="s1">startswith</span><span class="s2">(</span><span class="s3">'win'</span><span class="s2">),</span>
                                <span class="s1">_skip_reason</span><span class="s2">)</span>


<span class="s1">base_path </span><span class="s2">= </span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">dirname</span><span class="s2">(</span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">abspath</span><span class="s2">(</span><span class="s1">__file__</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">unset_macosx_deployment_target</span><span class="s2">():</span>
    <span class="s4">&quot;&quot;&quot;Unset MACOSX_DEPLOYMENT_TARGET because we are not building portable 
    libraries 
    &quot;&quot;&quot;</span>
    <span class="s0">if </span><span class="s3">'MACOSX_DEPLOYMENT_TARGET' </span><span class="s0">in </span><span class="s1">os</span><span class="s2">.</span><span class="s1">environ</span><span class="s2">:</span>
        <span class="s0">del </span><span class="s1">os</span><span class="s2">.</span><span class="s1">environ</span><span class="s2">[</span><span class="s3">'MACOSX_DEPLOYMENT_TARGET'</span><span class="s2">]</span>


<span class="s2">@</span><span class="s1">needs_setuptools</span>
<span class="s0">class </span><span class="s1">TestCompilerChecks</span><span class="s2">(</span><span class="s1">TestCase</span><span class="s2">):</span>

    <span class="s5"># NOTE: THIS TEST MUST ALWAYS RUN ON WINDOWS, DO NOT SKIP</span>
    <span class="s2">@</span><span class="s1">_windows_only</span>
    <span class="s0">def </span><span class="s1">test_windows_compiler_validity</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># When inside conda-build VSINSTALLDIR should be set and windows should</span>
        <span class="s5"># have a valid compiler available, `external_compiler_works()` should</span>
        <span class="s5"># agree with this. If this is not the case then error out to alert devs.</span>

        <span class="s5"># This is a local import to avoid deprecation warnings being generated</span>
        <span class="s5"># through the use of the numba.pycc module.</span>
        <span class="s0">from </span><span class="s1">numba</span><span class="s2">.</span><span class="s1">pycc</span><span class="s2">.</span><span class="s1">platform </span><span class="s0">import </span><span class="s1">external_compiler_works</span>
        <span class="s1">is_running_conda_build </span><span class="s2">= </span><span class="s1">os</span><span class="s2">.</span><span class="s1">environ</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s3">'CONDA_BUILD'</span><span class="s2">, </span><span class="s0">None</span><span class="s2">) </span><span class="s0">is not None</span>
        <span class="s0">if </span><span class="s1">is_running_conda_build</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">os</span><span class="s2">.</span><span class="s1">environ</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s3">'VSINSTALLDIR'</span><span class="s2">, </span><span class="s0">None</span><span class="s2">) </span><span class="s0">is not None</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">external_compiler_works</span><span class="s2">())</span>


<span class="s0">class </span><span class="s1">BasePYCCTest</span><span class="s2">(</span><span class="s1">TestCase</span><span class="s2">):</span>

    <span class="s0">def </span><span class="s1">setUp</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">unset_macosx_deployment_target</span><span class="s2">()</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">tmpdir </span><span class="s2">= </span><span class="s1">temp_directory</span><span class="s2">(</span><span class="s3">'test_pycc'</span><span class="s2">)</span>
        <span class="s5"># Make sure temporary files and directories created by</span>
        <span class="s5"># distutils don't clutter the top-level /tmp</span>
        <span class="s1">tempfile</span><span class="s2">.</span><span class="s1">tempdir </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">tmpdir</span>

    <span class="s0">def </span><span class="s1">tearDown</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">tempfile</span><span class="s2">.</span><span class="s1">tempdir </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s5"># Since we're executing the module-under-test several times</span>
        <span class="s5"># from the same process, we must clear the exports registry</span>
        <span class="s5"># between invocations.</span>

        <span class="s5"># This is a local import to avoid deprecation warnings being generated</span>
        <span class="s5"># through the use of the numba.pycc module.</span>
        <span class="s0">from </span><span class="s1">numba</span><span class="s2">.</span><span class="s1">pycc</span><span class="s2">.</span><span class="s1">decorators </span><span class="s0">import </span><span class="s1">clear_export_registry</span>
        <span class="s1">clear_export_registry</span><span class="s2">()</span>

    <span class="s2">@</span><span class="s1">contextlib</span><span class="s2">.</span><span class="s1">contextmanager</span>
    <span class="s0">def </span><span class="s1">check_c_ext</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">extdir</span><span class="s2">, </span><span class="s1">name</span><span class="s2">):</span>
        <span class="s1">sys</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">extdir</span><span class="s2">)</span>
        <span class="s0">try</span><span class="s2">:</span>
            <span class="s1">lib </span><span class="s2">= </span><span class="s1">import_dynamic</span><span class="s2">(</span><span class="s1">name</span><span class="s2">)</span>
            <span class="s0">yield </span><span class="s1">lib</span>
        <span class="s0">finally</span><span class="s2">:</span>
            <span class="s1">sys</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">extdir</span><span class="s2">)</span>
            <span class="s1">sys</span><span class="s2">.</span><span class="s1">modules</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">needs_setuptools</span>
<span class="s0">class </span><span class="s1">TestCC</span><span class="s2">(</span><span class="s1">BasePYCCTest</span><span class="s2">):</span>

    <span class="s0">def </span><span class="s1">setUp</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">super</span><span class="s2">(</span><span class="s1">TestCC</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">setUp</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">skip_if_no_external_compiler</span><span class="s2">() </span><span class="s5"># external compiler needed</span>
        <span class="s0">from </span><span class="s1">numba</span><span class="s2">.</span><span class="s1">tests </span><span class="s0">import </span><span class="s1">compile_with_pycc</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_module </span><span class="s2">= </span><span class="s1">compile_with_pycc</span>
        <span class="s1">importlib</span><span class="s2">.</span><span class="s1">reload</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_test_module</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">contextlib</span><span class="s2">.</span><span class="s1">contextmanager</span>
    <span class="s0">def </span><span class="s1">check_cc_compiled</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">cc</span><span class="s2">):</span>
        <span class="s5">#cc.verbose = True</span>
        <span class="s1">cc</span><span class="s2">.</span><span class="s1">output_dir </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">tmpdir</span>
        <span class="s1">cc</span><span class="s2">.</span><span class="s1">compile</span><span class="s2">()</span>

        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">check_c_ext</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">tmpdir</span><span class="s2">, </span><span class="s1">cc</span><span class="s2">.</span><span class="s1">name</span><span class="s2">) </span><span class="s0">as </span><span class="s1">lib</span><span class="s2">:</span>
            <span class="s0">yield </span><span class="s1">lib</span>

    <span class="s0">def </span><span class="s1">check_cc_compiled_in_subprocess</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">lib</span><span class="s2">, </span><span class="s1">code</span><span class="s2">):</span>
        <span class="s1">prolog </span><span class="s2">= </span><span class="s3">&quot;&quot;&quot;if 1: 
            import sys 
            import types 
            # to disable numba package 
            sys.modules['numba'] = types.ModuleType('numba') 
            try: 
                from numba import njit 
            except ImportError: 
                pass 
            else: 
                raise RuntimeError('cannot disable numba package') 
 
            sys.path.insert(0, %(path)r) 
            import %(name)s as lib 
            &quot;&quot;&quot; </span><span class="s2">% {</span><span class="s3">'name'</span><span class="s2">: </span><span class="s1">lib</span><span class="s2">.</span><span class="s1">__name__</span><span class="s2">,</span>
                   <span class="s3">'path'</span><span class="s2">: </span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">dirname</span><span class="s2">(</span><span class="s1">lib</span><span class="s2">.</span><span class="s1">__file__</span><span class="s2">)}</span>
        <span class="s1">code </span><span class="s2">= </span><span class="s1">prolog</span><span class="s2">.</span><span class="s1">strip</span><span class="s2">(</span><span class="s3">' '</span><span class="s2">) + </span><span class="s1">code</span>
        <span class="s1">subprocess</span><span class="s2">.</span><span class="s1">check_call</span><span class="s2">([</span><span class="s1">sys</span><span class="s2">.</span><span class="s1">executable</span><span class="s2">, </span><span class="s3">'-c'</span><span class="s2">, </span><span class="s1">code</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">test_cc_properties</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">cc </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_test_module</span><span class="s2">.</span><span class="s1">cc</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">cc</span><span class="s2">.</span><span class="s1">name</span><span class="s2">, </span><span class="s3">'pycc_test_simple'</span><span class="s2">)</span>

        <span class="s5"># Inferred output directory</span>
        <span class="s1">d </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_test_module</span><span class="s2">.</span><span class="s1">cc</span><span class="s2">.</span><span class="s1">output_dir</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">isdir</span><span class="s2">(</span><span class="s1">d</span><span class="s2">), </span><span class="s1">d</span><span class="s2">)</span>

        <span class="s5"># Inferred output filename</span>
        <span class="s1">f </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_test_module</span><span class="s2">.</span><span class="s1">cc</span><span class="s2">.</span><span class="s1">output_file</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertFalse</span><span class="s2">(</span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">exists</span><span class="s2">(</span><span class="s1">f</span><span class="s2">), </span><span class="s1">f</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">basename</span><span class="s2">(</span><span class="s1">f</span><span class="s2">).</span><span class="s1">startswith</span><span class="s2">(</span><span class="s3">'pycc_test_simple.'</span><span class="s2">), </span><span class="s1">f</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">sys</span><span class="s2">.</span><span class="s1">platform</span><span class="s2">.</span><span class="s1">startswith</span><span class="s2">(</span><span class="s3">'linux'</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">f</span><span class="s2">.</span><span class="s1">endswith</span><span class="s2">(</span><span class="s3">'.so'</span><span class="s2">), </span><span class="s1">f</span><span class="s2">)</span>
            <span class="s5"># This is a local import to avoid deprecation warnings being</span>
            <span class="s5"># generated through the use of the numba.pycc module.</span>
            <span class="s0">from </span><span class="s1">numba</span><span class="s2">.</span><span class="s1">pycc</span><span class="s2">.</span><span class="s1">platform </span><span class="s0">import </span><span class="s1">find_pyext_ending</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s1">find_pyext_ending</span><span class="s2">(), </span><span class="s1">f</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_compile</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">check_cc_compiled</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_test_module</span><span class="s2">.</span><span class="s1">cc</span><span class="s2">) </span><span class="s0">as </span><span class="s1">lib</span><span class="s2">:</span>
            <span class="s1">res </span><span class="s2">= </span><span class="s1">lib</span><span class="s2">.</span><span class="s1">multi</span><span class="s2">(</span><span class="s6">123</span><span class="s2">, </span><span class="s6">321</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s6">123 </span><span class="s2">* </span><span class="s6">321</span><span class="s2">)</span>
            <span class="s1">res </span><span class="s2">= </span><span class="s1">lib</span><span class="s2">.</span><span class="s1">multf</span><span class="s2">(</span><span class="s6">987</span><span class="s2">, </span><span class="s6">321</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s6">987.0 </span><span class="s2">* </span><span class="s6">321.0</span><span class="s2">)</span>
            <span class="s1">res </span><span class="s2">= </span><span class="s1">lib</span><span class="s2">.</span><span class="s1">square</span><span class="s2">(</span><span class="s6">5</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s6">25</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIs</span><span class="s2">(</span><span class="s1">lib</span><span class="s2">.</span><span class="s1">get_none</span><span class="s2">(), </span><span class="s0">None</span><span class="s2">)</span>
            <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">ZeroDivisionError</span><span class="s2">):</span>
                <span class="s1">lib</span><span class="s2">.</span><span class="s1">div</span><span class="s2">(</span><span class="s6">1</span><span class="s2">, </span><span class="s6">0</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">check_compile_for_cpu</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">cpu_name</span><span class="s2">):</span>
        <span class="s1">cc </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_test_module</span><span class="s2">.</span><span class="s1">cc</span>
        <span class="s1">cc</span><span class="s2">.</span><span class="s1">target_cpu </span><span class="s2">= </span><span class="s1">cpu_name</span>

        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">check_cc_compiled</span><span class="s2">(</span><span class="s1">cc</span><span class="s2">) </span><span class="s0">as </span><span class="s1">lib</span><span class="s2">:</span>
            <span class="s1">res </span><span class="s2">= </span><span class="s1">lib</span><span class="s2">.</span><span class="s1">multi</span><span class="s2">(</span><span class="s6">123</span><span class="s2">, </span><span class="s6">321</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s6">123 </span><span class="s2">* </span><span class="s6">321</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">lib</span><span class="s2">.</span><span class="s1">multi</span><span class="s2">.</span><span class="s1">__module__</span><span class="s2">, </span><span class="s3">'pycc_test_simple'</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_compile_for_cpu</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Compiling for the host CPU should always succeed</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_compile_for_cpu</span><span class="s2">(</span><span class="s1">ll</span><span class="s2">.</span><span class="s1">get_host_cpu_name</span><span class="s2">())</span>

    <span class="s0">def </span><span class="s1">test_compile_for_cpu_host</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Compiling for the host CPU should always succeed</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_compile_for_cpu</span><span class="s2">(</span><span class="s3">&quot;host&quot;</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_compile_helperlib</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">check_cc_compiled</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_test_module</span><span class="s2">.</span><span class="s1">cc_helperlib</span><span class="s2">) </span><span class="s0">as </span><span class="s1">lib</span><span class="s2">:</span>
            <span class="s1">res </span><span class="s2">= </span><span class="s1">lib</span><span class="s2">.</span><span class="s1">power</span><span class="s2">(</span><span class="s6">2</span><span class="s2">, </span><span class="s6">7</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s6">128</span><span class="s2">)</span>
            <span class="s0">for </span><span class="s1">val </span><span class="s0">in </span><span class="s2">(-</span><span class="s6">1</span><span class="s2">, -</span><span class="s6">1 </span><span class="s2">+ </span><span class="s6">0j</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">complex128</span><span class="s2">(-</span><span class="s6">1</span><span class="s2">)):</span>
                <span class="s1">res </span><span class="s2">= </span><span class="s1">lib</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s1">val</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s6">1j</span><span class="s2">)</span>
            <span class="s0">for </span><span class="s1">val </span><span class="s0">in </span><span class="s2">(</span><span class="s6">4</span><span class="s2">, </span><span class="s6">4.0</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">(</span><span class="s6">4</span><span class="s2">)):</span>
                <span class="s1">res </span><span class="s2">= </span><span class="s1">lib</span><span class="s2">.</span><span class="s1">np_sqrt</span><span class="s2">(</span><span class="s1">val</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s6">2.0</span><span class="s2">)</span>
            <span class="s1">res </span><span class="s2">= </span><span class="s1">lib</span><span class="s2">.</span><span class="s1">spacing</span><span class="s2">(</span><span class="s6">1.0</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s6">2</span><span class="s2">**-</span><span class="s6">52</span><span class="s2">)</span>
            <span class="s5"># Implicit seeding at startup should guarantee a non-pathological</span>
            <span class="s5"># start state.</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertNotEqual</span><span class="s2">(</span><span class="s1">lib</span><span class="s2">.</span><span class="s1">random</span><span class="s2">(-</span><span class="s6">1</span><span class="s2">), </span><span class="s1">lib</span><span class="s2">.</span><span class="s1">random</span><span class="s2">(-</span><span class="s6">1</span><span class="s2">))</span>
            <span class="s1">res </span><span class="s2">= </span><span class="s1">lib</span><span class="s2">.</span><span class="s1">random</span><span class="s2">(</span><span class="s6">42</span><span class="s2">)</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">RandomState</span><span class="s2">(</span><span class="s6">42</span><span class="s2">).</span><span class="s1">random_sample</span><span class="s2">()</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>
            <span class="s1">res </span><span class="s2">= </span><span class="s1">lib</span><span class="s2">.</span><span class="s1">size</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">([</span><span class="s6">0</span><span class="s2">] * </span><span class="s6">3</span><span class="s2">))</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s6">3</span><span class="s2">)</span>

            <span class="s1">code </span><span class="s2">= </span><span class="s3">&quot;&quot;&quot;if 1: 
                from numpy.testing import assert_equal, assert_allclose 
                res = lib.power(2, 7) 
                assert res == 128 
                res = lib.random(42) 
                assert_allclose(res, %(expected)s) 
                res = lib.spacing(1.0) 
                assert_allclose(res, 2**-52) 
                &quot;&quot;&quot; </span><span class="s2">% {</span><span class="s3">'expected'</span><span class="s2">: </span><span class="s1">expected</span><span class="s2">}</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">check_cc_compiled_in_subprocess</span><span class="s2">(</span><span class="s1">lib</span><span class="s2">, </span><span class="s1">code</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_compile_nrt</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">check_cc_compiled</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_test_module</span><span class="s2">.</span><span class="s1">cc_nrt</span><span class="s2">) </span><span class="s0">as </span><span class="s1">lib</span><span class="s2">:</span>
            <span class="s5"># Sanity check</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">lib</span><span class="s2">.</span><span class="s1">zero_scalar</span><span class="s2">(</span><span class="s6">1</span><span class="s2">), </span><span class="s6">0.0</span><span class="s2">)</span>
            <span class="s1">res </span><span class="s2">= </span><span class="s1">lib</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s6">3</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">list</span><span class="s2">(</span><span class="s1">res</span><span class="s2">), [</span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">])</span>
            <span class="s0">if </span><span class="s1">has_blas</span><span class="s2">:</span>
                <span class="s1">res </span><span class="s2">= </span><span class="s1">lib</span><span class="s2">.</span><span class="s1">vector_dot</span><span class="s2">(</span><span class="s6">4</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s6">30.0</span><span class="s2">)</span>
            <span class="s5"># test argsort</span>
            <span class="s1">val </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">([</span><span class="s6">2.</span><span class="s2">, </span><span class="s6">5.</span><span class="s2">, </span><span class="s6">1.</span><span class="s2">, </span><span class="s6">3.</span><span class="s2">, </span><span class="s6">4.</span><span class="s2">])</span>
            <span class="s1">res </span><span class="s2">= </span><span class="s1">lib</span><span class="s2">.</span><span class="s1">np_argsort</span><span class="s2">(</span><span class="s1">val</span><span class="s2">)</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">argsort</span><span class="s2">(</span><span class="s1">val</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

            <span class="s1">code </span><span class="s2">= </span><span class="s3">&quot;&quot;&quot;if 1: 
                from numpy.testing import assert_equal 
                from numpy import float64, argsort 
                res = lib.zero_scalar(1) 
                assert res == 0.0 
                res = lib.zeros(3) 
                assert list(res) == [0, 0, 0] 
                if %(has_blas)s: 
                    res = lib.vector_dot(4) 
                    assert res == 30.0 
                val = float64([2., 5., 1., 3., 4.]) 
                res = lib.np_argsort(val) 
                expected = argsort(val) 
                assert_equal(res, expected) 
                &quot;&quot;&quot; </span><span class="s2">% </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">has_blas</span><span class="s2">=</span><span class="s1">has_blas</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">check_cc_compiled_in_subprocess</span><span class="s2">(</span><span class="s1">lib</span><span class="s2">, </span><span class="s1">code</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_hashing</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">check_cc_compiled</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_test_module</span><span class="s2">.</span><span class="s1">cc_nrt</span><span class="s2">) </span><span class="s0">as </span><span class="s1">lib</span><span class="s2">:</span>
            <span class="s1">res </span><span class="s2">= </span><span class="s1">lib</span><span class="s2">.</span><span class="s1">hash_literal_str_A</span><span class="s2">()</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">hash</span><span class="s2">(</span><span class="s3">&quot;A&quot;</span><span class="s2">))</span>
            <span class="s1">res </span><span class="s2">= </span><span class="s1">lib</span><span class="s2">.</span><span class="s1">hash_str</span><span class="s2">(</span><span class="s3">&quot;A&quot;</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">hash</span><span class="s2">(</span><span class="s3">&quot;A&quot;</span><span class="s2">))</span>

            <span class="s1">code </span><span class="s2">= </span><span class="s3">&quot;&quot;&quot;if 1: 
                from numpy.testing import assert_equal 
                res = lib.hash_literal_str_A() 
                assert_equal(res, hash(&quot;A&quot;)) 
                res = lib.hash_str(&quot;A&quot;) 
                assert_equal(res, hash(&quot;A&quot;)) 
                &quot;&quot;&quot;</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">check_cc_compiled_in_subprocess</span><span class="s2">(</span><span class="s1">lib</span><span class="s2">, </span><span class="s1">code</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_c_extension_usecase</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Test C-extensions</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">check_cc_compiled</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_test_module</span><span class="s2">.</span><span class="s1">cc_nrt</span><span class="s2">) </span><span class="s0">as </span><span class="s1">lib</span><span class="s2">:</span>
            <span class="s1">arr </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s6">128</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">intp</span><span class="s2">)</span>
            <span class="s1">got </span><span class="s2">= </span><span class="s1">lib</span><span class="s2">.</span><span class="s1">dict_usecase</span><span class="s2">(</span><span class="s1">arr</span><span class="s2">)</span>
            <span class="s1">expect </span><span class="s2">= </span><span class="s1">arr </span><span class="s2">* </span><span class="s1">arr</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">got</span><span class="s2">, </span><span class="s1">expect</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">needs_setuptools</span>
<span class="s0">class </span><span class="s1">TestDistutilsSupport</span><span class="s2">(</span><span class="s1">TestCase</span><span class="s2">):</span>

    <span class="s0">def </span><span class="s1">setUp</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">super</span><span class="s2">().</span><span class="s1">setUp</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">skip_if_no_external_compiler</span><span class="s2">() </span><span class="s5"># external compiler needed</span>

        <span class="s1">unset_macosx_deployment_target</span><span class="s2">()</span>

        <span class="s5"># Copy the test project into a temp directory to avoid</span>
        <span class="s5"># keeping any build leftovers in the source tree</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">tmpdir </span><span class="s2">= </span><span class="s1">temp_directory</span><span class="s2">(</span><span class="s3">'test_pycc_distutils'</span><span class="s2">)</span>
        <span class="s1">source_dir </span><span class="s2">= </span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">base_path</span><span class="s2">, </span><span class="s3">'pycc_distutils_usecase'</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">usecase_dir </span><span class="s2">= </span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">tmpdir</span><span class="s2">, </span><span class="s3">'work'</span><span class="s2">)</span>
        <span class="s1">shutil</span><span class="s2">.</span><span class="s1">copytree</span><span class="s2">(</span><span class="s1">source_dir</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">usecase_dir</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">check_setup_py</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">setup_py_file</span><span class="s2">):</span>
        <span class="s5"># Compute PYTHONPATH to ensure the child processes see this Numba</span>
        <span class="s0">import </span><span class="s1">numba</span>
        <span class="s1">numba_path </span><span class="s2">= </span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">abspath</span><span class="s2">(</span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">dirname</span><span class="s2">(</span>
                                     <span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">dirname</span><span class="s2">(</span><span class="s1">numba</span><span class="s2">.</span><span class="s1">__file__</span><span class="s2">)))</span>
        <span class="s1">env </span><span class="s2">= </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">os</span><span class="s2">.</span><span class="s1">environ</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">env</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s3">'PYTHONPATH'</span><span class="s2">, </span><span class="s3">''</span><span class="s2">):</span>
            <span class="s1">env</span><span class="s2">[</span><span class="s3">'PYTHONPATH'</span><span class="s2">] = </span><span class="s1">numba_path </span><span class="s2">+ </span><span class="s1">os</span><span class="s2">.</span><span class="s1">pathsep </span><span class="s2">+ </span><span class="s1">env</span><span class="s2">[</span><span class="s3">'PYTHONPATH'</span><span class="s2">]</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">env</span><span class="s2">[</span><span class="s3">'PYTHONPATH'</span><span class="s2">] = </span><span class="s1">numba_path</span>

        <span class="s0">def </span><span class="s1">run_python</span><span class="s2">(</span><span class="s1">args</span><span class="s2">):</span>
            <span class="s1">p </span><span class="s2">= </span><span class="s1">subprocess</span><span class="s2">.</span><span class="s1">Popen</span><span class="s2">([</span><span class="s1">sys</span><span class="s2">.</span><span class="s1">executable</span><span class="s2">] + </span><span class="s1">args</span><span class="s2">,</span>
                                 <span class="s1">cwd</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">usecase_dir</span><span class="s2">,</span>
                                 <span class="s1">stdout</span><span class="s2">=</span><span class="s1">subprocess</span><span class="s2">.</span><span class="s1">PIPE</span><span class="s2">,</span>
                                 <span class="s1">stderr</span><span class="s2">=</span><span class="s1">subprocess</span><span class="s2">.</span><span class="s1">STDOUT</span><span class="s2">,</span>
                                 <span class="s1">env</span><span class="s2">=</span><span class="s1">env</span><span class="s2">)</span>
            <span class="s1">out</span><span class="s2">, </span><span class="s1">_ </span><span class="s2">= </span><span class="s1">p</span><span class="s2">.</span><span class="s1">communicate</span><span class="s2">()</span>
            <span class="s1">rc </span><span class="s2">= </span><span class="s1">p</span><span class="s2">.</span><span class="s1">wait</span><span class="s2">()</span>
            <span class="s0">if </span><span class="s1">rc </span><span class="s2">!= </span><span class="s6">0</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">fail</span><span class="s2">(</span><span class="s3">&quot;python failed with the following output:</span><span class="s0">\n</span><span class="s3">%s&quot;</span>
                          <span class="s2">% </span><span class="s1">out</span><span class="s2">.</span><span class="s1">decode</span><span class="s2">(</span><span class="s3">'utf-8'</span><span class="s2">, </span><span class="s3">'ignore'</span><span class="s2">))</span>

        <span class="s1">run_python</span><span class="s2">([</span><span class="s1">setup_py_file</span><span class="s2">, </span><span class="s3">&quot;build_ext&quot;</span><span class="s2">, </span><span class="s3">&quot;--inplace&quot;</span><span class="s2">])</span>
        <span class="s1">code </span><span class="s2">= </span><span class="s3">&quot;&quot;&quot;if 1: 
            import pycc_compiled_module as lib 
            assert lib.get_const() == 42 
            res = lib.ones(3) 
            assert list(res) == [1.0, 1.0, 1.0] 
            &quot;&quot;&quot;</span>
        <span class="s1">run_python</span><span class="s2">([</span><span class="s3">&quot;-c&quot;</span><span class="s2">, </span><span class="s1">code</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">check_setup_nested_py</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">setup_py_file</span><span class="s2">):</span>
        <span class="s5"># Compute PYTHONPATH to ensure the child processes see this Numba</span>
        <span class="s0">import </span><span class="s1">numba</span>
        <span class="s1">numba_path </span><span class="s2">= </span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">abspath</span><span class="s2">(</span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">dirname</span><span class="s2">(</span>
                                     <span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">dirname</span><span class="s2">(</span><span class="s1">numba</span><span class="s2">.</span><span class="s1">__file__</span><span class="s2">)))</span>
        <span class="s1">env </span><span class="s2">= </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">os</span><span class="s2">.</span><span class="s1">environ</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">env</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s3">'PYTHONPATH'</span><span class="s2">, </span><span class="s3">''</span><span class="s2">):</span>
            <span class="s1">env</span><span class="s2">[</span><span class="s3">'PYTHONPATH'</span><span class="s2">] = </span><span class="s1">numba_path </span><span class="s2">+ </span><span class="s1">os</span><span class="s2">.</span><span class="s1">pathsep </span><span class="s2">+ </span><span class="s1">env</span><span class="s2">[</span><span class="s3">'PYTHONPATH'</span><span class="s2">]</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">env</span><span class="s2">[</span><span class="s3">'PYTHONPATH'</span><span class="s2">] = </span><span class="s1">numba_path</span>

        <span class="s0">def </span><span class="s1">run_python</span><span class="s2">(</span><span class="s1">args</span><span class="s2">):</span>
            <span class="s1">p </span><span class="s2">= </span><span class="s1">subprocess</span><span class="s2">.</span><span class="s1">Popen</span><span class="s2">([</span><span class="s1">sys</span><span class="s2">.</span><span class="s1">executable</span><span class="s2">] + </span><span class="s1">args</span><span class="s2">,</span>
                                 <span class="s1">cwd</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">usecase_dir</span><span class="s2">,</span>
                                 <span class="s1">stdout</span><span class="s2">=</span><span class="s1">subprocess</span><span class="s2">.</span><span class="s1">PIPE</span><span class="s2">,</span>
                                 <span class="s1">stderr</span><span class="s2">=</span><span class="s1">subprocess</span><span class="s2">.</span><span class="s1">STDOUT</span><span class="s2">,</span>
                                 <span class="s1">env</span><span class="s2">=</span><span class="s1">env</span><span class="s2">)</span>
            <span class="s1">out</span><span class="s2">, </span><span class="s1">_ </span><span class="s2">= </span><span class="s1">p</span><span class="s2">.</span><span class="s1">communicate</span><span class="s2">()</span>
            <span class="s1">rc </span><span class="s2">= </span><span class="s1">p</span><span class="s2">.</span><span class="s1">wait</span><span class="s2">()</span>
            <span class="s0">if </span><span class="s1">rc </span><span class="s2">!= </span><span class="s6">0</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">fail</span><span class="s2">(</span><span class="s3">&quot;python failed with the following output:</span><span class="s0">\n</span><span class="s3">%s&quot;</span>
                          <span class="s2">% </span><span class="s1">out</span><span class="s2">.</span><span class="s1">decode</span><span class="s2">(</span><span class="s3">'utf-8'</span><span class="s2">, </span><span class="s3">'ignore'</span><span class="s2">))</span>

        <span class="s1">run_python</span><span class="s2">([</span><span class="s1">setup_py_file</span><span class="s2">, </span><span class="s3">&quot;build_ext&quot;</span><span class="s2">, </span><span class="s3">&quot;--inplace&quot;</span><span class="s2">])</span>
        <span class="s1">code </span><span class="s2">= </span><span class="s3">&quot;&quot;&quot;if 1: 
            import nested.pycc_compiled_module as lib 
            assert lib.get_const() == 42 
            res = lib.ones(3) 
            assert list(res) == [1.0, 1.0, 1.0] 
            &quot;&quot;&quot;</span>
        <span class="s1">run_python</span><span class="s2">([</span><span class="s3">&quot;-c&quot;</span><span class="s2">, </span><span class="s1">code</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">test_setup_py_distutils</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_setup_py</span><span class="s2">(</span><span class="s3">&quot;setup_distutils.py&quot;</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_setup_py_distutils_nested</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_setup_nested_py</span><span class="s2">(</span><span class="s3">&quot;setup_distutils_nested.py&quot;</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_setup_py_setuptools</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_setup_py</span><span class="s2">(</span><span class="s3">&quot;setup_setuptools.py&quot;</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_setup_py_setuptools_nested</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_setup_nested_py</span><span class="s2">(</span><span class="s3">&quot;setup_setuptools_nested.py&quot;</span><span class="s2">)</span>


<span class="s0">if </span><span class="s1">__name__ </span><span class="s2">== </span><span class="s3">&quot;__main__&quot;</span><span class="s2">:</span>
    <span class="s1">unittest</span><span class="s2">.</span><span class="s1">main</span><span class="s2">()</span>
</pre>
</body>
</html>