<html>
<head>
<title>settings.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #cf8e6d;}
.s5 { color: #7a7e85;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
settings.py</font>
</center></td></tr></table>
<pre><span class="s0">''' 
Settings 
======== 
 
.. versionadded:: 1.0.7 
 
This module provides a complete and extensible framework for adding a 
Settings interface to your application. By default, the interface uses 
a :class:`SettingsWithSpinner`, which consists of a 
:class:`~kivy.uix.spinner.Spinner` (top) to switch between individual 
settings panels (bottom). See :ref:`differentlayouts` for some 
alternatives. 
 
.. image:: images/settingswithspinner_kivy.jpg 
    :align: center 
 
A :class:`SettingsPanel` represents a group of configurable options. The 
:attr:`SettingsPanel.title` property is used by :class:`Settings` when a panel 
is added: it determines the name of the sidebar button. SettingsPanel controls 
a :class:`~kivy.config.ConfigParser` instance. 
 
The panel can be automatically constructed from a JSON definition file: you 
describe the settings you want and corresponding sections/keys in the 
ConfigParser instance... and you're done! 
 
Settings are also integrated into the :class:`~kivy.app.App` class. Use 
:meth:`Settings.add_kivy_panel` to configure the Kivy core settings in a panel. 
 
 
.. _settings_json: 
 
Create a panel from JSON 
------------------------ 
 
To create a panel from a JSON-file, you need two things: 
 
    * a :class:`~kivy.config.ConfigParser` instance with default values 
    * a JSON file 
 
.. warning:: 
 
    The :class:`kivy.config.ConfigParser` is required. You cannot use the 
    default ConfigParser from Python libraries. 
 
You must create and handle the :class:`~kivy.config.ConfigParser` 
object. SettingsPanel will read the values from the associated 
ConfigParser instance. Make sure you have set default values (using 
:attr:`~kivy.config.ConfigParser.setdefaults`) for all the sections/keys 
in your JSON file! 
 
The JSON file contains structured information to describe the available 
settings. Here is an example:: 
 
    [ 
        { 
            &quot;type&quot;: &quot;title&quot;, 
            &quot;title&quot;: &quot;Windows&quot; 
        }, 
        { 
            &quot;type&quot;: &quot;bool&quot;, 
            &quot;title&quot;: &quot;Fullscreen&quot;, 
            &quot;desc&quot;: &quot;Set the window in windowed or fullscreen&quot;, 
            &quot;section&quot;: &quot;graphics&quot;, 
            &quot;key&quot;: &quot;fullscreen&quot; 
        } 
    ] 
 
Each element in the root list represents a setting that the user can 
configure. Only the &quot;type&quot; key is mandatory: an instance of the associated 
class will be created and used for the setting - other keys are assigned to 
corresponding properties of that class. 
 
    ============== ================================================= 
    Type           Associated class 
    -------------- ------------------------------------------------- 
    title          :class:`SettingTitle` 
    bool           :class:`SettingBoolean` 
    numeric        :class:`SettingNumeric` 
    options        :class:`SettingOptions` 
    string         :class:`SettingString` 
    path           :class:`SettingPath` 
    color          :class:`SettingColor` 
    ============== ================================================= 
 
    .. versionadded:: 1.1.0 
        Added :attr:`SettingPath` type 
 
    .. versionadded:: 2.1.0 
        Added :attr:`SettingColor` type 
 
In the JSON example above, the first element is of type &quot;title&quot;. It will create 
a new instance of :class:`SettingTitle` and apply the rest of the key-value 
pairs to the properties of that class, i.e. &quot;title&quot;: &quot;Windows&quot; sets the 
:attr:`~SettingsPanel.title` property of the panel to &quot;Windows&quot;. 
 
To load the JSON example to a :class:`Settings` instance, use the 
:meth:`Settings.add_json_panel` method. It will automatically instantiate a 
:class:`SettingsPanel` and add it to :class:`Settings`:: 
 
    from kivy.config import ConfigParser 
 
    config = ConfigParser() 
    config.read('myconfig.ini') 
 
    s = Settings() 
    s.add_json_panel('My custom panel', config, 'settings_custom.json') 
    s.add_json_panel('Another panel', config, 'settings_test2.json') 
 
    # then use the s as a widget... 
 
 
.. _differentlayouts: 
 
Different panel layouts 
----------------------- 
 
A kivy :class:`~kivy.app.App` can automatically create and display a 
:class:`Settings` instance. See the :attr:`~kivy.app.App.settings_cls` 
documentation for details on how to choose which settings class to 
display. 
 
Several pre-built settings widgets are available. All except 
:class:`SettingsWithNoMenu` include close buttons triggering the 
on_close event. 
 
- :class:`Settings`: Displays settings with a sidebar at the left to 
  switch between json panels. 
 
- :class:`SettingsWithSidebar`: A trivial subclass of 
  :class:`Settings`. 
 
- :class:`SettingsWithSpinner`: Displays settings with a spinner at 
  the top, which can be used to switch between json panels. Uses 
  :class:`InterfaceWithSpinner` as the 
  :attr:`~Settings.interface_cls`. This is the default behavior from 
  Kivy 1.8.0. 
 
- :class:`SettingsWithTabbedPanel`: Displays json panels as individual 
  tabs in a :class:`~kivy.uix.tabbedpanel.TabbedPanel`. Uses 
  :class:`InterfaceWithTabbedPanel` as the :attr:`~Settings.interface_cls`. 
 
- :class:`SettingsWithNoMenu`: Displays a single json panel, with no 
  way to switch to other panels and no close button. This makes it 
  impossible for the user to exit unless 
  :meth:`~kivy.app.App.close_settings` is overridden with a different 
  close trigger! Uses :class:`InterfaceWithNoMenu` as the 
  :attr:`~Settings.interface_cls`. 
 
You can construct your own settings panels with any layout you choose 
by setting :attr:`Settings.interface_cls`. This should be a widget 
that displays a json settings panel with some way to switch between 
panels. An instance will be automatically created by :class:`Settings`. 
 
Interface widgets may be anything you like, but *must* have a method 
add_panel that receives newly created json settings panels for the 
interface to display. See the documentation for 
:class:`InterfaceWithSidebar` for more information. They may 
optionally dispatch an on_close event, for instance if a close button 
is clicked. This event is used by :class:`Settings` to trigger its own 
on_close event. 
 
For a complete, working example, please see 
:file:`kivy/examples/settings/main.py`. 
 
'''</span>

<span class="s1">__all__ </span><span class="s2">= (</span><span class="s3">'Settings'</span><span class="s2">, </span><span class="s3">'SettingsPanel'</span><span class="s2">, </span><span class="s3">'SettingItem'</span><span class="s2">, </span><span class="s3">'SettingString'</span><span class="s2">,</span>
           <span class="s3">'SettingPath'</span><span class="s2">, </span><span class="s3">'SettingBoolean'</span><span class="s2">, </span><span class="s3">'SettingNumeric'</span><span class="s2">, </span><span class="s3">'SettingOptions'</span><span class="s2">,</span>
           <span class="s3">'SettingTitle'</span><span class="s2">, </span><span class="s3">'SettingsWithSidebar'</span><span class="s2">, </span><span class="s3">'SettingsWithSpinner'</span><span class="s2">,</span>
           <span class="s3">'SettingsWithTabbedPanel'</span><span class="s2">, </span><span class="s3">'SettingsWithNoMenu'</span><span class="s2">,</span>
           <span class="s3">'InterfaceWithSidebar'</span><span class="s2">, </span><span class="s3">'ContentPanel'</span><span class="s2">, </span><span class="s3">'MenuSidebar'</span><span class="s2">)</span>

<span class="s4">import </span><span class="s1">json</span>
<span class="s4">import </span><span class="s1">os</span>
<span class="s4">import </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">utils </span><span class="s4">as </span><span class="s1">utils</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">factory </span><span class="s4">import </span><span class="s1">Factory</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">metrics </span><span class="s4">import </span><span class="s1">dp</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">config </span><span class="s4">import </span><span class="s1">ConfigParser</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">animation </span><span class="s4">import </span><span class="s1">Animation</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">compat </span><span class="s4">import </span><span class="s1">string_types</span><span class="s2">, </span><span class="s1">text_type</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">core</span><span class="s2">.</span><span class="s1">window </span><span class="s4">import </span><span class="s1">Window</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">boxlayout </span><span class="s4">import </span><span class="s1">BoxLayout</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">tabbedpanel </span><span class="s4">import </span><span class="s1">TabbedPanelHeader</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">button </span><span class="s4">import </span><span class="s1">Button</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">filechooser </span><span class="s4">import </span><span class="s1">FileChooserListView</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">colorpicker </span><span class="s4">import </span><span class="s1">ColorPicker</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">scrollview </span><span class="s4">import </span><span class="s1">ScrollView</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">floatlayout </span><span class="s4">import </span><span class="s1">FloatLayout</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">gridlayout </span><span class="s4">import </span><span class="s1">GridLayout</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">label </span><span class="s4">import </span><span class="s1">Label</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">popup </span><span class="s4">import </span><span class="s1">Popup</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">textinput </span><span class="s4">import </span><span class="s1">TextInput</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">togglebutton </span><span class="s4">import </span><span class="s1">ToggleButton</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">widget </span><span class="s4">import </span><span class="s1">Widget</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">properties </span><span class="s4">import </span><span class="s1">ObjectProperty</span><span class="s2">, </span><span class="s1">StringProperty</span><span class="s2">, </span><span class="s1">ListProperty</span><span class="s2">, </span><span class="s1">\</span>
    <span class="s1">BooleanProperty</span><span class="s2">, </span><span class="s1">NumericProperty</span><span class="s2">, </span><span class="s1">DictProperty</span>


<span class="s4">class </span><span class="s1">SettingSpacer</span><span class="s2">(</span><span class="s1">Widget</span><span class="s2">):</span>
    <span class="s5"># Internal class, not documented.</span>
    <span class="s4">pass</span>


<span class="s4">class </span><span class="s1">SettingItem</span><span class="s2">(</span><span class="s1">FloatLayout</span><span class="s2">):</span>
    <span class="s0">'''Base class for individual settings (within a panel). This class cannot 
    be used directly; it is used for implementing the other setting classes. 
    It builds a row with a title/description (left) and a setting control 
    (right). 
 
    Look at :class:`SettingBoolean`, :class:`SettingNumeric` and 
    :class:`SettingOptions` for usage examples. 
 
    :Events: 
        `on_release` 
            Fired when the item is touched and then released. 
 
    '''</span>

    <span class="s1">title </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span><span class="s3">'&lt;No title set&gt;'</span><span class="s2">)</span>
    <span class="s3">'''Title of the setting, defaults to '&lt;No title set&gt;'. 
 
    :attr:`title` is a :class:`~kivy.properties.StringProperty` and defaults 
    to '&lt;No title set&gt;'. 
    '''</span>

    <span class="s1">desc </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">, </span><span class="s1">allownone</span><span class="s2">=</span><span class="s4">True</span><span class="s2">)</span>
    <span class="s3">'''Description of the setting, rendered on the line below the title. 
 
    :attr:`desc` is a :class:`~kivy.properties.StringProperty` and defaults to 
    None. 
    '''</span>

    <span class="s1">disabled </span><span class="s2">= </span><span class="s1">BooleanProperty</span><span class="s2">(</span><span class="s4">False</span><span class="s2">)</span>
    <span class="s3">'''Indicate if this setting is disabled. If True, all touches on the 
    setting item will be discarded. 
 
    :attr:`disabled` is a :class:`~kivy.properties.BooleanProperty` and 
    defaults to False. 
    '''</span>

    <span class="s1">section </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">)</span>
    <span class="s3">'''Section of the token inside the :class:`~kivy.config.ConfigParser` 
    instance. 
 
    :attr:`section` is a :class:`~kivy.properties.StringProperty` and defaults 
    to None. 
    '''</span>

    <span class="s1">key </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">)</span>
    <span class="s3">'''Key of the token inside the :attr:`section` in the 
    :class:`~kivy.config.ConfigParser` instance. 
 
    :attr:`key` is a :class:`~kivy.properties.StringProperty` and defaults to 
    None. 
    '''</span>

    <span class="s1">value </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">)</span>
    <span class="s3">'''Value of the token according to the :class:`~kivy.config.ConfigParser` 
    instance. Any change to this value will trigger a 
    :meth:`Settings.on_config_change` event. 
 
    :attr:`value` is an :class:`~kivy.properties.ObjectProperty` and defaults 
    to None. 
    '''</span>

    <span class="s1">panel </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">)</span>
    <span class="s3">'''(internal) Reference to the SettingsPanel for this setting. You don't 
    need to use it. 
 
    :attr:`panel` is an :class:`~kivy.properties.ObjectProperty` and defaults 
    to None. 
    '''</span>

    <span class="s1">content </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">)</span>
    <span class="s3">'''(internal) Reference to the widget that contains the real setting. 
    As soon as the content object is set, any further call to add_widget will 
    call the content.add_widget. This is automatically set. 
 
    :attr:`content` is an :class:`~kivy.properties.ObjectProperty` and 
    defaults to None. 
    '''</span>

    <span class="s1">selected_alpha </span><span class="s2">= </span><span class="s1">NumericProperty</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
    <span class="s3">'''(internal) Float value from 0 to 1, used to animate the background when 
    the user touches the item. 
 
    :attr:`selected_alpha` is a :class:`~kivy.properties.NumericProperty` and 
    defaults to 0. 
    '''</span>

    <span class="s1">__events__ </span><span class="s2">= (</span><span class="s3">'on_release'</span><span class="s2">, )</span>

    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s1">super</span><span class="s2">(</span><span class="s1">SettingItem</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">__init__</span><span class="s2">(**</span><span class="s1">kwargs</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">value </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">panel</span><span class="s2">.</span><span class="s1">get_value</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">section</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">key</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">content </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s4">return </span><span class="s1">super</span><span class="s2">(</span><span class="s1">SettingItem</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">add_widget</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>
        <span class="s4">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">content</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">on_touch_down</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">touch</span><span class="s2">):</span>
        <span class="s4">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">collide_point</span><span class="s2">(*</span><span class="s1">touch</span><span class="s2">.</span><span class="s1">pos</span><span class="s2">):</span>
            <span class="s4">return</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">disabled</span><span class="s2">:</span>
            <span class="s4">return</span>
        <span class="s1">touch</span><span class="s2">.</span><span class="s1">grab</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">selected_alpha </span><span class="s2">= </span><span class="s6">1</span>
        <span class="s4">return </span><span class="s1">super</span><span class="s2">(</span><span class="s1">SettingItem</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">on_touch_down</span><span class="s2">(</span><span class="s1">touch</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">on_touch_up</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">touch</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">touch</span><span class="s2">.</span><span class="s1">grab_current </span><span class="s4">is </span><span class="s1">self</span><span class="s2">:</span>
            <span class="s1">touch</span><span class="s2">.</span><span class="s1">ungrab</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">dispatch</span><span class="s2">(</span><span class="s3">'on_release'</span><span class="s2">)</span>
            <span class="s1">Animation</span><span class="s2">(</span><span class="s1">selected_alpha</span><span class="s2">=</span><span class="s6">0</span><span class="s2">, </span><span class="s1">d</span><span class="s2">=</span><span class="s6">.25</span><span class="s2">, </span><span class="s1">t</span><span class="s2">=</span><span class="s3">'out_quad'</span><span class="s2">).</span><span class="s1">start</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>
            <span class="s4">return True</span>
        <span class="s4">return </span><span class="s1">super</span><span class="s2">(</span><span class="s1">SettingItem</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">on_touch_up</span><span class="s2">(</span><span class="s1">touch</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">on_release</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">pass</span>

    <span class="s4">def </span><span class="s1">on_value</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s4">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">section </span><span class="s4">or not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">key</span><span class="s2">:</span>
            <span class="s4">return</span>
        <span class="s5"># get current value in config</span>
        <span class="s1">panel </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">panel</span>
        <span class="s4">if not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">string_types</span><span class="s2">):</span>
            <span class="s1">value </span><span class="s2">= </span><span class="s1">str</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>
        <span class="s1">panel</span><span class="s2">.</span><span class="s1">set_value</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">section</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">key</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>


<span class="s4">class </span><span class="s1">SettingBoolean</span><span class="s2">(</span><span class="s1">SettingItem</span><span class="s2">):</span>
    <span class="s0">'''Implementation of a boolean setting on top of a :class:`SettingItem`. 
    It is visualized with a :class:`~kivy.uix.switch.Switch` widget. 
    By default, 0 and 1 are used for values: you can change them by setting 
    :attr:`values`. 
    '''</span>

    <span class="s1">values </span><span class="s2">= </span><span class="s1">ListProperty</span><span class="s2">([</span><span class="s3">'0'</span><span class="s2">, </span><span class="s3">'1'</span><span class="s2">])</span>
    <span class="s3">'''Values used to represent the state of the setting. If you want to use 
    &quot;yes&quot; and &quot;no&quot; in your ConfigParser instance:: 
 
        SettingBoolean(..., values=['no', 'yes']) 
 
    .. warning:: 
 
        You need a minimum of two values, the index 0 will be used as False, 
        and index 1 as True 
 
    :attr:`values` is a :class:`~kivy.properties.ListProperty` and defaults to 
    ['0', '1'] 
    '''</span>


<span class="s4">class </span><span class="s1">SettingString</span><span class="s2">(</span><span class="s1">SettingItem</span><span class="s2">):</span>
    <span class="s0">'''Implementation of a string setting on top of a :class:`SettingItem`. 
    It is visualized with a :class:`~kivy.uix.label.Label` widget that, when 
    clicked, will open a :class:`~kivy.uix.popup.Popup` with a 
    :class:`~kivy.uix.textinput.Textinput` so the user can enter a custom 
    value. 
    '''</span>

    <span class="s1">popup </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">, </span><span class="s1">allownone</span><span class="s2">=</span><span class="s4">True</span><span class="s2">)</span>
    <span class="s3">'''(internal) Used to store the current popup when it's shown. 
 
    :attr:`popup` is an :class:`~kivy.properties.ObjectProperty` and defaults 
    to None. 
    '''</span>

    <span class="s1">textinput </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">)</span>
    <span class="s3">'''(internal) Used to store the current textinput from the popup and 
    to listen for changes. 
 
    :attr:`textinput` is an :class:`~kivy.properties.ObjectProperty` and 
    defaults to None. 
    '''</span>

    <span class="s4">def </span><span class="s1">on_panel</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">value </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s4">return</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">fbind</span><span class="s2">(</span><span class="s3">'on_release'</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_create_popup</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">_dismiss</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">largs</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">textinput</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">textinput</span><span class="s2">.</span><span class="s1">focus </span><span class="s2">= </span><span class="s4">False</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">popup</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">popup</span><span class="s2">.</span><span class="s1">dismiss</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">popup </span><span class="s2">= </span><span class="s4">None</span>

    <span class="s4">def </span><span class="s1">_validate</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_dismiss</span><span class="s2">()</span>
        <span class="s1">value </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">textinput</span><span class="s2">.</span><span class="s1">text</span><span class="s2">.</span><span class="s1">strip</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">value </span><span class="s2">= </span><span class="s1">value</span>

    <span class="s4">def </span><span class="s1">_create_popup</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">):</span>
        <span class="s5"># create popup layout</span>
        <span class="s1">content </span><span class="s2">= </span><span class="s1">BoxLayout</span><span class="s2">(</span><span class="s1">orientation</span><span class="s2">=</span><span class="s3">'vertical'</span><span class="s2">, </span><span class="s1">spacing</span><span class="s2">=</span><span class="s3">'5dp'</span><span class="s2">)</span>
        <span class="s1">popup_width </span><span class="s2">= </span><span class="s1">min</span><span class="s2">(</span><span class="s6">0.95 </span><span class="s2">* </span><span class="s1">Window</span><span class="s2">.</span><span class="s1">width</span><span class="s2">, </span><span class="s1">dp</span><span class="s2">(</span><span class="s6">500</span><span class="s2">))</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">popup </span><span class="s2">= </span><span class="s1">popup </span><span class="s2">= </span><span class="s1">Popup</span><span class="s2">(</span>
            <span class="s1">title</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">title</span><span class="s2">, </span><span class="s1">content</span><span class="s2">=</span><span class="s1">content</span><span class="s2">, </span><span class="s1">size_hint</span><span class="s2">=(</span><span class="s4">None</span><span class="s2">, </span><span class="s4">None</span><span class="s2">),</span>
            <span class="s1">size</span><span class="s2">=(</span><span class="s1">popup_width</span><span class="s2">, </span><span class="s3">'250dp'</span><span class="s2">))</span>

        <span class="s5"># create the textinput used for numeric input</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">textinput </span><span class="s2">= </span><span class="s1">textinput </span><span class="s2">= </span><span class="s1">TextInput</span><span class="s2">(</span>
            <span class="s1">text</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">value</span><span class="s2">, </span><span class="s1">font_size</span><span class="s2">=</span><span class="s3">'24sp'</span><span class="s2">, </span><span class="s1">multiline</span><span class="s2">=</span><span class="s4">False</span><span class="s2">,</span>
            <span class="s1">size_hint_y</span><span class="s2">=</span><span class="s4">None</span><span class="s2">, </span><span class="s1">height</span><span class="s2">=</span><span class="s3">'42sp'</span><span class="s2">)</span>
        <span class="s1">textinput</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">on_text_validate</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_validate</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">textinput </span><span class="s2">= </span><span class="s1">textinput</span>

        <span class="s5"># construct the content, widget are used as a spacer</span>
        <span class="s1">content</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">Widget</span><span class="s2">())</span>
        <span class="s1">content</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">textinput</span><span class="s2">)</span>
        <span class="s1">content</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">Widget</span><span class="s2">())</span>
        <span class="s1">content</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">SettingSpacer</span><span class="s2">())</span>

        <span class="s5"># 2 buttons are created for accept or cancel the current value</span>
        <span class="s1">btnlayout </span><span class="s2">= </span><span class="s1">BoxLayout</span><span class="s2">(</span><span class="s1">size_hint_y</span><span class="s2">=</span><span class="s4">None</span><span class="s2">, </span><span class="s1">height</span><span class="s2">=</span><span class="s3">'50dp'</span><span class="s2">, </span><span class="s1">spacing</span><span class="s2">=</span><span class="s3">'5dp'</span><span class="s2">)</span>
        <span class="s1">btn </span><span class="s2">= </span><span class="s1">Button</span><span class="s2">(</span><span class="s1">text</span><span class="s2">=</span><span class="s3">'Ok'</span><span class="s2">)</span>
        <span class="s1">btn</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">on_release</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_validate</span><span class="s2">)</span>
        <span class="s1">btnlayout</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">btn</span><span class="s2">)</span>
        <span class="s1">btn </span><span class="s2">= </span><span class="s1">Button</span><span class="s2">(</span><span class="s1">text</span><span class="s2">=</span><span class="s3">'Cancel'</span><span class="s2">)</span>
        <span class="s1">btn</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">on_release</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_dismiss</span><span class="s2">)</span>
        <span class="s1">btnlayout</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">btn</span><span class="s2">)</span>
        <span class="s1">content</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">btnlayout</span><span class="s2">)</span>

        <span class="s5"># all done, open the popup !</span>
        <span class="s1">popup</span><span class="s2">.</span><span class="s1">open</span><span class="s2">()</span>


<span class="s4">class </span><span class="s1">SettingPath</span><span class="s2">(</span><span class="s1">SettingItem</span><span class="s2">):</span>
    <span class="s0">'''Implementation of a Path setting on top of a :class:`SettingItem`. 
    It is visualized with a :class:`~kivy.uix.label.Label` widget that, when 
    clicked, will open a :class:`~kivy.uix.popup.Popup` with a 
    :class:`~kivy.uix.filechooser.FileChooserListView` so the user can enter 
    a custom value. 
 
    .. versionadded:: 1.1.0 
    '''</span>

    <span class="s1">popup </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">, </span><span class="s1">allownone</span><span class="s2">=</span><span class="s4">True</span><span class="s2">)</span>
    <span class="s3">'''(internal) Used to store the current popup when it is shown. 
 
    :attr:`popup` is an :class:`~kivy.properties.ObjectProperty` and defaults 
    to None. 
    '''</span>

    <span class="s1">textinput </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">)</span>
    <span class="s3">'''(internal) Used to store the current textinput from the popup and 
    to listen for changes. 
 
    :attr:`textinput` is an :class:`~kivy.properties.ObjectProperty` and 
    defaults to None. 
    '''</span>

    <span class="s1">show_hidden </span><span class="s2">= </span><span class="s1">BooleanProperty</span><span class="s2">(</span><span class="s4">False</span><span class="s2">)</span>
    <span class="s3">'''Whether to show 'hidden' filenames. What that means is 
    operating-system-dependent. 
 
    :attr:`show_hidden` is an :class:`~kivy.properties.BooleanProperty` and 
    defaults to False. 
 
    .. versionadded:: 1.10.0 
    '''</span>

    <span class="s1">dirselect </span><span class="s2">= </span><span class="s1">BooleanProperty</span><span class="s2">(</span><span class="s4">True</span><span class="s2">)</span>
    <span class="s3">'''Whether to allow selection of directories. 
 
    :attr:`dirselect` is a :class:`~kivy.properties.BooleanProperty` and 
    defaults to True. 
 
    .. versionadded:: 1.10.0 
    '''</span>

    <span class="s4">def </span><span class="s1">on_panel</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">value </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s4">return</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">fbind</span><span class="s2">(</span><span class="s3">'on_release'</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_create_popup</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">_dismiss</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">largs</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">textinput</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">textinput</span><span class="s2">.</span><span class="s1">focus </span><span class="s2">= </span><span class="s4">False</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">popup</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">popup</span><span class="s2">.</span><span class="s1">dismiss</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">popup </span><span class="s2">= </span><span class="s4">None</span>

    <span class="s4">def </span><span class="s1">_validate</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_dismiss</span><span class="s2">()</span>
        <span class="s1">value </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">textinput</span><span class="s2">.</span><span class="s1">selection</span>

        <span class="s4">if not </span><span class="s1">value</span><span class="s2">:</span>
            <span class="s4">return</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">value </span><span class="s2">= </span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">realpath</span><span class="s2">(</span><span class="s1">value</span><span class="s2">[</span><span class="s6">0</span><span class="s2">])</span>

    <span class="s4">def </span><span class="s1">_create_popup</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">):</span>
        <span class="s5"># create popup layout</span>
        <span class="s1">content </span><span class="s2">= </span><span class="s1">BoxLayout</span><span class="s2">(</span><span class="s1">orientation</span><span class="s2">=</span><span class="s3">'vertical'</span><span class="s2">, </span><span class="s1">spacing</span><span class="s2">=</span><span class="s6">5</span><span class="s2">)</span>
        <span class="s1">popup_width </span><span class="s2">= </span><span class="s1">min</span><span class="s2">(</span><span class="s6">0.95 </span><span class="s2">* </span><span class="s1">Window</span><span class="s2">.</span><span class="s1">width</span><span class="s2">, </span><span class="s1">dp</span><span class="s2">(</span><span class="s6">500</span><span class="s2">))</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">popup </span><span class="s2">= </span><span class="s1">popup </span><span class="s2">= </span><span class="s1">Popup</span><span class="s2">(</span>
            <span class="s1">title</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">title</span><span class="s2">, </span><span class="s1">content</span><span class="s2">=</span><span class="s1">content</span><span class="s2">, </span><span class="s1">size_hint</span><span class="s2">=(</span><span class="s4">None</span><span class="s2">, </span><span class="s6">0.9</span><span class="s2">),</span>
            <span class="s1">width</span><span class="s2">=</span><span class="s1">popup_width</span><span class="s2">)</span>

        <span class="s5"># create the filechooser</span>
        <span class="s1">initial_path </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">value </span><span class="s4">or </span><span class="s1">os</span><span class="s2">.</span><span class="s1">getcwd</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">textinput </span><span class="s2">= </span><span class="s1">textinput </span><span class="s2">= </span><span class="s1">FileChooserListView</span><span class="s2">(</span>
            <span class="s1">path</span><span class="s2">=</span><span class="s1">initial_path</span><span class="s2">, </span><span class="s1">size_hint</span><span class="s2">=(</span><span class="s6">1</span><span class="s2">, </span><span class="s6">1</span><span class="s2">),</span>
            <span class="s1">dirselect</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dirselect</span><span class="s2">, </span><span class="s1">show_hidden</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">show_hidden</span><span class="s2">)</span>
        <span class="s1">textinput</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">on_path</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_validate</span><span class="s2">)</span>

        <span class="s5"># construct the content</span>
        <span class="s1">content</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">textinput</span><span class="s2">)</span>
        <span class="s1">content</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">SettingSpacer</span><span class="s2">())</span>

        <span class="s5"># 2 buttons are created for accept or cancel the current value</span>
        <span class="s1">btnlayout </span><span class="s2">= </span><span class="s1">BoxLayout</span><span class="s2">(</span><span class="s1">size_hint_y</span><span class="s2">=</span><span class="s4">None</span><span class="s2">, </span><span class="s1">height</span><span class="s2">=</span><span class="s3">'50dp'</span><span class="s2">, </span><span class="s1">spacing</span><span class="s2">=</span><span class="s3">'5dp'</span><span class="s2">)</span>
        <span class="s1">btn </span><span class="s2">= </span><span class="s1">Button</span><span class="s2">(</span><span class="s1">text</span><span class="s2">=</span><span class="s3">'Ok'</span><span class="s2">)</span>
        <span class="s1">btn</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">on_release</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_validate</span><span class="s2">)</span>
        <span class="s1">btnlayout</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">btn</span><span class="s2">)</span>
        <span class="s1">btn </span><span class="s2">= </span><span class="s1">Button</span><span class="s2">(</span><span class="s1">text</span><span class="s2">=</span><span class="s3">'Cancel'</span><span class="s2">)</span>
        <span class="s1">btn</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">on_release</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_dismiss</span><span class="s2">)</span>
        <span class="s1">btnlayout</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">btn</span><span class="s2">)</span>
        <span class="s1">content</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">btnlayout</span><span class="s2">)</span>

        <span class="s5"># all done, open the popup !</span>
        <span class="s1">popup</span><span class="s2">.</span><span class="s1">open</span><span class="s2">()</span>


<span class="s4">class </span><span class="s1">SettingColor</span><span class="s2">(</span><span class="s1">SettingItem</span><span class="s2">):</span>
    <span class="s0">'''Implementation of a color setting on top of a :class:`SettingItem`. 
    It is visualized with a :class:`~kivy.uix.label.Label` widget and a 
    colored canvas rectangle that, when clicked, will open a 
    :class:`~kivy.uix.popup.Popup` with a 
    :class:`~kivy.uix.colorpicker.ColorPicker` so the user can choose a color. 
 
    .. versionadded:: 2.0.1 
    '''</span>

    <span class="s1">popup </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">, </span><span class="s1">allownone</span><span class="s2">=</span><span class="s4">True</span><span class="s2">)</span>
    <span class="s3">'''(internal) Used to store the current popup when it's shown. 
 
    :attr:`popup` is an :class:`~kivy.properties.ObjectProperty` and defaults 
    to None. 
    '''</span>

    <span class="s4">def </span><span class="s1">on_panel</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">value </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s4">return</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">on_release</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_create_popup</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">_dismiss</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">largs</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">popup</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">popup</span><span class="s2">.</span><span class="s1">dismiss</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">popup </span><span class="s2">= </span><span class="s4">None</span>

    <span class="s4">def </span><span class="s1">_validate</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_dismiss</span><span class="s2">()</span>
        <span class="s1">value </span><span class="s2">= </span><span class="s1">utils</span><span class="s2">.</span><span class="s1">get_hex_from_color</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">colorpicker</span><span class="s2">.</span><span class="s1">color</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">value </span><span class="s2">= </span><span class="s1">value</span>

    <span class="s4">def </span><span class="s1">_create_popup</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">):</span>
        <span class="s5"># create popup layout</span>
        <span class="s1">content </span><span class="s2">= </span><span class="s1">BoxLayout</span><span class="s2">(</span><span class="s1">orientation</span><span class="s2">=</span><span class="s3">'vertical'</span><span class="s2">, </span><span class="s1">spacing</span><span class="s2">=</span><span class="s3">'5dp'</span><span class="s2">)</span>
        <span class="s1">popup_width </span><span class="s2">= </span><span class="s1">min</span><span class="s2">(</span><span class="s6">0.95 </span><span class="s2">* </span><span class="s1">Window</span><span class="s2">.</span><span class="s1">width</span><span class="s2">, </span><span class="s1">dp</span><span class="s2">(</span><span class="s6">500</span><span class="s2">))</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">popup </span><span class="s2">= </span><span class="s1">popup </span><span class="s2">= </span><span class="s1">Popup</span><span class="s2">(</span>
            <span class="s1">title</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">title</span><span class="s2">, </span><span class="s1">content</span><span class="s2">=</span><span class="s1">content</span><span class="s2">, </span><span class="s1">size_hint</span><span class="s2">=(</span><span class="s4">None</span><span class="s2">, </span><span class="s6">0.9</span><span class="s2">),</span>
            <span class="s1">width</span><span class="s2">=</span><span class="s1">popup_width</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">colorpicker </span><span class="s2">= </span><span class="s1">colorpicker </span><span class="s2">= </span><span class="s1">\</span>
            <span class="s1">ColorPicker</span><span class="s2">(</span><span class="s1">color</span><span class="s2">=</span><span class="s1">utils</span><span class="s2">.</span><span class="s1">get_color_from_hex</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">value</span><span class="s2">))</span>
        <span class="s1">colorpicker</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">on_color</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_validate</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">colorpicker </span><span class="s2">= </span><span class="s1">colorpicker</span>
        <span class="s1">content</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">colorpicker</span><span class="s2">)</span>
        <span class="s1">content</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">SettingSpacer</span><span class="s2">())</span>

        <span class="s5"># 2 buttons are created for accept or cancel the current value</span>
        <span class="s1">btnlayout </span><span class="s2">= </span><span class="s1">BoxLayout</span><span class="s2">(</span><span class="s1">size_hint_y</span><span class="s2">=</span><span class="s4">None</span><span class="s2">, </span><span class="s1">height</span><span class="s2">=</span><span class="s3">'50dp'</span><span class="s2">, </span><span class="s1">spacing</span><span class="s2">=</span><span class="s3">'5dp'</span><span class="s2">)</span>
        <span class="s1">btn </span><span class="s2">= </span><span class="s1">Button</span><span class="s2">(</span><span class="s1">text</span><span class="s2">=</span><span class="s3">'Ok'</span><span class="s2">)</span>
        <span class="s1">btn</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">on_release</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_validate</span><span class="s2">)</span>
        <span class="s1">btnlayout</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">btn</span><span class="s2">)</span>
        <span class="s1">btn </span><span class="s2">= </span><span class="s1">Button</span><span class="s2">(</span><span class="s1">text</span><span class="s2">=</span><span class="s3">'Cancel'</span><span class="s2">)</span>
        <span class="s1">btn</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">on_release</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_dismiss</span><span class="s2">)</span>
        <span class="s1">btnlayout</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">btn</span><span class="s2">)</span>
        <span class="s1">content</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">btnlayout</span><span class="s2">)</span>

        <span class="s5"># all done, open the popup !</span>
        <span class="s1">popup</span><span class="s2">.</span><span class="s1">open</span><span class="s2">()</span>


<span class="s4">class </span><span class="s1">SettingNumeric</span><span class="s2">(</span><span class="s1">SettingString</span><span class="s2">):</span>
    <span class="s0">'''Implementation of a numeric setting on top of a :class:`SettingString`. 
    It is visualized with a :class:`~kivy.uix.label.Label` widget that, when 
    clicked, will open a :class:`~kivy.uix.popup.Popup` with a 
    :class:`~kivy.uix.textinput.Textinput` so the user can enter a custom 
    value. 
    '''</span>

    <span class="s4">def </span><span class="s1">_validate</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">):</span>
        <span class="s5"># we know the type just by checking if there is a '.' in the original</span>
        <span class="s5"># value</span>
        <span class="s1">is_float </span><span class="s2">= </span><span class="s3">'.' </span><span class="s4">in </span><span class="s1">str</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_dismiss</span><span class="s2">()</span>
        <span class="s4">try</span><span class="s2">:</span>
            <span class="s4">if </span><span class="s1">is_float</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">value </span><span class="s2">= </span><span class="s1">text_type</span><span class="s2">(</span><span class="s1">float</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">textinput</span><span class="s2">.</span><span class="s1">text</span><span class="s2">))</span>
            <span class="s4">else</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">value </span><span class="s2">= </span><span class="s1">text_type</span><span class="s2">(</span><span class="s1">int</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">textinput</span><span class="s2">.</span><span class="s1">text</span><span class="s2">))</span>
        <span class="s4">except </span><span class="s1">ValueError</span><span class="s2">:</span>
            <span class="s4">return</span>


<span class="s4">class </span><span class="s1">SettingOptions</span><span class="s2">(</span><span class="s1">SettingItem</span><span class="s2">):</span>
    <span class="s0">'''Implementation of an option list on top of a :class:`SettingItem`. 
    It is visualized with a :class:`~kivy.uix.label.Label` widget that, when 
    clicked, will open a :class:`~kivy.uix.popup.Popup` with a 
    list of options from which the user can select. 
    '''</span>

    <span class="s1">options </span><span class="s2">= </span><span class="s1">ListProperty</span><span class="s2">([])</span>
    <span class="s3">'''List of all availables options. This must be a list of &quot;string&quot; items. 
    Otherwise, it will crash. :) 
 
    :attr:`options` is a :class:`~kivy.properties.ListProperty` and defaults 
    to []. 
    '''</span>

    <span class="s1">popup </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">, </span><span class="s1">allownone</span><span class="s2">=</span><span class="s4">True</span><span class="s2">)</span>
    <span class="s3">'''(internal) Used to store the current popup when it is shown. 
 
    :attr:`popup` is an :class:`~kivy.properties.ObjectProperty` and defaults 
    to None. 
    '''</span>

    <span class="s4">def </span><span class="s1">on_panel</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">value </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s4">return</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">fbind</span><span class="s2">(</span><span class="s3">'on_release'</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_create_popup</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">_set_option</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">value </span><span class="s2">= </span><span class="s1">instance</span><span class="s2">.</span><span class="s1">text</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">popup</span><span class="s2">.</span><span class="s1">dismiss</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">_create_popup</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">):</span>
        <span class="s5"># create the popup</span>
        <span class="s1">content </span><span class="s2">= </span><span class="s1">BoxLayout</span><span class="s2">(</span><span class="s1">orientation</span><span class="s2">=</span><span class="s3">'vertical'</span><span class="s2">, </span><span class="s1">spacing</span><span class="s2">=</span><span class="s3">'5dp'</span><span class="s2">)</span>
        <span class="s1">popup_width </span><span class="s2">= </span><span class="s1">min</span><span class="s2">(</span><span class="s6">0.95 </span><span class="s2">* </span><span class="s1">Window</span><span class="s2">.</span><span class="s1">width</span><span class="s2">, </span><span class="s1">dp</span><span class="s2">(</span><span class="s6">500</span><span class="s2">))</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">popup </span><span class="s2">= </span><span class="s1">popup </span><span class="s2">= </span><span class="s1">Popup</span><span class="s2">(</span>
            <span class="s1">content</span><span class="s2">=</span><span class="s1">content</span><span class="s2">, </span><span class="s1">title</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">title</span><span class="s2">, </span><span class="s1">size_hint</span><span class="s2">=(</span><span class="s4">None</span><span class="s2">, </span><span class="s4">None</span><span class="s2">),</span>
            <span class="s1">size</span><span class="s2">=(</span><span class="s1">popup_width</span><span class="s2">, </span><span class="s3">'400dp'</span><span class="s2">))</span>
        <span class="s1">popup</span><span class="s2">.</span><span class="s1">height </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">options</span><span class="s2">) * </span><span class="s1">dp</span><span class="s2">(</span><span class="s6">55</span><span class="s2">) + </span><span class="s1">dp</span><span class="s2">(</span><span class="s6">150</span><span class="s2">)</span>

        <span class="s5"># add all the options</span>
        <span class="s1">content</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">Widget</span><span class="s2">(</span><span class="s1">size_hint_y</span><span class="s2">=</span><span class="s4">None</span><span class="s2">, </span><span class="s1">height</span><span class="s2">=</span><span class="s6">1</span><span class="s2">))</span>
        <span class="s1">uid </span><span class="s2">= </span><span class="s1">str</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">uid</span><span class="s2">)</span>
        <span class="s4">for </span><span class="s1">option </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">options</span><span class="s2">:</span>
            <span class="s1">state </span><span class="s2">= </span><span class="s3">'down' </span><span class="s4">if </span><span class="s1">option </span><span class="s2">== </span><span class="s1">self</span><span class="s2">.</span><span class="s1">value </span><span class="s4">else </span><span class="s3">'normal'</span>
            <span class="s1">btn </span><span class="s2">= </span><span class="s1">ToggleButton</span><span class="s2">(</span><span class="s1">text</span><span class="s2">=</span><span class="s1">option</span><span class="s2">, </span><span class="s1">state</span><span class="s2">=</span><span class="s1">state</span><span class="s2">, </span><span class="s1">group</span><span class="s2">=</span><span class="s1">uid</span><span class="s2">)</span>
            <span class="s1">btn</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">on_release</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_set_option</span><span class="s2">)</span>
            <span class="s1">content</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">btn</span><span class="s2">)</span>

        <span class="s5"># finally, add a cancel button to return on the previous panel</span>
        <span class="s1">content</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">SettingSpacer</span><span class="s2">())</span>
        <span class="s1">btn </span><span class="s2">= </span><span class="s1">Button</span><span class="s2">(</span><span class="s1">text</span><span class="s2">=</span><span class="s3">'Cancel'</span><span class="s2">, </span><span class="s1">size_hint_y</span><span class="s2">=</span><span class="s4">None</span><span class="s2">, </span><span class="s1">height</span><span class="s2">=</span><span class="s1">dp</span><span class="s2">(</span><span class="s6">50</span><span class="s2">))</span>
        <span class="s1">btn</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">on_release</span><span class="s2">=</span><span class="s1">popup</span><span class="s2">.</span><span class="s1">dismiss</span><span class="s2">)</span>
        <span class="s1">content</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">btn</span><span class="s2">)</span>

        <span class="s5"># and open the popup !</span>
        <span class="s1">popup</span><span class="s2">.</span><span class="s1">open</span><span class="s2">()</span>


<span class="s4">class </span><span class="s1">SettingTitle</span><span class="s2">(</span><span class="s1">Label</span><span class="s2">):</span>
    <span class="s0">'''A simple title label, used to organize the settings in sections. 
    '''</span>

    <span class="s1">title </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">()</span>

    <span class="s1">panel </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">)</span>


<span class="s4">class </span><span class="s1">SettingsPanel</span><span class="s2">(</span><span class="s1">GridLayout</span><span class="s2">):</span>
    <span class="s0">'''This class is used to construct panel settings, for use with a 
    :class:`Settings` instance or subclass. 
    '''</span>

    <span class="s1">title </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span><span class="s3">'Default title'</span><span class="s2">)</span>
    <span class="s3">'''Title of the panel. The title will be reused by the :class:`Settings` in 
    the sidebar. 
    '''</span>

    <span class="s1">config </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">, </span><span class="s1">allownone</span><span class="s2">=</span><span class="s4">True</span><span class="s2">)</span>
    <span class="s3">'''A :class:`kivy.config.ConfigParser` instance. See module documentation 
    for more information. 
    '''</span>

    <span class="s1">settings </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">)</span>
    <span class="s3">'''A :class:`Settings` instance that will be used to fire the 
    `on_config_change` event. 
    '''</span>

    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s1">kwargs</span><span class="s2">.</span><span class="s1">setdefault</span><span class="s2">(</span><span class="s3">'cols'</span><span class="s2">, </span><span class="s6">1</span><span class="s2">)</span>
        <span class="s1">super</span><span class="s2">(</span><span class="s1">SettingsPanel</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">__init__</span><span class="s2">(**</span><span class="s1">kwargs</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">on_config</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">value </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s4">return</span>
        <span class="s4">if not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">ConfigParser</span><span class="s2">):</span>
            <span class="s4">raise </span><span class="s1">Exception</span><span class="s2">(</span><span class="s3">'Invalid config object, you must use a'</span>
                            <span class="s3">'kivy.config.ConfigParser, not another one !'</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">get_value</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">section</span><span class="s2">, </span><span class="s1">key</span><span class="s2">):</span>
        <span class="s0">'''Return the value of the section/key from the :attr:`config` 
        ConfigParser instance. This function is used by :class:`SettingItem` to 
        get the value for a given section/key. 
 
        If you don't want to use a ConfigParser instance, you might want to 
        override this function. 
        '''</span>
        <span class="s1">config </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">config</span>
        <span class="s4">if not </span><span class="s1">config</span><span class="s2">:</span>
            <span class="s4">return</span>
        <span class="s4">return </span><span class="s1">config</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">section</span><span class="s2">, </span><span class="s1">key</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">set_value</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">section</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">current </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">get_value</span><span class="s2">(</span><span class="s1">section</span><span class="s2">, </span><span class="s1">key</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">current </span><span class="s2">== </span><span class="s1">value</span><span class="s2">:</span>
            <span class="s4">return</span>
        <span class="s1">config </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">config</span>
        <span class="s4">if </span><span class="s1">config</span><span class="s2">:</span>
            <span class="s1">config</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">section</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>
            <span class="s1">config</span><span class="s2">.</span><span class="s1">write</span><span class="s2">()</span>
        <span class="s1">settings </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">settings</span>
        <span class="s4">if </span><span class="s1">settings</span><span class="s2">:</span>
            <span class="s1">settings</span><span class="s2">.</span><span class="s1">dispatch</span><span class="s2">(</span><span class="s3">'on_config_change'</span><span class="s2">,</span>
                              <span class="s1">config</span><span class="s2">, </span><span class="s1">section</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>


<span class="s4">class </span><span class="s1">InterfaceWithSidebar</span><span class="s2">(</span><span class="s1">BoxLayout</span><span class="s2">):</span>
    <span class="s0">'''The default Settings interface class. It displays a sidebar menu 
    with names of available settings panels, which may be used to switch 
    which one is currently displayed. 
 
    See :meth:`~InterfaceWithSidebar.add_panel` for information on the 
    method you must implement if creating your own interface. 
 
    This class also dispatches an event 'on_close', which is triggered 
    when the sidebar menu's close button is released. If creating your 
    own interface widget, it should also dispatch such an event which 
    will automatically be caught by :class:`Settings` and used to 
    trigger its own 'on_close' event. 
 
    '''</span>

    <span class="s1">menu </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">()</span>
    <span class="s3">'''(internal) A reference to the sidebar menu widget. 
 
    :attr:`menu` is an :class:`~kivy.properties.ObjectProperty` and 
    defaults to None. 
    '''</span>

    <span class="s1">content </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">()</span>
    <span class="s3">'''(internal) A reference to the panel display widget (a 
    :class:`ContentPanel`). 
 
    :attr:`content` is an :class:`~kivy.properties.ObjectProperty` and 
    defaults to None. 
 
    '''</span>

    <span class="s1">__events__ </span><span class="s2">= (</span><span class="s3">'on_close'</span><span class="s2">, )</span>

    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s1">super</span><span class="s2">(</span><span class="s1">InterfaceWithSidebar</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">__init__</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">menu</span><span class="s2">.</span><span class="s1">close_button</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span>
            <span class="s1">on_release</span><span class="s2">=</span><span class="s4">lambda </span><span class="s1">j</span><span class="s2">: </span><span class="s1">self</span><span class="s2">.</span><span class="s1">dispatch</span><span class="s2">(</span><span class="s3">'on_close'</span><span class="s2">))</span>

    <span class="s4">def </span><span class="s1">add_panel</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">panel</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">uid</span><span class="s2">):</span>
        <span class="s0">'''This method is used by Settings to add new panels for possible 
        display. Any replacement for ContentPanel *must* implement 
        this method. 
 
        :Parameters: 
            `panel`: :class:`SettingsPanel` 
                It should be stored and the interface should provide a way to 
                switch between panels. 
            `name`: 
                The name of the panel as a string. It may be used to represent 
                the panel but isn't necessarily unique. 
            `uid`: 
                A unique int identifying the panel. It should be used to 
                identify and switch between panels. 
 
        '''</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">menu</span><span class="s2">.</span><span class="s1">add_item</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">uid</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">content</span><span class="s2">.</span><span class="s1">add_panel</span><span class="s2">(</span><span class="s1">panel</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">uid</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">on_close</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">):</span>
        <span class="s4">pass</span>


<span class="s4">class </span><span class="s1">InterfaceWithSpinner</span><span class="s2">(</span><span class="s1">BoxLayout</span><span class="s2">):</span>
    <span class="s0">'''A settings interface that displays a spinner at the top for 
    switching between panels. 
 
    The workings of this class are considered internal and are not 
    documented. See :meth:`InterfaceWithSidebar` for 
    information on implementing your own interface class. 
 
    '''</span>

    <span class="s1">__events__ </span><span class="s2">= (</span><span class="s3">'on_close'</span><span class="s2">, )</span>

    <span class="s1">menu </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">()</span>
    <span class="s3">'''(internal) A reference to the sidebar menu widget. 
 
    :attr:`menu` is an :class:`~kivy.properties.ObjectProperty` and 
    defaults to None. 
    '''</span>

    <span class="s1">content </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">()</span>
    <span class="s3">'''(internal) A reference to the panel display widget (a 
    :class:`ContentPanel`). 
 
    :attr:`menu` is an :class:`~kivy.properties.ObjectProperty` and 
    defaults to None. 
 
    '''</span>

    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s1">super</span><span class="s2">(</span><span class="s1">InterfaceWithSpinner</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">__init__</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">menu</span><span class="s2">.</span><span class="s1">close_button</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span>
            <span class="s1">on_release</span><span class="s2">=</span><span class="s4">lambda </span><span class="s1">j</span><span class="s2">: </span><span class="s1">self</span><span class="s2">.</span><span class="s1">dispatch</span><span class="s2">(</span><span class="s3">'on_close'</span><span class="s2">))</span>

    <span class="s4">def </span><span class="s1">add_panel</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">panel</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">uid</span><span class="s2">):</span>
        <span class="s0">'''This method is used by Settings to add new panels for possible 
        display. Any replacement for ContentPanel *must* implement 
        this method. 
 
        :Parameters: 
            `panel`: :class:`SettingsPanel` 
                It should be stored and the interface should provide a way to 
                switch between panels. 
            `name`: 
                The name of the panel as a string. It may be used to represent 
                the panel but may not be unique. 
            `uid`: 
                A unique int identifying the panel. It should be used to 
                identify and switch between panels. 
 
        '''</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">content</span><span class="s2">.</span><span class="s1">add_panel</span><span class="s2">(</span><span class="s1">panel</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">uid</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">menu</span><span class="s2">.</span><span class="s1">add_item</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">uid</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">on_close</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">):</span>
        <span class="s4">pass</span>


<span class="s4">class </span><span class="s1">ContentPanel</span><span class="s2">(</span><span class="s1">ScrollView</span><span class="s2">):</span>
    <span class="s0">'''A class for displaying settings panels. It displays a single 
    settings panel at a time, taking up the full size and shape of the 
    ContentPanel. It is used by :class:`InterfaceWithSidebar` and 
    :class:`InterfaceWithSpinner` to display settings. 
 
    '''</span>

    <span class="s1">panels </span><span class="s2">= </span><span class="s1">DictProperty</span><span class="s2">({})</span>
    <span class="s3">'''(internal) Stores a dictionary mapping settings panels to their uids. 
 
    :attr:`panels` is a :class:`~kivy.properties.DictProperty` and 
    defaults to {}. 
 
    '''</span>

    <span class="s1">container </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">()</span>
    <span class="s3">'''(internal) A reference to the GridLayout that contains the 
    settings panel. 
 
    :attr:`container` is an :class:`~kivy.properties.ObjectProperty` and 
    defaults to None. 
 
    '''</span>

    <span class="s1">current_panel </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">)</span>
    <span class="s3">'''(internal) A reference to the current settings panel. 
 
    :attr:`current_panel` is an :class:`~kivy.properties.ObjectProperty` and 
    defaults to None. 
 
    '''</span>

    <span class="s1">current_uid </span><span class="s2">= </span><span class="s1">NumericProperty</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
    <span class="s3">'''(internal) A reference to the uid of the current settings panel. 
 
    :attr:`current_uid` is a 
    :class:`~kivy.properties.NumericProperty` and defaults to 0. 
 
    '''</span>

    <span class="s4">def </span><span class="s1">add_panel</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">panel</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">uid</span><span class="s2">):</span>
        <span class="s0">'''This method is used by Settings to add new panels for possible 
        display. Any replacement for ContentPanel *must* implement 
        this method. 
 
        :Parameters: 
            `panel`: :class:`SettingsPanel` 
                It should be stored and displayed when requested. 
            `name`: 
                The name of the panel as a string. It may be used to represent 
                the panel. 
            `uid`: 
                A unique int identifying the panel. It should be stored and 
                used to identify panels when switching. 
 
        '''</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">panels</span><span class="s2">[</span><span class="s1">uid</span><span class="s2">] = </span><span class="s1">panel</span>
        <span class="s4">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">current_uid</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">current_uid </span><span class="s2">= </span><span class="s1">uid</span>

    <span class="s4">def </span><span class="s1">on_current_uid</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">):</span>
        <span class="s0">'''The uid of the currently displayed panel. Changing this will 
        automatically change the displayed panel. 
 
        :Parameters: 
            `uid`: 
                A panel uid. It should be used to retrieve and display 
                a settings panel that has previously been added with 
                :meth:`add_panel`. 
 
        '''</span>
        <span class="s1">uid </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">current_uid</span>
        <span class="s4">if </span><span class="s1">uid </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">panels</span><span class="s2">:</span>
            <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">current_panel </span><span class="s4">is not None</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">remove_widget</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">current_panel</span><span class="s2">)</span>
            <span class="s1">new_panel </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">panels</span><span class="s2">[</span><span class="s1">uid</span><span class="s2">]</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">new_panel</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">current_panel </span><span class="s2">= </span><span class="s1">new_panel</span>
            <span class="s4">return True</span>
        <span class="s4">return False  </span><span class="s5"># New uid doesn't exist</span>

    <span class="s4">def </span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">container </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s1">super</span><span class="s2">(</span><span class="s1">ContentPanel</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">add_widget</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">container</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">remove_widget</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">container</span><span class="s2">.</span><span class="s1">remove_widget</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>


<span class="s4">class </span><span class="s1">Settings</span><span class="s2">(</span><span class="s1">BoxLayout</span><span class="s2">):</span>

    <span class="s0">'''Settings UI. Check module documentation for more information on how 
    to use this class. 
 
    :Events: 
        `on_config_change`: ConfigParser instance, section, key, value 
            Fired when the section's key-value pair of a ConfigParser changes. 
 
            .. warning: 
 
                value will be str/unicode type, regardless of the setting 
                type (numeric, boolean, etc) 
        `on_close` 
            Fired by the default panel when the Close button is pressed. 
 
        '''</span>

    <span class="s1">interface </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">)</span>
    <span class="s3">'''(internal) Reference to the widget that will contain, organise and 
    display the panel configuration panel widgets. 
 
    :attr:`interface` is an :class:`~kivy.properties.ObjectProperty` and 
    defaults to None. 
 
    '''</span>

    <span class="s1">interface_cls </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">(</span><span class="s1">InterfaceWithSidebar</span><span class="s2">)</span>
    <span class="s3">'''The widget class that will be used to display the graphical 
    interface for the settings panel. By default, it displays one Settings 
    panel at a time with a sidebar to switch between them. 
 
    :attr:`interface_cls` is an 
    :class:`~kivy.properties.ObjectProperty` and defaults to 
    :class:`InterfaceWithSidebar`. 
 
    .. versionchanged:: 1.8.0 
        If you set a string, the :class:`~kivy.factory.Factory` will be used to 
        resolve the class. 
 
    '''</span>

    <span class="s1">__events__ </span><span class="s2">= (</span><span class="s3">'on_close'</span><span class="s2">, </span><span class="s3">'on_config_change'</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kargs</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_types </span><span class="s2">= {}</span>
        <span class="s1">super</span><span class="s2">(</span><span class="s1">Settings</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">__init__</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kargs</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">add_interface</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">register_type</span><span class="s2">(</span><span class="s3">'string'</span><span class="s2">, </span><span class="s1">SettingString</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">register_type</span><span class="s2">(</span><span class="s3">'bool'</span><span class="s2">, </span><span class="s1">SettingBoolean</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">register_type</span><span class="s2">(</span><span class="s3">'numeric'</span><span class="s2">, </span><span class="s1">SettingNumeric</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">register_type</span><span class="s2">(</span><span class="s3">'options'</span><span class="s2">, </span><span class="s1">SettingOptions</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">register_type</span><span class="s2">(</span><span class="s3">'title'</span><span class="s2">, </span><span class="s1">SettingTitle</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">register_type</span><span class="s2">(</span><span class="s3">'path'</span><span class="s2">, </span><span class="s1">SettingPath</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">register_type</span><span class="s2">(</span><span class="s3">'color'</span><span class="s2">, </span><span class="s1">SettingColor</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">on_touch_down</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">touch</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">collide_point</span><span class="s2">(*</span><span class="s1">touch</span><span class="s2">.</span><span class="s1">pos</span><span class="s2">):</span>
            <span class="s1">super</span><span class="s2">(</span><span class="s1">Settings</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">on_touch_down</span><span class="s2">(</span><span class="s1">touch</span><span class="s2">)</span>
            <span class="s4">return True</span>

    <span class="s4">def </span><span class="s1">register_type</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">tp</span><span class="s2">, </span><span class="s1">cls</span><span class="s2">):</span>
        <span class="s0">'''Register a new type that can be used in the JSON definition. 
        '''</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_types</span><span class="s2">[</span><span class="s1">tp</span><span class="s2">] = </span><span class="s1">cls</span>

    <span class="s4">def </span><span class="s1">on_close</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">):</span>
        <span class="s4">pass</span>

    <span class="s4">def </span><span class="s1">add_interface</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">'''(Internal) creates an instance of :attr:`Settings.interface_cls`, 
        and sets it to :attr:`~Settings.interface`. When json panels are 
        created, they will be added to this interface which will display them 
        to the user. 
        '''</span>
        <span class="s1">cls </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">interface_cls</span>
        <span class="s4">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">, </span><span class="s1">string_types</span><span class="s2">):</span>
            <span class="s1">cls </span><span class="s2">= </span><span class="s1">Factory</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">)</span>
        <span class="s1">interface </span><span class="s2">= </span><span class="s1">cls</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">interface </span><span class="s2">= </span><span class="s1">interface</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">interface</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">interface</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">on_close</span><span class="s2">=</span><span class="s4">lambda </span><span class="s1">j</span><span class="s2">: </span><span class="s1">self</span><span class="s2">.</span><span class="s1">dispatch</span><span class="s2">(</span><span class="s3">'on_close'</span><span class="s2">))</span>

    <span class="s4">def </span><span class="s1">on_config_change</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">config</span><span class="s2">, </span><span class="s1">section</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s4">pass</span>

    <span class="s4">def </span><span class="s1">add_json_panel</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">title</span><span class="s2">, </span><span class="s1">config</span><span class="s2">, </span><span class="s1">filename</span><span class="s2">=</span><span class="s4">None</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s4">None</span><span class="s2">):</span>
        <span class="s0">'''Create and add a new :class:`SettingsPanel` using the configuration 
        `config` with the JSON definition `filename`. If `filename` is not set, 
        then the JSON definition is read from the `data` parameter instead. 
 
        Check the :ref:`settings_json` section in the documentation for more 
        information about JSON format and the usage of this function. 
        '''</span>
        <span class="s1">panel </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">create_json_panel</span><span class="s2">(</span><span class="s1">title</span><span class="s2">, </span><span class="s1">config</span><span class="s2">, </span><span class="s1">filename</span><span class="s2">, </span><span class="s1">data</span><span class="s2">)</span>
        <span class="s1">uid </span><span class="s2">= </span><span class="s1">panel</span><span class="s2">.</span><span class="s1">uid</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">interface </span><span class="s4">is not None</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">interface</span><span class="s2">.</span><span class="s1">add_panel</span><span class="s2">(</span><span class="s1">panel</span><span class="s2">, </span><span class="s1">title</span><span class="s2">, </span><span class="s1">uid</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">create_json_panel</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">title</span><span class="s2">, </span><span class="s1">config</span><span class="s2">, </span><span class="s1">filename</span><span class="s2">=</span><span class="s4">None</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s4">None</span><span class="s2">):</span>
        <span class="s0">'''Create new :class:`SettingsPanel`. 
 
        .. versionadded:: 1.5.0 
 
        Check the documentation of :meth:`add_json_panel` for more information. 
        '''</span>
        <span class="s4">if </span><span class="s1">filename </span><span class="s4">is None and </span><span class="s1">data </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s4">raise </span><span class="s1">Exception</span><span class="s2">(</span><span class="s3">'You must specify either the filename or data'</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">filename </span><span class="s4">is not None</span><span class="s2">:</span>
            <span class="s4">with </span><span class="s1">open</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">, </span><span class="s3">'r'</span><span class="s2">) </span><span class="s4">as </span><span class="s1">fd</span><span class="s2">:</span>
                <span class="s1">data </span><span class="s2">= </span><span class="s1">json</span><span class="s2">.</span><span class="s1">loads</span><span class="s2">(</span><span class="s1">fd</span><span class="s2">.</span><span class="s1">read</span><span class="s2">())</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">data </span><span class="s2">= </span><span class="s1">json</span><span class="s2">.</span><span class="s1">loads</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)</span>
        <span class="s4">if not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">list</span><span class="s2">):</span>
            <span class="s4">raise </span><span class="s1">ValueError</span><span class="s2">(</span><span class="s3">'The first element must be a list'</span><span class="s2">)</span>
        <span class="s1">panel </span><span class="s2">= </span><span class="s1">SettingsPanel</span><span class="s2">(</span><span class="s1">title</span><span class="s2">=</span><span class="s1">title</span><span class="s2">, </span><span class="s1">settings</span><span class="s2">=</span><span class="s1">self</span><span class="s2">, </span><span class="s1">config</span><span class="s2">=</span><span class="s1">config</span><span class="s2">)</span>

        <span class="s4">for </span><span class="s1">setting </span><span class="s4">in </span><span class="s1">data</span><span class="s2">:</span>
            <span class="s5"># determine the type and the class to use</span>
            <span class="s4">if </span><span class="s3">'type' </span><span class="s4">not in </span><span class="s1">setting</span><span class="s2">:</span>
                <span class="s4">raise </span><span class="s1">ValueError</span><span class="s2">(</span><span class="s3">'One setting are missing the &quot;type&quot; element'</span><span class="s2">)</span>
            <span class="s1">ttype </span><span class="s2">= </span><span class="s1">setting</span><span class="s2">[</span><span class="s3">'type'</span><span class="s2">]</span>
            <span class="s1">cls </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_types</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">ttype</span><span class="s2">)</span>
            <span class="s4">if </span><span class="s1">cls </span><span class="s4">is None</span><span class="s2">:</span>
                <span class="s4">raise </span><span class="s1">ValueError</span><span class="s2">(</span>
                    <span class="s3">'No class registered to handle the &lt;%s&gt; type' </span><span class="s2">%</span>
                    <span class="s1">setting</span><span class="s2">[</span><span class="s3">'type'</span><span class="s2">])</span>

            <span class="s5"># create a instance of the class, without the type attribute</span>
            <span class="s4">del </span><span class="s1">setting</span><span class="s2">[</span><span class="s3">'type'</span><span class="s2">]</span>
            <span class="s1">str_settings </span><span class="s2">= {}</span>
            <span class="s4">for </span><span class="s1">key</span><span class="s2">, </span><span class="s1">item </span><span class="s4">in </span><span class="s1">setting</span><span class="s2">.</span><span class="s1">items</span><span class="s2">():</span>
                <span class="s1">str_settings</span><span class="s2">[</span><span class="s1">str</span><span class="s2">(</span><span class="s1">key</span><span class="s2">)] = </span><span class="s1">item</span>

            <span class="s1">instance </span><span class="s2">= </span><span class="s1">cls</span><span class="s2">(</span><span class="s1">panel</span><span class="s2">=</span><span class="s1">panel</span><span class="s2">, **</span><span class="s1">str_settings</span><span class="s2">)</span>

            <span class="s5"># instance created, add to the panel</span>
            <span class="s1">panel</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">instance</span><span class="s2">)</span>

        <span class="s4">return </span><span class="s1">panel</span>

    <span class="s4">def </span><span class="s1">add_kivy_panel</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">'''Add a panel for configuring Kivy. This panel acts directly on the 
        kivy configuration. Feel free to include or exclude it in your 
        configuration. 
 
        See :meth:`~kivy.app.App.use_kivy_settings` for information on 
        enabling/disabling the automatic kivy panel. 
 
        '''</span>
        <span class="s4">from </span><span class="s1">kivy </span><span class="s4">import </span><span class="s1">kivy_data_dir</span>
        <span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">config </span><span class="s4">import </span><span class="s1">Config</span>
        <span class="s4">from </span><span class="s1">os</span><span class="s2">.</span><span class="s1">path </span><span class="s4">import </span><span class="s1">join</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">add_json_panel</span><span class="s2">(</span><span class="s3">'Kivy'</span><span class="s2">, </span><span class="s1">Config</span><span class="s2">,</span>
                            <span class="s1">join</span><span class="s2">(</span><span class="s1">kivy_data_dir</span><span class="s2">, </span><span class="s3">'settings_kivy.json'</span><span class="s2">))</span>


<span class="s4">class </span><span class="s1">SettingsWithSidebar</span><span class="s2">(</span><span class="s1">Settings</span><span class="s2">):</span>
    <span class="s0">'''A settings widget that displays settings panels with a sidebar to 
    switch between them. This is the default behavior of 
    :class:`Settings`, and this widget is a trivial wrapper subclass. 
 
    '''</span>


<span class="s4">class </span><span class="s1">SettingsWithSpinner</span><span class="s2">(</span><span class="s1">Settings</span><span class="s2">):</span>
    <span class="s0">'''A settings widget that displays one settings panel at a time with a 
    spinner at the top to switch between them. 
 
    '''</span>
    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">interface_cls </span><span class="s2">= </span><span class="s1">InterfaceWithSpinner</span>
        <span class="s1">super</span><span class="s2">(</span><span class="s1">SettingsWithSpinner</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">__init__</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>


<span class="s4">class </span><span class="s1">SettingsWithTabbedPanel</span><span class="s2">(</span><span class="s1">Settings</span><span class="s2">):</span>
    <span class="s0">'''A settings widget that displays settings panels as pages in a 
    :class:`~kivy.uix.tabbedpanel.TabbedPanel`. 
    '''</span>

    <span class="s1">__events__ </span><span class="s2">= (</span><span class="s3">'on_close'</span><span class="s2">, )</span>

    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">interface_cls </span><span class="s2">= </span><span class="s1">InterfaceWithTabbedPanel</span>
        <span class="s1">super</span><span class="s2">(</span><span class="s1">SettingsWithTabbedPanel</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">__init__</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">on_close</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">):</span>
        <span class="s4">pass</span>


<span class="s4">class </span><span class="s1">SettingsWithNoMenu</span><span class="s2">(</span><span class="s1">Settings</span><span class="s2">):</span>
    <span class="s0">'''A settings widget that displays a single settings panel with *no* 
    Close button. It will not accept more than one Settings panel. It 
    is intended for use in programs with few enough settings that a 
    full panel switcher is not useful. 
 
    .. warning:: 
 
        This Settings panel does *not* provide a Close 
        button, and so it is impossible to leave the settings screen 
        unless you also add other behavior or override 
        :meth:`~kivy.app.App.display_settings` and 
        :meth:`~kivy.app.App.close_settings`. 
 
    '''</span>
    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">interface_cls </span><span class="s2">= </span><span class="s1">InterfaceWithNoMenu</span>
        <span class="s1">super</span><span class="s2">(</span><span class="s1">SettingsWithNoMenu</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">__init__</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>


<span class="s4">class </span><span class="s1">InterfaceWithNoMenu</span><span class="s2">(</span><span class="s1">ContentPanel</span><span class="s2">):</span>
    <span class="s0">'''The interface widget used by :class:`SettingsWithNoMenu`. It 
    stores and displays a single settings panel. 
 
    This widget is considered internal and is not documented. See the 
    :class:`ContentPanel` for information on defining your own content 
    widget. 
 
    '''</span>
    <span class="s4">def </span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">container </span><span class="s4">is not None and </span><span class="s1">len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">container</span><span class="s2">.</span><span class="s1">children</span><span class="s2">) &gt; </span><span class="s6">0</span><span class="s2">:</span>
            <span class="s4">raise </span><span class="s1">Exception</span><span class="s2">(</span>
                <span class="s3">'ContentNoMenu cannot accept more than one settings panel'</span><span class="s2">)</span>
        <span class="s1">super</span><span class="s2">(</span><span class="s1">InterfaceWithNoMenu</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">add_widget</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>


<span class="s4">class </span><span class="s1">InterfaceWithTabbedPanel</span><span class="s2">(</span><span class="s1">FloatLayout</span><span class="s2">):</span>
    <span class="s0">'''The content widget used by :class:`SettingsWithTabbedPanel`. It 
    stores and displays Settings panels in tabs of a TabbedPanel. 
 
    This widget is considered internal and is not documented. See 
    :class:`InterfaceWithSidebar` for information on defining your own 
    interface widget. 
 
    '''</span>
    <span class="s1">tabbedpanel </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">()</span>
    <span class="s1">close_button </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">()</span>

    <span class="s1">__events__ </span><span class="s2">= (</span><span class="s3">'on_close'</span><span class="s2">, )</span>

    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s1">super</span><span class="s2">(</span><span class="s1">InterfaceWithTabbedPanel</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">__init__</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">close_button</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">on_release</span><span class="s2">=</span><span class="s4">lambda </span><span class="s1">j</span><span class="s2">: </span><span class="s1">self</span><span class="s2">.</span><span class="s1">dispatch</span><span class="s2">(</span><span class="s3">'on_close'</span><span class="s2">))</span>

    <span class="s4">def </span><span class="s1">add_panel</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">panel</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">uid</span><span class="s2">):</span>
        <span class="s1">scrollview </span><span class="s2">= </span><span class="s1">ScrollView</span><span class="s2">()</span>
        <span class="s1">scrollview</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">panel</span><span class="s2">)</span>
        <span class="s4">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">tabbedpanel</span><span class="s2">.</span><span class="s1">default_tab_content</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">tabbedpanel</span><span class="s2">.</span><span class="s1">default_tab_text </span><span class="s2">= </span><span class="s1">name</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">tabbedpanel</span><span class="s2">.</span><span class="s1">default_tab_content </span><span class="s2">= </span><span class="s1">scrollview</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">panelitem </span><span class="s2">= </span><span class="s1">TabbedPanelHeader</span><span class="s2">(</span><span class="s1">text</span><span class="s2">=</span><span class="s1">name</span><span class="s2">, </span><span class="s1">content</span><span class="s2">=</span><span class="s1">scrollview</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">tabbedpanel</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">panelitem</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">on_close</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">):</span>
        <span class="s4">pass</span>


<span class="s4">class </span><span class="s1">MenuSpinner</span><span class="s2">(</span><span class="s1">BoxLayout</span><span class="s2">):</span>
    <span class="s0">'''The menu class used by :class:`SettingsWithSpinner`. It provides a 
    sidebar with an entry for each settings panel. 
 
    This widget is considered internal and is not documented. See 
    :class:`MenuSidebar` for information on menus and creating your own menu 
    class. 
 
    '''</span>
    <span class="s1">selected_uid </span><span class="s2">= </span><span class="s1">NumericProperty</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
    <span class="s1">close_button </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
    <span class="s1">spinner </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">()</span>
    <span class="s1">panel_names </span><span class="s2">= </span><span class="s1">DictProperty</span><span class="s2">({})</span>
    <span class="s1">spinner_text </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">()</span>
    <span class="s1">close_button </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">add_item</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">uid</span><span class="s2">):</span>
        <span class="s1">values </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">spinner</span><span class="s2">.</span><span class="s1">values</span>
        <span class="s4">if </span><span class="s1">name </span><span class="s4">in </span><span class="s1">values</span><span class="s2">:</span>
            <span class="s1">i </span><span class="s2">= </span><span class="s6">2</span>
            <span class="s4">while </span><span class="s1">name </span><span class="s2">+ </span><span class="s3">' {}'</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">i</span><span class="s2">) </span><span class="s4">in </span><span class="s1">values</span><span class="s2">:</span>
                <span class="s1">i </span><span class="s2">+= </span><span class="s6">1</span>
            <span class="s1">name </span><span class="s2">= </span><span class="s1">name </span><span class="s2">+ </span><span class="s3">' {}'</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">i</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">panel_names</span><span class="s2">[</span><span class="s1">name</span><span class="s2">] = </span><span class="s1">uid</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">spinner</span><span class="s2">.</span><span class="s1">values</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">name</span><span class="s2">)</span>
        <span class="s4">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">spinner</span><span class="s2">.</span><span class="s1">text</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">spinner</span><span class="s2">.</span><span class="s1">text </span><span class="s2">= </span><span class="s1">name</span>

    <span class="s4">def </span><span class="s1">on_spinner_text</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">):</span>
        <span class="s1">text </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">spinner_text</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">selected_uid </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">panel_names</span><span class="s2">[</span><span class="s1">text</span><span class="s2">]</span>


<span class="s4">class </span><span class="s1">MenuSidebar</span><span class="s2">(</span><span class="s1">FloatLayout</span><span class="s2">):</span>
    <span class="s0">'''The menu used by :class:`InterfaceWithSidebar`. It provides a 
    sidebar with an entry for each settings panel, which the user may 
    click to select. 
 
    '''</span>

    <span class="s1">selected_uid </span><span class="s2">= </span><span class="s1">NumericProperty</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
    <span class="s3">'''The uid of the currently selected panel. This may be used to switch 
    between displayed panels, e.g. by binding it to the 
    :attr:`~ContentPanel.current_uid` of a :class:`ContentPanel`. 
 
    :attr:`selected_uid` is a 
    :class:`~kivy.properties.NumericProperty` and defaults to 0. 
 
    '''</span>

    <span class="s1">buttons_layout </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">)</span>
    <span class="s3">'''(internal) Reference to the GridLayout that contains individual 
    settings panel menu buttons. 
 
    :attr:`buttons_layout` is an 
    :class:`~kivy.properties.ObjectProperty` and defaults to None. 
 
    '''</span>

    <span class="s1">close_button </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">)</span>
    <span class="s3">'''(internal) Reference to the widget's Close button. 
 
    :attr:`buttons_layout` is an 
    :class:`~kivy.properties.ObjectProperty` and defaults to None. 
 
    '''</span>

    <span class="s4">def </span><span class="s1">add_item</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">uid</span><span class="s2">):</span>
        <span class="s0">'''This method is used to add new panels to the menu. 
 
        :Parameters: 
            `name`: 
                The name (a string) of the panel. It should be used 
                to represent the panel in the menu. 
            `uid`: 
                The name (an int) of the panel. It should be used internally 
                to represent the panel and used to set self.selected_uid when 
                the panel is changed. 
 
        '''</span>

        <span class="s1">label </span><span class="s2">= </span><span class="s1">SettingSidebarLabel</span><span class="s2">(</span><span class="s1">text</span><span class="s2">=</span><span class="s1">name</span><span class="s2">, </span><span class="s1">uid</span><span class="s2">=</span><span class="s1">uid</span><span class="s2">, </span><span class="s1">menu</span><span class="s2">=</span><span class="s1">self</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">buttons_layout</span><span class="s2">.</span><span class="s1">children</span><span class="s2">) == </span><span class="s6">0</span><span class="s2">:</span>
            <span class="s1">label</span><span class="s2">.</span><span class="s1">selected </span><span class="s2">= </span><span class="s4">True</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">buttons_layout </span><span class="s4">is not None</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">buttons_layout</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">label</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">on_selected_uid</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">):</span>
        <span class="s0">'''(internal) unselects any currently selected menu buttons, unless 
        they represent the current panel. 
 
        '''</span>
        <span class="s4">for </span><span class="s1">button </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">buttons_layout</span><span class="s2">.</span><span class="s1">children</span><span class="s2">:</span>
            <span class="s4">if </span><span class="s1">button</span><span class="s2">.</span><span class="s1">uid </span><span class="s2">!= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">selected_uid</span><span class="s2">:</span>
                <span class="s1">button</span><span class="s2">.</span><span class="s1">selected </span><span class="s2">= </span><span class="s4">False</span>


<span class="s4">class </span><span class="s1">SettingSidebarLabel</span><span class="s2">(</span><span class="s1">Label</span><span class="s2">):</span>
    <span class="s5"># Internal class, not documented.</span>
    <span class="s1">selected </span><span class="s2">= </span><span class="s1">BooleanProperty</span><span class="s2">(</span><span class="s4">False</span><span class="s2">)</span>
    <span class="s1">uid </span><span class="s2">= </span><span class="s1">NumericProperty</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
    <span class="s1">menu </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">on_touch_down</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">touch</span><span class="s2">):</span>
        <span class="s4">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">collide_point</span><span class="s2">(*</span><span class="s1">touch</span><span class="s2">.</span><span class="s1">pos</span><span class="s2">):</span>
            <span class="s4">return</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">selected </span><span class="s2">= </span><span class="s4">True</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">menu</span><span class="s2">.</span><span class="s1">selected_uid </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">uid</span>


<span class="s4">if </span><span class="s1">__name__ </span><span class="s2">== </span><span class="s3">'__main__'</span><span class="s2">:</span>
    <span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">app </span><span class="s4">import </span><span class="s1">App</span>

    <span class="s4">class </span><span class="s1">SettingsApp</span><span class="s2">(</span><span class="s1">App</span><span class="s2">):</span>
        <span class="s1">demo_json_settings </span><span class="s2">= </span><span class="s1">json</span><span class="s2">.</span><span class="s1">dumps</span><span class="s2">([</span>
            <span class="s2">{</span>
                <span class="s3">'type'</span><span class="s2">: </span><span class="s3">'color'</span><span class="s2">,</span>
                <span class="s3">'title'</span><span class="s2">: </span><span class="s3">'Test color'</span><span class="s2">,</span>
                <span class="s3">'desc'</span><span class="s2">: </span><span class="s3">'Your chosen Color'</span><span class="s2">,</span>
                <span class="s3">'section'</span><span class="s2">: </span><span class="s3">'colorselection'</span><span class="s2">,</span>
                <span class="s3">'key'</span><span class="s2">: </span><span class="s3">'testcolor'</span>
            <span class="s2">}])</span>

        <span class="s4">def </span><span class="s1">build</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
            <span class="s1">s </span><span class="s2">= </span><span class="s1">Settings</span><span class="s2">()</span>
            <span class="s1">s</span><span class="s2">.</span><span class="s1">add_kivy_panel</span><span class="s2">()</span>
            <span class="s1">s</span><span class="s2">.</span><span class="s1">add_json_panel</span><span class="s2">(</span><span class="s3">'Color settings'</span><span class="s2">,</span>
                             <span class="s1">self</span><span class="s2">.</span><span class="s1">config</span><span class="s2">,</span>
                             <span class="s1">data</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">demo_json_settings</span><span class="s2">)</span>
            <span class="s1">s</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">on_close</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">stop</span><span class="s2">)</span>
            <span class="s4">return </span><span class="s1">s</span>

        <span class="s4">def </span><span class="s1">build_config</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">config</span><span class="s2">):</span>
            <span class="s1">config</span><span class="s2">.</span><span class="s1">setdefaults</span><span class="s2">(</span><span class="s3">'colorselection'</span><span class="s2">, {</span><span class="s3">'testcolor'</span><span class="s2">: </span><span class="s3">'#FF0000'</span><span class="s2">})</span>

    <span class="s1">SettingsApp</span><span class="s2">().</span><span class="s1">run</span><span class="s2">()</span>
</pre>
</body>
</html>