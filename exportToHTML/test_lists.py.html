<html>
<head>
<title>test_lists.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #5f826b; font-style: italic;}
.s5 { color: #2aacb8;}
.s6 { color: #7a7e85;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_lists.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">collections </span><span class="s0">import </span><span class="s1">namedtuple</span>
<span class="s0">import </span><span class="s1">contextlib</span>
<span class="s0">import </span><span class="s1">itertools</span>
<span class="s0">import </span><span class="s1">math</span>
<span class="s0">import </span><span class="s1">sys</span>
<span class="s0">import </span><span class="s1">ctypes </span><span class="s0">as </span><span class="s1">ct</span>
<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>

<span class="s0">from </span><span class="s1">numba </span><span class="s0">import </span><span class="s1">jit</span><span class="s2">, </span><span class="s1">typeof</span><span class="s2">, </span><span class="s1">njit</span><span class="s2">, </span><span class="s1">literal_unroll</span><span class="s2">, </span><span class="s1">literally</span>
<span class="s0">import </span><span class="s1">unittest</span>
<span class="s0">from </span><span class="s1">numba</span><span class="s2">.</span><span class="s1">core </span><span class="s0">import </span><span class="s1">types</span><span class="s2">, </span><span class="s1">errors</span>
<span class="s0">from </span><span class="s1">numba</span><span class="s2">.</span><span class="s1">tests</span><span class="s2">.</span><span class="s1">support </span><span class="s0">import </span><span class="s1">TestCase</span><span class="s2">, </span><span class="s1">MemoryLeakMixin</span>
<span class="s0">from </span><span class="s1">numba</span><span class="s2">.</span><span class="s1">experimental </span><span class="s0">import </span><span class="s1">jitclass</span>
<span class="s0">from </span><span class="s1">numba</span><span class="s2">.</span><span class="s1">core</span><span class="s2">.</span><span class="s1">extending </span><span class="s0">import </span><span class="s1">overload</span>


<span class="s1">Point </span><span class="s2">= </span><span class="s1">namedtuple</span><span class="s2">(</span><span class="s3">'Point'</span><span class="s2">, (</span><span class="s3">'a'</span><span class="s2">, </span><span class="s3">'b'</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">noop</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
    <span class="s0">pass</span>

<span class="s0">def </span><span class="s1">unbox_usecase</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
    <span class="s4">&quot;&quot;&quot; 
    Expect a list of numbers 
    &quot;&quot;&quot;</span>
    <span class="s1">res </span><span class="s2">= </span><span class="s5">0</span>
    <span class="s0">for </span><span class="s1">v </span><span class="s0">in </span><span class="s1">x</span><span class="s2">:</span>
        <span class="s1">res </span><span class="s2">+= </span><span class="s1">v</span>
    <span class="s0">return </span><span class="s1">res</span>

<span class="s0">def </span><span class="s1">unbox_usecase2</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
    <span class="s4">&quot;&quot;&quot; 
    Expect a list of tuples 
    &quot;&quot;&quot;</span>
    <span class="s1">res </span><span class="s2">= </span><span class="s5">0</span>
    <span class="s0">for </span><span class="s1">v </span><span class="s0">in </span><span class="s1">x</span><span class="s2">:</span>
        <span class="s1">res </span><span class="s2">+= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">v</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">res</span>

<span class="s0">def </span><span class="s1">unbox_usecase3</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
    <span class="s4">&quot;&quot;&quot; 
    Expect a (number, list of numbers) tuple. 
    &quot;&quot;&quot;</span>
    <span class="s1">a</span><span class="s2">, </span><span class="s1">b </span><span class="s2">= </span><span class="s1">x</span>
    <span class="s1">res </span><span class="s2">= </span><span class="s1">a</span>
    <span class="s0">for </span><span class="s1">v </span><span class="s0">in </span><span class="s1">b</span><span class="s2">:</span>
        <span class="s1">res </span><span class="s2">+= </span><span class="s1">v</span>
    <span class="s0">return </span><span class="s1">res</span>

<span class="s0">def </span><span class="s1">unbox_usecase4</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
    <span class="s4">&quot;&quot;&quot; 
    Expect a (number, list of tuples) tuple. 
    &quot;&quot;&quot;</span>
    <span class="s1">a</span><span class="s2">, </span><span class="s1">b </span><span class="s2">= </span><span class="s1">x</span>
    <span class="s1">res </span><span class="s2">= </span><span class="s1">a</span>
    <span class="s0">for </span><span class="s1">v </span><span class="s0">in </span><span class="s1">b</span><span class="s2">:</span>
        <span class="s1">res </span><span class="s2">+= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">v</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">res</span>


<span class="s0">def </span><span class="s1">create_list</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s2">[</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">]</span>

<span class="s0">def </span><span class="s1">create_nested_list</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">c</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s2">[[</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">], [</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">c</span><span class="s2">]]</span>

<span class="s0">def </span><span class="s1">list_comprehension1</span><span class="s2">():</span>
    <span class="s0">return </span><span class="s1">sum</span><span class="s2">([</span><span class="s1">x</span><span class="s2">**</span><span class="s5">2 </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">10</span><span class="s2">)])</span>

<span class="s0">def </span><span class="s1">list_comprehension2</span><span class="s2">():</span>
    <span class="s0">return </span><span class="s1">sum</span><span class="s2">([</span><span class="s1">x </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">10</span><span class="s2">) </span><span class="s0">if </span><span class="s1">x </span><span class="s2">% </span><span class="s5">2 </span><span class="s2">== </span><span class="s5">0</span><span class="s2">])</span>

<span class="s0">def </span><span class="s1">list_comprehension3</span><span class="s2">():</span>
    <span class="s0">return </span><span class="s1">sum</span><span class="s2">([</span><span class="s1">math</span><span class="s2">.</span><span class="s1">pow</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s5">2</span><span class="s2">) </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">10</span><span class="s2">)])</span>

<span class="s0">def </span><span class="s1">list_comprehension4</span><span class="s2">():</span>
    <span class="s0">return </span><span class="s1">sum</span><span class="s2">([</span><span class="s1">x </span><span class="s2">* </span><span class="s1">y </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">10</span><span class="s2">) </span><span class="s0">for </span><span class="s1">y </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">10</span><span class="s2">)])</span>

<span class="s0">def </span><span class="s1">list_comprehension5</span><span class="s2">():</span>
    <span class="s0">return </span><span class="s2">[</span><span class="s1">x </span><span class="s2">* </span><span class="s5">2 </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">10</span><span class="s2">)]</span>

<span class="s0">def </span><span class="s1">list_comprehension6</span><span class="s2">():</span>
    <span class="s0">return </span><span class="s2">[[</span><span class="s1">x </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">y</span><span class="s2">)] </span><span class="s0">for </span><span class="s1">y </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">3</span><span class="s2">)]</span>


<span class="s0">def </span><span class="s1">list_constructor</span><span class="s2">(</span><span class="s1">n</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">))</span>

<span class="s0">def </span><span class="s1">list_constructor_empty</span><span class="s2">():</span>
    <span class="s6"># cannot be typed, list is empty and no typing information is present to</span>
    <span class="s6"># infer a type</span>
    <span class="s0">return </span><span class="s1">list</span><span class="s2">()</span>

<span class="s0">def </span><span class="s1">list_constructor_empty_but_typeable</span><span class="s2">(</span><span class="s1">n</span><span class="s2">):</span>
    <span class="s6"># can be typed, list is empty but later append has typing info that allows</span>
    <span class="s6"># for inference</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">list</span><span class="s2">()</span>
    <span class="s0">return </span><span class="s1">y</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">n</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">list_append</span><span class="s2">(</span><span class="s1">n</span><span class="s2">):</span>
    <span class="s1">l </span><span class="s2">= []</span>
    <span class="s1">l</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s5">42</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">):</span>
        <span class="s1">l</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">i</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">l</span>

<span class="s0">def </span><span class="s1">list_append_heterogeneous</span><span class="s2">(</span><span class="s1">n</span><span class="s2">):</span>
    <span class="s1">l </span><span class="s2">= []</span>
    <span class="s1">l</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s5">42.0</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">):</span>
        <span class="s1">l</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">i</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">l</span>

<span class="s0">def </span><span class="s1">list_extend</span><span class="s2">(</span><span class="s1">n</span><span class="s2">):</span>
    <span class="s1">l </span><span class="s2">= []</span>
    <span class="s6"># A non-list iterable and a list</span>
    <span class="s1">l</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">))</span>
    <span class="s1">l</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">(</span><span class="s1">l</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">])</span>
    <span class="s1">l</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">))</span>
    <span class="s0">return </span><span class="s1">l</span>

<span class="s0">def </span><span class="s1">list_extend_heterogeneous</span><span class="s2">(</span><span class="s1">n</span><span class="s2">):</span>
    <span class="s1">l </span><span class="s2">= []</span>
    <span class="s6"># Extend with various iterables, including lists, with different types</span>
    <span class="s1">l</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">))</span>
    <span class="s1">l</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">(</span><span class="s1">l</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">])</span>
    <span class="s1">l</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">((</span><span class="s5">5</span><span class="s2">, </span><span class="s5">42</span><span class="s2">))</span>
    <span class="s1">l</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">([</span><span class="s5">123.0</span><span class="s2">])</span>
    <span class="s0">return </span><span class="s1">l</span>

<span class="s0">def </span><span class="s1">list_pop0</span><span class="s2">(</span><span class="s1">n</span><span class="s2">):</span>
    <span class="s1">l </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">))</span>
    <span class="s1">res </span><span class="s2">= </span><span class="s5">0</span>
    <span class="s0">while </span><span class="s1">len</span><span class="s2">(</span><span class="s1">l</span><span class="s2">) &gt; </span><span class="s5">0</span><span class="s2">:</span>
        <span class="s1">res </span><span class="s2">+= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">l</span><span class="s2">) * </span><span class="s1">l</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">()</span>
    <span class="s0">return </span><span class="s1">res</span>

<span class="s0">def </span><span class="s1">list_pop1</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">i</span><span class="s2">):</span>
    <span class="s1">l </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">))</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">l</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">(</span><span class="s1">i</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">x</span><span class="s2">, </span><span class="s1">l</span>

<span class="s0">def </span><span class="s1">list_len</span><span class="s2">(</span><span class="s1">n</span><span class="s2">):</span>
    <span class="s1">l </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">))</span>
    <span class="s0">return </span><span class="s1">len</span><span class="s2">(</span><span class="s1">l</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">list_getitem</span><span class="s2">(</span><span class="s1">n</span><span class="s2">):</span>
    <span class="s1">l </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">))</span>
    <span class="s1">res </span><span class="s2">= </span><span class="s5">0</span>
    <span class="s6"># Positive indices</span>
    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">l</span><span class="s2">)):</span>
        <span class="s1">res </span><span class="s2">+= </span><span class="s1">i </span><span class="s2">* </span><span class="s1">l</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]</span>
    <span class="s6"># Negative indices</span>
    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(-</span><span class="s1">len</span><span class="s2">(</span><span class="s1">l</span><span class="s2">), </span><span class="s5">0</span><span class="s2">):</span>
        <span class="s1">res </span><span class="s2">-= </span><span class="s1">i </span><span class="s2">* </span><span class="s1">l</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]</span>
    <span class="s0">return </span><span class="s1">res</span>

<span class="s0">def </span><span class="s1">list_setitem</span><span class="s2">(</span><span class="s1">n</span><span class="s2">):</span>
    <span class="s1">l </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">))</span>
    <span class="s1">res </span><span class="s2">= </span><span class="s5">0</span>
    <span class="s6"># Positive indices</span>
    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">l</span><span class="s2">)):</span>
        <span class="s1">l</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] = </span><span class="s1">i </span><span class="s2">* </span><span class="s1">l</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]</span>
    <span class="s6"># Negative indices</span>
    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(-</span><span class="s1">len</span><span class="s2">(</span><span class="s1">l</span><span class="s2">), </span><span class="s5">0</span><span class="s2">):</span>
        <span class="s1">l</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] = </span><span class="s1">i </span><span class="s2">* </span><span class="s1">l</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]</span>
    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">l</span><span class="s2">)):</span>
        <span class="s1">res </span><span class="s2">+= </span><span class="s1">l</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]</span>
    <span class="s0">return </span><span class="s1">res</span>

<span class="s0">def </span><span class="s1">list_getslice2</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">):</span>
    <span class="s1">l </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">))</span>
    <span class="s0">return </span><span class="s1">l</span><span class="s2">[</span><span class="s1">start</span><span class="s2">:</span><span class="s1">stop</span><span class="s2">]</span>

<span class="s0">def </span><span class="s1">list_getslice3</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">, </span><span class="s1">step</span><span class="s2">):</span>
    <span class="s1">l </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">))</span>
    <span class="s0">return </span><span class="s1">l</span><span class="s2">[</span><span class="s1">start</span><span class="s2">:</span><span class="s1">stop</span><span class="s2">:</span><span class="s1">step</span><span class="s2">]</span>

<span class="s0">def </span><span class="s1">list_setslice2</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">n_source</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">):</span>
    <span class="s6"># Generic setslice with size change</span>
    <span class="s1">l </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">))</span>
    <span class="s1">v </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s5">100</span><span class="s2">, </span><span class="s5">100 </span><span class="s2">+ </span><span class="s1">n_source</span><span class="s2">))</span>
    <span class="s1">l</span><span class="s2">[</span><span class="s1">start</span><span class="s2">:</span><span class="s1">stop</span><span class="s2">] = </span><span class="s1">v</span>
    <span class="s0">return </span><span class="s1">l</span>

<span class="s0">def </span><span class="s1">list_setslice3</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">, </span><span class="s1">step</span><span class="s2">):</span>
    <span class="s1">l </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">))</span>
    <span class="s1">v </span><span class="s2">= </span><span class="s1">l</span><span class="s2">[</span><span class="s1">start</span><span class="s2">:</span><span class="s1">stop</span><span class="s2">:</span><span class="s1">step</span><span class="s2">]</span>
    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">v</span><span class="s2">)):</span>
        <span class="s1">v</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] += </span><span class="s5">100</span>
    <span class="s1">l</span><span class="s2">[</span><span class="s1">start</span><span class="s2">:</span><span class="s1">stop</span><span class="s2">:</span><span class="s1">step</span><span class="s2">] = </span><span class="s1">v</span>
    <span class="s0">return </span><span class="s1">l</span>

<span class="s0">def </span><span class="s1">list_setslice3_arbitrary</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">n_src</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">, </span><span class="s1">step</span><span class="s2">):</span>
    <span class="s1">l </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">))</span>
    <span class="s1">l</span><span class="s2">[</span><span class="s1">start</span><span class="s2">:</span><span class="s1">stop</span><span class="s2">:</span><span class="s1">step</span><span class="s2">] = </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s5">100</span><span class="s2">, </span><span class="s5">100 </span><span class="s2">+ </span><span class="s1">n_src</span><span class="s2">))</span>
    <span class="s0">return </span><span class="s1">l</span>

<span class="s0">def </span><span class="s1">list_delslice0</span><span class="s2">(</span><span class="s1">n</span><span class="s2">):</span>
    <span class="s1">l </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">))</span>
    <span class="s0">del </span><span class="s1">l</span><span class="s2">[:]</span>
    <span class="s0">return </span><span class="s1">l</span>

<span class="s0">def </span><span class="s1">list_delslice1</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">):</span>
    <span class="s1">l </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">))</span>
    <span class="s0">del </span><span class="s1">l</span><span class="s2">[</span><span class="s1">start</span><span class="s2">:]</span>
    <span class="s0">del </span><span class="s1">l</span><span class="s2">[:</span><span class="s1">stop</span><span class="s2">]</span>
    <span class="s0">return </span><span class="s1">l</span>

<span class="s0">def </span><span class="s1">list_delslice2</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">):</span>
    <span class="s1">l </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">))</span>
    <span class="s0">del </span><span class="s1">l</span><span class="s2">[</span><span class="s1">start</span><span class="s2">:</span><span class="s1">stop</span><span class="s2">]</span>
    <span class="s0">return </span><span class="s1">l</span>

<span class="s0">def </span><span class="s1">list_clear</span><span class="s2">(</span><span class="s1">n</span><span class="s2">):</span>
    <span class="s1">l </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">))</span>
    <span class="s1">l</span><span class="s2">.</span><span class="s1">clear</span><span class="s2">()</span>
    <span class="s0">return </span><span class="s1">l</span>

<span class="s0">def </span><span class="s1">list_copy</span><span class="s2">(</span><span class="s1">n</span><span class="s2">):</span>
    <span class="s1">l </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">))</span>
    <span class="s1">ll </span><span class="s2">= </span><span class="s1">l</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
    <span class="s1">l</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s5">42</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">l</span><span class="s2">, </span><span class="s1">ll</span>

<span class="s0">def </span><span class="s1">list_iteration</span><span class="s2">(</span><span class="s1">n</span><span class="s2">):</span>
    <span class="s1">l </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">))</span>
    <span class="s1">res </span><span class="s2">= </span><span class="s5">0</span>
    <span class="s0">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">v </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">l</span><span class="s2">):</span>
        <span class="s1">res </span><span class="s2">+= </span><span class="s1">i </span><span class="s2">* </span><span class="s1">v</span>
    <span class="s0">return </span><span class="s1">res</span>

<span class="s0">def </span><span class="s1">list_contains</span><span class="s2">(</span><span class="s1">n</span><span class="s2">):</span>
    <span class="s1">l </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">))</span>
    <span class="s0">return </span><span class="s2">(</span><span class="s5">0 </span><span class="s0">in </span><span class="s1">l</span><span class="s2">, </span><span class="s5">1 </span><span class="s0">in </span><span class="s1">l</span><span class="s2">, </span><span class="s1">n </span><span class="s2">- </span><span class="s5">1 </span><span class="s0">in </span><span class="s1">l</span><span class="s2">, </span><span class="s1">n </span><span class="s0">in </span><span class="s1">l</span><span class="s2">,</span>
            <span class="s5">0 </span><span class="s0">not in </span><span class="s1">l</span><span class="s2">, </span><span class="s5">1 </span><span class="s0">not in </span><span class="s1">l</span><span class="s2">, </span><span class="s1">n </span><span class="s2">- </span><span class="s5">1 </span><span class="s0">not in </span><span class="s1">l</span><span class="s2">, </span><span class="s1">n </span><span class="s0">not in </span><span class="s1">l</span><span class="s2">,</span>
            <span class="s2">)</span>

<span class="s0">def </span><span class="s1">list_index1</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">v</span><span class="s2">):</span>
    <span class="s1">l </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">))</span>
    <span class="s0">return </span><span class="s1">l</span><span class="s2">.</span><span class="s1">index</span><span class="s2">(</span><span class="s1">v</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">list_index2</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">v</span><span class="s2">, </span><span class="s1">start</span><span class="s2">):</span>
    <span class="s1">l </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">))</span>
    <span class="s0">return </span><span class="s1">l</span><span class="s2">.</span><span class="s1">index</span><span class="s2">(</span><span class="s1">v</span><span class="s2">, </span><span class="s1">start</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">list_index3</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">v</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">):</span>
    <span class="s1">l </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">))</span>
    <span class="s0">return </span><span class="s1">l</span><span class="s2">.</span><span class="s1">index</span><span class="s2">(</span><span class="s1">v</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">list_remove</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">v</span><span class="s2">):</span>
    <span class="s1">l </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">n </span><span class="s2">- </span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">))</span>
    <span class="s1">l</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">v</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">l</span>

<span class="s0">def </span><span class="s1">list_insert</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">, </span><span class="s1">v</span><span class="s2">):</span>
    <span class="s1">l </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s1">n</span><span class="s2">))</span>
    <span class="s1">l</span><span class="s2">.</span><span class="s1">insert</span><span class="s2">(</span><span class="s1">pos</span><span class="s2">, </span><span class="s1">v</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">l</span>

<span class="s0">def </span><span class="s1">list_count</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">v</span><span class="s2">):</span>
    <span class="s1">l </span><span class="s2">= []</span>
    <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">):</span>
        <span class="s1">l</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">x </span><span class="s2">&amp; </span><span class="s5">3</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">l</span><span class="s2">.</span><span class="s1">count</span><span class="s2">(</span><span class="s1">v</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">list_reverse</span><span class="s2">(</span><span class="s1">n</span><span class="s2">):</span>
    <span class="s1">l </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">))</span>
    <span class="s1">l</span><span class="s2">.</span><span class="s1">reverse</span><span class="s2">()</span>
    <span class="s0">return </span><span class="s1">l</span>

<span class="s0">def </span><span class="s1">list_add</span><span class="s2">(</span><span class="s1">m</span><span class="s2">, </span><span class="s1">n</span><span class="s2">):</span>
    <span class="s1">a </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s1">m</span><span class="s2">))</span>
    <span class="s1">b </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s5">100</span><span class="s2">, </span><span class="s5">100 </span><span class="s2">+ </span><span class="s1">n</span><span class="s2">))</span>
    <span class="s1">res </span><span class="s2">= </span><span class="s1">a </span><span class="s2">+ </span><span class="s1">b</span>
    <span class="s1">res</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s5">42</span><span class="s2">)   </span><span class="s6"># check result is a copy</span>
    <span class="s0">return </span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">res</span>

<span class="s0">def </span><span class="s1">list_add_heterogeneous</span><span class="s2">():</span>
    <span class="s1">a </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">]</span>
    <span class="s1">b </span><span class="s2">= [</span><span class="s5">2.0</span><span class="s2">]</span>
    <span class="s1">c </span><span class="s2">= </span><span class="s1">a </span><span class="s2">+ </span><span class="s1">b</span>
    <span class="s1">d </span><span class="s2">= </span><span class="s1">b </span><span class="s2">+ </span><span class="s1">a</span>
    <span class="s6"># check result is a copy</span>
    <span class="s1">a</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s5">3</span><span class="s2">)</span>
    <span class="s1">b</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s5">4.0</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">c</span><span class="s2">, </span><span class="s1">d</span>

<span class="s0">def </span><span class="s1">list_add_inplace</span><span class="s2">(</span><span class="s1">m</span><span class="s2">, </span><span class="s1">n</span><span class="s2">):</span>
    <span class="s1">a </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s1">m</span><span class="s2">))</span>
    <span class="s1">b </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s5">100</span><span class="s2">, </span><span class="s5">100 </span><span class="s2">+ </span><span class="s1">n</span><span class="s2">))</span>
    <span class="s1">a </span><span class="s2">+= </span><span class="s1">b</span>
    <span class="s0">return </span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span>

<span class="s0">def </span><span class="s1">list_add_inplace_heterogeneous</span><span class="s2">():</span>
    <span class="s1">a </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">]</span>
    <span class="s1">b </span><span class="s2">= [</span><span class="s5">2.0</span><span class="s2">]</span>
    <span class="s1">a </span><span class="s2">+= </span><span class="s1">b</span>
    <span class="s1">b </span><span class="s2">+= </span><span class="s1">a</span>
    <span class="s0">return </span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span>

<span class="s0">def </span><span class="s1">list_mul</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">v</span><span class="s2">):</span>
    <span class="s1">a </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">))</span>
    <span class="s0">return </span><span class="s1">a </span><span class="s2">* </span><span class="s1">v</span>

<span class="s0">def </span><span class="s1">list_mul2</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">v</span><span class="s2">):</span>
    <span class="s1">a </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">))</span>
    <span class="s0">return </span><span class="s1">v </span><span class="s2">* </span><span class="s1">a</span>

<span class="s0">def </span><span class="s1">list_mul_inplace</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">v</span><span class="s2">):</span>
    <span class="s1">a </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">))</span>
    <span class="s1">a </span><span class="s2">*= </span><span class="s1">v</span>
    <span class="s0">return </span><span class="s1">a</span>

<span class="s0">def </span><span class="s1">list_bool</span><span class="s2">(</span><span class="s1">n</span><span class="s2">):</span>
    <span class="s1">a </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">))</span>
    <span class="s0">return </span><span class="s1">bool</span><span class="s2">(</span><span class="s1">a</span><span class="s2">), (</span><span class="s0">True if </span><span class="s1">a </span><span class="s0">else False</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">eq_usecase</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">list</span><span class="s2">(</span><span class="s1">a</span><span class="s2">) == </span><span class="s1">list</span><span class="s2">(</span><span class="s1">b</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">ne_usecase</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">list</span><span class="s2">(</span><span class="s1">a</span><span class="s2">) != </span><span class="s1">list</span><span class="s2">(</span><span class="s1">b</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">gt_usecase</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">list</span><span class="s2">(</span><span class="s1">a</span><span class="s2">) &gt; </span><span class="s1">list</span><span class="s2">(</span><span class="s1">b</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">ge_usecase</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">list</span><span class="s2">(</span><span class="s1">a</span><span class="s2">) &gt;= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">b</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">lt_usecase</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">list</span><span class="s2">(</span><span class="s1">a</span><span class="s2">) &lt; </span><span class="s1">list</span><span class="s2">(</span><span class="s1">b</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">le_usecase</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">list</span><span class="s2">(</span><span class="s1">a</span><span class="s2">) &lt;= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">b</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">identity_usecase</span><span class="s2">(</span><span class="s1">n</span><span class="s2">):</span>
    <span class="s1">a </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">))</span>
    <span class="s1">b </span><span class="s2">= </span><span class="s1">a</span>
    <span class="s1">c </span><span class="s2">= </span><span class="s1">a</span><span class="s2">[:]</span>
    <span class="s0">return </span><span class="s2">(</span><span class="s1">a </span><span class="s0">is </span><span class="s1">b</span><span class="s2">), (</span><span class="s1">a </span><span class="s0">is not </span><span class="s1">b</span><span class="s2">), (</span><span class="s1">a </span><span class="s0">is </span><span class="s1">c</span><span class="s2">), (</span><span class="s1">a </span><span class="s0">is not </span><span class="s1">c</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">bool_list_usecase</span><span class="s2">():</span>
    <span class="s6"># Exercise getitem, setitem, iteration with bool values (issue #1373)</span>
    <span class="s1">l </span><span class="s2">= [</span><span class="s0">False</span><span class="s2">]</span>
    <span class="s1">l</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] = </span><span class="s0">True</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s0">False</span>
    <span class="s0">for </span><span class="s1">v </span><span class="s0">in </span><span class="s1">l</span><span class="s2">:</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">x </span><span class="s2">^ </span><span class="s1">v</span>
    <span class="s0">return </span><span class="s1">l</span><span class="s2">, </span><span class="s1">x</span>

<span class="s0">def </span><span class="s1">reflect_simple</span><span class="s2">(</span><span class="s1">l</span><span class="s2">, </span><span class="s1">ll</span><span class="s2">):</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">l</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">()</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">l</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">()</span>
    <span class="s1">l</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] = </span><span class="s5">42.</span>
    <span class="s1">l</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">(</span><span class="s1">ll</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">l</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span>

<span class="s0">def </span><span class="s1">reflect_conditional</span><span class="s2">(</span><span class="s1">l</span><span class="s2">, </span><span class="s1">ll</span><span class="s2">):</span>
    <span class="s6"># `l` may or may not actually reflect a Python list</span>
    <span class="s0">if </span><span class="s1">ll</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]:</span>
        <span class="s1">l </span><span class="s2">= [</span><span class="s5">11.</span><span class="s2">, </span><span class="s5">22.</span><span class="s2">, </span><span class="s5">33.</span><span class="s2">, </span><span class="s5">44.</span><span class="s2">]</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">l</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">()</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">l</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">()</span>
    <span class="s1">l</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] = </span><span class="s5">42.</span>
    <span class="s1">l</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">(</span><span class="s1">ll</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">l</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span>

<span class="s0">def </span><span class="s1">reflect_exception</span><span class="s2">(</span><span class="s1">l</span><span class="s2">):</span>
    <span class="s1">l</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s5">42</span><span class="s2">)</span>
    <span class="s0">raise </span><span class="s1">ZeroDivisionError</span>

<span class="s0">def </span><span class="s1">reflect_dual</span><span class="s2">(</span><span class="s1">l</span><span class="s2">, </span><span class="s1">ll</span><span class="s2">):</span>
    <span class="s1">l</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">ll</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">())</span>
    <span class="s0">return </span><span class="s1">l </span><span class="s0">is </span><span class="s1">ll</span>


<span class="s0">class </span><span class="s1">TestLists</span><span class="s2">(</span><span class="s1">MemoryLeakMixin</span><span class="s2">, </span><span class="s1">TestCase</span><span class="s2">):</span>

    <span class="s0">def </span><span class="s1">test_create_list</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">create_list</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">njit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">))(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_create_nested_list</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">create_nested_list</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">njit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">,</span>
                      <span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">))(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">check_unary_with_size</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">pyfunc</span><span class="s2">, </span><span class="s1">precise</span><span class="s2">=</span><span class="s0">True</span><span class="s2">):</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s6"># Use various sizes, to stress the allocation algorithm</span>
        <span class="s0">for </span><span class="s1">n </span><span class="s0">in </span><span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">16</span><span class="s2">, </span><span class="s5">70</span><span class="s2">, </span><span class="s5">400</span><span class="s2">]:</span>
            <span class="s1">eq </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual </span><span class="s0">if </span><span class="s1">precise </span><span class="s0">else </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span>
            <span class="s1">eq</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">n</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">n</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_constructor</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_unary_with_size</span><span class="s2">(</span><span class="s1">list_constructor</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_constructor_empty</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">disable_leak_check</span><span class="s2">()</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">list_constructor_empty</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">.</span><span class="s1">TypingError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">cfunc</span><span class="s2">()</span>
        <span class="s1">errmsg </span><span class="s2">= </span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s3">&quot;Cannot infer the type of variable&quot;</span><span class="s2">, </span><span class="s1">errmsg</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s3">&quot;list(undefined)&quot;</span><span class="s2">, </span><span class="s1">errmsg</span><span class="s2">)</span>
        <span class="s6"># check error message went in</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s3">&quot;For Numba to be able to compile a list&quot;</span><span class="s2">, </span><span class="s1">errmsg</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_constructor_empty_but_typeable</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">args </span><span class="s2">= [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">(</span><span class="s5">1</span><span class="s2">), </span><span class="s5">10.</span><span class="s2">, </span><span class="s5">1 </span><span class="s2">+ </span><span class="s5">3j</span><span class="s2">, [</span><span class="s5">7</span><span class="s2">], [</span><span class="s5">17.</span><span class="s2">, </span><span class="s5">14.</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">10</span><span class="s2">])]</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">list_constructor_empty_but_typeable</span>
        <span class="s0">for </span><span class="s1">arg </span><span class="s0">in </span><span class="s1">args</span><span class="s2">:</span>
            <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">)</span>
            <span class="s1">got </span><span class="s2">= </span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">got</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_append</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_unary_with_size</span><span class="s2">(</span><span class="s1">list_append</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_append_heterogeneous</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_unary_with_size</span><span class="s2">(</span><span class="s1">list_append_heterogeneous</span><span class="s2">, </span><span class="s1">precise</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_extend</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_unary_with_size</span><span class="s2">(</span><span class="s1">list_extend</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_extend_heterogeneous</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_unary_with_size</span><span class="s2">(</span><span class="s1">list_extend_heterogeneous</span><span class="s2">, </span><span class="s1">precise</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_pop0</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_unary_with_size</span><span class="s2">(</span><span class="s1">list_pop0</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_pop1</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">list_pop1</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">n </span><span class="s0">in </span><span class="s2">[</span><span class="s5">5</span><span class="s2">, </span><span class="s5">40</span><span class="s2">]:</span>
            <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s1">n </span><span class="s2">- </span><span class="s5">2</span><span class="s2">, </span><span class="s1">n </span><span class="s2">- </span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">2</span><span class="s2">, -</span><span class="s1">n </span><span class="s2">+ </span><span class="s5">3</span><span class="s2">, -</span><span class="s1">n </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">]:</span>
                <span class="s1">expected </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">i</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">i</span><span class="s2">), </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_pop_errors</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6"># XXX References are leaked when an exception is raised</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">disable_leak_check</span><span class="s2">()</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">list_pop1</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">IndexError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">cm</span><span class="s2">:</span>
            <span class="s1">cfunc</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">5</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">cm</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">), </span><span class="s3">&quot;pop from empty list&quot;</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">IndexError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">cm</span><span class="s2">:</span>
            <span class="s1">cfunc</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">5</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">cm</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">), </span><span class="s3">&quot;pop index out of range&quot;</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_insert</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">list_insert</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">n </span><span class="s0">in </span><span class="s2">[</span><span class="s5">5</span><span class="s2">, </span><span class="s5">40</span><span class="s2">]:</span>
            <span class="s1">indices </span><span class="s2">= [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s1">n </span><span class="s2">- </span><span class="s5">2</span><span class="s2">, </span><span class="s1">n </span><span class="s2">- </span><span class="s5">1</span><span class="s2">, </span><span class="s1">n </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">2</span><span class="s2">, -</span><span class="s1">n </span><span class="s2">+ </span><span class="s5">3</span><span class="s2">, -</span><span class="s1">n </span><span class="s2">- </span><span class="s5">1</span><span class="s2">]</span>
            <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">indices</span><span class="s2">:</span>
                <span class="s1">expected </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">i</span><span class="s2">, </span><span class="s5">42</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">i</span><span class="s2">, </span><span class="s5">42</span><span class="s2">), </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_unary_with_size</span><span class="s2">(</span><span class="s1">list_len</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_getitem</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_unary_with_size</span><span class="s2">(</span><span class="s1">list_getitem</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_setitem</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_unary_with_size</span><span class="s2">(</span><span class="s1">list_setitem</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">check_slicing2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">pyfunc</span><span class="s2">):</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">sizes </span><span class="s2">= [</span><span class="s5">5</span><span class="s2">, </span><span class="s5">40</span><span class="s2">]</span>
        <span class="s0">for </span><span class="s1">n </span><span class="s0">in </span><span class="s1">sizes</span><span class="s2">:</span>
            <span class="s1">indices </span><span class="s2">= [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s1">n </span><span class="s2">- </span><span class="s5">2</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">2</span><span class="s2">, -</span><span class="s1">n </span><span class="s2">+ </span><span class="s5">3</span><span class="s2">, -</span><span class="s1">n </span><span class="s2">- </span><span class="s5">1</span><span class="s2">, -</span><span class="s1">n</span><span class="s2">]</span>
            <span class="s0">for </span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop </span><span class="s0">in </span><span class="s1">itertools</span><span class="s2">.</span><span class="s1">product</span><span class="s2">(</span><span class="s1">indices</span><span class="s2">, </span><span class="s1">indices</span><span class="s2">):</span>
                <span class="s1">expected </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">), </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_getslice2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_slicing2</span><span class="s2">(</span><span class="s1">list_getslice2</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_setslice2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">list_setslice2</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">sizes </span><span class="s2">= [</span><span class="s5">5</span><span class="s2">, </span><span class="s5">40</span><span class="s2">]</span>
        <span class="s0">for </span><span class="s1">n</span><span class="s2">, </span><span class="s1">n_src </span><span class="s0">in </span><span class="s1">itertools</span><span class="s2">.</span><span class="s1">product</span><span class="s2">(</span><span class="s1">sizes</span><span class="s2">, </span><span class="s1">sizes</span><span class="s2">):</span>
            <span class="s1">indices </span><span class="s2">= [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s1">n </span><span class="s2">- </span><span class="s5">2</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">2</span><span class="s2">, -</span><span class="s1">n </span><span class="s2">+ </span><span class="s5">3</span><span class="s2">, -</span><span class="s1">n </span><span class="s2">- </span><span class="s5">1</span><span class="s2">, -</span><span class="s1">n</span><span class="s2">]</span>
            <span class="s0">for </span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop </span><span class="s0">in </span><span class="s1">itertools</span><span class="s2">.</span><span class="s1">product</span><span class="s2">(</span><span class="s1">indices</span><span class="s2">, </span><span class="s1">indices</span><span class="s2">):</span>
                <span class="s1">expected </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">n_src</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">n_src</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">), </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_getslice3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">list_getslice3</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">n </span><span class="s0">in </span><span class="s2">[</span><span class="s5">10</span><span class="s2">]:</span>
            <span class="s1">indices </span><span class="s2">= [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s1">n </span><span class="s2">- </span><span class="s5">2</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">2</span><span class="s2">, -</span><span class="s1">n </span><span class="s2">+ </span><span class="s5">3</span><span class="s2">, -</span><span class="s1">n </span><span class="s2">- </span><span class="s5">1</span><span class="s2">, -</span><span class="s1">n</span><span class="s2">]</span>
            <span class="s1">steps </span><span class="s2">= [</span><span class="s5">4</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, -</span><span class="s5">3</span><span class="s2">]</span>
            <span class="s0">for </span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">, </span><span class="s1">step </span><span class="s0">in </span><span class="s1">itertools</span><span class="s2">.</span><span class="s1">product</span><span class="s2">(</span><span class="s1">indices</span><span class="s2">, </span><span class="s1">indices</span><span class="s2">, </span><span class="s1">steps</span><span class="s2">):</span>
                <span class="s1">expected </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">, </span><span class="s1">step</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">, </span><span class="s1">step</span><span class="s2">), </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_setslice3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">list_setslice3</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">n </span><span class="s0">in </span><span class="s2">[</span><span class="s5">10</span><span class="s2">]:</span>
            <span class="s1">indices </span><span class="s2">= [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s1">n </span><span class="s2">- </span><span class="s5">2</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">2</span><span class="s2">, -</span><span class="s1">n </span><span class="s2">+ </span><span class="s5">3</span><span class="s2">, -</span><span class="s1">n </span><span class="s2">- </span><span class="s5">1</span><span class="s2">, -</span><span class="s1">n</span><span class="s2">]</span>
            <span class="s1">steps </span><span class="s2">= [</span><span class="s5">4</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, -</span><span class="s5">3</span><span class="s2">]</span>
            <span class="s0">for </span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">, </span><span class="s1">step </span><span class="s0">in </span><span class="s1">itertools</span><span class="s2">.</span><span class="s1">product</span><span class="s2">(</span><span class="s1">indices</span><span class="s2">, </span><span class="s1">indices</span><span class="s2">, </span><span class="s1">steps</span><span class="s2">):</span>
                <span class="s1">expected </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">, </span><span class="s1">step</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">, </span><span class="s1">step</span><span class="s2">), </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_setslice3_resize</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6"># XXX References are leaked when an exception is raised</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">disable_leak_check</span><span class="s2">()</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">list_setslice3_arbitrary</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s6"># step == 1 =&gt; can resize</span>
        <span class="s1">cfunc</span><span class="s2">(</span><span class="s5">5</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
        <span class="s6"># step != 1 =&gt; cannot resize</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">cm</span><span class="s2">:</span>
            <span class="s1">cfunc</span><span class="s2">(</span><span class="s5">5</span><span class="s2">, </span><span class="s5">100</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s3">&quot;cannot resize&quot;</span><span class="s2">, </span><span class="s1">str</span><span class="s2">(</span><span class="s1">cm</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_delslice0</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_unary_with_size</span><span class="s2">(</span><span class="s1">list_delslice0</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_delslice1</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_slicing2</span><span class="s2">(</span><span class="s1">list_delslice1</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_delslice2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_slicing2</span><span class="s2">(</span><span class="s1">list_delslice2</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_invalid_slice</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">disable_leak_check</span><span class="s2">()</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">list_getslice3</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">cm</span><span class="s2">:</span>
            <span class="s1">cfunc</span><span class="s2">(</span><span class="s5">10</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">cm</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">), </span><span class="s3">&quot;slice step cannot be zero&quot;</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_iteration</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_unary_with_size</span><span class="s2">(</span><span class="s1">list_iteration</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_reverse</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_unary_with_size</span><span class="s2">(</span><span class="s1">list_reverse</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_contains</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_unary_with_size</span><span class="s2">(</span><span class="s1">list_contains</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">check_index_result</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">pyfunc</span><span class="s2">, </span><span class="s1">cfunc</span><span class="s2">, </span><span class="s1">args</span><span class="s2">):</span>
        <span class="s0">try</span><span class="s2">:</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">)</span>
        <span class="s0">except </span><span class="s1">ValueError</span><span class="s2">:</span>
            <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
                <span class="s1">cfunc</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">), </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_index1</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">disable_leak_check</span><span class="s2">()</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">list_index1</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">v </span><span class="s0">in </span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">99999999</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">check_index_result</span><span class="s2">(</span><span class="s1">pyfunc</span><span class="s2">, </span><span class="s1">cfunc</span><span class="s2">, (</span><span class="s5">16</span><span class="s2">, </span><span class="s1">v</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_index2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">disable_leak_check</span><span class="s2">()</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">list_index2</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">n </span><span class="s2">= </span><span class="s5">16</span>
        <span class="s0">for </span><span class="s1">v </span><span class="s0">in </span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">99999999</span><span class="s2">):</span>
            <span class="s1">indices </span><span class="s2">= [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s1">n </span><span class="s2">- </span><span class="s5">2</span><span class="s2">, </span><span class="s1">n </span><span class="s2">- </span><span class="s5">1</span><span class="s2">, </span><span class="s1">n </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">2</span><span class="s2">, -</span><span class="s1">n </span><span class="s2">+ </span><span class="s5">3</span><span class="s2">, -</span><span class="s1">n </span><span class="s2">- </span><span class="s5">1</span><span class="s2">]</span>
            <span class="s0">for </span><span class="s1">start </span><span class="s0">in </span><span class="s1">indices</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">check_index_result</span><span class="s2">(</span><span class="s1">pyfunc</span><span class="s2">, </span><span class="s1">cfunc</span><span class="s2">, (</span><span class="s5">16</span><span class="s2">, </span><span class="s1">v</span><span class="s2">, </span><span class="s1">start</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_index3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">disable_leak_check</span><span class="s2">()</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">list_index3</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">n </span><span class="s2">= </span><span class="s5">16</span>
        <span class="s0">for </span><span class="s1">v </span><span class="s0">in </span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">99999999</span><span class="s2">):</span>
            <span class="s1">indices </span><span class="s2">= [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s1">n </span><span class="s2">- </span><span class="s5">2</span><span class="s2">, </span><span class="s1">n </span><span class="s2">- </span><span class="s5">1</span><span class="s2">, </span><span class="s1">n </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">2</span><span class="s2">, -</span><span class="s1">n </span><span class="s2">+ </span><span class="s5">3</span><span class="s2">, -</span><span class="s1">n </span><span class="s2">- </span><span class="s5">1</span><span class="s2">]</span>
            <span class="s0">for </span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop </span><span class="s0">in </span><span class="s1">itertools</span><span class="s2">.</span><span class="s1">product</span><span class="s2">(</span><span class="s1">indices</span><span class="s2">, </span><span class="s1">indices</span><span class="s2">):</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">check_index_result</span><span class="s2">(</span><span class="s1">pyfunc</span><span class="s2">, </span><span class="s1">cfunc</span><span class="s2">, (</span><span class="s5">16</span><span class="s2">, </span><span class="s1">v</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_index_exception1</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">list_index3</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">'arg &quot;start&quot; must be an Integer.'</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaisesRegex</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">.</span><span class="s1">TypingError</span><span class="s2">, </span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">cfunc</span><span class="s2">(</span><span class="s5">10</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s3">'invalid'</span><span class="s2">, </span><span class="s5">5</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_index_exception2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">list_index3</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">'arg &quot;stop&quot; must be an Integer.'</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaisesRegex</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">.</span><span class="s1">TypingError</span><span class="s2">, </span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">cfunc</span><span class="s2">(</span><span class="s5">10</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s3">'invalid'</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_remove</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">list_remove</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">n </span><span class="s2">= </span><span class="s5">16</span>
        <span class="s0">for </span><span class="s1">v </span><span class="s0">in </span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">15</span><span class="s2">):</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">v</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">v</span><span class="s2">), </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_remove_error</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">disable_leak_check</span><span class="s2">()</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">list_remove</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">cm</span><span class="s2">:</span>
            <span class="s1">cfunc</span><span class="s2">(</span><span class="s5">10</span><span class="s2">, </span><span class="s5">42</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">cm</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">), </span><span class="s3">&quot;list.remove(x): x not in list&quot;</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_count</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">list_count</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">v </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">5</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s5">18</span><span class="s2">, </span><span class="s1">v</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s5">18</span><span class="s2">, </span><span class="s1">v</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_clear</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_unary_with_size</span><span class="s2">(</span><span class="s1">list_clear</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_copy</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_unary_with_size</span><span class="s2">(</span><span class="s1">list_copy</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">check_add</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">pyfunc</span><span class="s2">):</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">sizes </span><span class="s2">= [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">50</span><span class="s2">, </span><span class="s5">300</span><span class="s2">]</span>
        <span class="s0">for </span><span class="s1">m</span><span class="s2">, </span><span class="s1">n </span><span class="s0">in </span><span class="s1">itertools</span><span class="s2">.</span><span class="s1">product</span><span class="s2">(</span><span class="s1">sizes</span><span class="s2">, </span><span class="s1">sizes</span><span class="s2">):</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">m</span><span class="s2">, </span><span class="s1">n</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">m</span><span class="s2">, </span><span class="s1">n</span><span class="s2">), </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_add</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_add</span><span class="s2">(</span><span class="s1">list_add</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_add_heterogeneous</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">list_add_heterogeneous</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(), </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_add_inplace</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_add</span><span class="s2">(</span><span class="s1">list_add_inplace</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_add_inplace_heterogeneous</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">list_add_inplace_heterogeneous</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(), </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">check_mul</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">pyfunc</span><span class="s2">):</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">n </span><span class="s0">in </span><span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">50</span><span class="s2">, </span><span class="s5">300</span><span class="s2">]:</span>
            <span class="s0">for </span><span class="s1">v </span><span class="s0">in </span><span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">42</span><span class="s2">]:</span>
                <span class="s1">expected </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">v</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">v</span><span class="s2">), </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_mul</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_mul</span><span class="s2">(</span><span class="s1">list_mul</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_mul2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_mul</span><span class="s2">(</span><span class="s1">list_mul2</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_mul_inplace</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_mul</span><span class="s2">(</span><span class="s1">list_mul_inplace</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">unittest</span><span class="s2">.</span><span class="s1">skipUnless</span><span class="s2">(</span><span class="s1">sys</span><span class="s2">.</span><span class="s1">maxsize </span><span class="s2">&gt;= </span><span class="s5">2</span><span class="s2">**</span><span class="s5">32</span><span class="s2">,</span>
                         <span class="s3">&quot;need a 64-bit system to test for MemoryError&quot;</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_mul_error</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">disable_leak_check</span><span class="s2">()</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">list_mul</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s6"># Fail in malloc()</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">MemoryError</span><span class="s2">):</span>
            <span class="s1">cfunc</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">**</span><span class="s5">58</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">sys</span><span class="s2">.</span><span class="s1">platform</span><span class="s2">.</span><span class="s1">startswith</span><span class="s2">(</span><span class="s3">'darwin'</span><span class="s2">):</span>
            <span class="s1">libc </span><span class="s2">= </span><span class="s1">ct</span><span class="s2">.</span><span class="s1">CDLL</span><span class="s2">(</span><span class="s3">'libc.dylib'</span><span class="s2">)</span>
            <span class="s1">libc</span><span class="s2">.</span><span class="s1">printf</span><span class="s2">(</span><span class="s3">&quot;###Please ignore the above error message i.e. </span><span class="s0">\ 
</span><span class="s3">can't allocate region. It is in fact the purpose of this test to </span><span class="s0">\ 
</span><span class="s3">request more memory than can be provided###</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s2">.</span><span class="s1">encode</span><span class="s2">(</span><span class="s3">&quot;UTF-8&quot;</span><span class="s2">))</span>
        <span class="s6"># Overflow size computation when multiplying by item size</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">MemoryError</span><span class="s2">):</span>
            <span class="s1">cfunc</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">**</span><span class="s5">62</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_bool</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">list_bool</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">n </span><span class="s0">in </span><span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]:</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">n</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">n</span><span class="s2">), </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_list_passing</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6"># Check one can pass a list from a Numba function to another</span>
        <span class="s2">@</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s0">def </span><span class="s1">inner</span><span class="s2">(</span><span class="s1">lst</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s1">len</span><span class="s2">(</span><span class="s1">lst</span><span class="s2">), </span><span class="s1">lst</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">]</span>

        <span class="s2">@</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s0">def </span><span class="s1">outer</span><span class="s2">(</span><span class="s1">n</span><span class="s2">):</span>
            <span class="s1">l </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">))</span>
            <span class="s0">return </span><span class="s1">inner</span><span class="s2">(</span><span class="s1">l</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">outer</span><span class="s2">(</span><span class="s5">5</span><span class="s2">), (</span><span class="s5">5</span><span class="s2">, </span><span class="s5">4</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">_test_compare</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">pyfunc</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">eq</span><span class="s2">(</span><span class="s1">args</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIs</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">),</span>
                          <span class="s3">&quot;mismatch for arguments %s&quot; </span><span class="s2">% (</span><span class="s1">args</span><span class="s2">,))</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">eq</span><span class="s2">(((</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">), (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)))</span>
        <span class="s1">eq</span><span class="s2">(((</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">), (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)))</span>
        <span class="s1">eq</span><span class="s2">(((</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">), (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)))</span>
        <span class="s1">eq</span><span class="s2">(((</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">), (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)))</span>
        <span class="s1">eq</span><span class="s2">(((</span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">2.0</span><span class="s2">, </span><span class="s5">3.0</span><span class="s2">), (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)))</span>
        <span class="s1">eq</span><span class="s2">(((</span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">2.0</span><span class="s2">, </span><span class="s5">3.5</span><span class="s2">), (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)))</span>

    <span class="s0">def </span><span class="s1">test_eq</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_compare</span><span class="s2">(</span><span class="s1">eq_usecase</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_ne</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_compare</span><span class="s2">(</span><span class="s1">ne_usecase</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_le</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_compare</span><span class="s2">(</span><span class="s1">le_usecase</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_lt</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_compare</span><span class="s2">(</span><span class="s1">lt_usecase</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_ge</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_compare</span><span class="s2">(</span><span class="s1">ge_usecase</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_gt</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_compare</span><span class="s2">(</span><span class="s1">gt_usecase</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_identity</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">identity_usecase</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s5">3</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s5">3</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_bool_list</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6"># Check lists of bools compile and run successfully</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">bool_list_usecase</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(), </span><span class="s1">pyfunc</span><span class="s2">())</span>


<span class="s0">class </span><span class="s1">TestUnboxing</span><span class="s2">(</span><span class="s1">MemoryLeakMixin</span><span class="s2">, </span><span class="s1">TestCase</span><span class="s2">):</span>
    <span class="s4">&quot;&quot;&quot; 
    Test unboxing of Python lists into native Numba lists. 
    &quot;&quot;&quot;</span>

    <span class="s2">@</span><span class="s1">contextlib</span><span class="s2">.</span><span class="s1">contextmanager</span>
    <span class="s0">def </span><span class="s1">assert_type_error</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">msg</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s0">yield</span>
        <span class="s0">if </span><span class="s1">msg </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertRegex</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">), </span><span class="s1">msg</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">check_unary</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">pyfunc</span><span class="s2">):</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s0">def </span><span class="s1">check</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">):</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">)</span>
            <span class="s1">got </span><span class="s2">= </span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">got</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">check</span>

    <span class="s0">def </span><span class="s1">test_numbers</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">check </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">check_unary</span><span class="s2">(</span><span class="s1">unbox_usecase</span><span class="s2">)</span>
        <span class="s1">check</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">])</span>
        <span class="s1">check</span><span class="s2">([</span><span class="s5">1j</span><span class="s2">, </span><span class="s5">2.5j</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">test_tuples</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">check </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">check_unary</span><span class="s2">(</span><span class="s1">unbox_usecase2</span><span class="s2">)</span>
        <span class="s1">check</span><span class="s2">([(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">), (</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">)])</span>
        <span class="s1">check</span><span class="s2">([(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2j</span><span class="s2">), (</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4j</span><span class="s2">)])</span>
        <span class="s1">check</span><span class="s2">([(), (), ()])</span>

    <span class="s0">def </span><span class="s1">test_list_inside_tuple</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">check </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">check_unary</span><span class="s2">(</span><span class="s1">unbox_usecase3</span><span class="s2">)</span>
        <span class="s1">check</span><span class="s2">((</span><span class="s5">1</span><span class="s2">, [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">]))</span>

    <span class="s0">def </span><span class="s1">test_list_of_tuples_inside_tuple</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">check </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">check_unary</span><span class="s2">(</span><span class="s1">unbox_usecase4</span><span class="s2">)</span>
        <span class="s1">check</span><span class="s2">((</span><span class="s5">1</span><span class="s2">, [(</span><span class="s5">2</span><span class="s2">,), (</span><span class="s5">3</span><span class="s2">,)]))</span>

    <span class="s0">def </span><span class="s1">test_errors</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6"># See #1545 and #1594: error checking should ensure the list is</span>
        <span class="s6"># homogeneous</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;can't unbox heterogeneous list&quot;</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">noop</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">lst </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2.5</span><span class="s2">]</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assert_type_error</span><span class="s2">(</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">cfunc</span><span class="s2">(</span><span class="s1">lst</span><span class="s2">)</span>
        <span class="s6"># The list hasn't been changed (bogus reflecting)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">lst</span><span class="s2">, [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2.5</span><span class="s2">])</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assert_type_error</span><span class="s2">(</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">cfunc</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2j</span><span class="s2">])</span>
        <span class="s6"># Same when the list is nested in a tuple or namedtuple</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assert_type_error</span><span class="s2">(</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">cfunc</span><span class="s2">((</span><span class="s5">1</span><span class="s2">, [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2j</span><span class="s2">]))</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assert_type_error</span><span class="s2">(</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">cfunc</span><span class="s2">(</span><span class="s1">Point</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2j</span><span class="s2">]))</span>
        <span class="s6"># Issue #1638: tuples of different size.</span>
        <span class="s6"># Note the check is really on the tuple side.</span>
        <span class="s1">lst </span><span class="s2">= [(</span><span class="s5">1</span><span class="s2">,), (</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)]</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">cfunc</span><span class="s2">(</span><span class="s1">lst</span><span class="s2">)</span>
        <span class="s1">msg </span><span class="s2">= (</span><span class="s3">&quot;can't unbox heterogeneous list: &quot;</span>
                <span class="s3">&quot;UniTuple({0} x 1) != UniTuple({0} x 2)&quot;</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">), </span><span class="s1">msg</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">intp</span><span class="s2">))</span>



<span class="s0">class </span><span class="s1">TestListReflection</span><span class="s2">(</span><span class="s1">MemoryLeakMixin</span><span class="s2">, </span><span class="s1">TestCase</span><span class="s2">):</span>
    <span class="s4">&quot;&quot;&quot; 
    Test reflection of native Numba lists on Python list objects. 
    &quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">check_reflection</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">pyfunc</span><span class="s2">):</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">samples </span><span class="s2">= [([</span><span class="s5">1.</span><span class="s2">, </span><span class="s5">2.</span><span class="s2">, </span><span class="s5">3.</span><span class="s2">, </span><span class="s5">4.</span><span class="s2">], [</span><span class="s5">0.</span><span class="s2">]),</span>
                   <span class="s2">([</span><span class="s5">1.</span><span class="s2">, </span><span class="s5">2.</span><span class="s2">, </span><span class="s5">3.</span><span class="s2">, </span><span class="s5">4.</span><span class="s2">], [</span><span class="s5">5.</span><span class="s2">, </span><span class="s5">6.</span><span class="s2">, </span><span class="s5">7.</span><span class="s2">, </span><span class="s5">8.</span><span class="s2">, </span><span class="s5">9.</span><span class="s2">]),</span>
                   <span class="s2">]</span>
        <span class="s0">for </span><span class="s1">dest</span><span class="s2">, </span><span class="s1">src </span><span class="s0">in </span><span class="s1">samples</span><span class="s2">:</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">dest</span><span class="s2">)</span>
            <span class="s1">got </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">dest</span><span class="s2">)</span>
            <span class="s1">pyres </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">src</span><span class="s2">)</span>
            <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRefCount</span><span class="s2">(</span><span class="s1">got</span><span class="s2">, </span><span class="s1">src</span><span class="s2">):</span>
                <span class="s1">cres </span><span class="s2">= </span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">got</span><span class="s2">, </span><span class="s1">src</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cres</span><span class="s2">, </span><span class="s1">pyres</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">got</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">pyres</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] </span><span class="s0">is </span><span class="s1">expected</span><span class="s2">, </span><span class="s1">cres</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] </span><span class="s0">is </span><span class="s1">got</span><span class="s2">)</span>
                <span class="s0">del </span><span class="s1">pyres</span><span class="s2">, </span><span class="s1">cres</span>

    <span class="s0">def </span><span class="s1">test_reflect_simple</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_reflection</span><span class="s2">(</span><span class="s1">reflect_simple</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_reflect_conditional</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_reflection</span><span class="s2">(</span><span class="s1">reflect_conditional</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_reflect_exception</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">&quot;&quot;&quot; 
        When the function exits with an exception, lists should still be 
        reflected. 
        &quot;&quot;&quot;</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">reflect_exception</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">l </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRefCount</span><span class="s2">(</span><span class="s1">l</span><span class="s2">):</span>
            <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">ZeroDivisionError</span><span class="s2">):</span>
                <span class="s1">cfunc</span><span class="s2">(</span><span class="s1">l</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">l</span><span class="s2">, [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">42</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">test_reflect_same_list</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">&quot;&quot;&quot; 
        When the same list object is reflected twice, behaviour should 
        be consistent. 
        &quot;&quot;&quot;</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">reflect_dual</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">pylist </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]</span>
        <span class="s1">clist </span><span class="s2">= </span><span class="s1">pylist</span><span class="s2">[:]</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">pylist</span><span class="s2">, </span><span class="s1">pylist</span><span class="s2">)</span>
        <span class="s1">got </span><span class="s2">= </span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">clist</span><span class="s2">, </span><span class="s1">clist</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">got</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">pylist</span><span class="s2">, </span><span class="s1">clist</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertRefCountEqual</span><span class="s2">(</span><span class="s1">pylist</span><span class="s2">, </span><span class="s1">clist</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_reflect_clean</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">&quot;&quot;&quot; 
        When the list wasn't mutated, no reflection should take place. 
        &quot;&quot;&quot;</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">noop</span><span class="s2">)</span>
        <span class="s6"># Use a complex, as Python integers can be cached</span>
        <span class="s1">l </span><span class="s2">= [</span><span class="s5">12.5j</span><span class="s2">]</span>
        <span class="s1">ids </span><span class="s2">= [</span><span class="s1">id</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">l</span><span class="s2">]</span>
        <span class="s1">cfunc</span><span class="s2">(</span><span class="s1">l</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">([</span><span class="s1">id</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">l</span><span class="s2">], </span><span class="s1">ids</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">ManagedListTestCase</span><span class="s2">(</span><span class="s1">MemoryLeakMixin</span><span class="s2">, </span><span class="s1">TestCase</span><span class="s2">):</span>

    <span class="s0">def </span><span class="s1">assert_list_element_precise_equal</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">expect</span><span class="s2">, </span><span class="s1">got</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">expect</span><span class="s2">), </span><span class="s1">len</span><span class="s2">(</span><span class="s1">got</span><span class="s2">))</span>
        <span class="s0">for </span><span class="s1">a</span><span class="s2">, </span><span class="s1">b </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">expect</span><span class="s2">, </span><span class="s1">got</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestListManagedElements</span><span class="s2">(</span><span class="s1">ManagedListTestCase</span><span class="s2">):</span>
    <span class="s4">&quot;Test list containing objects that need refct&quot;</span>

    <span class="s0">def </span><span class="s1">_check_element_equal</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">pyfunc</span><span class="s2">):</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">con </span><span class="s2">= [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">3</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">intp</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">5</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">intp</span><span class="s2">)]</span>
        <span class="s1">expect </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">con</span><span class="s2">)</span>
        <span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">expect</span><span class="s2">)</span>
        <span class="s1">got </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">con</span><span class="s2">)</span>
        <span class="s1">cfunc</span><span class="s2">(</span><span class="s1">got</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assert_list_element_precise_equal</span><span class="s2">(</span>
            <span class="s1">expect</span><span class="s2">=</span><span class="s1">expect</span><span class="s2">, </span><span class="s1">got</span><span class="s2">=</span><span class="s1">got</span>
            <span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_reflect_passthru</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">con</span><span class="s2">):</span>
            <span class="s0">pass</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_check_element_equal</span><span class="s2">(</span><span class="s1">pyfunc</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_reflect_appended</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">con</span><span class="s2">):</span>
            <span class="s1">con</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">10</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">intp</span><span class="s2">))</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">_check_element_equal</span><span class="s2">(</span><span class="s1">pyfunc</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_reflect_setitem</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">con</span><span class="s2">):</span>
            <span class="s1">con</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">10</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">_check_element_equal</span><span class="s2">(</span><span class="s1">pyfunc</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_reflect_popped</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">con</span><span class="s2">):</span>
            <span class="s1">con</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">()</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">_check_element_equal</span><span class="s2">(</span><span class="s1">pyfunc</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_reflect_insert</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">&quot;&quot;&quot;make sure list.insert() doesn't crash for refcounted objects (see #7553) 
        &quot;&quot;&quot;</span>

        <span class="s0">def </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">con</span><span class="s2">):</span>
            <span class="s1">con</span><span class="s2">.</span><span class="s1">insert</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">4</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">intp</span><span class="s2">))</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">_check_element_equal</span><span class="s2">(</span><span class="s1">pyfunc</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_append</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">pyfunc</span><span class="s2">():</span>
            <span class="s1">con </span><span class="s2">= []</span>
            <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">300</span><span class="s2">):</span>
                <span class="s1">con</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s1">i</span><span class="s2">, ).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">intp</span><span class="s2">))</span>
            <span class="s0">return </span><span class="s1">con</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">expect </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">()</span>
        <span class="s1">got </span><span class="s2">= </span><span class="s1">cfunc</span><span class="s2">()</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assert_list_element_precise_equal</span><span class="s2">(</span>
            <span class="s1">expect</span><span class="s2">=</span><span class="s1">expect</span><span class="s2">, </span><span class="s1">got</span><span class="s2">=</span><span class="s1">got</span>
            <span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_append_noret</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6"># This test make sure local dtor works</span>
        <span class="s0">def </span><span class="s1">pyfunc</span><span class="s2">():</span>
            <span class="s1">con </span><span class="s2">= []</span>
            <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">300</span><span class="s2">):</span>
                <span class="s1">con</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s1">i</span><span class="s2">))</span>
            <span class="s1">c </span><span class="s2">= </span><span class="s5">0.0</span>
            <span class="s0">for </span><span class="s1">arr </span><span class="s0">in </span><span class="s1">con</span><span class="s2">:</span>
                <span class="s1">c </span><span class="s2">+= </span><span class="s1">arr</span><span class="s2">.</span><span class="s1">sum</span><span class="s2">() / (</span><span class="s5">1 </span><span class="s2">+ </span><span class="s1">arr</span><span class="s2">.</span><span class="s1">size</span><span class="s2">)</span>
            <span class="s0">return </span><span class="s1">c</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">expect </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">()</span>
        <span class="s1">got </span><span class="s2">= </span><span class="s1">cfunc</span><span class="s2">()</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">expect</span><span class="s2">, </span><span class="s1">got</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_reassign_refct</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">pyfunc</span><span class="s2">():</span>
            <span class="s1">con </span><span class="s2">= []</span>
            <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">5</span><span class="s2">):</span>
                <span class="s1">con</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">2</span><span class="s2">))</span>
            <span class="s1">con</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">4</span><span class="s2">)</span>
            <span class="s0">return </span><span class="s1">con</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">expect </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">()</span>
        <span class="s1">got </span><span class="s2">= </span><span class="s1">cfunc</span><span class="s2">()</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assert_list_element_precise_equal</span><span class="s2">(</span>
            <span class="s1">expect</span><span class="s2">=</span><span class="s1">expect</span><span class="s2">, </span><span class="s1">got</span><span class="s2">=</span><span class="s1">got</span>
            <span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_get_slice</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">pyfunc</span><span class="s2">():</span>
            <span class="s1">con </span><span class="s2">= []</span>
            <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">5</span><span class="s2">):</span>
                <span class="s1">con</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">2</span><span class="s2">))</span>
            <span class="s0">return </span><span class="s1">con</span><span class="s2">[</span><span class="s5">2</span><span class="s2">:</span><span class="s5">4</span><span class="s2">]</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">expect </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">()</span>
        <span class="s1">got </span><span class="s2">= </span><span class="s1">cfunc</span><span class="s2">()</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assert_list_element_precise_equal</span><span class="s2">(</span>
            <span class="s1">expect</span><span class="s2">=</span><span class="s1">expect</span><span class="s2">, </span><span class="s1">got</span><span class="s2">=</span><span class="s1">got</span>
            <span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_set_slice</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">pyfunc</span><span class="s2">():</span>
            <span class="s1">con </span><span class="s2">= []</span>
            <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">5</span><span class="s2">):</span>
                <span class="s1">con</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">2</span><span class="s2">))</span>
            <span class="s1">con</span><span class="s2">[</span><span class="s5">1</span><span class="s2">:</span><span class="s5">3</span><span class="s2">] = </span><span class="s1">con</span><span class="s2">[</span><span class="s5">2</span><span class="s2">:</span><span class="s5">4</span><span class="s2">]</span>
            <span class="s0">return </span><span class="s1">con</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">expect </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">()</span>
        <span class="s1">got </span><span class="s2">= </span><span class="s1">cfunc</span><span class="s2">()</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assert_list_element_precise_equal</span><span class="s2">(</span>
            <span class="s1">expect</span><span class="s2">=</span><span class="s1">expect</span><span class="s2">, </span><span class="s1">got</span><span class="s2">=</span><span class="s1">got</span>
            <span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_pop</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">pyfunc</span><span class="s2">():</span>
            <span class="s1">con </span><span class="s2">= []</span>
            <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">20</span><span class="s2">):</span>
                <span class="s1">con</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s1">i </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">))</span>
            <span class="s0">while </span><span class="s1">len</span><span class="s2">(</span><span class="s1">con</span><span class="s2">) &gt; </span><span class="s5">2</span><span class="s2">:</span>
                <span class="s1">con</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">()</span>
            <span class="s0">return </span><span class="s1">con</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">expect </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">()</span>
        <span class="s1">got </span><span class="s2">= </span><span class="s1">cfunc</span><span class="s2">()</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assert_list_element_precise_equal</span><span class="s2">(</span>
            <span class="s1">expect</span><span class="s2">=</span><span class="s1">expect</span><span class="s2">, </span><span class="s1">got</span><span class="s2">=</span><span class="s1">got</span>
            <span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_pop_loc</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">pyfunc</span><span class="s2">():</span>
            <span class="s1">con </span><span class="s2">= []</span>
            <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">1000</span><span class="s2">):</span>
                <span class="s1">con</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s1">i </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">))</span>
            <span class="s0">while </span><span class="s1">len</span><span class="s2">(</span><span class="s1">con</span><span class="s2">) &gt; </span><span class="s5">2</span><span class="s2">:</span>
                <span class="s1">con</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">(</span><span class="s5">1</span><span class="s2">)</span>
            <span class="s0">return </span><span class="s1">con</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">expect </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">()</span>
        <span class="s1">got </span><span class="s2">= </span><span class="s1">cfunc</span><span class="s2">()</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assert_list_element_precise_equal</span><span class="s2">(</span>
            <span class="s1">expect</span><span class="s2">=</span><span class="s1">expect</span><span class="s2">, </span><span class="s1">got</span><span class="s2">=</span><span class="s1">got</span>
            <span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_del_range</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">pyfunc</span><span class="s2">():</span>
            <span class="s1">con </span><span class="s2">= []</span>
            <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">20</span><span class="s2">):</span>
                <span class="s1">con</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s1">i </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">))</span>
            <span class="s0">del </span><span class="s1">con</span><span class="s2">[</span><span class="s5">3</span><span class="s2">:</span><span class="s5">10</span><span class="s2">]</span>
            <span class="s0">return </span><span class="s1">con</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">expect </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">()</span>
        <span class="s1">got </span><span class="s2">= </span><span class="s1">cfunc</span><span class="s2">()</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assert_list_element_precise_equal</span><span class="s2">(</span>
            <span class="s1">expect</span><span class="s2">=</span><span class="s1">expect</span><span class="s2">, </span><span class="s1">got</span><span class="s2">=</span><span class="s1">got</span>
            <span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_list_of_list</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">pyfunc</span><span class="s2">():</span>
            <span class="s1">con </span><span class="s2">= []</span>
            <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">10</span><span class="s2">):</span>
                <span class="s1">con</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s5">0</span><span class="s2">] * </span><span class="s1">i</span><span class="s2">)</span>
            <span class="s0">return </span><span class="s1">con</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">expect </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">()</span>
        <span class="s1">got </span><span class="s2">= </span><span class="s1">cfunc</span><span class="s2">()</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">expect</span><span class="s2">, </span><span class="s1">got</span><span class="s2">)</span>



<span class="s0">def </span><span class="s1">expect_reflection_failure</span><span class="s2">(</span><span class="s1">fn</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">wrapped</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">disable_leak_check</span><span class="s2">()</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">fn</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>
        <span class="s1">expect_msg </span><span class="s2">= </span><span class="s3">'cannot reflect element of reflected container'</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s1">expect_msg</span><span class="s2">, </span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">))</span>

    <span class="s0">return </span><span class="s1">wrapped</span>


<span class="s0">class </span><span class="s1">TestListOfList</span><span class="s2">(</span><span class="s1">ManagedListTestCase</span><span class="s2">):</span>

    <span class="s0">def </span><span class="s1">compile_and_test</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">pyfunc</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">):</span>
        <span class="s0">from </span><span class="s1">copy </span><span class="s0">import </span><span class="s1">deepcopy</span>
        <span class="s1">expect_args </span><span class="s2">= </span><span class="s1">deepcopy</span><span class="s2">(</span><span class="s1">args</span><span class="s2">)</span>
        <span class="s1">expect </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">(*</span><span class="s1">expect_args</span><span class="s2">)</span>

        <span class="s1">njit_args </span><span class="s2">= </span><span class="s1">deepcopy</span><span class="s2">(</span><span class="s1">args</span><span class="s2">)</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">got </span><span class="s2">= </span><span class="s1">cfunc</span><span class="s2">(*</span><span class="s1">njit_args</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assert_list_element_precise_equal</span><span class="s2">(</span>
            <span class="s1">expect</span><span class="s2">=</span><span class="s1">expect</span><span class="s2">, </span><span class="s1">got</span><span class="s2">=</span><span class="s1">got</span>
            <span class="s2">)</span>
        <span class="s6"># Check reflection</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assert_list_element_precise_equal</span><span class="s2">(</span>
            <span class="s1">expect</span><span class="s2">=</span><span class="s1">expect_args</span><span class="s2">, </span><span class="s1">got</span><span class="s2">=</span><span class="s1">njit_args</span>
            <span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_returning_list_of_list</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">pyfunc</span><span class="s2">():</span>
            <span class="s1">a </span><span class="s2">= [[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s1">i</span><span class="s2">)] </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">)]</span>
            <span class="s0">return </span><span class="s1">a</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">compile_and_test</span><span class="s2">(</span><span class="s1">pyfunc</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">expect_reflection_failure</span>
    <span class="s0">def </span><span class="s1">test_heterogeneous_list_error</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s1">x</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">l2 </span><span class="s2">= [[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s1">i</span><span class="s2">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">5</span><span class="s2">)],</span>
              <span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s1">i</span><span class="s2">)+</span><span class="s5">1j </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">5</span><span class="s2">)]]</span>
        <span class="s1">l3 </span><span class="s2">= [[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s1">i</span><span class="s2">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">5</span><span class="s2">)], [(</span><span class="s5">1</span><span class="s2">,)]]</span>
        <span class="s1">l4 </span><span class="s2">= [[</span><span class="s5">1</span><span class="s2">], [{</span><span class="s5">1</span><span class="s2">}]]</span>
        <span class="s1">l5 </span><span class="s2">= [[</span><span class="s5">1</span><span class="s2">], [{</span><span class="s3">'a'</span><span class="s2">: </span><span class="s5">1</span><span class="s2">}]]</span>

        <span class="s6"># TODO: this triggers a reflection error.</span>
        <span class="s6"># Remove this line when nested reflection is supported</span>
        <span class="s1">cfunc</span><span class="s2">(</span><span class="s1">l2</span><span class="s2">)</span>

        <span class="s6"># error_cases</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">cfunc</span><span class="s2">(</span><span class="s1">l2</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span>
            <span class="s2">(</span><span class="s3">&quot;reflected list(array(float64, 1d, C)) != &quot;</span>
             <span class="s3">&quot;reflected list(array(complex128, 1d, C))&quot;</span><span class="s2">),</span>
            <span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">)</span>
            <span class="s2">)</span>

        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">cfunc</span><span class="s2">(</span><span class="s1">l3</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span>
            <span class="s2">(</span><span class="s3">&quot;reflected list(array(float64, 1d, C)) != &quot;</span>
             <span class="s3">&quot;reflected list((int64 x 1))&quot;</span><span class="s2">),</span>
            <span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">)</span>
            <span class="s2">)</span>

        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">cfunc</span><span class="s2">(</span><span class="s1">l4</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span>
            <span class="s3">&quot;reflected list(int64) != reflected list(reflected set(int64))&quot;</span><span class="s2">,</span>
            <span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">)</span>
            <span class="s2">)</span>

        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">cfunc</span><span class="s2">(</span><span class="s1">l5</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span>
            <span class="s3">&quot;Cannot type list element of &lt;class 'dict'&gt;&quot;</span><span class="s2">,</span>
            <span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">)</span>
            <span class="s2">)</span>

    <span class="s2">@</span><span class="s1">expect_reflection_failure</span>
    <span class="s0">def </span><span class="s1">test_list_of_list_reflected</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">l1</span><span class="s2">, </span><span class="s1">l2</span><span class="s2">):</span>
            <span class="s1">l1</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">l2</span><span class="s2">)</span>
            <span class="s1">l1</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">].</span><span class="s1">append</span><span class="s2">(</span><span class="s5">123</span><span class="s2">)</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">l1 </span><span class="s2">= [[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]]</span>
        <span class="s1">l2 </span><span class="s2">= [</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">]</span>
        <span class="s1">expect </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">l1</span><span class="s2">), </span><span class="s1">list</span><span class="s2">(</span><span class="s1">l2</span><span class="s2">)</span>
        <span class="s1">got </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">l1</span><span class="s2">), </span><span class="s1">list</span><span class="s2">(</span><span class="s1">l2</span><span class="s2">)</span>
        <span class="s1">pyfunc</span><span class="s2">(*</span><span class="s1">expect</span><span class="s2">)</span>
        <span class="s1">cfunc</span><span class="s2">(*</span><span class="s1">got</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">expect</span><span class="s2">, </span><span class="s1">got</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">expect_reflection_failure</span>
    <span class="s0">def </span><span class="s1">test_heterogeneous_list</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s1">x</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]</span>

        <span class="s1">l1 </span><span class="s2">= [[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s1">i</span><span class="s2">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">5</span><span class="s2">)], [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s1">i</span><span class="s2">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">5</span><span class="s2">)]]</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">l1_got </span><span class="s2">= </span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">l1</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">l1</span><span class="s2">), </span><span class="s1">l1_got</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">expect_reflection_failure</span>
    <span class="s0">def </span><span class="s1">test_c01</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">bar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s1">x</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">()</span>

        <span class="s1">r </span><span class="s2">= [[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)], [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s5">10</span><span class="s2">)*</span><span class="s5">1j</span><span class="s2">]]</span>
        <span class="s6"># TODO: this triggers a reflection error.</span>
        <span class="s6"># Remove this line when nested reflection is supported</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">compile_and_test</span><span class="s2">(</span><span class="s1">bar</span><span class="s2">, </span><span class="s1">r</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">compile_and_test</span><span class="s2">(</span><span class="s1">bar</span><span class="s2">, </span><span class="s1">r</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span>
            <span class="s2">(</span><span class="s3">&quot;reflected list(array(float64, 1d, C)) != &quot;</span>
             <span class="s3">&quot;reflected list(array(complex128, 1d, C))&quot;</span><span class="s2">),</span>
            <span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">),</span>
            <span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_c02</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">bar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s1">x</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>
            <span class="s0">return </span><span class="s1">x</span>

        <span class="s1">r </span><span class="s2">= [[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)]]</span>

        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">.</span><span class="s1">TypingError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">compile_and_test</span><span class="s2">(</span><span class="s1">bar</span><span class="s2">, </span><span class="s1">r</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span>
            <span class="s3">&quot;Invalid use of BoundFunction(list.append&quot;</span><span class="s2">,</span>
            <span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">),</span>
            <span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_c03</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">bar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s1">f </span><span class="s2">= </span><span class="s1">x</span>
            <span class="s1">f</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] = </span><span class="s5">1</span>
            <span class="s0">return </span><span class="s1">f</span>

        <span class="s1">r </span><span class="s2">= [[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">3</span><span class="s2">)]]</span>

        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">.</span><span class="s1">TypingError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">compile_and_test</span><span class="s2">(</span><span class="s1">bar</span><span class="s2">, </span><span class="s1">r</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span>
            <span class="s3">&quot;invalid setitem with value of {} to element of {}&quot;</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span>
                <span class="s1">typeof</span><span class="s2">(</span><span class="s5">1</span><span class="s2">),</span>
                <span class="s1">typeof</span><span class="s2">(</span><span class="s1">r</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]),</span>
                <span class="s2">),</span>
            <span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">),</span>
        <span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_c04</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">bar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s1">f </span><span class="s2">= </span><span class="s1">x</span>
            <span class="s1">f</span><span class="s2">[</span><span class="s5">0</span><span class="s2">][</span><span class="s5">0</span><span class="s2">] = </span><span class="s5">10</span>
            <span class="s0">return </span><span class="s1">f</span>

        <span class="s1">r </span><span class="s2">= [[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">3</span><span class="s2">)]]</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">.</span><span class="s1">TypingError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">compile_and_test</span><span class="s2">(</span><span class="s1">bar</span><span class="s2">, </span><span class="s1">r</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span>
            <span class="s3">&quot;invalid setitem with value of {} to element of {}&quot;</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span>
                <span class="s1">typeof</span><span class="s2">(</span><span class="s5">10</span><span class="s2">),</span>
                <span class="s1">typeof</span><span class="s2">(</span><span class="s1">r</span><span class="s2">[</span><span class="s5">0</span><span class="s2">][</span><span class="s5">0</span><span class="s2">]),</span>
                <span class="s2">),</span>
            <span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">),</span>
            <span class="s2">)</span>

    <span class="s2">@</span><span class="s1">expect_reflection_failure</span>
    <span class="s0">def </span><span class="s1">test_c05</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">bar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s1">f </span><span class="s2">= </span><span class="s1">x</span>
            <span class="s1">f</span><span class="s2">[</span><span class="s5">0</span><span class="s2">][</span><span class="s5">0</span><span class="s2">] = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">x </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">10</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">intp</span><span class="s2">)])</span>
            <span class="s0">return </span><span class="s1">f</span>

        <span class="s1">r </span><span class="s2">= [[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">3</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">intp</span><span class="s2">)]]</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">compile_and_test</span><span class="s2">(</span><span class="s1">bar</span><span class="s2">, </span><span class="s1">r</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_c06</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">bar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s1">f </span><span class="s2">= </span><span class="s1">x</span>
            <span class="s1">f</span><span class="s2">[</span><span class="s5">0</span><span class="s2">][</span><span class="s5">0</span><span class="s2">] = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">x </span><span class="s2">+ </span><span class="s5">1j </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">10</span><span class="s2">)])</span>
            <span class="s0">return </span><span class="s1">f</span>

        <span class="s1">r </span><span class="s2">= [[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">3</span><span class="s2">)]]</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">.</span><span class="s1">TypingError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">compile_and_test</span><span class="s2">(</span><span class="s1">bar</span><span class="s2">, </span><span class="s1">r</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s3">&quot;invalid setitem with value&quot;</span><span class="s2">, </span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">))</span>

    <span class="s2">@</span><span class="s1">expect_reflection_failure</span>
    <span class="s0">def </span><span class="s1">test_c07</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">disable_leak_check</span><span class="s2">()</span>

        <span class="s0">def </span><span class="s1">bar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s1">x</span><span class="s2">[-</span><span class="s5">7</span><span class="s2">]</span>

        <span class="s1">r </span><span class="s2">= [[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">3</span><span class="s2">)]]</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">bar</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">IndexError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">cfunc</span><span class="s2">(</span><span class="s1">r</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s3">&quot;getitem out of range&quot;</span><span class="s2">, </span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_c08</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">disable_leak_check</span><span class="s2">()</span>

        <span class="s0">def </span><span class="s1">bar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s1">x</span><span class="s2">[</span><span class="s5">5</span><span class="s2">] = </span><span class="s5">7</span>
            <span class="s0">return </span><span class="s1">x</span>

        <span class="s1">r </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">bar</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">IndexError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">cfunc</span><span class="s2">(</span><span class="s1">r</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s3">&quot;setitem out of range&quot;</span><span class="s2">, </span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_c09</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">bar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s1">x</span><span class="s2">[-</span><span class="s5">2</span><span class="s2">] = </span><span class="s5">7j</span>
            <span class="s0">return </span><span class="s1">x</span>

        <span class="s1">r </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">.</span><span class="s1">TypingError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">compile_and_test</span><span class="s2">(</span><span class="s1">bar</span><span class="s2">, </span><span class="s1">r</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s3">&quot;invalid setitem with value&quot;</span><span class="s2">, </span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">))</span>

    <span class="s2">@</span><span class="s1">expect_reflection_failure</span>
    <span class="s0">def </span><span class="s1">test_c10</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">bar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s1">x</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">x</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] = </span><span class="s1">x</span><span class="s2">[</span><span class="s5">1</span><span class="s2">], </span><span class="s1">x</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]</span>
            <span class="s0">return </span><span class="s1">x</span>

        <span class="s1">r </span><span class="s2">= [[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">]]</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">compile_and_test</span><span class="s2">(</span><span class="s1">bar</span><span class="s2">, </span><span class="s1">r</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">expect_reflection_failure</span>
    <span class="s0">def </span><span class="s1">test_c11</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">bar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s1">x</span><span class="s2">[:] = </span><span class="s1">x</span><span class="s2">[::-</span><span class="s5">1</span><span class="s2">]</span>
            <span class="s0">return </span><span class="s1">x</span>

        <span class="s1">r </span><span class="s2">= [[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">]]</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">compile_and_test</span><span class="s2">(</span><span class="s1">bar</span><span class="s2">, </span><span class="s1">r</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_c12</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">bar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s0">del </span><span class="s1">x</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">]</span>
            <span class="s0">return </span><span class="s1">x</span>

        <span class="s1">r </span><span class="s2">= [</span><span class="s1">x </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">10</span><span class="s2">)]</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">compile_and_test</span><span class="s2">(</span><span class="s1">bar</span><span class="s2">, </span><span class="s1">r</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">Item</span><span class="s2">(</span><span class="s1">object</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">many</span><span class="s2">, </span><span class="s1">scalar</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">many </span><span class="s2">= </span><span class="s1">many</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">scalar </span><span class="s2">= </span><span class="s1">scalar</span>


<span class="s0">class </span><span class="s1">Container</span><span class="s2">(</span><span class="s1">object</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">n</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">data </span><span class="s2">= [[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s1">i</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)] </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">)]</span>

    <span class="s0">def </span><span class="s1">more</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">n</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">data</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s1">i</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)])</span>


<span class="s0">class </span><span class="s1">TestListAndJitClasses</span><span class="s2">(</span><span class="s1">ManagedListTestCase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">make_jitclass_element</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">spec </span><span class="s2">= [</span>
            <span class="s2">(</span><span class="s3">'many'</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">[:]),</span>
            <span class="s2">(</span><span class="s3">'scalar'</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">),</span>
        <span class="s2">]</span>
        <span class="s1">JCItem </span><span class="s2">= </span><span class="s1">jitclass</span><span class="s2">(</span><span class="s1">spec</span><span class="s2">)(</span><span class="s1">Item</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">JCItem</span>

    <span class="s0">def </span><span class="s1">make_jitclass_container</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">spec </span><span class="s2">= {</span>
            <span class="s3">'data'</span><span class="s2">: </span><span class="s1">types</span><span class="s2">.</span><span class="s1">List</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">types</span><span class="s2">.</span><span class="s1">List</span><span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">[::</span><span class="s5">1</span><span class="s2">])),</span>
        <span class="s2">}</span>
        <span class="s1">JCContainer </span><span class="s2">= </span><span class="s1">jitclass</span><span class="s2">(</span><span class="s1">spec</span><span class="s2">)(</span><span class="s1">Container</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">JCContainer</span>

    <span class="s0">def </span><span class="s1">assert_list_element_with_tester</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">tester</span><span class="s2">, </span><span class="s1">expect</span><span class="s2">, </span><span class="s1">got</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">expect</span><span class="s2">, </span><span class="s1">got</span><span class="s2">):</span>
            <span class="s1">tester</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_jitclass_instance_elements</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">JCItem </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">make_jitclass_element</span><span class="s2">()</span>

        <span class="s0">def </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">xs</span><span class="s2">):</span>
            <span class="s1">xs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">], </span><span class="s1">xs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] = </span><span class="s1">xs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">xs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]</span>
            <span class="s0">return </span><span class="s1">xs</span>

        <span class="s0">def </span><span class="s1">eq</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">x</span><span class="s2">.</span><span class="s1">many</span><span class="s2">, </span><span class="s1">y</span><span class="s2">.</span><span class="s1">many</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">x</span><span class="s2">.</span><span class="s1">scalar</span><span class="s2">, </span><span class="s1">y</span><span class="s2">.</span><span class="s1">scalar</span><span class="s2">)</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>

        <span class="s1">arg </span><span class="s2">= [</span><span class="s1">JCItem</span><span class="s2">(</span><span class="s1">many</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">random</span><span class="s2">(</span><span class="s1">n </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">), </span><span class="s1">scalar</span><span class="s2">=</span><span class="s1">n </span><span class="s2">* </span><span class="s5">1.2</span><span class="s2">)</span>
               <span class="s0">for </span><span class="s1">n </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">5</span><span class="s2">)]</span>

        <span class="s1">expect_arg </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">)</span>
        <span class="s1">got_arg </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">)</span>

        <span class="s1">expect_res </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">expect_arg</span><span class="s2">)</span>
        <span class="s1">got_res </span><span class="s2">= </span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">got_arg</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assert_list_element_with_tester</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">, </span><span class="s1">expect_arg</span><span class="s2">, </span><span class="s1">got_arg</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assert_list_element_with_tester</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">, </span><span class="s1">expect_res</span><span class="s2">, </span><span class="s1">got_res</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_jitclass_containing_list</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">JCContainer </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">make_jitclass_container</span><span class="s2">()</span>

        <span class="s1">expect </span><span class="s2">= </span><span class="s1">Container</span><span class="s2">(</span><span class="s1">n</span><span class="s2">=</span><span class="s5">4</span><span class="s2">)</span>
        <span class="s1">got </span><span class="s2">= </span><span class="s1">JCContainer</span><span class="s2">(</span><span class="s1">n</span><span class="s2">=</span><span class="s5">4</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assert_list_element_precise_equal</span><span class="s2">(</span><span class="s1">got</span><span class="s2">.</span><span class="s1">data</span><span class="s2">, </span><span class="s1">expect</span><span class="s2">.</span><span class="s1">data</span><span class="s2">)</span>
        <span class="s1">expect</span><span class="s2">.</span><span class="s1">more</span><span class="s2">(</span><span class="s5">3</span><span class="s2">)</span>
        <span class="s1">got</span><span class="s2">.</span><span class="s1">more</span><span class="s2">(</span><span class="s5">3</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assert_list_element_precise_equal</span><span class="s2">(</span><span class="s1">got</span><span class="s2">.</span><span class="s1">data</span><span class="s2">, </span><span class="s1">expect</span><span class="s2">.</span><span class="s1">data</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestListInitialValues</span><span class="s2">(</span><span class="s1">MemoryLeakMixin</span><span class="s2">, </span><span class="s1">TestCase</span><span class="s2">):</span>
    <span class="s4">&quot;&quot;&quot;Tests that lists carry their initial value if present&quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">test_homogeneous_and_literal</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">bar</span><span class="s2">(</span><span class="s1">l</span><span class="s2">):</span>
            <span class="s2">...</span>

        <span class="s2">@</span><span class="s1">overload</span><span class="s2">(</span><span class="s1">bar</span><span class="s2">)</span>
        <span class="s0">def </span><span class="s1">ol_bar</span><span class="s2">(</span><span class="s1">l</span><span class="s2">):</span>
            <span class="s0">if </span><span class="s1">l</span><span class="s2">.</span><span class="s1">initial_value </span><span class="s0">is None</span><span class="s2">:</span>
                <span class="s0">return lambda </span><span class="s1">l</span><span class="s2">: </span><span class="s1">literally</span><span class="s2">(</span><span class="s1">l</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">l</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">List</span><span class="s2">))</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">l</span><span class="s2">.</span><span class="s1">initial_value</span><span class="s2">, [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">])</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">l</span><span class="s2">, </span><span class="s3">'literal_value'</span><span class="s2">), </span><span class="s0">False</span><span class="s2">)</span>
            <span class="s0">return lambda </span><span class="s1">l</span><span class="s2">: </span><span class="s1">l</span>

        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">():</span>
            <span class="s6"># keys and values all have literal representation</span>
            <span class="s1">x </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]</span>
            <span class="s1">bar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>

        <span class="s1">foo</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">test_heterogeneous_but_castable_to_homogeneous</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">bar</span><span class="s2">(</span><span class="s1">l</span><span class="s2">):</span>
            <span class="s2">...</span>

        <span class="s2">@</span><span class="s1">overload</span><span class="s2">(</span><span class="s1">bar</span><span class="s2">)</span>
        <span class="s0">def </span><span class="s1">ol_bar</span><span class="s2">(</span><span class="s1">l</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">l</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">List</span><span class="s2">))</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">l</span><span class="s2">.</span><span class="s1">initial_value</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">l</span><span class="s2">, </span><span class="s3">'literal_value'</span><span class="s2">), </span><span class="s0">False</span><span class="s2">)</span>
            <span class="s0">return lambda </span><span class="s1">l</span><span class="s2">: </span><span class="s1">l</span>

        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">():</span>
            <span class="s6"># This list will be typed based on 1j, i.e. complex128</span>
            <span class="s6"># as the values are not all literals, there's no &quot;initial_value&quot;</span>
            <span class="s6"># available irrespective of whether it's possible to rip this</span>
            <span class="s6"># information out of the bytecode.</span>
            <span class="s1">x </span><span class="s2">= [</span><span class="s5">1j</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]</span>
            <span class="s1">bar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>

        <span class="s1">foo</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">test_mutation_not_carried</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">bar</span><span class="s2">(</span><span class="s1">d</span><span class="s2">):</span>
            <span class="s2">...</span>

        <span class="s2">@</span><span class="s1">overload</span><span class="s2">(</span><span class="s1">bar</span><span class="s2">)</span>
        <span class="s0">def </span><span class="s1">ol_bar</span><span class="s2">(</span><span class="s1">d</span><span class="s2">):</span>
            <span class="s0">if </span><span class="s1">d</span><span class="s2">.</span><span class="s1">initial_value </span><span class="s0">is None</span><span class="s2">:</span>
                <span class="s0">return lambda </span><span class="s1">d</span><span class="s2">: </span><span class="s1">literally</span><span class="s2">(</span><span class="s1">d</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">d</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">List</span><span class="s2">))</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">d</span><span class="s2">.</span><span class="s1">initial_value</span><span class="s2">, [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">])</span>
            <span class="s0">return lambda </span><span class="s1">d</span><span class="s2">: </span><span class="s1">d</span>

        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">():</span>
            <span class="s6"># This list is mutated, check the initial_value carries</span>
            <span class="s6"># correctly and is not mutated</span>
            <span class="s1">x </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]</span>
            <span class="s1">x</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s5">4</span><span class="s2">)</span>
            <span class="s1">bar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>

        <span class="s1">foo</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">test_mutation_not_carried_single_function</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6"># this is another pattern for using literally</span>

        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">nop</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">):</span>
            <span class="s0">pass</span>

        <span class="s0">for </span><span class="s1">fn</span><span class="s2">, </span><span class="s1">iv </span><span class="s0">in </span><span class="s2">(</span><span class="s1">nop</span><span class="s2">, </span><span class="s0">None</span><span class="s2">), (</span><span class="s1">literally</span><span class="s2">, [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]):</span>
            <span class="s2">@</span><span class="s1">njit</span>
            <span class="s0">def </span><span class="s1">baz</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
                <span class="s0">pass</span>

            <span class="s0">def </span><span class="s1">bar</span><span class="s2">(</span><span class="s1">z</span><span class="s2">):</span>
                <span class="s0">pass</span>

            <span class="s2">@</span><span class="s1">overload</span><span class="s2">(</span><span class="s1">bar</span><span class="s2">)</span>
            <span class="s0">def </span><span class="s1">ol_bar</span><span class="s2">(</span><span class="s1">z</span><span class="s2">):</span>
                <span class="s0">def </span><span class="s1">impl</span><span class="s2">(</span><span class="s1">z</span><span class="s2">):</span>
                    <span class="s1">fn</span><span class="s2">(</span><span class="s1">z</span><span class="s2">)</span>
                    <span class="s1">baz</span><span class="s2">(</span><span class="s1">z</span><span class="s2">)</span>
                <span class="s0">return </span><span class="s1">impl</span>

            <span class="s2">@</span><span class="s1">njit</span>
            <span class="s0">def </span><span class="s1">foo</span><span class="s2">():</span>
                <span class="s1">x </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]</span>
                <span class="s1">bar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>
                <span class="s1">x</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s5">2</span><span class="s2">)</span>
                <span class="s0">return </span><span class="s1">x</span>

            <span class="s1">foo</span><span class="s2">()</span>
            <span class="s6"># baz should be specialised based on literally being invoked and</span>
            <span class="s6"># the literal/unliteral arriving at the call site</span>
            <span class="s1">larg </span><span class="s2">= </span><span class="s1">baz</span><span class="s2">.</span><span class="s1">signatures</span><span class="s2">[</span><span class="s5">0</span><span class="s2">][</span><span class="s5">0</span><span class="s2">]</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">larg</span><span class="s2">.</span><span class="s1">initial_value</span><span class="s2">, </span><span class="s1">iv</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_list_of_list_ctor</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6"># see issue 6082</span>
        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">bar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s0">pass</span>

        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">():</span>
            <span class="s1">x </span><span class="s2">= [[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">6</span><span class="s2">]]</span>
            <span class="s1">bar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>

        <span class="s1">foo</span><span class="s2">()</span>
        <span class="s1">larg </span><span class="s2">= </span><span class="s1">bar</span><span class="s2">.</span><span class="s1">signatures</span><span class="s2">[</span><span class="s5">0</span><span class="s2">][</span><span class="s5">0</span><span class="s2">]</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">larg</span><span class="s2">.</span><span class="s1">initial_value</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">larg</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">initial_value</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestLiteralLists</span><span class="s2">(</span><span class="s1">MemoryLeakMixin</span><span class="s2">, </span><span class="s1">TestCase</span><span class="s2">):</span>

    <span class="s0">def </span><span class="s1">test_basic_compile</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">():</span>
            <span class="s1">l </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">, </span><span class="s3">'a'</span><span class="s2">]</span>

        <span class="s1">foo</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">test_literal_value_passthrough</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>

        <span class="s0">def </span><span class="s1">bar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s0">pass</span>

        <span class="s2">@</span><span class="s1">overload</span><span class="s2">(</span><span class="s1">bar</span><span class="s2">)</span>
        <span class="s0">def </span><span class="s1">ol_bar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">LiteralList</span><span class="s2">))</span>
            <span class="s1">lv </span><span class="s2">= </span><span class="s1">x</span><span class="s2">.</span><span class="s1">literal_value</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">lv</span><span class="s2">, </span><span class="s1">list</span><span class="s2">))</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">lv</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">types</span><span class="s2">.</span><span class="s1">literal</span><span class="s2">(</span><span class="s5">1</span><span class="s2">))</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">lv</span><span class="s2">[</span><span class="s5">1</span><span class="s2">], </span><span class="s1">types</span><span class="s2">.</span><span class="s1">literal</span><span class="s2">(</span><span class="s3">'a'</span><span class="s2">))</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">lv</span><span class="s2">[</span><span class="s5">2</span><span class="s2">], </span><span class="s1">types</span><span class="s2">.</span><span class="s1">Array</span><span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s3">'C'</span><span class="s2">))</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">lv</span><span class="s2">[</span><span class="s5">3</span><span class="s2">], </span><span class="s1">types</span><span class="s2">.</span><span class="s1">List</span><span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">intp</span><span class="s2">, </span><span class="s1">reflected</span><span class="s2">=</span><span class="s0">False</span><span class="s2">,</span>
                                               <span class="s1">initial_value</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]))</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">lv</span><span class="s2">[</span><span class="s5">4</span><span class="s2">], </span><span class="s1">types</span><span class="s2">.</span><span class="s1">LiteralList</span><span class="s2">))</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">lv</span><span class="s2">[</span><span class="s5">4</span><span class="s2">].</span><span class="s1">literal_value</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">types</span><span class="s2">.</span><span class="s1">literal</span><span class="s2">(</span><span class="s3">'cat'</span><span class="s2">))</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">lv</span><span class="s2">[</span><span class="s5">4</span><span class="s2">].</span><span class="s1">literal_value</span><span class="s2">[</span><span class="s5">1</span><span class="s2">], </span><span class="s1">types</span><span class="s2">.</span><span class="s1">literal</span><span class="s2">(</span><span class="s5">10</span><span class="s2">))</span>
            <span class="s0">return lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s1">x</span>

        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">():</span>
            <span class="s1">otherhomogeneouslist </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]</span>
            <span class="s1">otherheterogeneouslist </span><span class="s2">= [</span><span class="s3">'cat'</span><span class="s2">, </span><span class="s5">10</span><span class="s2">]</span>
            <span class="s1">zeros </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s5">5</span><span class="s2">)</span>
            <span class="s1">l </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">, </span><span class="s3">'a'</span><span class="s2">, </span><span class="s1">zeros</span><span class="s2">, </span><span class="s1">otherhomogeneouslist</span><span class="s2">, </span><span class="s1">otherheterogeneouslist</span><span class="s2">]</span>
            <span class="s1">bar</span><span class="s2">(</span><span class="s1">l</span><span class="s2">)</span>

        <span class="s1">foo</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">test_literal_value_involved_passthrough</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>

        <span class="s0">def </span><span class="s1">bar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s0">pass</span>

        <span class="s2">@</span><span class="s1">overload</span><span class="s2">(</span><span class="s1">bar</span><span class="s2">)</span>
        <span class="s0">def </span><span class="s1">ol_bar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">LiteralStrKeyDict</span><span class="s2">))</span>
            <span class="s1">dlv </span><span class="s2">= </span><span class="s1">x</span><span class="s2">.</span><span class="s1">literal_value</span>
            <span class="s1">inner_literal </span><span class="s2">= {</span><span class="s1">types</span><span class="s2">.</span><span class="s1">literal</span><span class="s2">(</span><span class="s3">'g'</span><span class="s2">): </span><span class="s1">types</span><span class="s2">.</span><span class="s1">literal</span><span class="s2">(</span><span class="s3">'h'</span><span class="s2">),</span>
                             <span class="s1">types</span><span class="s2">.</span><span class="s1">literal</span><span class="s2">(</span><span class="s3">'i'</span><span class="s2">):</span>
                                 <span class="s1">types</span><span class="s2">.</span><span class="s1">Array</span><span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s3">'C'</span><span class="s2">)}</span>
            <span class="s1">inner_dict </span><span class="s2">= </span><span class="s1">types</span><span class="s2">.</span><span class="s1">LiteralStrKeyDict</span><span class="s2">(</span><span class="s1">inner_literal</span><span class="s2">)</span>
            <span class="s1">outer_literal </span><span class="s2">= {</span><span class="s1">types</span><span class="s2">.</span><span class="s1">literal</span><span class="s2">(</span><span class="s3">'a'</span><span class="s2">):</span>
                            <span class="s1">types</span><span class="s2">.</span><span class="s1">LiteralList</span><span class="s2">([</span><span class="s1">types</span><span class="s2">.</span><span class="s1">literal</span><span class="s2">(</span><span class="s5">1</span><span class="s2">),</span>
                                               <span class="s1">types</span><span class="s2">.</span><span class="s1">literal</span><span class="s2">(</span><span class="s3">'a'</span><span class="s2">),</span>
                                               <span class="s1">types</span><span class="s2">.</span><span class="s1">DictType</span><span class="s2">(</span>
                                                   <span class="s1">types</span><span class="s2">.</span><span class="s1">unicode_type</span><span class="s2">,</span>
                                                   <span class="s1">types</span><span class="s2">.</span><span class="s1">intp</span><span class="s2">,</span>
                                                   <span class="s1">initial_value</span><span class="s2">={</span><span class="s3">'f'</span><span class="s2">: </span><span class="s5">1</span><span class="s2">}),</span>
                                               <span class="s1">inner_dict</span><span class="s2">]),</span>
                        <span class="s1">types</span><span class="s2">.</span><span class="s1">literal</span><span class="s2">(</span><span class="s3">'b'</span><span class="s2">): </span><span class="s1">types</span><span class="s2">.</span><span class="s1">literal</span><span class="s2">(</span><span class="s5">2</span><span class="s2">),</span>
                        <span class="s1">types</span><span class="s2">.</span><span class="s1">literal</span><span class="s2">(</span><span class="s3">'c'</span><span class="s2">): </span><span class="s1">types</span><span class="s2">.</span><span class="s1">List</span><span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">complex128</span><span class="s2">,</span>
                                                       <span class="s1">reflected</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)}</span>
            <span class="s0">def </span><span class="s1">check_same</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">):</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">LiteralList</span><span class="s2">) </span><span class="s0">and</span>
                    <span class="s1">isinstance</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">LiteralList</span><span class="s2">)):</span>
                    <span class="s0">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">j </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">a</span><span class="s2">.</span><span class="s1">literal_value</span><span class="s2">, </span><span class="s1">b</span><span class="s2">.</span><span class="s1">literal_value</span><span class="s2">):</span>
                        <span class="s1">check_same</span><span class="s2">(</span><span class="s1">a</span><span class="s2">.</span><span class="s1">literal_value</span><span class="s2">, </span><span class="s1">b</span><span class="s2">.</span><span class="s1">literal_value</span><span class="s2">)</span>
                <span class="s0">elif </span><span class="s2">(</span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">list</span><span class="s2">) </span><span class="s0">and</span>
                     <span class="s1">isinstance</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">list</span><span class="s2">)):</span>
                    <span class="s0">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">j </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">):</span>
                        <span class="s1">check_same</span><span class="s2">(</span><span class="s1">i</span><span class="s2">, </span><span class="s1">j</span><span class="s2">)</span>
                <span class="s0">elif </span><span class="s2">(</span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">LiteralStrKeyDict</span><span class="s2">) </span><span class="s0">and</span>
                      <span class="s1">isinstance</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">LiteralStrKeyDict</span><span class="s2">)):</span>
                    <span class="s0">for </span><span class="s2">(</span><span class="s1">ki</span><span class="s2">, </span><span class="s1">vi</span><span class="s2">), (</span><span class="s1">kj</span><span class="s2">, </span><span class="s1">vj</span><span class="s2">) </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">a</span><span class="s2">.</span><span class="s1">literal_value</span><span class="s2">.</span><span class="s1">items</span><span class="s2">(),</span>
                                                  <span class="s1">b</span><span class="s2">.</span><span class="s1">literal_value</span><span class="s2">.</span><span class="s1">items</span><span class="s2">()):</span>
                        <span class="s1">check_same</span><span class="s2">(</span><span class="s1">ki</span><span class="s2">, </span><span class="s1">kj</span><span class="s2">)</span>
                        <span class="s1">check_same</span><span class="s2">(</span><span class="s1">vi</span><span class="s2">, </span><span class="s1">vj</span><span class="s2">)</span>
                <span class="s0">elif </span><span class="s2">(</span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">) </span><span class="s0">and</span>
                      <span class="s1">isinstance</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">)):</span>
                    <span class="s0">for </span><span class="s2">(</span><span class="s1">ki</span><span class="s2">, </span><span class="s1">vi</span><span class="s2">), (</span><span class="s1">kj</span><span class="s2">, </span><span class="s1">vj</span><span class="s2">) </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">a</span><span class="s2">.</span><span class="s1">items</span><span class="s2">(), </span><span class="s1">b</span><span class="s2">.</span><span class="s1">items</span><span class="s2">()):</span>
                        <span class="s1">check_same</span><span class="s2">(</span><span class="s1">ki</span><span class="s2">, </span><span class="s1">kj</span><span class="s2">)</span>
                        <span class="s1">check_same</span><span class="s2">(</span><span class="s1">vi</span><span class="s2">, </span><span class="s1">vj</span><span class="s2">)</span>
                <span class="s0">else</span><span class="s2">:</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">)</span>
            <span class="s1">check_same</span><span class="s2">(</span><span class="s1">dlv</span><span class="s2">, </span><span class="s1">outer_literal</span><span class="s2">)</span>
            <span class="s0">return lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s1">x</span>

        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">():</span>
            <span class="s6"># this stretches what's possible with LiteralStrKeyDict and</span>
            <span class="s6"># LiteralList, it's nested and contains typed.Dict and np arrays</span>
            <span class="s6"># as well as more constant type things.</span>
            <span class="s1">l </span><span class="s2">= {</span><span class="s3">'a'</span><span class="s2">: [</span><span class="s5">1</span><span class="s2">, </span><span class="s3">'a'</span><span class="s2">, {</span><span class="s3">'f'</span><span class="s2">: </span><span class="s5">1</span><span class="s2">}, {</span><span class="s3">'g'</span><span class="s2">: </span><span class="s3">'h'</span><span class="s2">, </span><span class="s3">'i'</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s5">5</span><span class="s2">)}], </span><span class="s3">'b'</span><span class="s2">: </span><span class="s5">2</span><span class="s2">,</span>
                 <span class="s3">'c'</span><span class="s2">: [</span><span class="s5">1j</span><span class="s2">, </span><span class="s5">2j</span><span class="s2">, </span><span class="s5">3j</span><span class="s2">]}</span>
            <span class="s1">bar</span><span class="s2">(</span><span class="s1">l</span><span class="s2">)</span>

        <span class="s1">foo</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">test_mutation_failure</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>

        <span class="s0">def </span><span class="s1">staticsetitem</span><span class="s2">():</span>
            <span class="s1">l </span><span class="s2">= [</span><span class="s3">'a'</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]</span>
            <span class="s1">l</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] = </span><span class="s3">'b'</span>

        <span class="s0">def </span><span class="s1">delitem</span><span class="s2">():</span>
            <span class="s1">l </span><span class="s2">= [</span><span class="s3">'a'</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]</span>
            <span class="s0">del </span><span class="s1">l</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]</span>

        <span class="s0">def </span><span class="s1">append</span><span class="s2">():</span>
            <span class="s1">l </span><span class="s2">= [</span><span class="s3">'a'</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]</span>
            <span class="s1">l</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s5">2j</span><span class="s2">)</span>

        <span class="s0">def </span><span class="s1">extend</span><span class="s2">():</span>
            <span class="s1">l </span><span class="s2">= [</span><span class="s3">'a'</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]</span>
            <span class="s1">l</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">([</span><span class="s5">2j</span><span class="s2">, </span><span class="s5">3j</span><span class="s2">])</span>

        <span class="s0">def </span><span class="s1">insert</span><span class="s2">():</span>
            <span class="s1">l </span><span class="s2">= [</span><span class="s3">'a'</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]</span>
            <span class="s1">l</span><span class="s2">.</span><span class="s1">insert</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2j</span><span class="s2">)</span>

        <span class="s0">def </span><span class="s1">remove</span><span class="s2">():</span>
            <span class="s1">l </span><span class="s2">= [</span><span class="s3">'a'</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]</span>
            <span class="s1">l</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s3">'a'</span><span class="s2">)</span>

        <span class="s0">def </span><span class="s1">pop</span><span class="s2">():</span>
            <span class="s1">l </span><span class="s2">= [</span><span class="s3">'a'</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]</span>
            <span class="s1">l</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">()</span>

        <span class="s0">def </span><span class="s1">clear</span><span class="s2">():</span>
            <span class="s1">l </span><span class="s2">= [</span><span class="s3">'a'</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]</span>
            <span class="s1">l</span><span class="s2">.</span><span class="s1">clear</span><span class="s2">()</span>

        <span class="s0">def </span><span class="s1">sort</span><span class="s2">():</span>
            <span class="s1">l </span><span class="s2">= [</span><span class="s3">'a'</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]</span>
            <span class="s1">l</span><span class="s2">.</span><span class="s1">sort</span><span class="s2">()</span>

        <span class="s0">def </span><span class="s1">reverse</span><span class="s2">():</span>
            <span class="s1">l </span><span class="s2">= [</span><span class="s3">'a'</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]</span>
            <span class="s1">l</span><span class="s2">.</span><span class="s1">reverse</span><span class="s2">()</span>

        <span class="s1">illegals </span><span class="s2">= (</span><span class="s1">staticsetitem</span><span class="s2">, </span><span class="s1">delitem</span><span class="s2">, </span><span class="s1">append</span><span class="s2">, </span><span class="s1">extend</span><span class="s2">, </span><span class="s1">insert</span><span class="s2">, </span><span class="s1">remove</span><span class="s2">, </span><span class="s1">pop</span><span class="s2">,</span>
                    <span class="s1">clear</span><span class="s2">, </span><span class="s1">sort</span><span class="s2">, </span><span class="s1">reverse</span><span class="s2">)</span>

        <span class="s0">for </span><span class="s1">test </span><span class="s0">in </span><span class="s1">illegals</span><span class="s2">:</span>
            <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">subTest</span><span class="s2">(</span><span class="s1">test</span><span class="s2">.</span><span class="s1">__name__</span><span class="s2">):</span>
                <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">.</span><span class="s1">TypingError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
                    <span class="s1">njit</span><span class="s2">(</span><span class="s1">test</span><span class="s2">)()</span>
                <span class="s1">expect </span><span class="s2">= </span><span class="s3">&quot;Cannot mutate a literal list&quot;</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s1">expect</span><span class="s2">, </span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_count</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">():</span>
            <span class="s1">l </span><span class="s2">= [</span><span class="s3">'a'</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s3">'a'</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s3">'a'</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s3">'b'</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s3">'b'</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s3">'c'</span><span class="s2">]</span>
            <span class="s1">r </span><span class="s2">= []</span>
            <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s3">'abc'</span><span class="s2">:</span>
                <span class="s1">r</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">l</span><span class="s2">.</span><span class="s1">count</span><span class="s2">(</span><span class="s1">x</span><span class="s2">))</span>
            <span class="s0">return </span><span class="s1">r</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">foo</span><span class="s2">.</span><span class="s1">py_func</span><span class="s2">(), </span><span class="s1">foo</span><span class="s2">())</span>

    <span class="s0">def </span><span class="s1">test_len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">():</span>
            <span class="s1">l </span><span class="s2">= [</span><span class="s3">'a'</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s3">'a'</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s3">'a'</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s3">'b'</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s3">'b'</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s3">'c'</span><span class="s2">]</span>
            <span class="s0">return </span><span class="s1">len</span><span class="s2">(</span><span class="s1">l</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">foo</span><span class="s2">.</span><span class="s1">py_func</span><span class="s2">(), </span><span class="s1">foo</span><span class="s2">())</span>

    <span class="s0">def </span><span class="s1">test_contains</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">():</span>
            <span class="s1">l </span><span class="s2">= [</span><span class="s3">'a'</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s3">'a'</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s3">'a'</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s3">'b'</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s3">'b'</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s3">'c'</span><span class="s2">]</span>
            <span class="s1">r </span><span class="s2">= []</span>
            <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">literal_unroll</span><span class="s2">((</span><span class="s3">'a'</span><span class="s2">, </span><span class="s3">'d'</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">6</span><span class="s2">)):</span>
                <span class="s1">r</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">x </span><span class="s0">in </span><span class="s1">l</span><span class="s2">)</span>
            <span class="s0">return </span><span class="s1">r</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">foo</span><span class="s2">.</span><span class="s1">py_func</span><span class="s2">(), </span><span class="s1">foo</span><span class="s2">())</span>

    <span class="s0">def </span><span class="s1">test_getitem</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>

        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s1">l </span><span class="s2">= [</span><span class="s3">'a'</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]</span>
            <span class="s0">return </span><span class="s1">l</span><span class="s2">[</span><span class="s1">x</span><span class="s2">]</span>

        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">.</span><span class="s1">TypingError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">foo</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>
        <span class="s1">expect </span><span class="s2">= </span><span class="s3">&quot;Cannot __getitem__ on a literal list&quot;</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s1">expect</span><span class="s2">, </span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_staticgetitem</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>

        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">():</span>
            <span class="s1">l </span><span class="s2">= [</span><span class="s3">'a'</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]</span>
            <span class="s0">return </span><span class="s1">l</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">l</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">foo</span><span class="s2">.</span><span class="s1">py_func</span><span class="s2">(), </span><span class="s1">foo</span><span class="s2">())</span>

    <span class="s0">def </span><span class="s1">test_staticgetitem_slice</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6"># this is forbidden by typing as there's no way to serialize a list of</span>
        <span class="s6"># any kind as required by returning a (static) slice of a LiteralList</span>
        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">():</span>
            <span class="s1">l </span><span class="s2">= [</span><span class="s3">'a'</span><span class="s2">, </span><span class="s3">'b'</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]</span>
            <span class="s0">return </span><span class="s1">l</span><span class="s2">[:</span><span class="s5">2</span><span class="s2">]</span>

        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">.</span><span class="s1">TypingError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">foo</span><span class="s2">()</span>
        <span class="s1">expect </span><span class="s2">= </span><span class="s3">&quot;Cannot __getitem__ on a literal list&quot;</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s1">expect</span><span class="s2">, </span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_setitem</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>

        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s1">l </span><span class="s2">= [</span><span class="s3">'a'</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]</span>
            <span class="s1">l</span><span class="s2">[</span><span class="s1">x</span><span class="s2">] = </span><span class="s3">'b'</span>

        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">.</span><span class="s1">TypingError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">foo</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>
        <span class="s1">expect </span><span class="s2">= </span><span class="s3">&quot;Cannot mutate a literal list&quot;</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s1">expect</span><span class="s2">, </span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_unify</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>

        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s0">if </span><span class="s1">x </span><span class="s2">+ </span><span class="s5">1 </span><span class="s2">&gt; </span><span class="s5">3</span><span class="s2">:</span>
                <span class="s1">l </span><span class="s2">= [</span><span class="s3">'a'</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s1">l </span><span class="s2">= [</span><span class="s3">'b'</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]</span>
            <span class="s0">return </span><span class="s1">l</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]</span>

        <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s2">(-</span><span class="s5">100</span><span class="s2">, </span><span class="s5">100</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">foo</span><span class="s2">.</span><span class="s1">py_func</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">foo</span><span class="s2">(</span><span class="s1">x</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_not_unify</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>

        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s0">if </span><span class="s1">x </span><span class="s2">+ </span><span class="s5">1 </span><span class="s2">&gt; </span><span class="s5">3</span><span class="s2">:</span>
                <span class="s1">l </span><span class="s2">= [</span><span class="s3">'a'</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2j</span><span class="s2">]</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s1">l </span><span class="s2">= [</span><span class="s3">'b'</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]</span>
            <span class="s0">return </span><span class="s1">l</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">l</span><span class="s2">[</span><span class="s5">1</span><span class="s2">], </span><span class="s1">l</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">l</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] </span><span class="s6"># defeat py310 inliner</span>

        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">.</span><span class="s1">TypingError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">foo</span><span class="s2">(</span><span class="s5">100</span><span class="s2">)</span>
        <span class="s1">expect </span><span class="s2">= </span><span class="s3">&quot;Cannot unify LiteralList&quot;</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s1">expect</span><span class="s2">, </span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_index</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">():</span>
            <span class="s1">l </span><span class="s2">= [</span><span class="s3">'a'</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]</span>
            <span class="s1">l</span><span class="s2">.</span><span class="s1">index</span><span class="s2">(</span><span class="s3">'a'</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">.</span><span class="s1">TypingError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">foo</span><span class="s2">()</span>
        <span class="s1">expect </span><span class="s2">= </span><span class="s3">&quot;list.index is unsupported for literal lists&quot;</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s1">expect</span><span class="s2">, </span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_copy</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">():</span>
            <span class="s1">l </span><span class="s2">= [</span><span class="s3">'a'</span><span class="s2">, </span><span class="s5">1</span><span class="s2">].</span><span class="s1">copy</span><span class="s2">()</span>
            <span class="s0">return </span><span class="s1">l</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">l</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">foo</span><span class="s2">(), </span><span class="s1">foo</span><span class="s2">.</span><span class="s1">py_func</span><span class="s2">())</span>

    <span class="s0">def </span><span class="s1">test_tuple_not_in_mro</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6"># Related to #6094, make sure that LiteralList does not inherit from</span>
        <span class="s6"># types.BaseTuple as this breaks isinstance checks.</span>
        <span class="s0">def </span><span class="s1">bar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s0">pass</span>

        <span class="s2">@</span><span class="s1">overload</span><span class="s2">(</span><span class="s1">bar</span><span class="s2">)</span>
        <span class="s0">def </span><span class="s1">ol_bar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertFalse</span><span class="s2">(</span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">BaseTuple</span><span class="s2">))</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">LiteralList</span><span class="s2">))</span>
            <span class="s0">return lambda </span><span class="s1">x</span><span class="s2">: ...</span>

        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">():</span>
            <span class="s1">l </span><span class="s2">= [</span><span class="s3">'a'</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]</span>
            <span class="s1">bar</span><span class="s2">(</span><span class="s1">l</span><span class="s2">)</span>

        <span class="s1">foo</span><span class="s2">()</span>


<span class="s0">if </span><span class="s1">__name__ </span><span class="s2">== </span><span class="s3">'__main__'</span><span class="s2">:</span>
    <span class="s1">unittest</span><span class="s2">.</span><span class="s1">main</span><span class="s2">()</span>
</pre>
</body>
</html>