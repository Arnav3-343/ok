<html>
<head>
<title>test_lang_pre_process_and_post_process.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #5f826b; font-style: italic;}
.s5 { color: #7a7e85;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_lang_pre_process_and_post_process.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">unittest</span>
<span class="s0">import </span><span class="s1">textwrap</span>
<span class="s0">from </span><span class="s1">collections </span><span class="s0">import </span><span class="s1">defaultdict</span>


<span class="s0">class </span><span class="s1">TrackCallbacks</span><span class="s2">(</span><span class="s1">object</span><span class="s2">):</span>

    <span class="s1">kv_pre_events </span><span class="s2">= []</span>
    <span class="s3">'''Stores values added during the pre event dispatched callbacks. 
    '''</span>

    <span class="s1">kv_applied_events </span><span class="s2">= []</span>
    <span class="s3">'''Stores values added during the applied event dispatched callbacks. 
    '''</span>

    <span class="s1">kv_post_events </span><span class="s2">= []</span>
    <span class="s3">'''Stores values added during the post event dispatched callbacks. 
    '''</span>

    <span class="s1">events_in_pre </span><span class="s2">= []</span>
    <span class="s3">'''List of expected events that should be in kv_pre_events after all the 
    callbacks has been executed. 
    '''</span>

    <span class="s1">events_in_applied </span><span class="s2">= []</span>
    <span class="s3">'''List of expected events that should be in kv_applied_events after all 
    the callbacks has been executed. 
    '''</span>

    <span class="s1">events_in_post </span><span class="s2">= []</span>
    <span class="s3">'''List of expected events that should be in kv_post_events after all the 
    callbacks has been executed. 
    '''</span>

    <span class="s1">instantiated_widgets </span><span class="s2">= []</span>
    <span class="s3">'''Whenever a widget of this class is instantiated, it is added to this 
    list, which is class specific. 
 
    It lets us iterate through all the instance of this class and assert for 
    all of them as needed. 
    '''</span>

    <span class="s1">root_widget </span><span class="s2">= </span><span class="s0">None</span>
    <span class="s3">'''The expected root widget in the kv rule as dispatched in on_kv_applied. 
    '''</span>

    <span class="s1">base_widget </span><span class="s2">= </span><span class="s0">None</span>
    <span class="s3">'''The expected base widget as dispatched in on_kv_post. 
    '''</span>

    <span class="s1">actual_root_widget </span><span class="s2">= </span><span class="s0">None</span>
    <span class="s3">'''The actual root widget in the kv rule as dispatched in on_kv_applied. 
    '''</span>

    <span class="s1">actual_base_widget </span><span class="s2">= </span><span class="s0">None</span>
    <span class="s3">'''The actual base widget as dispatched in on_kv_post. 
    '''</span>

    <span class="s1">name </span><span class="s2">= </span><span class="s3">'none'</span>
    <span class="s3">'''Optional name given to the widget to help it identify during a test 
    failure. 
    '''</span>

    <span class="s1">my_roots_expected_ids </span><span class="s2">= {}</span>
    <span class="s3">'''Dictionary containing the expected ids as stored in the root 
    widget's `ids`. The root being this widget's root widget from kv. 
    '''</span>

    <span class="s1">actual_ids </span><span class="s2">= {}</span>
    <span class="s3">'''Dictionary containing the actual ids as stored in the root 
    widget's `ids`. The root being this widget's root widget from kv. 
 
    The ids is saved here during the `on_kv_post` callback. 
    '''</span>

    <span class="s1">expected_prop_values </span><span class="s2">= {}</span>
    <span class="s3">'''A dict of property names and the values they are expected to have 
    during the on_kv_post dispatch. 
    '''</span>

    <span class="s1">actual_prop_values </span><span class="s2">= {}</span>
    <span class="s3">'''A dict of property names and the values they actually had 
    during the on_kv_post dispatch. 
    '''</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">=</span><span class="s3">'none'</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">kv_pre_events </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">kv_pre_events</span><span class="s2">[:]</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">kv_applied_events </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">kv_applied_events</span><span class="s2">[:]</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">kv_post_events </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">kv_post_events</span><span class="s2">[:]</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">events_in_pre </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">events_in_pre</span><span class="s2">[:]</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">events_in_applied </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">events_in_applied</span><span class="s2">[:]</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">events_in_post </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">events_in_post</span><span class="s2">[:]</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">name </span><span class="s2">= </span><span class="s1">name</span>

        <span class="s1">super</span><span class="s2">(</span><span class="s1">TrackCallbacks</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">__init__</span><span class="s2">(**</span><span class="s1">kwargs</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">instantiated_widgets</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">add</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">event</span><span class="s2">):</span>
        <span class="s4">'''Add name to the list of the names added in the callbacks for this 
        event. 
        '''</span>
        <span class="s1">events </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s3">'kv_{}_events'</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">event</span><span class="s2">))</span>
        <span class="s1">events</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">name</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">classmethod</span>
    <span class="s0">def </span><span class="s1">check</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">, </span><span class="s1">testcase</span><span class="s2">):</span>
        <span class="s4">'''Checks that all the widgets of this class pass all the assertions. 
        '''</span>
        <span class="s0">for </span><span class="s1">widget </span><span class="s0">in </span><span class="s1">cls</span><span class="s2">.</span><span class="s1">instantiated_widgets</span><span class="s2">:</span>
            <span class="s5"># check that all the events match</span>
            <span class="s0">for </span><span class="s1">event </span><span class="s0">in </span><span class="s2">(</span><span class="s3">'pre'</span><span class="s2">, </span><span class="s3">'applied'</span><span class="s2">, </span><span class="s3">'post'</span><span class="s2">):</span>
                <span class="s1">cls</span><span class="s2">.</span><span class="s1">check_event</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, </span><span class="s1">event</span><span class="s2">, </span><span class="s1">testcase</span><span class="s2">)</span>

            <span class="s5"># check that the ids are properly saved during on_kv_post dispatch</span>
            <span class="s1">expected </span><span class="s2">= {</span>
                <span class="s1">k</span><span class="s2">: </span><span class="s1">v</span><span class="s2">.</span><span class="s1">__self__ </span><span class="s0">for </span><span class="s1">k</span><span class="s2">, </span><span class="s1">v </span><span class="s0">in </span><span class="s1">widget</span><span class="s2">.</span><span class="s1">my_roots_expected_ids</span><span class="s2">.</span><span class="s1">items</span><span class="s2">()}</span>
            <span class="s1">actual </span><span class="s2">= {</span><span class="s1">k</span><span class="s2">: </span><span class="s1">v</span><span class="s2">.</span><span class="s1">__self__ </span><span class="s0">for </span><span class="s1">k</span><span class="s2">, </span><span class="s1">v </span><span class="s0">in </span><span class="s1">widget</span><span class="s2">.</span><span class="s1">actual_ids</span><span class="s2">.</span><span class="s1">items</span><span class="s2">()}</span>
            <span class="s1">testcase</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">actual</span><span class="s2">)</span>

            <span class="s5"># check that the root widget is as expected</span>
            <span class="s1">testcase</span><span class="s2">.</span><span class="s1">assertIs</span><span class="s2">(</span>
                <span class="s1">widget</span><span class="s2">.</span><span class="s1">root_widget </span><span class="s0">and </span><span class="s1">widget</span><span class="s2">.</span><span class="s1">root_widget</span><span class="s2">.</span><span class="s1">__self__</span><span class="s2">,</span>
                <span class="s1">widget</span><span class="s2">.</span><span class="s1">actual_root_widget </span><span class="s0">and</span>
                <span class="s1">widget</span><span class="s2">.</span><span class="s1">actual_root_widget</span><span class="s2">.</span><span class="s1">__self__</span><span class="s2">,</span>
                <span class="s3">'expected &quot;{}&quot;, got &quot;{}&quot; instead for root_widget'</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span>
                    <span class="s1">widget</span><span class="s2">.</span><span class="s1">root_widget </span><span class="s0">and </span><span class="s1">widget</span><span class="s2">.</span><span class="s1">root_widget</span><span class="s2">.</span><span class="s1">name</span><span class="s2">,</span>
                    <span class="s1">widget</span><span class="s2">.</span><span class="s1">actual_root_widget </span><span class="s0">and</span>
                    <span class="s1">widget</span><span class="s2">.</span><span class="s1">actual_root_widget</span><span class="s2">.</span><span class="s1">name</span><span class="s2">))</span>

            <span class="s5"># check that the base widget is as expected</span>
            <span class="s1">testcase</span><span class="s2">.</span><span class="s1">assertIs</span><span class="s2">(</span>
                <span class="s1">widget</span><span class="s2">.</span><span class="s1">base_widget </span><span class="s0">and </span><span class="s1">widget</span><span class="s2">.</span><span class="s1">base_widget</span><span class="s2">.</span><span class="s1">__self__</span><span class="s2">,</span>
                <span class="s1">widget</span><span class="s2">.</span><span class="s1">actual_base_widget </span><span class="s0">and</span>
                <span class="s1">widget</span><span class="s2">.</span><span class="s1">actual_base_widget</span><span class="s2">.</span><span class="s1">__self__</span><span class="s2">,</span>
                <span class="s3">'expected &quot;{}&quot;, got &quot;{}&quot; instead for base_widget'</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span>
                    <span class="s1">widget</span><span class="s2">.</span><span class="s1">base_widget </span><span class="s0">and </span><span class="s1">widget</span><span class="s2">.</span><span class="s1">base_widget</span><span class="s2">.</span><span class="s1">name</span><span class="s2">,</span>
                    <span class="s1">widget</span><span class="s2">.</span><span class="s1">actual_base_widget </span><span class="s0">and</span>
                    <span class="s1">widget</span><span class="s2">.</span><span class="s1">actual_base_widget</span><span class="s2">.</span><span class="s1">name</span><span class="s2">))</span>

            <span class="s5"># check that the properties have expected values</span>
            <span class="s1">testcase</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span>
                <span class="s1">widget</span><span class="s2">.</span><span class="s1">expected_prop_values</span><span class="s2">, </span><span class="s1">widget</span><span class="s2">.</span><span class="s1">actual_prop_values</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">staticmethod</span>
    <span class="s0">def </span><span class="s1">check_event</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, </span><span class="s1">event_name</span><span class="s2">, </span><span class="s1">testcase</span><span class="s2">):</span>
        <span class="s4">'''Check that the names are added as expected for this event. 
        '''</span>
        <span class="s1">events </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, </span><span class="s3">'kv_{}_events'</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">event_name</span><span class="s2">))</span>
        <span class="s1">should_be_in </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, </span><span class="s3">'events_in_{}'</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">event_name</span><span class="s2">))</span>

        <span class="s1">counter </span><span class="s2">= </span><span class="s1">defaultdict</span><span class="s2">(</span><span class="s1">int</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">name </span><span class="s0">in </span><span class="s1">events</span><span class="s2">:</span>
            <span class="s1">counter</span><span class="s2">[</span><span class="s1">name</span><span class="s2">] += </span><span class="s6">1</span>

        <span class="s0">for </span><span class="s1">name</span><span class="s2">, </span><span class="s1">value </span><span class="s0">in </span><span class="s1">counter</span><span class="s2">.</span><span class="s1">items</span><span class="s2">():</span>
            <span class="s1">testcase</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span>
                <span class="s1">value</span><span class="s2">, </span><span class="s6">1</span><span class="s2">,</span>
                <span class="s3">'&quot;{}&quot; was present &quot;{}&quot; times for event &quot;{}&quot; for widget &quot;{} '</span>
                <span class="s3">'({})&quot;'</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">value</span><span class="s2">, </span><span class="s1">event_name</span><span class="s2">, </span><span class="s1">widget</span><span class="s2">.</span><span class="s1">name</span><span class="s2">, </span><span class="s1">widget</span><span class="s2">))</span>

        <span class="s1">testcase</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span>
            <span class="s1">set</span><span class="s2">(</span><span class="s1">should_be_in</span><span class="s2">), </span><span class="s1">set</span><span class="s2">(</span><span class="s1">events</span><span class="s2">),</span>
            <span class="s3">'Expected and actual event callbacks do not match for event &quot;{}&quot; '</span>
            <span class="s3">'for widget &quot;{} ({})&quot;'</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span>
                <span class="s1">event_name</span><span class="s2">, </span><span class="s1">widget</span><span class="s2">.</span><span class="s1">name</span><span class="s2">, </span><span class="s1">widget</span><span class="s2">))</span>

    <span class="s2">@</span><span class="s1">staticmethod</span>
    <span class="s0">def </span><span class="s1">get_base_class</span><span class="s2">():</span>
        <span class="s4">'''The base class to use for widgets during testing so we can use 
        this class variables to ease testing. 
        '''</span>
        <span class="s0">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">widget </span><span class="s0">import </span><span class="s1">Widget</span>

        <span class="s0">class </span><span class="s1">TestEventsBase</span><span class="s2">(</span><span class="s1">TrackCallbacks</span><span class="s2">, </span><span class="s1">Widget</span><span class="s2">):</span>

            <span class="s1">__events__ </span><span class="s2">= (</span><span class="s3">'on_kv_pre'</span><span class="s2">, </span><span class="s3">'on_kv_applied'</span><span class="s2">)</span>

            <span class="s1">instantiated_widgets </span><span class="s2">= []</span>

            <span class="s1">events_in_pre </span><span class="s2">= [</span><span class="s6">1</span><span class="s2">, ]</span>
            <span class="s1">events_in_applied </span><span class="s2">= [</span><span class="s6">1</span><span class="s2">, ]</span>
            <span class="s1">events_in_post </span><span class="s2">= [</span><span class="s6">1</span><span class="s2">, ]</span>

            <span class="s0">def </span><span class="s1">on_kv_pre</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s6">1</span><span class="s2">, </span><span class="s3">'pre'</span><span class="s2">)</span>

            <span class="s0">def </span><span class="s1">on_kv_applied</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">root_widget</span><span class="s2">):</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s6">1</span><span class="s2">, </span><span class="s3">'applied'</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">actual_root_widget </span><span class="s2">= </span><span class="s1">root_widget</span>

            <span class="s0">def </span><span class="s1">on_kv_post</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">base_widget</span><span class="s2">):</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s6">1</span><span class="s2">, </span><span class="s3">'post'</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">actual_base_widget </span><span class="s2">= </span><span class="s1">base_widget</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">actual_prop_values </span><span class="s2">= {</span>
                    <span class="s1">k</span><span class="s2">: </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">k</span><span class="s2">) </span><span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">expected_prop_values</span><span class="s2">}</span>

                <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">actual_root_widget </span><span class="s0">is not None</span><span class="s2">:</span>
                    <span class="s5"># make a copy of the ids at the current moment</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">actual_ids </span><span class="s2">= </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">actual_root_widget</span><span class="s2">.</span><span class="s1">ids</span><span class="s2">)</span>

            <span class="s0">def </span><span class="s1">apply_class_lang_rules</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">root</span><span class="s2">=</span><span class="s0">None</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">dispatch</span><span class="s2">(</span><span class="s3">'on_kv_pre'</span><span class="s2">)</span>
                <span class="s1">super</span><span class="s2">(</span><span class="s1">TestEventsBase</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">apply_class_lang_rules</span><span class="s2">(</span>
                    <span class="s1">root</span><span class="s2">=</span><span class="s1">root</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">dispatch</span><span class="s2">(</span><span class="s3">'on_kv_applied'</span><span class="s2">, </span><span class="s1">root</span><span class="s2">)</span>

        <span class="s0">return </span><span class="s1">TestEventsBase</span>

    <span class="s0">def </span><span class="s1">__repr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">module </span><span class="s2">= </span><span class="s1">type</span><span class="s2">(</span><span class="s1">self</span><span class="s2">).</span><span class="s1">__module__</span>
        <span class="s0">try</span><span class="s2">:</span>
            <span class="s1">qualname </span><span class="s2">= </span><span class="s1">type</span><span class="s2">(</span><span class="s1">self</span><span class="s2">).</span><span class="s1">__qualname__</span>
        <span class="s0">except </span><span class="s1">AttributeError</span><span class="s2">:  </span><span class="s5"># python 2</span>
            <span class="s1">qualname </span><span class="s2">= </span><span class="s3">''</span>
        <span class="s0">return </span><span class="s3">'&lt;Name: &quot;{}&quot; {}.{} object at {}&gt;'</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">name</span><span class="s2">, </span><span class="s1">module</span><span class="s2">, </span><span class="s1">qualname</span><span class="s2">, </span><span class="s1">hex</span><span class="s2">(</span><span class="s1">id</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)))</span>


<span class="s0">class </span><span class="s1">TestKvEvents</span><span class="s2">(</span><span class="s1">unittest</span><span class="s2">.</span><span class="s1">TestCase</span><span class="s2">):</span>

    <span class="s0">def </span><span class="s1">test_pure_python_auto_binding</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">class </span><span class="s1">TestEventsPureAuto</span><span class="s2">(</span><span class="s1">TrackCallbacks</span><span class="s2">.</span><span class="s1">get_base_class</span><span class="s2">()):</span>
            <span class="s1">instantiated_widgets </span><span class="s2">= []</span>

        <span class="s1">widget </span><span class="s2">= </span><span class="s1">TestEventsPureAuto</span><span class="s2">()</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">root_widget </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">base_widget </span><span class="s2">= </span><span class="s1">widget</span>
        <span class="s1">TestEventsPureAuto</span><span class="s2">.</span><span class="s1">check</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_pure_python_callbacks</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">class </span><span class="s1">TestEventsPure</span><span class="s2">(</span><span class="s1">TrackCallbacks</span><span class="s2">.</span><span class="s1">get_base_class</span><span class="s2">()):</span>
            <span class="s1">instantiated_widgets </span><span class="s2">= []</span>

            <span class="s1">events_in_pre </span><span class="s2">= [</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">]</span>
            <span class="s1">events_in_applied </span><span class="s2">= [</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">]</span>
            <span class="s1">events_in_post </span><span class="s2">= [</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">]</span>

            <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">fbind</span><span class="s2">(</span><span class="s3">'on_kv_pre'</span><span class="s2">, </span><span class="s0">lambda </span><span class="s1">_</span><span class="s2">: </span><span class="s1">self</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s6">2</span><span class="s2">, </span><span class="s3">'pre'</span><span class="s2">))</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">fbind</span><span class="s2">(</span>
                    <span class="s3">'on_kv_applied'</span><span class="s2">, </span><span class="s0">lambda </span><span class="s1">_</span><span class="s2">, </span><span class="s1">x</span><span class="s2">: </span><span class="s1">self</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s6">2</span><span class="s2">, </span><span class="s3">'applied'</span><span class="s2">))</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">fbind</span><span class="s2">(</span><span class="s3">'on_kv_post'</span><span class="s2">, </span><span class="s0">lambda </span><span class="s1">_</span><span class="s2">, </span><span class="s1">x</span><span class="s2">: </span><span class="s1">self</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s6">2</span><span class="s2">, </span><span class="s3">'post'</span><span class="s2">))</span>

                <span class="s1">super</span><span class="s2">(</span><span class="s1">TestEventsPure</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">__init__</span><span class="s2">(**</span><span class="s1">kwargs</span><span class="s2">)</span>

        <span class="s1">widget </span><span class="s2">= </span><span class="s1">TestEventsPure</span><span class="s2">()</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">root_widget </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">base_widget </span><span class="s2">= </span><span class="s1">widget</span>

        <span class="s1">widget</span><span class="s2">.</span><span class="s1">fbind</span><span class="s2">(</span><span class="s3">'on_kv_pre'</span><span class="s2">, </span><span class="s0">lambda </span><span class="s1">_</span><span class="s2">: </span><span class="s1">widget</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s6">3</span><span class="s2">, </span><span class="s3">'pre'</span><span class="s2">))</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">fbind</span><span class="s2">(</span><span class="s3">'on_kv_applied'</span><span class="s2">, </span><span class="s0">lambda </span><span class="s1">_</span><span class="s2">, </span><span class="s1">x</span><span class="s2">: </span><span class="s1">widget</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s6">3</span><span class="s2">, </span><span class="s3">'applied'</span><span class="s2">))</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">fbind</span><span class="s2">(</span><span class="s3">'on_kv_post'</span><span class="s2">, </span><span class="s0">lambda </span><span class="s1">_</span><span class="s2">, </span><span class="s1">x</span><span class="s2">: </span><span class="s1">widget</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s6">3</span><span class="s2">, </span><span class="s3">'post'</span><span class="s2">))</span>

        <span class="s1">TestEventsPure</span><span class="s2">.</span><span class="s1">check</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_instantiate_from_kv</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">lang </span><span class="s0">import </span><span class="s1">Builder</span>

        <span class="s0">class </span><span class="s1">TestEventsFromKV</span><span class="s2">(</span><span class="s1">TrackCallbacks</span><span class="s2">.</span><span class="s1">get_base_class</span><span class="s2">()):</span>
            <span class="s1">instantiated_widgets </span><span class="s2">= []</span>

        <span class="s1">widget </span><span class="s2">= </span><span class="s1">Builder</span><span class="s2">.</span><span class="s1">load_string</span><span class="s2">(</span><span class="s3">'TestEventsFromKV'</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIsInstance</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, </span><span class="s1">TestEventsFromKV</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">root_widget </span><span class="s2">= </span><span class="s1">widget</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">base_widget </span><span class="s2">= </span><span class="s1">widget</span>

        <span class="s1">widget</span><span class="s2">.</span><span class="s1">check</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_instantiate_from_kv_with_event</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">lang </span><span class="s0">import </span><span class="s1">Builder</span>

        <span class="s0">class </span><span class="s1">TestEventsFromKVEvent</span><span class="s2">(</span><span class="s1">TrackCallbacks</span><span class="s2">.</span><span class="s1">get_base_class</span><span class="s2">()):</span>
            <span class="s1">instantiated_widgets </span><span class="s2">= []</span>

        <span class="s1">widget </span><span class="s2">= </span><span class="s1">Builder</span><span class="s2">.</span><span class="s1">load_string</span><span class="s2">(</span><span class="s1">textwrap</span><span class="s2">.</span><span class="s1">dedent</span><span class="s2">(</span><span class="s3">&quot;&quot;&quot; 
        TestEventsFromKVEvent: 
            events_in_post: [1, 2] 
            on_kv_pre: self.add(2, 'pre') 
            on_kv_applied: self.add(2, 'applied') 
            on_kv_post: self.add(2, 'post') 
            root_widget: self 
            base_widget: self 
        &quot;&quot;&quot;</span><span class="s2">))</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIsInstance</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, </span><span class="s1">TestEventsFromKVEvent</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">check</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_instantiate_from_kv_with_child</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">lang </span><span class="s0">import </span><span class="s1">Builder</span>

        <span class="s0">class </span><span class="s1">TestEventsFromKVChild</span><span class="s2">(</span><span class="s1">TrackCallbacks</span><span class="s2">.</span><span class="s1">get_base_class</span><span class="s2">()):</span>
            <span class="s1">instantiated_widgets </span><span class="s2">= []</span>

        <span class="s1">widget </span><span class="s2">= </span><span class="s1">Builder</span><span class="s2">.</span><span class="s1">load_string</span><span class="s2">(</span><span class="s1">textwrap</span><span class="s2">.</span><span class="s1">dedent</span><span class="s2">(</span><span class="s3">&quot;&quot;&quot; 
        TestEventsFromKVChild: 
            events_in_post: [1, 2] 
            on_kv_pre: self.add(2, 'pre') 
            on_kv_applied: self.add(2, 'applied') 
            on_kv_post: self.add(2, 'post') 
            root_widget: self 
            base_widget: self 
            name: 'root' 
            my_roots_expected_ids: {'child_widget': child_widget} 
            TestEventsFromKVChild: 
                events_in_post: [1, 2] 
                on_kv_pre: self.add(2, 'pre') 
                on_kv_applied: self.add(2, 'applied') 
                on_kv_post: self.add(2, 'post') 
                root_widget: root 
                base_widget: root 
                name: 'child' 
                id: child_widget 
                my_roots_expected_ids: {'child_widget': self} 
        &quot;&quot;&quot;</span><span class="s2">))</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIsInstance</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, </span><span class="s1">TestEventsFromKVChild</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">check</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_instantiate_from_kv_with_child_inherit</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">lang </span><span class="s0">import </span><span class="s1">Builder</span>

        <span class="s0">class </span><span class="s1">TestEventsFromKVChildInherit</span><span class="s2">(</span><span class="s1">TrackCallbacks</span><span class="s2">.</span><span class="s1">get_base_class</span><span class="s2">()):</span>
            <span class="s1">instantiated_widgets </span><span class="s2">= []</span>

        <span class="s1">widget </span><span class="s2">= </span><span class="s1">Builder</span><span class="s2">.</span><span class="s1">load_string</span><span class="s2">(</span><span class="s1">textwrap</span><span class="s2">.</span><span class="s1">dedent</span><span class="s2">(</span><span class="s3">&quot;&quot;&quot; 
        &lt;TestEventsFromKVChildInherit2@TestEventsFromKVChildInherit&gt;: 
            on_kv_pre: self.add(3, 'pre') 
            on_kv_applied: self.add(3, 'applied') 
            on_kv_post: self.add(3, 'post') 
 
        &lt;TestEventsFromKVChildInherit3@TestEventsFromKVChildInherit2&gt;: 
            on_kv_pre: self.add(4, 'pre') 
            on_kv_applied: self.add(4, 'applied') 
            on_kv_post: self.add(4, 'post') 
            some_value: 'fruit' 
            TestEventsFromKVChildInherit2: 
                events_in_applied: [1, 2, 3] 
                events_in_post: [1, 2, 3, 4] 
                on_kv_pre: self.add(4, 'pre') 
                on_kv_applied: self.add(4, 'applied') 
                on_kv_post: self.add(4, 'post') 
                root_widget: root 
                base_widget: self.parent.parent 
                name: 'third child' 
                id: third_child 
                my_roots_expected_ids: {'third_child': self} 
 
        &lt;TestEventsFromKVChildInherit&gt;: 
            on_kv_pre: self.add(2, 'pre') 
            on_kv_applied: self.add(2, 'applied') 
            on_kv_post: self.add(2, 'post') 
            another_value: 'apple' 
 
        TestEventsFromKVChildInherit: 
            events_in_applied: [1, 2] 
            events_in_post: [1, 2, 3] 
            on_kv_pre: self.add(3, 'pre') 
            on_kv_applied: self.add(3, 'applied') 
            on_kv_post: self.add(3, 'post') 
            root_widget: self 
            base_widget: self 
            name: 'root' 
            my_roots_expected_ids: </span><span class="s0">\ 
                </span><span class="s3">{'second_child': second_child, 'first_child': first_child} 
            TestEventsFromKVChildInherit: 
                events_in_applied: [1, 2] 
                events_in_post: [1, 2, 3] 
                on_kv_pre: self.add(3, 'pre') 
                on_kv_applied: self.add(3, 'applied') 
                on_kv_post: self.add(3, 'post') 
                root_widget: root 
                base_widget: root 
                name: 'first child' 
                id: first_child 
                my_roots_expected_ids: </span><span class="s0">\ 
                    </span><span class="s3">{'second_child': second_child, 'first_child': self} 
            TestEventsFromKVChildInherit3: 
                events_in_applied: [1, 2, 3, 4] 
                events_in_post: [1, 2, 3, 4, 5] 
                on_kv_pre: self.add(5, 'pre') 
                on_kv_applied: self.add(5, 'applied') 
                on_kv_post: self.add(5, 'post') 
                root_widget: root 
                base_widget: root 
                name: 'second child' 
                some_value: first_child.another_value 
                expected_prop_values: {'some_value': 'apple'} 
                id: second_child 
                my_roots_expected_ids: </span><span class="s0">\ 
                    </span><span class="s3">{'second_child': self, 'first_child': first_child} 
        &quot;&quot;&quot;</span><span class="s2">))</span>

        <span class="s1">widget</span><span class="s2">.</span><span class="s1">check</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>
</pre>
</body>
</html>