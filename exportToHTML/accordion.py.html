<html>
<head>
<title>accordion.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #cf8e6d;}
.s5 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
accordion.py</font>
</center></td></tr></table>
<pre><span class="s0">''' 
Accordion 
========= 
 
.. versionadded:: 1.0.8 
 
 
.. image:: images/accordion.jpg 
    :align: right 
 
The Accordion widget is a form of menu where the options are stacked either 
vertically or horizontally and the item in focus (when touched) opens up to 
display its content. 
 
The :class:`Accordion` should contain one or many :class:`AccordionItem` 
instances, each of which should contain one root content widget. You'll end up 
with a Tree something like this: 
 
- Accordion 
 
  - AccordionItem 
 
    - YourContent 
 
  - AccordionItem 
 
    - BoxLayout 
 
      - Another user content 1 
 
      - Another user content 2 
 
  - AccordionItem 
 
    - Another user content 
 
 
The current implementation divides the :class:`AccordionItem` into two parts: 
 
#. One container for the title bar 
#. One container for the content 
 
The title bar is made from a Kv template. We'll see how to create a new 
template to customize the design of the title bar. 
 
.. warning:: 
 
    If you see message like:: 
 
        [WARNING] [Accordion] not have enough space for displaying all children 
        [WARNING] [Accordion] need 440px, got 100px 
        [WARNING] [Accordion] layout aborted. 
 
    That means you have too many children and there is no more space to 
    display the content. This is &quot;normal&quot; and nothing will be done. Try to 
    increase the space for the accordion or reduce the number of children. You 
    can also reduce the :attr:`Accordion.min_space`. 
 
Simple example 
-------------- 
 
.. include:: ../../examples/widgets/accordion_1.py 
    :literal: 
 
Customize the accordion 
----------------------- 
 
You can increase the default size of the title bar:: 
 
    root = Accordion(min_space=60) 
 
Or change the orientation to vertical:: 
 
    root = Accordion(orientation='vertical') 
 
The AccordionItem is more configurable and you can set your own title 
background when the item is collapsed or opened:: 
 
    item = AccordionItem(background_normal='image_when_collapsed.png', 
        background_selected='image_when_selected.png') 
 
'''</span>

<span class="s1">__all__ </span><span class="s2">= (</span><span class="s3">'Accordion'</span><span class="s2">, </span><span class="s3">'AccordionItem'</span><span class="s2">, </span><span class="s3">'AccordionException'</span><span class="s2">)</span>

<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">animation </span><span class="s4">import </span><span class="s1">Animation</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">floatlayout </span><span class="s4">import </span><span class="s1">FloatLayout</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">clock </span><span class="s4">import </span><span class="s1">Clock</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">lang </span><span class="s4">import </span><span class="s1">Builder</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">properties </span><span class="s4">import </span><span class="s2">(</span><span class="s1">ObjectProperty</span><span class="s2">, </span><span class="s1">StringProperty</span><span class="s2">,</span>
                             <span class="s1">BooleanProperty</span><span class="s2">, </span><span class="s1">NumericProperty</span><span class="s2">,</span>
                             <span class="s1">ListProperty</span><span class="s2">, </span><span class="s1">OptionProperty</span><span class="s2">, </span><span class="s1">DictProperty</span><span class="s2">)</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">widget </span><span class="s4">import </span><span class="s1">Widget</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">logger </span><span class="s4">import </span><span class="s1">Logger</span>


<span class="s4">class </span><span class="s1">AccordionException</span><span class="s2">(</span><span class="s1">Exception</span><span class="s2">):</span>
    <span class="s0">'''AccordionException class. 
    '''</span>
    <span class="s4">pass</span>


<span class="s4">class </span><span class="s1">AccordionItem</span><span class="s2">(</span><span class="s1">FloatLayout</span><span class="s2">):</span>
    <span class="s0">'''AccordionItem class that must be used in conjunction with the 
    :class:`Accordion` class. See the module documentation for more 
    information. 
    '''</span>

    <span class="s1">title </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span><span class="s3">''</span><span class="s2">)</span>
    <span class="s3">'''Title string of the item. The title might be used in conjunction with the 
    `AccordionItemTitle` template. If you are using a custom template, you can 
    use that property as a text entry, or not. By default, it's used for the 
    title text. See title_template and the example below. 
 
    :attr:`title` is a :class:`~kivy.properties.StringProperty` and defaults 
    to ''. 
    '''</span>

    <span class="s1">title_template </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span><span class="s3">'AccordionItemTitle'</span><span class="s2">)</span>
    <span class="s3">'''Template to use for creating the title part of the accordion item. The 
    default template is a simple Label, not customizable (except the text) that 
    supports vertical and horizontal orientation and different backgrounds for 
    collapse and selected mode. 
 
    It's better to create and use your own template if the default template 
    does not suffice. 
 
    :attr:`title` is a :class:`~kivy.properties.StringProperty` and defaults to 
    'AccordionItemTitle'. The current default template lives in the 
    `kivy/data/style.kv` file. 
 
    Here is the code if you want to build your own template:: 
 
        [AccordionItemTitle@Label]: 
            text: ctx.title 
            canvas.before: 
                Color: 
                    rgb: 1, 1, 1 
                BorderImage: 
                    source: 
                        ctx.item.background_normal </span><span class="s4">\ 
                        </span><span class="s3">if ctx.item.collapse </span><span class="s4">\ 
                        </span><span class="s3">else ctx.item.background_selected 
                    pos: self.pos 
                    size: self.size 
                PushMatrix 
                Translate: 
                    xy: self.center_x, self.center_y 
                Rotate: 
                    angle: 90 if ctx.item.orientation == 'horizontal' else 0 
                    axis: 0, 0, 1 
                Translate: 
                    xy: -self.center_x, -self.center_y 
            canvas.after: 
                PopMatrix 
 
 
    '''</span>

    <span class="s1">title_args </span><span class="s2">= </span><span class="s1">DictProperty</span><span class="s2">({})</span>
    <span class="s3">'''Default arguments that will be passed to the 
    :meth:`kivy.lang.Builder.template` method. 
 
    :attr:`title_args` is a :class:`~kivy.properties.DictProperty` and defaults 
    to {}. 
    '''</span>

    <span class="s1">collapse </span><span class="s2">= </span><span class="s1">BooleanProperty</span><span class="s2">(</span><span class="s4">True</span><span class="s2">)</span>
    <span class="s3">'''Boolean to indicate if the current item is collapsed or not. 
 
    :attr:`collapse` is a :class:`~kivy.properties.BooleanProperty` and 
    defaults to True. 
    '''</span>

    <span class="s1">collapse_alpha </span><span class="s2">= </span><span class="s1">NumericProperty</span><span class="s2">(</span><span class="s5">1.</span><span class="s2">)</span>
    <span class="s3">'''Value between 0 and 1 to indicate how much the item is collapsed (1) or 
    whether it is selected (0). It's mostly used for animation. 
 
    :attr:`collapse_alpha` is a :class:`~kivy.properties.NumericProperty` and 
    defaults to 1. 
    '''</span>

    <span class="s1">accordion </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">)</span>
    <span class="s3">'''Instance of the :class:`Accordion` that the item belongs to. 
 
    :attr:`accordion` is an :class:`~kivy.properties.ObjectProperty` and 
    defaults to None. 
    '''</span>

    <span class="s1">background_normal </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span>
        <span class="s3">'atlas://data/images/defaulttheme/button'</span><span class="s2">)</span>
    <span class="s3">'''Background image of the accordion item used for the default graphical 
    representation when the item is collapsed. 
 
    :attr:`background_normal` is a :class:`~kivy.properties.StringProperty` and 
    defaults to 'atlas://data/images/defaulttheme/button'. 
    '''</span>

    <span class="s1">background_disabled_normal </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span>
        <span class="s3">'atlas://data/images/defaulttheme/button_disabled'</span><span class="s2">)</span>
    <span class="s3">'''Background image of the accordion item used for the default graphical 
    representation when the item is collapsed and disabled. 
 
    .. versionadded:: 1.8.0 
 
    :attr:`background__disabled_normal` is a 
    :class:`~kivy.properties.StringProperty` and defaults to 
    'atlas://data/images/defaulttheme/button_disabled'. 
    '''</span>

    <span class="s1">background_selected </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span>
        <span class="s3">'atlas://data/images/defaulttheme/button_pressed'</span><span class="s2">)</span>
    <span class="s3">'''Background image of the accordion item used for the default graphical 
    representation when the item is selected (not collapsed). 
 
    :attr:`background_normal` is a :class:`~kivy.properties.StringProperty` and 
    defaults to 'atlas://data/images/defaulttheme/button_pressed'. 
    '''</span>

    <span class="s1">background_disabled_selected </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span>
        <span class="s3">'atlas://data/images/defaulttheme/button_disabled_pressed'</span><span class="s2">)</span>
    <span class="s3">'''Background image of the accordion item used for the default graphical 
    representation when the item is selected (not collapsed) and disabled. 
 
    .. versionadded:: 1.8.0 
 
    :attr:`background_disabled_selected` is a 
    :class:`~kivy.properties.StringProperty` and defaults to 
    'atlas://data/images/defaulttheme/button_disabled_pressed'. 
    '''</span>

    <span class="s1">orientation </span><span class="s2">= </span><span class="s1">OptionProperty</span><span class="s2">(</span><span class="s3">'vertical'</span><span class="s2">, </span><span class="s1">options</span><span class="s2">=(</span>
        <span class="s3">'horizontal'</span><span class="s2">, </span><span class="s3">'vertical'</span><span class="s2">))</span>
    <span class="s3">'''Link to the :attr:`Accordion.orientation` property. 
    '''</span>

    <span class="s1">min_space </span><span class="s2">= </span><span class="s1">NumericProperty</span><span class="s2">(</span><span class="s3">'44dp'</span><span class="s2">)</span>
    <span class="s3">'''Link to the :attr:`Accordion.min_space` property. 
    '''</span>

    <span class="s1">content_size </span><span class="s2">= </span><span class="s1">ListProperty</span><span class="s2">([</span><span class="s5">100</span><span class="s2">, </span><span class="s5">100</span><span class="s2">])</span>
    <span class="s3">'''(internal) Set by the :class:`Accordion` to the size allocated for the 
    content. 
    '''</span>

    <span class="s1">container </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">)</span>
    <span class="s3">'''(internal) Property that will be set to the container of children inside 
    the AccordionItem representation. 
    '''</span>

    <span class="s1">container_title </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">)</span>
    <span class="s3">'''(internal) Property that will be set to the container of title inside 
    the AccordionItem representation. 
    '''</span>

    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_trigger_title </span><span class="s2">= </span><span class="s1">Clock</span><span class="s2">.</span><span class="s1">create_trigger</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_update_title</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_anim_collapse </span><span class="s2">= </span><span class="s4">None</span>
        <span class="s1">super</span><span class="s2">(</span><span class="s1">AccordionItem</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">__init__</span><span class="s2">(**</span><span class="s1">kwargs</span><span class="s2">)</span>
        <span class="s1">trigger_title </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_trigger_title</span>
        <span class="s1">fbind </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">fbind</span>
        <span class="s1">fbind</span><span class="s2">(</span><span class="s3">'title'</span><span class="s2">, </span><span class="s1">trigger_title</span><span class="s2">)</span>
        <span class="s1">fbind</span><span class="s2">(</span><span class="s3">'title_template'</span><span class="s2">, </span><span class="s1">trigger_title</span><span class="s2">)</span>
        <span class="s1">fbind</span><span class="s2">(</span><span class="s3">'title_args'</span><span class="s2">, </span><span class="s1">trigger_title</span><span class="s2">)</span>
        <span class="s1">trigger_title</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">container </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s1">super</span><span class="s2">(</span><span class="s1">AccordionItem</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">add_widget</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>
            <span class="s4">return</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">container</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">remove_widget</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">container</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">container</span><span class="s2">.</span><span class="s1">remove_widget</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>
            <span class="s4">return</span>
        <span class="s1">super</span><span class="s2">(</span><span class="s1">AccordionItem</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">remove_widget</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">on_collapse</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">accordion </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">accordion</span>
        <span class="s4">if </span><span class="s1">accordion </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s4">return</span>
        <span class="s4">if not </span><span class="s1">value</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">accordion</span><span class="s2">.</span><span class="s1">select</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>
        <span class="s1">collapse_alpha </span><span class="s2">= </span><span class="s1">float</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_anim_collapse</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_anim_collapse</span><span class="s2">.</span><span class="s1">stop</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_anim_collapse </span><span class="s2">= </span><span class="s4">None</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">collapse_alpha </span><span class="s2">!= </span><span class="s1">collapse_alpha</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_anim_collapse </span><span class="s2">= </span><span class="s1">Animation</span><span class="s2">(</span>
                <span class="s1">collapse_alpha</span><span class="s2">=</span><span class="s1">collapse_alpha</span><span class="s2">,</span>
                <span class="s1">t</span><span class="s2">=</span><span class="s1">accordion</span><span class="s2">.</span><span class="s1">anim_func</span><span class="s2">,</span>
                <span class="s1">d</span><span class="s2">=</span><span class="s1">accordion</span><span class="s2">.</span><span class="s1">anim_duration</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_anim_collapse</span><span class="s2">.</span><span class="s1">start</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">on_collapse_alpha</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">accordion</span><span class="s2">.</span><span class="s1">_trigger_layout</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">on_touch_down</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">touch</span><span class="s2">):</span>
        <span class="s4">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">collide_point</span><span class="s2">(*</span><span class="s1">touch</span><span class="s2">.</span><span class="s1">pos</span><span class="s2">):</span>
            <span class="s4">return</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">disabled</span><span class="s2">:</span>
            <span class="s4">return True</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">collapse</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">collapse </span><span class="s2">= </span><span class="s4">False</span>
            <span class="s4">return True</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s4">return </span><span class="s1">super</span><span class="s2">(</span><span class="s1">AccordionItem</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">on_touch_down</span><span class="s2">(</span><span class="s1">touch</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">_update_title</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">dt</span><span class="s2">):</span>
        <span class="s4">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">container_title</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_trigger_title</span><span class="s2">()</span>
            <span class="s4">return</span>
        <span class="s1">c </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">container_title</span>
        <span class="s1">c</span><span class="s2">.</span><span class="s1">clear_widgets</span><span class="s2">()</span>
        <span class="s1">instance </span><span class="s2">= </span><span class="s1">Builder</span><span class="s2">.</span><span class="s1">template</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">title_template</span><span class="s2">,</span>
                                    <span class="s1">title</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">title</span><span class="s2">,</span>
                                    <span class="s1">item</span><span class="s2">=</span><span class="s1">self</span><span class="s2">,</span>
                                    <span class="s2">**</span><span class="s1">self</span><span class="s2">.</span><span class="s1">title_args</span><span class="s2">)</span>
        <span class="s1">c</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">instance</span><span class="s2">)</span>


<span class="s4">class </span><span class="s1">Accordion</span><span class="s2">(</span><span class="s1">Widget</span><span class="s2">):</span>
    <span class="s0">'''Accordion class. See module documentation for more information. 
    '''</span>

    <span class="s1">orientation </span><span class="s2">= </span><span class="s1">OptionProperty</span><span class="s2">(</span><span class="s3">'horizontal'</span><span class="s2">, </span><span class="s1">options</span><span class="s2">=(</span>
        <span class="s3">'horizontal'</span><span class="s2">, </span><span class="s3">'vertical'</span><span class="s2">))</span>
    <span class="s3">'''Orientation of the layout. 
 
    :attr:`orientation` is an :class:`~kivy.properties.OptionProperty` 
    and defaults to 'horizontal'. Can take a value of 'vertical' or 
    'horizontal'. 
 
    '''</span>

    <span class="s1">anim_duration </span><span class="s2">= </span><span class="s1">NumericProperty</span><span class="s2">(</span><span class="s5">.25</span><span class="s2">)</span>
    <span class="s3">'''Duration of the animation in seconds when a new accordion item is 
    selected. 
 
    :attr:`anim_duration` is a :class:`~kivy.properties.NumericProperty` and 
    defaults to .25 (250ms). 
    '''</span>

    <span class="s1">anim_func </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">(</span><span class="s3">'out_expo'</span><span class="s2">)</span>
    <span class="s3">'''Easing function to use for the animation. Check 
    :class:`kivy.animation.AnimationTransition` for more information about 
    available animation functions. 
 
    :attr:`anim_func` is an :class:`~kivy.properties.ObjectProperty` and 
    defaults to 'out_expo'. You can set a string or a function to use as an 
    easing function. 
    '''</span>

    <span class="s1">min_space </span><span class="s2">= </span><span class="s1">NumericProperty</span><span class="s2">(</span><span class="s3">'44dp'</span><span class="s2">)</span>
    <span class="s3">'''Minimum space to use for the title of each item. This value is 
    automatically set for each child every time the layout event occurs. 
 
    :attr:`min_space` is a :class:`~kivy.properties.NumericProperty` and 
    defaults to 44 (px). 
    '''</span>

    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s1">super</span><span class="s2">(</span><span class="s1">Accordion</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">__init__</span><span class="s2">(**</span><span class="s1">kwargs</span><span class="s2">)</span>
        <span class="s1">update </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_trigger_layout </span><span class="s2">= </span><span class="s1">\</span>
            <span class="s1">Clock</span><span class="s2">.</span><span class="s1">create_trigger</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_do_layout</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">)</span>
        <span class="s1">fbind </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">fbind</span>
        <span class="s1">fbind</span><span class="s2">(</span><span class="s3">'orientation'</span><span class="s2">, </span><span class="s1">update</span><span class="s2">)</span>
        <span class="s1">fbind</span><span class="s2">(</span><span class="s3">'children'</span><span class="s2">, </span><span class="s1">update</span><span class="s2">)</span>
        <span class="s1">fbind</span><span class="s2">(</span><span class="s3">'size'</span><span class="s2">, </span><span class="s1">update</span><span class="s2">)</span>
        <span class="s1">fbind</span><span class="s2">(</span><span class="s3">'pos'</span><span class="s2">, </span><span class="s1">update</span><span class="s2">)</span>
        <span class="s1">fbind</span><span class="s2">(</span><span class="s3">'min_space'</span><span class="s2">, </span><span class="s1">update</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">widget</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s4">if not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, </span><span class="s1">AccordionItem</span><span class="s2">):</span>
            <span class="s4">raise </span><span class="s1">AccordionException</span><span class="s2">(</span><span class="s3">'Accordion accept only AccordionItem'</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">accordion </span><span class="s2">= </span><span class="s1">self</span>
        <span class="s1">super</span><span class="s2">(</span><span class="s1">Accordion</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">select</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">instance </span><span class="s4">not in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">children</span><span class="s2">:</span>
            <span class="s4">raise </span><span class="s1">AccordionException</span><span class="s2">(</span>
                <span class="s3">'Accordion: instance not found in children'</span><span class="s2">)</span>
        <span class="s4">for </span><span class="s1">widget </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">children</span><span class="s2">:</span>
            <span class="s1">widget</span><span class="s2">.</span><span class="s1">collapse </span><span class="s2">= </span><span class="s1">widget </span><span class="s4">is not </span><span class="s1">instance</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_trigger_layout</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">_do_layout</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">dt</span><span class="s2">):</span>
        <span class="s1">children </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">children</span>
        <span class="s4">if </span><span class="s1">children</span><span class="s2">:</span>
            <span class="s1">all_collapsed </span><span class="s2">= </span><span class="s1">all</span><span class="s2">(</span><span class="s1">x</span><span class="s2">.</span><span class="s1">collapse </span><span class="s4">for </span><span class="s1">x </span><span class="s4">in </span><span class="s1">children</span><span class="s2">)</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">all_collapsed </span><span class="s2">= </span><span class="s4">False</span>

        <span class="s4">if </span><span class="s1">all_collapsed</span><span class="s2">:</span>
            <span class="s1">children</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">collapse </span><span class="s2">= </span><span class="s4">False</span>

        <span class="s1">orientation </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">orientation</span>
        <span class="s1">min_space </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">min_space</span>
        <span class="s1">min_space_total </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">children</span><span class="s2">) * </span><span class="s1">self</span><span class="s2">.</span><span class="s1">min_space</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">size</span>
        <span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">pos</span>
        <span class="s4">if </span><span class="s1">orientation </span><span class="s2">== </span><span class="s3">'horizontal'</span><span class="s2">:</span>
            <span class="s1">display_space </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">width </span><span class="s2">- </span><span class="s1">min_space_total</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">display_space </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">height </span><span class="s2">- </span><span class="s1">min_space_total</span>

        <span class="s4">if </span><span class="s1">display_space </span><span class="s2">&lt;= </span><span class="s5">0</span><span class="s2">:</span>
            <span class="s1">Logger</span><span class="s2">.</span><span class="s1">warning</span><span class="s2">(</span><span class="s3">'Accordion: not enough space '</span>
                           <span class="s3">'for displaying all children'</span><span class="s2">)</span>
            <span class="s1">Logger</span><span class="s2">.</span><span class="s1">warning</span><span class="s2">(</span><span class="s3">'Accordion: need %dpx, got %dpx' </span><span class="s2">% (</span>
                <span class="s1">min_space_total</span><span class="s2">, </span><span class="s1">min_space_total </span><span class="s2">+ </span><span class="s1">display_space</span><span class="s2">))</span>
            <span class="s1">Logger</span><span class="s2">.</span><span class="s1">warning</span><span class="s2">(</span><span class="s3">'Accordion: layout aborted.'</span><span class="s2">)</span>
            <span class="s4">return</span>

        <span class="s4">if </span><span class="s1">orientation </span><span class="s2">== </span><span class="s3">'horizontal'</span><span class="s2">:</span>
            <span class="s1">children </span><span class="s2">= </span><span class="s1">reversed</span><span class="s2">(</span><span class="s1">children</span><span class="s2">)</span>

        <span class="s4">for </span><span class="s1">child </span><span class="s4">in </span><span class="s1">children</span><span class="s2">:</span>
            <span class="s1">child_space </span><span class="s2">= </span><span class="s1">min_space</span>
            <span class="s1">child_space </span><span class="s2">+= </span><span class="s1">display_space </span><span class="s2">* (</span><span class="s5">1 </span><span class="s2">- </span><span class="s1">child</span><span class="s2">.</span><span class="s1">collapse_alpha</span><span class="s2">)</span>
            <span class="s1">child</span><span class="s2">.</span><span class="s1">_min_space </span><span class="s2">= </span><span class="s1">min_space</span>
            <span class="s1">child</span><span class="s2">.</span><span class="s1">x </span><span class="s2">= </span><span class="s1">x</span>
            <span class="s1">child</span><span class="s2">.</span><span class="s1">y </span><span class="s2">= </span><span class="s1">y</span>
            <span class="s1">child</span><span class="s2">.</span><span class="s1">orientation </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">orientation</span>
            <span class="s4">if </span><span class="s1">orientation </span><span class="s2">== </span><span class="s3">'horizontal'</span><span class="s2">:</span>
                <span class="s1">child</span><span class="s2">.</span><span class="s1">content_size </span><span class="s2">= </span><span class="s1">display_space</span><span class="s2">, </span><span class="s1">h</span>
                <span class="s1">child</span><span class="s2">.</span><span class="s1">width </span><span class="s2">= </span><span class="s1">child_space</span>
                <span class="s1">child</span><span class="s2">.</span><span class="s1">height </span><span class="s2">= </span><span class="s1">h</span>
                <span class="s1">x </span><span class="s2">+= </span><span class="s1">child_space</span>
            <span class="s4">else</span><span class="s2">:</span>
                <span class="s1">child</span><span class="s2">.</span><span class="s1">content_size </span><span class="s2">= </span><span class="s1">w</span><span class="s2">, </span><span class="s1">display_space</span>
                <span class="s1">child</span><span class="s2">.</span><span class="s1">width </span><span class="s2">= </span><span class="s1">w</span>
                <span class="s1">child</span><span class="s2">.</span><span class="s1">height </span><span class="s2">= </span><span class="s1">child_space</span>
                <span class="s1">y </span><span class="s2">+= </span><span class="s1">child_space</span>


<span class="s4">if </span><span class="s1">__name__ </span><span class="s2">== </span><span class="s3">'__main__'</span><span class="s2">:</span>
    <span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">base </span><span class="s4">import </span><span class="s1">runTouchApp</span>
    <span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">button </span><span class="s4">import </span><span class="s1">Button</span>
    <span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">boxlayout </span><span class="s4">import </span><span class="s1">BoxLayout</span>
    <span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">label </span><span class="s4">import </span><span class="s1">Label</span>

    <span class="s1">acc </span><span class="s2">= </span><span class="s1">Accordion</span><span class="s2">()</span>
    <span class="s4">for </span><span class="s1">x </span><span class="s4">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">10</span><span class="s2">):</span>
        <span class="s1">item </span><span class="s2">= </span><span class="s1">AccordionItem</span><span class="s2">(</span><span class="s1">title</span><span class="s2">=</span><span class="s3">'Title %d' </span><span class="s2">% </span><span class="s1">x</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">x </span><span class="s2">== </span><span class="s5">0</span><span class="s2">:</span>
            <span class="s1">item</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">Button</span><span class="s2">(</span><span class="s1">text</span><span class="s2">=</span><span class="s3">'Content %d' </span><span class="s2">% </span><span class="s1">x</span><span class="s2">))</span>
        <span class="s4">elif </span><span class="s1">x </span><span class="s2">== </span><span class="s5">1</span><span class="s2">:</span>
            <span class="s1">z </span><span class="s2">= </span><span class="s1">BoxLayout</span><span class="s2">(</span><span class="s1">orientation</span><span class="s2">=</span><span class="s3">'vertical'</span><span class="s2">)</span>
            <span class="s1">z</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">Button</span><span class="s2">(</span><span class="s1">text</span><span class="s2">=</span><span class="s1">str</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">size_hint_y</span><span class="s2">=</span><span class="s4">None</span><span class="s2">, </span><span class="s1">height</span><span class="s2">=</span><span class="s5">35</span><span class="s2">))</span>
            <span class="s1">z</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">Label</span><span class="s2">(</span><span class="s1">text</span><span class="s2">=</span><span class="s3">'Content %d' </span><span class="s2">% </span><span class="s1">x</span><span class="s2">))</span>
            <span class="s1">item</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">z</span><span class="s2">)</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">item</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">Label</span><span class="s2">(</span><span class="s1">text</span><span class="s2">=</span><span class="s3">'This is a big content</span><span class="s4">\n</span><span class="s3">' </span><span class="s2">* </span><span class="s5">20</span><span class="s2">))</span>
        <span class="s1">acc</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">item</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">toggle_layout</span><span class="s2">(*</span><span class="s1">l</span><span class="s2">):</span>
        <span class="s1">o </span><span class="s2">= </span><span class="s1">acc</span><span class="s2">.</span><span class="s1">orientation</span>
        <span class="s1">acc</span><span class="s2">.</span><span class="s1">orientation </span><span class="s2">= </span><span class="s3">'vertical' </span><span class="s4">if </span><span class="s1">o </span><span class="s2">== </span><span class="s3">'horizontal' </span><span class="s4">else </span><span class="s3">'horizontal'</span>
    <span class="s1">btn </span><span class="s2">= </span><span class="s1">Button</span><span class="s2">(</span><span class="s1">text</span><span class="s2">=</span><span class="s3">'Toggle layout'</span><span class="s2">)</span>
    <span class="s1">btn</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">on_release</span><span class="s2">=</span><span class="s1">toggle_layout</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">select_2nd_item</span><span class="s2">(*</span><span class="s1">l</span><span class="s2">):</span>
        <span class="s1">acc</span><span class="s2">.</span><span class="s1">select</span><span class="s2">(</span><span class="s1">acc</span><span class="s2">.</span><span class="s1">children</span><span class="s2">[-</span><span class="s5">2</span><span class="s2">])</span>
    <span class="s1">btn2 </span><span class="s2">= </span><span class="s1">Button</span><span class="s2">(</span><span class="s1">text</span><span class="s2">=</span><span class="s3">'Select 2nd item'</span><span class="s2">)</span>
    <span class="s1">btn2</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">on_release</span><span class="s2">=</span><span class="s1">select_2nd_item</span><span class="s2">)</span>

    <span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">slider </span><span class="s4">import </span><span class="s1">Slider</span>
    <span class="s1">slider </span><span class="s2">= </span><span class="s1">Slider</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">update_min_space</span><span class="s2">(</span><span class="s1">instance</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">acc</span><span class="s2">.</span><span class="s1">min_space </span><span class="s2">= </span><span class="s1">value</span>

    <span class="s1">slider</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">value</span><span class="s2">=</span><span class="s1">update_min_space</span><span class="s2">)</span>

    <span class="s1">root </span><span class="s2">= </span><span class="s1">BoxLayout</span><span class="s2">(</span><span class="s1">spacing</span><span class="s2">=</span><span class="s5">20</span><span class="s2">, </span><span class="s1">padding</span><span class="s2">=</span><span class="s5">20</span><span class="s2">)</span>
    <span class="s1">controls </span><span class="s2">= </span><span class="s1">BoxLayout</span><span class="s2">(</span><span class="s1">orientation</span><span class="s2">=</span><span class="s3">'vertical'</span><span class="s2">, </span><span class="s1">size_hint_x</span><span class="s2">=</span><span class="s5">.3</span><span class="s2">)</span>
    <span class="s1">controls</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">btn</span><span class="s2">)</span>
    <span class="s1">controls</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">btn2</span><span class="s2">)</span>
    <span class="s1">controls</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">slider</span><span class="s2">)</span>
    <span class="s1">root</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">controls</span><span class="s2">)</span>
    <span class="s1">root</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">acc</span><span class="s2">)</span>
    <span class="s1">runTouchApp</span><span class="s2">(</span><span class="s1">root</span><span class="s2">)</span>
</pre>
</body>
</html>