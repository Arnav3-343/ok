<html>
<head>
<title>screenmanager.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #cf8e6d;}
.s5 { color: #2aacb8;}
.s6 { color: #7a7e85;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
screenmanager.py</font>
</center></td></tr></table>
<pre><span class="s0">'''Screen Manager 
============== 
 
.. image:: images/screenmanager.gif 
    :align: right 
 
.. versionadded:: 1.4.0 
 
The screen manager is a widget dedicated to managing multiple screens for your 
application. The default :class:`ScreenManager` displays only one 
:class:`Screen` at a time and uses a :class:`TransitionBase` to switch from one 
Screen to another. 
 
Multiple transitions are supported based on changing the screen coordinates / 
scale or even performing fancy animation using custom shaders. 
 
Basic Usage 
----------- 
 
Let's construct a Screen Manager with 4 named screens. When you are creating 
a screen, **you absolutely need to give a name to it**:: 
 
    from kivy.uix.screenmanager import ScreenManager, Screen 
 
    # Create the manager 
    sm = ScreenManager() 
 
    # Add few screens 
    for i in range(4): 
        screen = Screen(name='Title %d' % i) 
        sm.add_widget(screen) 
 
    # By default, the first screen added into the ScreenManager will be 
    # displayed. You can then change to another screen. 
 
    # Let's display the screen named 'Title 2' 
    # A transition will automatically be used. 
    sm.current = 'Title 2' 
 
The default :attr:`ScreenManager.transition` is a :class:`SlideTransition` with 
options :attr:`~SlideTransition.direction` and 
:attr:`~TransitionBase.duration`. 
 
Please note that by default, a :class:`Screen` displays nothing: it's just a 
:class:`~kivy.uix.relativelayout.RelativeLayout`. You need to use that class as 
a root widget for your own screen, the best way being to subclass. 
 
.. warning:: 
    As :class:`Screen` is a :class:`~kivy.uix.relativelayout.RelativeLayout`, 
    it is important to understand the 
    :ref:`kivy-uix-relativelayout-common-pitfalls`. 
 
Here is an example with a 'Menu Screen' and a 'Settings Screen':: 
 
    from kivy.app import App 
    from kivy.lang import Builder 
    from kivy.uix.screenmanager import ScreenManager, Screen 
 
    # Create both screens. Please note the root.manager.current: this is how 
    # you can control the ScreenManager from kv. Each screen has by default a 
    # property manager that gives you the instance of the ScreenManager used. 
    Builder.load_string(&quot;&quot;&quot; 
    &lt;MenuScreen&gt;: 
        BoxLayout: 
            Button: 
                text: 'Goto settings' 
                on_press: root.manager.current = 'settings' 
            Button: 
                text: 'Quit' 
 
    &lt;SettingsScreen&gt;: 
        BoxLayout: 
            Button: 
                text: 'My settings button' 
            Button: 
                text: 'Back to menu' 
                on_press: root.manager.current = 'menu' 
    &quot;&quot;&quot;) 
 
    # Declare both screens 
    class MenuScreen(Screen): 
        pass 
 
    class SettingsScreen(Screen): 
        pass 
 
    class TestApp(App): 
 
        def build(self): 
            # Create the screen manager 
            sm = ScreenManager() 
            sm.add_widget(MenuScreen(name='menu')) 
            sm.add_widget(SettingsScreen(name='settings')) 
 
            return sm 
 
    if __name__ == '__main__': 
        TestApp().run() 
 
 
Changing Direction 
------------------ 
 
A common use case for :class:`ScreenManager` involves using a 
:class:`SlideTransition` which slides right to the next screen 
and slides left to the previous screen. Building on the previous 
example, this can be accomplished like so:: 
 
    Builder.load_string(&quot;&quot;&quot; 
    &lt;MenuScreen&gt;: 
        BoxLayout: 
            Button: 
                text: 'Goto settings' 
                on_press: 
                    root.manager.transition.direction = 'left' 
                    root.manager.current = 'settings' 
            Button: 
                text: 'Quit' 
 
    &lt;SettingsScreen&gt;: 
        BoxLayout: 
            Button: 
                text: 'My settings button' 
            Button: 
                text: 'Back to menu' 
                on_press: 
                    root.manager.transition.direction = 'right' 
                    root.manager.current = 'menu' 
    &quot;&quot;&quot;) 
 
 
Advanced Usage 
-------------- 
 
From 1.8.0, you can now switch dynamically to a new screen, change the 
transition options and remove the previous one by using 
:meth:`~ScreenManager.switch_to`:: 
 
    sm = ScreenManager() 
    screens = [Screen(name='Title {}'.format(i)) for i in range(4)] 
 
    sm.switch_to(screens[0]) 
    # later 
    sm.switch_to(screens[1], direction='right') 
 
Note that this method adds the screen to the :class:`ScreenManager` instance 
and should not be used if your screens have already been added to this 
instance. To switch to a screen which is already added, you should use the 
:attr:`~ScreenManager.current` property. 
 
 
Changing transitions 
-------------------- 
 
You have multiple transitions available by default, such as: 
 
- :class:`NoTransition` - switches screens instantly with no animation 
- :class:`SlideTransition` - slide the screen in/out, from any direction 
- :class:`CardTransition` - new screen slides on the previous 
  or the old one slides off the new one depending on the mode 
- :class:`SwapTransition` - implementation of the iOS swap transition 
- :class:`FadeTransition` - shader to fade the screen in/out 
- :class:`WipeTransition` - shader to wipe the screens from right to left 
- :class:`FallOutTransition` - shader where the old screen 'falls' and 
  becomes transparent, revealing the new one behind it. 
- :class:`RiseInTransition` - shader where the new screen rises from the 
  screen centre while fading from transparent to opaque. 
 
You can easily switch transitions by changing the 
:attr:`ScreenManager.transition` property:: 
 
    sm = ScreenManager(transition=FadeTransition()) 
 
.. note:: 
 
    Currently, none of Shader based Transitions use 
    anti-aliasing. This is because they use the FBO which doesn't have 
    any logic to handle supersampling. This is a known issue and we 
    are working on a transparent implementation that will give the 
    same results as if it had been rendered on screen. 
 
    To be more concrete, if you see sharp edged text during the animation, it's 
    normal. 
 
'''</span>

<span class="s1">__all__ </span><span class="s2">= (</span><span class="s3">'Screen'</span><span class="s2">, </span><span class="s3">'ScreenManager'</span><span class="s2">, </span><span class="s3">'ScreenManagerException'</span><span class="s2">,</span>
           <span class="s3">'TransitionBase'</span><span class="s2">, </span><span class="s3">'ShaderTransition'</span><span class="s2">, </span><span class="s3">'SlideTransition'</span><span class="s2">,</span>
           <span class="s3">'SwapTransition'</span><span class="s2">, </span><span class="s3">'FadeTransition'</span><span class="s2">, </span><span class="s3">'WipeTransition'</span><span class="s2">,</span>
           <span class="s3">'FallOutTransition'</span><span class="s2">, </span><span class="s3">'RiseInTransition'</span><span class="s2">, </span><span class="s3">'NoTransition'</span><span class="s2">,</span>
           <span class="s3">'CardTransition'</span><span class="s2">)</span>

<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">compat </span><span class="s4">import </span><span class="s1">iteritems</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">logger </span><span class="s4">import </span><span class="s1">Logger</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">event </span><span class="s4">import </span><span class="s1">EventDispatcher</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">clock </span><span class="s4">import </span><span class="s1">Clock</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">floatlayout </span><span class="s4">import </span><span class="s1">FloatLayout</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">properties </span><span class="s4">import </span><span class="s2">(</span><span class="s1">StringProperty</span><span class="s2">, </span><span class="s1">ObjectProperty</span><span class="s2">, </span><span class="s1">AliasProperty</span><span class="s2">,</span>
                             <span class="s1">NumericProperty</span><span class="s2">, </span><span class="s1">ListProperty</span><span class="s2">, </span><span class="s1">OptionProperty</span><span class="s2">,</span>
                             <span class="s1">BooleanProperty</span><span class="s2">, </span><span class="s1">ColorProperty</span><span class="s2">)</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">animation </span><span class="s4">import </span><span class="s1">Animation</span><span class="s2">, </span><span class="s1">AnimationTransition</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">relativelayout </span><span class="s4">import </span><span class="s1">RelativeLayout</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">lang </span><span class="s4">import </span><span class="s1">Builder</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">graphics </span><span class="s4">import </span><span class="s2">(</span><span class="s1">RenderContext</span><span class="s2">, </span><span class="s1">Rectangle</span><span class="s2">, </span><span class="s1">Fbo</span><span class="s2">,</span>
                           <span class="s1">ClearColor</span><span class="s2">, </span><span class="s1">ClearBuffers</span><span class="s2">, </span><span class="s1">BindTexture</span><span class="s2">, </span><span class="s1">PushMatrix</span><span class="s2">,</span>
                           <span class="s1">PopMatrix</span><span class="s2">, </span><span class="s1">Translate</span><span class="s2">, </span><span class="s1">Callback</span><span class="s2">, </span><span class="s1">Scale</span><span class="s2">)</span>


<span class="s4">class </span><span class="s1">ScreenManagerException</span><span class="s2">(</span><span class="s1">Exception</span><span class="s2">):</span>
    <span class="s0">'''Exception for the :class:`ScreenManager`. 
    '''</span>
    <span class="s4">pass</span>


<span class="s4">class </span><span class="s1">Screen</span><span class="s2">(</span><span class="s1">RelativeLayout</span><span class="s2">):</span>
    <span class="s0">'''Screen is an element intended to be used with a :class:`ScreenManager`. 
    Check module documentation for more information. 
 
    :Events: 
        `on_pre_enter`: () 
            Event fired when the screen is about to be used: the entering 
            animation is started. 
        `on_enter`: () 
            Event fired when the screen is displayed: the entering animation is 
            complete. 
        `on_pre_leave`: () 
            Event fired when the screen is about to be removed: the leaving 
            animation is started. 
        `on_leave`: () 
            Event fired when the screen is removed: the leaving animation is 
            finished. 
 
    .. versionchanged:: 1.6.0 
        Events `on_pre_enter`, `on_enter`, `on_pre_leave` and `on_leave` were 
        added. 
    '''</span>

    <span class="s1">name </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span><span class="s3">''</span><span class="s2">)</span>
    <span class="s3">''' 
    Name of the screen which must be unique within a :class:`ScreenManager`. 
    This is the name used for :attr:`ScreenManager.current`. 
 
    :attr:`name` is a :class:`~kivy.properties.StringProperty` and defaults to 
    ''. 
    '''</span>

    <span class="s1">manager </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">, </span><span class="s1">allownone</span><span class="s2">=</span><span class="s4">True</span><span class="s2">)</span>
    <span class="s3">''':class:`ScreenManager` object, set when the screen is added to a 
    manager. 
 
    :attr:`manager` is an :class:`~kivy.properties.ObjectProperty` and 
    defaults to None, read-only. 
 
    '''</span>

    <span class="s1">transition_progress </span><span class="s2">= </span><span class="s1">NumericProperty</span><span class="s2">(</span><span class="s5">0.</span><span class="s2">)</span>
    <span class="s3">'''Value that represents the completion of the current transition, if any 
    is occurring. 
 
    If a transition is in progress, whatever the mode, the value will change 
    from 0 to 1. If you want to know if it's an entering or leaving animation, 
    check the :attr:`transition_state`. 
 
    :attr:`transition_progress` is a :class:`~kivy.properties.NumericProperty` 
    and defaults to 0. 
    '''</span>

    <span class="s1">transition_state </span><span class="s2">= </span><span class="s1">OptionProperty</span><span class="s2">(</span><span class="s3">'out'</span><span class="s2">, </span><span class="s1">options</span><span class="s2">=(</span><span class="s3">'in'</span><span class="s2">, </span><span class="s3">'out'</span><span class="s2">))</span>
    <span class="s3">'''Value that represents the state of the transition: 
 
    - 'in' if the transition is going to show your screen 
    - 'out' if the transition is going to hide your screen 
 
    After the transition is complete, the state will retain its last value (in 
    or out). 
 
    :attr:`transition_state` is an :class:`~kivy.properties.OptionProperty` and 
    defaults to 'out'. 
    '''</span>

    <span class="s1">__events__ </span><span class="s2">= (</span><span class="s3">'on_pre_enter'</span><span class="s2">, </span><span class="s3">'on_enter'</span><span class="s2">, </span><span class="s3">'on_pre_leave'</span><span class="s2">, </span><span class="s3">'on_leave'</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">on_pre_enter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">):</span>
        <span class="s4">pass</span>

    <span class="s4">def </span><span class="s1">on_enter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">):</span>
        <span class="s4">pass</span>

    <span class="s4">def </span><span class="s1">on_pre_leave</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">):</span>
        <span class="s4">pass</span>

    <span class="s4">def </span><span class="s1">on_leave</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">):</span>
        <span class="s4">pass</span>

    <span class="s4">def </span><span class="s1">__repr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s3">'&lt;Screen name=%r&gt;' </span><span class="s2">% </span><span class="s1">self</span><span class="s2">.</span><span class="s1">name</span>


<span class="s4">class </span><span class="s1">TransitionBase</span><span class="s2">(</span><span class="s1">EventDispatcher</span><span class="s2">):</span>
    <span class="s0">'''TransitionBase is used to animate 2 screens within the 
    :class:`ScreenManager`. This class acts as a base for other 
    implementations like the :class:`SlideTransition` and 
    :class:`SwapTransition`. 
 
    :Events: 
        `on_progress`: Transition object, progression float 
            Fired during the animation of the transition. 
        `on_complete`: Transition object 
            Fired when the transition is finished. 
    '''</span>

    <span class="s1">screen_out </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">()</span>
    <span class="s3">'''Property that contains the screen to hide. 
    Automatically set by the :class:`ScreenManager`. 
 
    :class:`screen_out` is an :class:`~kivy.properties.ObjectProperty` and 
    defaults to None. 
    '''</span>

    <span class="s1">screen_in </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">()</span>
    <span class="s3">'''Property that contains the screen to show. 
    Automatically set by the :class:`ScreenManager`. 
 
    :class:`screen_in` is an :class:`~kivy.properties.ObjectProperty` and 
    defaults to None. 
    '''</span>

    <span class="s1">duration </span><span class="s2">= </span><span class="s1">NumericProperty</span><span class="s2">(</span><span class="s5">.4</span><span class="s2">)</span>
    <span class="s3">'''Duration in seconds of the transition. 
 
    :class:`duration` is a :class:`~kivy.properties.NumericProperty` and 
    defaults to .4 (= 400ms). 
 
    .. versionchanged:: 1.8.0 
 
        Default duration has been changed from 700ms to 400ms. 
    '''</span>

    <span class="s1">manager </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">()</span>
    <span class="s3">''':class:`ScreenManager` object, set when the screen is added to a 
    manager. 
 
    :attr:`manager` is an :class:`~kivy.properties.ObjectProperty` and 
    defaults to None, read-only. 
 
    '''</span>

    <span class="s1">is_active </span><span class="s2">= </span><span class="s1">BooleanProperty</span><span class="s2">(</span><span class="s4">False</span><span class="s2">)</span>
    <span class="s3">'''Indicate whether the transition is currently active or not. 
 
    :attr:`is_active` is a :class:`~kivy.properties.BooleanProperty` and 
    defaults to False, read-only. 
    '''</span>

    <span class="s6"># privates</span>

    <span class="s1">_anim </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">(</span><span class="s1">allownone</span><span class="s2">=</span><span class="s4">True</span><span class="s2">)</span>

    <span class="s1">__events__ </span><span class="s2">= (</span><span class="s3">'on_progress'</span><span class="s2">, </span><span class="s3">'on_complete'</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">start</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">manager</span><span class="s2">):</span>
        <span class="s0">'''(internal) Starts the transition. This is automatically 
        called by the :class:`ScreenManager`. 
        '''</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">is_active</span><span class="s2">:</span>
            <span class="s4">raise </span><span class="s1">ScreenManagerException</span><span class="s2">(</span><span class="s3">'start() is called twice!'</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">manager </span><span class="s2">= </span><span class="s1">manager</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_anim </span><span class="s2">= </span><span class="s1">Animation</span><span class="s2">(</span><span class="s1">d</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">duration</span><span class="s2">, </span><span class="s1">s</span><span class="s2">=</span><span class="s5">0</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_anim</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">on_progress</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_on_progress</span><span class="s2">,</span>
                        <span class="s1">on_complete</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_on_complete</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">add_screen</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">screen_in</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">screen_in</span><span class="s2">.</span><span class="s1">transition_progress </span><span class="s2">= </span><span class="s5">0.</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">screen_in</span><span class="s2">.</span><span class="s1">transition_state </span><span class="s2">= </span><span class="s3">'in'</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">screen_out</span><span class="s2">.</span><span class="s1">transition_progress </span><span class="s2">= </span><span class="s5">0.</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">screen_out</span><span class="s2">.</span><span class="s1">transition_state </span><span class="s2">= </span><span class="s3">'out'</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">screen_in</span><span class="s2">.</span><span class="s1">dispatch</span><span class="s2">(</span><span class="s3">'on_pre_enter'</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">screen_out</span><span class="s2">.</span><span class="s1">dispatch</span><span class="s2">(</span><span class="s3">'on_pre_leave'</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">is_active </span><span class="s2">= </span><span class="s4">True</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_anim</span><span class="s2">.</span><span class="s1">start</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dispatch</span><span class="s2">(</span><span class="s3">'on_progress'</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">stop</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">'''(internal) Stops the transition. This is automatically called by the 
        :class:`ScreenManager`. 
        '''</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_anim</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_anim</span><span class="s2">.</span><span class="s1">cancel</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">dispatch</span><span class="s2">(</span><span class="s3">'on_complete'</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_anim </span><span class="s2">= </span><span class="s4">None</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">is_active </span><span class="s2">= </span><span class="s4">False</span>

    <span class="s4">def </span><span class="s1">add_screen</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">screen</span><span class="s2">):</span>
        <span class="s0">'''(internal) Used to add a screen to the :class:`ScreenManager`. 
        '''</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">manager</span><span class="s2">.</span><span class="s1">real_add_widget</span><span class="s2">(</span><span class="s1">screen</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">remove_screen</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">screen</span><span class="s2">):</span>
        <span class="s0">'''(internal) Used to remove a screen from the :class:`ScreenManager`. 
        '''</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">manager</span><span class="s2">.</span><span class="s1">real_remove_widget</span><span class="s2">(</span><span class="s1">screen</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">on_complete</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">remove_screen</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">screen_out</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">on_progress</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">progression</span><span class="s2">):</span>
        <span class="s4">pass</span>

    <span class="s4">def </span><span class="s1">_on_progress</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">l</span><span class="s2">):</span>
        <span class="s1">progress </span><span class="s2">= </span><span class="s1">l</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">]</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">screen_in</span><span class="s2">.</span><span class="s1">transition_progress </span><span class="s2">= </span><span class="s1">progress</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">screen_out</span><span class="s2">.</span><span class="s1">transition_progress </span><span class="s2">= </span><span class="s5">1. </span><span class="s2">- </span><span class="s1">progress</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dispatch</span><span class="s2">(</span><span class="s3">'on_progress'</span><span class="s2">, </span><span class="s1">progress</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">_on_complete</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">l</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">is_active </span><span class="s2">= </span><span class="s4">False</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dispatch</span><span class="s2">(</span><span class="s3">'on_complete'</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">screen_in</span><span class="s2">.</span><span class="s1">dispatch</span><span class="s2">(</span><span class="s3">'on_enter'</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">screen_out</span><span class="s2">.</span><span class="s1">dispatch</span><span class="s2">(</span><span class="s3">'on_leave'</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_anim </span><span class="s2">= </span><span class="s4">None</span>


<span class="s4">class </span><span class="s1">ShaderTransition</span><span class="s2">(</span><span class="s1">TransitionBase</span><span class="s2">):</span>
    <span class="s0">'''Transition class that uses a Shader for animating the transition between 
    2 screens. By default, this class doesn't assign any fragment/vertex 
    shader. If you want to create your own fragment shader for the transition, 
    you need to declare the header yourself and include the &quot;t&quot;, &quot;tex_in&quot; and 
    &quot;tex_out&quot; uniform:: 
 
        # Create your own transition. This shader implements a &quot;fading&quot; 
        # transition. 
        fs = &quot;&quot;&quot;$HEADER 
            uniform float t; 
            uniform sampler2D tex_in; 
            uniform sampler2D tex_out; 
 
            void main(void) { 
                vec4 cin = texture2D(tex_in, tex_coord0); 
                vec4 cout = texture2D(tex_out, tex_coord0); 
                gl_FragColor = mix(cout, cin, t); 
            } 
        &quot;&quot;&quot; 
 
        # And create your transition 
        tr = ShaderTransition(fs=fs) 
        sm = ScreenManager(transition=tr) 
 
    '''</span>

    <span class="s1">fs </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">)</span>
    <span class="s3">'''Fragment shader to use. 
 
    :attr:`fs` is a :class:`~kivy.properties.StringProperty` and defaults to 
    None.'''</span>

    <span class="s1">vs </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">)</span>
    <span class="s3">'''Vertex shader to use. 
 
    :attr:`vs` is a :class:`~kivy.properties.StringProperty` and defaults to 
    None.'''</span>

    <span class="s1">clearcolor </span><span class="s2">= </span><span class="s1">ColorProperty</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">])</span>
    <span class="s3">'''Sets the color of Fbo ClearColor. 
 
    .. versionadded:: 1.9.0 
 
    :attr:`clearcolor` is a :class:`~kivy.properties.ColorProperty` 
    and defaults to [0, 0, 0, 1]. 
 
    .. versionchanged:: 2.0.0 
        Changed from :class:`~kivy.properties.ListProperty` to 
        :class:`~kivy.properties.ColorProperty`. 
    '''</span>

    <span class="s4">def </span><span class="s1">make_screen_fbo</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">screen</span><span class="s2">):</span>
        <span class="s1">fbo </span><span class="s2">= </span><span class="s1">Fbo</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=</span><span class="s1">screen</span><span class="s2">.</span><span class="s1">size</span><span class="s2">, </span><span class="s1">with_stencilbuffer</span><span class="s2">=</span><span class="s4">True</span><span class="s2">)</span>
        <span class="s4">with </span><span class="s1">fbo</span><span class="s2">:</span>
            <span class="s1">ClearColor</span><span class="s2">(*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">clearcolor</span><span class="s2">)</span>
            <span class="s1">ClearBuffers</span><span class="s2">()</span>
        <span class="s1">fbo</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s1">screen</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">)</span>
        <span class="s4">with </span><span class="s1">fbo</span><span class="s2">.</span><span class="s1">before</span><span class="s2">:</span>
            <span class="s1">PushMatrix</span><span class="s2">()</span>
            <span class="s1">Translate</span><span class="s2">(-</span><span class="s1">screen</span><span class="s2">.</span><span class="s1">x</span><span class="s2">, -</span><span class="s1">screen</span><span class="s2">.</span><span class="s1">y</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)</span>
        <span class="s4">with </span><span class="s1">fbo</span><span class="s2">.</span><span class="s1">after</span><span class="s2">:</span>
            <span class="s1">PopMatrix</span><span class="s2">()</span>
        <span class="s4">return </span><span class="s1">fbo</span>

    <span class="s4">def </span><span class="s1">on_progress</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">progress</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">render_ctx</span><span class="s2">[</span><span class="s3">'t'</span><span class="s2">] = </span><span class="s1">progress</span>

    <span class="s4">def </span><span class="s1">on_complete</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">render_ctx</span><span class="s2">[</span><span class="s3">'t'</span><span class="s2">] = </span><span class="s5">1.</span>
        <span class="s1">super</span><span class="s2">(</span><span class="s1">ShaderTransition</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">on_complete</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">_remove_out_canvas</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">screen_out </span><span class="s4">and</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">screen_out</span><span class="s2">.</span><span class="s1">canvas </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">manager</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">children </span><span class="s4">and</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">screen_out </span><span class="s4">not in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">manager</span><span class="s2">.</span><span class="s1">children</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">manager</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">screen_out</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">add_screen</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">screen</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">screen_in</span><span class="s2">.</span><span class="s1">pos </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">screen_out</span><span class="s2">.</span><span class="s1">pos</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">screen_in</span><span class="s2">.</span><span class="s1">size </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">screen_out</span><span class="s2">.</span><span class="s1">size</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">manager</span><span class="s2">.</span><span class="s1">real_remove_widget</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">screen_out</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">manager</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">screen_out</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">)</span>

        <span class="s4">def </span><span class="s1">remove_screen_out</span><span class="s2">(</span><span class="s1">instr</span><span class="s2">):</span>
            <span class="s1">Clock</span><span class="s2">.</span><span class="s1">schedule_once</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_remove_out_canvas</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">render_ctx</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">instr</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">fbo_in </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">make_screen_fbo</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">screen_in</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">fbo_out </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">make_screen_fbo</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">screen_out</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">manager</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">fbo_in</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">manager</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">fbo_out</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">render_ctx </span><span class="s2">= </span><span class="s1">RenderContext</span><span class="s2">(</span><span class="s1">fs</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">fs</span><span class="s2">, </span><span class="s1">vs</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">vs</span><span class="s2">,</span>
                                        <span class="s1">use_parent_modelview</span><span class="s2">=</span><span class="s4">True</span><span class="s2">,</span>
                                        <span class="s1">use_parent_projection</span><span class="s2">=</span><span class="s4">True</span><span class="s2">)</span>
        <span class="s4">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">render_ctx</span><span class="s2">:</span>
            <span class="s1">BindTexture</span><span class="s2">(</span><span class="s1">texture</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">fbo_out</span><span class="s2">.</span><span class="s1">texture</span><span class="s2">, </span><span class="s1">index</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
            <span class="s1">BindTexture</span><span class="s2">(</span><span class="s1">texture</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">fbo_in</span><span class="s2">.</span><span class="s1">texture</span><span class="s2">, </span><span class="s1">index</span><span class="s2">=</span><span class="s5">2</span><span class="s2">)</span>
            <span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">screen_in</span><span class="s2">.</span><span class="s1">pos</span>
            <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">fbo_in</span><span class="s2">.</span><span class="s1">texture</span><span class="s2">.</span><span class="s1">size</span>
            <span class="s1">Rectangle</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=(</span><span class="s1">w</span><span class="s2">, </span><span class="s1">h</span><span class="s2">), </span><span class="s1">pos</span><span class="s2">=(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">),</span>
                      <span class="s1">tex_coords</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">fbo_in</span><span class="s2">.</span><span class="s1">texture</span><span class="s2">.</span><span class="s1">tex_coords</span><span class="s2">)</span>
            <span class="s1">Callback</span><span class="s2">(</span><span class="s1">remove_screen_out</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">render_ctx</span><span class="s2">[</span><span class="s3">'tex_out'</span><span class="s2">] = </span><span class="s5">1</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">render_ctx</span><span class="s2">[</span><span class="s3">'tex_in'</span><span class="s2">] = </span><span class="s5">2</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">manager</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">render_ctx</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">remove_screen</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">screen</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">manager</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">fbo_in</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">manager</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">fbo_out</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">manager</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">render_ctx</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_remove_out_canvas</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">manager</span><span class="s2">.</span><span class="s1">real_add_widget</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">screen_in</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">stop</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_remove_out_canvas</span><span class="s2">()</span>
        <span class="s1">super</span><span class="s2">(</span><span class="s1">ShaderTransition</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">stop</span><span class="s2">()</span>


<span class="s4">class </span><span class="s1">NoTransition</span><span class="s2">(</span><span class="s1">TransitionBase</span><span class="s2">):</span>
    <span class="s0">'''No transition, instantly switches to the next screen with no delay or 
    animation. 
 
    .. versionadded:: 1.8.0 
    '''</span>

    <span class="s1">duration </span><span class="s2">= </span><span class="s1">NumericProperty</span><span class="s2">(</span><span class="s5">0.0</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">on_complete</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">screen_in</span><span class="s2">.</span><span class="s1">pos </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">manager</span><span class="s2">.</span><span class="s1">pos</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">screen_out</span><span class="s2">.</span><span class="s1">pos </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">manager</span><span class="s2">.</span><span class="s1">pos</span>
        <span class="s1">super</span><span class="s2">(</span><span class="s1">NoTransition</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">on_complete</span><span class="s2">()</span>


<span class="s4">class </span><span class="s1">SlideTransition</span><span class="s2">(</span><span class="s1">TransitionBase</span><span class="s2">):</span>
    <span class="s0">'''Slide Transition, can be used to show a new screen from any direction: 
    left, right, up or down. 
    '''</span>

    <span class="s1">direction </span><span class="s2">= </span><span class="s1">OptionProperty</span><span class="s2">(</span><span class="s3">'left'</span><span class="s2">, </span><span class="s1">options</span><span class="s2">=(</span><span class="s3">'left'</span><span class="s2">, </span><span class="s3">'right'</span><span class="s2">, </span><span class="s3">'up'</span><span class="s2">, </span><span class="s3">'down'</span><span class="s2">))</span>
    <span class="s3">'''Direction of the transition. 
 
    :attr:`direction` is an :class:`~kivy.properties.OptionProperty` and 
    defaults to 'left'. Can be one of 'left', 'right', 'up' or 'down'. 
    '''</span>

    <span class="s4">def </span><span class="s1">on_progress</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">progression</span><span class="s2">):</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">screen_in</span>
        <span class="s1">b </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">screen_out</span>
        <span class="s1">manager </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">manager</span>
        <span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">manager</span><span class="s2">.</span><span class="s1">pos</span>
        <span class="s1">width</span><span class="s2">, </span><span class="s1">height </span><span class="s2">= </span><span class="s1">manager</span><span class="s2">.</span><span class="s1">size</span>
        <span class="s1">direction </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">direction</span>
        <span class="s1">al </span><span class="s2">= </span><span class="s1">AnimationTransition</span><span class="s2">.</span><span class="s1">out_quad</span>
        <span class="s1">progression </span><span class="s2">= </span><span class="s1">al</span><span class="s2">(</span><span class="s1">progression</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">direction </span><span class="s2">== </span><span class="s3">'left'</span><span class="s2">:</span>
            <span class="s1">a</span><span class="s2">.</span><span class="s1">y </span><span class="s2">= </span><span class="s1">b</span><span class="s2">.</span><span class="s1">y </span><span class="s2">= </span><span class="s1">y</span>
            <span class="s1">a</span><span class="s2">.</span><span class="s1">x </span><span class="s2">= </span><span class="s1">x </span><span class="s2">+ </span><span class="s1">width </span><span class="s2">* (</span><span class="s5">1 </span><span class="s2">- </span><span class="s1">progression</span><span class="s2">)</span>
            <span class="s1">b</span><span class="s2">.</span><span class="s1">x </span><span class="s2">= </span><span class="s1">x </span><span class="s2">- </span><span class="s1">width </span><span class="s2">* </span><span class="s1">progression</span>
        <span class="s4">elif </span><span class="s1">direction </span><span class="s2">== </span><span class="s3">'right'</span><span class="s2">:</span>
            <span class="s1">a</span><span class="s2">.</span><span class="s1">y </span><span class="s2">= </span><span class="s1">b</span><span class="s2">.</span><span class="s1">y </span><span class="s2">= </span><span class="s1">y</span>
            <span class="s1">b</span><span class="s2">.</span><span class="s1">x </span><span class="s2">= </span><span class="s1">x </span><span class="s2">+ </span><span class="s1">width </span><span class="s2">* </span><span class="s1">progression</span>
            <span class="s1">a</span><span class="s2">.</span><span class="s1">x </span><span class="s2">= </span><span class="s1">x </span><span class="s2">- </span><span class="s1">width </span><span class="s2">* (</span><span class="s5">1 </span><span class="s2">- </span><span class="s1">progression</span><span class="s2">)</span>
        <span class="s4">elif </span><span class="s1">direction </span><span class="s2">== </span><span class="s3">'down'</span><span class="s2">:</span>
            <span class="s1">a</span><span class="s2">.</span><span class="s1">x </span><span class="s2">= </span><span class="s1">b</span><span class="s2">.</span><span class="s1">x </span><span class="s2">= </span><span class="s1">x</span>
            <span class="s1">a</span><span class="s2">.</span><span class="s1">y </span><span class="s2">= </span><span class="s1">y </span><span class="s2">+ </span><span class="s1">height </span><span class="s2">* (</span><span class="s5">1 </span><span class="s2">- </span><span class="s1">progression</span><span class="s2">)</span>
            <span class="s1">b</span><span class="s2">.</span><span class="s1">y </span><span class="s2">= </span><span class="s1">y </span><span class="s2">- </span><span class="s1">height </span><span class="s2">* </span><span class="s1">progression</span>
        <span class="s4">elif </span><span class="s1">direction </span><span class="s2">== </span><span class="s3">'up'</span><span class="s2">:</span>
            <span class="s1">a</span><span class="s2">.</span><span class="s1">x </span><span class="s2">= </span><span class="s1">b</span><span class="s2">.</span><span class="s1">x </span><span class="s2">= </span><span class="s1">x</span>
            <span class="s1">b</span><span class="s2">.</span><span class="s1">y </span><span class="s2">= </span><span class="s1">y </span><span class="s2">+ </span><span class="s1">height </span><span class="s2">* </span><span class="s1">progression</span>
            <span class="s1">a</span><span class="s2">.</span><span class="s1">y </span><span class="s2">= </span><span class="s1">y </span><span class="s2">- </span><span class="s1">height </span><span class="s2">* (</span><span class="s5">1 </span><span class="s2">- </span><span class="s1">progression</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">on_complete</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">screen_in</span><span class="s2">.</span><span class="s1">pos </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">manager</span><span class="s2">.</span><span class="s1">pos</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">screen_out</span><span class="s2">.</span><span class="s1">pos </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">manager</span><span class="s2">.</span><span class="s1">pos</span>
        <span class="s1">super</span><span class="s2">(</span><span class="s1">SlideTransition</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">on_complete</span><span class="s2">()</span>


<span class="s4">class </span><span class="s1">CardTransition</span><span class="s2">(</span><span class="s1">SlideTransition</span><span class="s2">):</span>
    <span class="s0">'''Card transition that looks similar to Android 4.x application drawer 
    interface animation. 
 
    It supports 4 directions like SlideTransition: left, right, up and down, 
    and two modes, pop and push. If push mode is activated, the previous 
    screen does not move, and the new one slides in from the given direction. 
    If the pop mode is activated, the previous screen slides out, when the new 
    screen is already on the position of the ScreenManager. 
 
    .. versionadded:: 1.10 
    '''</span>

    <span class="s1">mode </span><span class="s2">= </span><span class="s1">OptionProperty</span><span class="s2">(</span><span class="s3">'push'</span><span class="s2">, </span><span class="s1">options</span><span class="s2">=[</span><span class="s3">'pop'</span><span class="s2">, </span><span class="s3">'push'</span><span class="s2">])</span>
    <span class="s3">'''Indicates if the transition should push or pop 
    the screen on/off the ScreenManager. 
 
    - 'push' means the screen slides in in the given direction 
    - 'pop' means the screen slides out in the given direction 
 
    :attr:`mode` is an :class:`~kivy.properties.OptionProperty` and 
    defaults to 'push'. 
    '''</span>

    <span class="s4">def </span><span class="s1">start</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">manager</span><span class="s2">):</span>
        <span class="s0">'''(internal) Starts the transition. This is automatically 
        called by the :class:`ScreenManager`. 
        '''</span>
        <span class="s1">super</span><span class="s2">(</span><span class="s1">CardTransition</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">start</span><span class="s2">(</span><span class="s1">manager</span><span class="s2">)</span>
        <span class="s1">mode </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">mode</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">screen_in</span>
        <span class="s1">b </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">screen_out</span>
        <span class="s6"># ensure that the correct widget is &quot;on top&quot;</span>
        <span class="s4">if </span><span class="s1">mode </span><span class="s2">== </span><span class="s3">'push'</span><span class="s2">:</span>
            <span class="s1">manager</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">a</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">)</span>
            <span class="s1">manager</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s1">a</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">)</span>
        <span class="s4">elif </span><span class="s1">mode </span><span class="s2">== </span><span class="s3">'pop'</span><span class="s2">:</span>
            <span class="s1">manager</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">b</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">)</span>
            <span class="s1">manager</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s1">b</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">on_progress</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">progression</span><span class="s2">):</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">screen_in</span>
        <span class="s1">b </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">screen_out</span>
        <span class="s1">manager </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">manager</span>
        <span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">manager</span><span class="s2">.</span><span class="s1">pos</span>
        <span class="s1">width</span><span class="s2">, </span><span class="s1">height </span><span class="s2">= </span><span class="s1">manager</span><span class="s2">.</span><span class="s1">size</span>
        <span class="s1">direction </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">direction</span>
        <span class="s1">mode </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">mode</span>
        <span class="s1">al </span><span class="s2">= </span><span class="s1">AnimationTransition</span><span class="s2">.</span><span class="s1">out_quad</span>
        <span class="s1">progression </span><span class="s2">= </span><span class="s1">al</span><span class="s2">(</span><span class="s1">progression</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">mode </span><span class="s2">== </span><span class="s3">'push'</span><span class="s2">:</span>
            <span class="s1">b</span><span class="s2">.</span><span class="s1">pos </span><span class="s2">= </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span>
            <span class="s4">if </span><span class="s1">direction </span><span class="s2">== </span><span class="s3">'left'</span><span class="s2">:</span>
                <span class="s1">a</span><span class="s2">.</span><span class="s1">pos </span><span class="s2">= </span><span class="s1">x </span><span class="s2">+ </span><span class="s1">width </span><span class="s2">* (</span><span class="s5">1 </span><span class="s2">- </span><span class="s1">progression</span><span class="s2">), </span><span class="s1">y</span>
            <span class="s4">elif </span><span class="s1">direction </span><span class="s2">== </span><span class="s3">'right'</span><span class="s2">:</span>
                <span class="s1">a</span><span class="s2">.</span><span class="s1">pos </span><span class="s2">= </span><span class="s1">x </span><span class="s2">- </span><span class="s1">width </span><span class="s2">* (</span><span class="s5">1 </span><span class="s2">- </span><span class="s1">progression</span><span class="s2">), </span><span class="s1">y</span>
            <span class="s4">elif </span><span class="s1">direction </span><span class="s2">== </span><span class="s3">'down'</span><span class="s2">:</span>
                <span class="s1">a</span><span class="s2">.</span><span class="s1">pos </span><span class="s2">= </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">+ </span><span class="s1">height </span><span class="s2">* (</span><span class="s5">1 </span><span class="s2">- </span><span class="s1">progression</span><span class="s2">)</span>
            <span class="s4">elif </span><span class="s1">direction </span><span class="s2">== </span><span class="s3">'up'</span><span class="s2">:</span>
                <span class="s1">a</span><span class="s2">.</span><span class="s1">pos </span><span class="s2">= </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">- </span><span class="s1">height </span><span class="s2">* (</span><span class="s5">1 </span><span class="s2">- </span><span class="s1">progression</span><span class="s2">)</span>
        <span class="s4">elif </span><span class="s1">mode </span><span class="s2">== </span><span class="s3">'pop'</span><span class="s2">:</span>
            <span class="s1">a</span><span class="s2">.</span><span class="s1">pos </span><span class="s2">= </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span>
            <span class="s4">if </span><span class="s1">direction </span><span class="s2">== </span><span class="s3">'left'</span><span class="s2">:</span>
                <span class="s1">b</span><span class="s2">.</span><span class="s1">pos </span><span class="s2">= </span><span class="s1">x </span><span class="s2">- </span><span class="s1">width </span><span class="s2">* </span><span class="s1">progression</span><span class="s2">, </span><span class="s1">y</span>
            <span class="s4">elif </span><span class="s1">direction </span><span class="s2">== </span><span class="s3">'right'</span><span class="s2">:</span>
                <span class="s1">b</span><span class="s2">.</span><span class="s1">pos </span><span class="s2">= </span><span class="s1">x </span><span class="s2">+ </span><span class="s1">width </span><span class="s2">* </span><span class="s1">progression</span><span class="s2">, </span><span class="s1">y</span>
            <span class="s4">elif </span><span class="s1">direction </span><span class="s2">== </span><span class="s3">'down'</span><span class="s2">:</span>
                <span class="s1">b</span><span class="s2">.</span><span class="s1">pos </span><span class="s2">= </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">- </span><span class="s1">height </span><span class="s2">* </span><span class="s1">progression</span>
            <span class="s4">elif </span><span class="s1">direction </span><span class="s2">== </span><span class="s3">'up'</span><span class="s2">:</span>
                <span class="s1">b</span><span class="s2">.</span><span class="s1">pos </span><span class="s2">= </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">+ </span><span class="s1">height </span><span class="s2">* </span><span class="s1">progression</span>


<span class="s4">class </span><span class="s1">SwapTransition</span><span class="s2">(</span><span class="s1">TransitionBase</span><span class="s2">):</span>
    <span class="s0">'''Swap transition that looks like iOS transition when a new window 
    appears on the screen. 
    '''</span>
    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s1">super</span><span class="s2">(</span><span class="s1">SwapTransition</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">__init__</span><span class="s2">(**</span><span class="s1">kwargs</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">scales </span><span class="s2">= {}</span>

    <span class="s4">def </span><span class="s1">start</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">manager</span><span class="s2">):</span>
        <span class="s4">for </span><span class="s1">screen </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">screen_in</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">screen_out</span><span class="s2">:</span>
            <span class="s4">with </span><span class="s1">screen</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">before</span><span class="s2">:</span>
                <span class="s1">PushMatrix</span><span class="s2">(</span><span class="s1">group</span><span class="s2">=</span><span class="s3">'swaptransition_scale'</span><span class="s2">)</span>
                <span class="s1">scale </span><span class="s2">= </span><span class="s1">Scale</span><span class="s2">(</span><span class="s1">group</span><span class="s2">=</span><span class="s3">'swaptransition_scale'</span><span class="s2">)</span>
            <span class="s4">with </span><span class="s1">screen</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">after</span><span class="s2">:</span>
                <span class="s1">PopMatrix</span><span class="s2">(</span><span class="s1">group</span><span class="s2">=</span><span class="s3">'swaptransition_scale'</span><span class="s2">)</span>

            <span class="s1">screen</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">center</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">update_scale</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">scales</span><span class="s2">[</span><span class="s1">screen</span><span class="s2">] = </span><span class="s1">scale</span>
        <span class="s1">super</span><span class="s2">(</span><span class="s1">SwapTransition</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">start</span><span class="s2">(</span><span class="s1">manager</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">update_scale</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">screen</span><span class="s2">, </span><span class="s1">center</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">scales</span><span class="s2">[</span><span class="s1">screen</span><span class="s2">].</span><span class="s1">origin </span><span class="s2">= </span><span class="s1">center</span>

    <span class="s4">def </span><span class="s1">add_screen</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">screen</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">manager</span><span class="s2">.</span><span class="s1">real_add_widget</span><span class="s2">(</span><span class="s1">screen</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">on_complete</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">screen_in</span><span class="s2">.</span><span class="s1">pos </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">manager</span><span class="s2">.</span><span class="s1">pos</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">screen_out</span><span class="s2">.</span><span class="s1">pos </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">manager</span><span class="s2">.</span><span class="s1">pos</span>
        <span class="s4">for </span><span class="s1">screen </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">screen_in</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">screen_out</span><span class="s2">:</span>
            <span class="s4">for </span><span class="s1">canvas </span><span class="s4">in </span><span class="s1">screen</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">before</span><span class="s2">, </span><span class="s1">screen</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">after</span><span class="s2">:</span>
                <span class="s1">canvas</span><span class="s2">.</span><span class="s1">remove_group</span><span class="s2">(</span><span class="s3">'swaptransition_scale'</span><span class="s2">)</span>
        <span class="s1">super</span><span class="s2">(</span><span class="s1">SwapTransition</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">on_complete</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">on_progress</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">progression</span><span class="s2">):</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">screen_in</span>
        <span class="s1">b </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">screen_out</span>
        <span class="s1">manager </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">manager</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">scales</span><span class="s2">[</span><span class="s1">b</span><span class="s2">].</span><span class="s1">xyz </span><span class="s2">= [</span><span class="s5">1. </span><span class="s2">- </span><span class="s1">progression </span><span class="s2">* </span><span class="s5">0.7 </span><span class="s4">for </span><span class="s1">xyz </span><span class="s4">in </span><span class="s3">'xyz'</span><span class="s2">]</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">scales</span><span class="s2">[</span><span class="s1">a</span><span class="s2">].</span><span class="s1">xyz </span><span class="s2">= [</span><span class="s5">0.5 </span><span class="s2">+ </span><span class="s1">progression </span><span class="s2">* </span><span class="s5">0.5 </span><span class="s4">for </span><span class="s1">xyz </span><span class="s4">in </span><span class="s3">'xyz'</span><span class="s2">]</span>
        <span class="s1">a</span><span class="s2">.</span><span class="s1">center_y </span><span class="s2">= </span><span class="s1">b</span><span class="s2">.</span><span class="s1">center_y </span><span class="s2">= </span><span class="s1">manager</span><span class="s2">.</span><span class="s1">center_y</span>

        <span class="s1">al </span><span class="s2">= </span><span class="s1">AnimationTransition</span><span class="s2">.</span><span class="s1">in_out_sine</span>

        <span class="s4">if </span><span class="s1">progression </span><span class="s2">&lt; </span><span class="s5">0.5</span><span class="s2">:</span>
            <span class="s1">p2 </span><span class="s2">= </span><span class="s1">al</span><span class="s2">(</span><span class="s1">progression </span><span class="s2">* </span><span class="s5">2</span><span class="s2">)</span>
            <span class="s1">width </span><span class="s2">= </span><span class="s1">manager</span><span class="s2">.</span><span class="s1">width </span><span class="s2">* </span><span class="s5">0.7</span>
            <span class="s1">widthb </span><span class="s2">= </span><span class="s1">manager</span><span class="s2">.</span><span class="s1">width </span><span class="s2">* </span><span class="s5">0.2</span>
            <span class="s1">a</span><span class="s2">.</span><span class="s1">x </span><span class="s2">= </span><span class="s1">manager</span><span class="s2">.</span><span class="s1">center_x </span><span class="s2">+ </span><span class="s1">p2 </span><span class="s2">* </span><span class="s1">width </span><span class="s2">/ </span><span class="s5">2.</span>
            <span class="s1">b</span><span class="s2">.</span><span class="s1">center_x </span><span class="s2">= </span><span class="s1">manager</span><span class="s2">.</span><span class="s1">center_x </span><span class="s2">- </span><span class="s1">p2 </span><span class="s2">* </span><span class="s1">widthb </span><span class="s2">/ </span><span class="s5">2.</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">screen_in </span><span class="s4">is </span><span class="s1">self</span><span class="s2">.</span><span class="s1">manager</span><span class="s2">.</span><span class="s1">children</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">]:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">manager</span><span class="s2">.</span><span class="s1">real_remove_widget</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">screen_in</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">manager</span><span class="s2">.</span><span class="s1">real_add_widget</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">screen_in</span><span class="s2">)</span>
            <span class="s1">p2 </span><span class="s2">= </span><span class="s1">al</span><span class="s2">((</span><span class="s1">progression </span><span class="s2">- </span><span class="s5">0.5</span><span class="s2">) * </span><span class="s5">2</span><span class="s2">)</span>
            <span class="s1">width </span><span class="s2">= </span><span class="s1">manager</span><span class="s2">.</span><span class="s1">width </span><span class="s2">* </span><span class="s5">0.85</span>
            <span class="s1">widthb </span><span class="s2">= </span><span class="s1">manager</span><span class="s2">.</span><span class="s1">width </span><span class="s2">* </span><span class="s5">0.2</span>
            <span class="s1">a</span><span class="s2">.</span><span class="s1">x </span><span class="s2">= </span><span class="s1">manager</span><span class="s2">.</span><span class="s1">x </span><span class="s2">+ </span><span class="s1">width </span><span class="s2">* (</span><span class="s5">1 </span><span class="s2">- </span><span class="s1">p2</span><span class="s2">)</span>
            <span class="s1">b</span><span class="s2">.</span><span class="s1">center_x </span><span class="s2">= </span><span class="s1">manager</span><span class="s2">.</span><span class="s1">center_x </span><span class="s2">- (</span><span class="s5">1 </span><span class="s2">- </span><span class="s1">p2</span><span class="s2">) * </span><span class="s1">widthb </span><span class="s2">/ </span><span class="s5">2.</span>


<span class="s4">class </span><span class="s1">WipeTransition</span><span class="s2">(</span><span class="s1">ShaderTransition</span><span class="s2">):</span>
    <span class="s0">'''Wipe transition, based on a fragment Shader. 
    '''</span>

    <span class="s1">WIPE_TRANSITION_FS </span><span class="s2">= </span><span class="s3">'''$HEADER$ 
    uniform float t; 
    uniform sampler2D tex_in; 
    uniform sampler2D tex_out; 
 
    void main(void) { 
        vec4 cin = texture2D(tex_in, tex_coord0); 
        vec4 cout = texture2D(tex_out, tex_coord0); 
        gl_FragColor = mix(cout, cin, clamp((-1.5 + 1.5*tex_coord0.x + 2.5*t), 
            0.0, 1.0)); 
    } 
    '''</span>
    <span class="s1">fs </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span><span class="s1">WIPE_TRANSITION_FS</span><span class="s2">)</span>


<span class="s4">class </span><span class="s1">FadeTransition</span><span class="s2">(</span><span class="s1">ShaderTransition</span><span class="s2">):</span>
    <span class="s0">'''Fade transition, based on a fragment Shader. 
    '''</span>

    <span class="s1">FADE_TRANSITION_FS </span><span class="s2">= </span><span class="s3">'''$HEADER$ 
    uniform float t; 
    uniform sampler2D tex_in; 
    uniform sampler2D tex_out; 
 
    void main(void) { 
        vec4 cin = vec4(texture2D(tex_in, tex_coord0.st)); 
        vec4 cout = vec4(texture2D(tex_out, tex_coord0.st)); 
        vec4 frag_col = vec4(t * cin) + vec4((1.0 - t) * cout); 
        gl_FragColor = frag_col; 
    } 
    '''</span>
    <span class="s1">fs </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span><span class="s1">FADE_TRANSITION_FS</span><span class="s2">)</span>


<span class="s4">class </span><span class="s1">FallOutTransition</span><span class="s2">(</span><span class="s1">ShaderTransition</span><span class="s2">):</span>
    <span class="s0">'''Transition where the new screen 'falls' from the screen centre, 
    becoming smaller and more transparent until it disappears, and 
    revealing the new screen behind it. Mimics the popular/standard 
    Android transition. 
 
    .. versionadded:: 1.8.0 
 
    '''</span>

    <span class="s1">duration </span><span class="s2">= </span><span class="s1">NumericProperty</span><span class="s2">(</span><span class="s5">0.15</span><span class="s2">)</span>
    <span class="s3">'''Duration in seconds of the transition, replacing the default of 
    :class:`TransitionBase`. 
 
    :class:`duration` is a :class:`~kivy.properties.NumericProperty` and 
    defaults to .15 (= 150ms). 
    '''</span>

    <span class="s1">FALLOUT_TRANSITION_FS </span><span class="s2">= </span><span class="s3">'''$HEADER$ 
    uniform float t; 
    uniform sampler2D tex_in; 
    uniform sampler2D tex_out; 
 
    void main(void) { 
        /* quantities for position and opacity calculation */ 
        float tr = 0.5*sin(t);  /* 'real' time */ 
        vec2 diff = (tex_coord0.st - 0.5) * (1.0/(1.0-tr)); 
        vec2 dist = diff + 0.5; 
        float max_dist = 1.0 - tr; 
 
        /* in and out colors */ 
        vec4 cin = vec4(texture2D(tex_in, tex_coord0.st)); 
        vec4 cout = vec4(texture2D(tex_out, dist)); 
 
        /* opacities for in and out textures */ 
        float oin = clamp(1.0-cos(t), 0.0, 1.0); 
        float oout = clamp(cos(t), 0.0, 1.0); 
 
        bvec2 outside_bounds = bvec2(abs(tex_coord0.s - 0.5) &gt; 0.5*max_dist, 
                                     abs(tex_coord0.t - 0.5) &gt; 0.5*max_dist); 
 
        vec4 frag_col; 
        if (any(outside_bounds) ){ 
            frag_col = vec4(cin.x, cin.y, cin.z, 1.0); 
            } 
        else { 
            frag_col = vec4(oout*cout.x + oin*cin.x, oout*cout.y + oin*cin.y, 
                            oout*cout.z + oin*cin.z, 1.0); 
            } 
 
        gl_FragColor = frag_col; 
    } 
    '''</span>

    <span class="s1">fs </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span><span class="s1">FALLOUT_TRANSITION_FS</span><span class="s2">)</span>


<span class="s4">class </span><span class="s1">RiseInTransition</span><span class="s2">(</span><span class="s1">ShaderTransition</span><span class="s2">):</span>
    <span class="s0">'''Transition where the new screen rises from the screen centre, 
    becoming larger and changing from transparent to opaque until it 
    fills the screen. Mimics the popular/standard Android transition. 
 
    .. versionadded:: 1.8.0 
    '''</span>

    <span class="s1">duration </span><span class="s2">= </span><span class="s1">NumericProperty</span><span class="s2">(</span><span class="s5">0.2</span><span class="s2">)</span>
    <span class="s3">'''Duration in seconds of the transition, replacing the default of 
    :class:`TransitionBase`. 
 
    :class:`duration` is a :class:`~kivy.properties.NumericProperty` and 
    defaults to .2 (= 200ms). 
    '''</span>

    <span class="s1">RISEIN_TRANSITION_FS </span><span class="s2">= </span><span class="s3">'''$HEADER$ 
    uniform float t; 
    uniform sampler2D tex_in; 
    uniform sampler2D tex_out; 
 
    void main(void) { 
        /* quantities for position and opacity calculation */ 
        float tr = 0.5 - 0.5*sqrt(sin(t));  /* 'real' time */ 
        vec2 diff = (tex_coord0.st - 0.5) * (1.0/(1.0-tr)); 
        vec2 dist = diff + 0.5; 
        float max_dist = 1.0 - tr; 
 
        /* in and out colors */ 
        vec4 cin = vec4(texture2D(tex_in, dist)); 
        vec4 cout = vec4(texture2D(tex_out, tex_coord0.st)); 
 
        /* opacities for in and out textures */ 
        float oin = clamp(sin(2.0*t), 0.0, 1.0); 
        float oout = clamp(1.0 - sin(2.0*t), 0.0, 1.0); 
 
        bvec2 outside_bounds = bvec2(abs(tex_coord0.s - 0.5) &gt; 0.5*max_dist, 
                                     abs(tex_coord0.t - 0.5) &gt; 0.5*max_dist); 
 
        vec4 frag_col; 
        if (any(outside_bounds) ){ 
            frag_col = vec4(cout.x, cout.y, cout.z, 1.0); 
            } 
        else { 
            frag_col = vec4(oout*cout.x + oin*cin.x, oout*cout.y + oin*cin.y, 
                            oout*cout.z + oin*cin.z, 1.0); 
            } 
 
        gl_FragColor = frag_col; 
    } 
    '''</span>

    <span class="s1">fs </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span><span class="s1">RISEIN_TRANSITION_FS</span><span class="s2">)</span>


<span class="s4">class </span><span class="s1">ScreenManager</span><span class="s2">(</span><span class="s1">FloatLayout</span><span class="s2">):</span>
    <span class="s0">'''Screen manager. This is the main class that will control your 
    :class:`Screen` stack and memory. 
 
    By default, the manager will show only one screen at a time. 
    '''</span>

    <span class="s1">current </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">, </span><span class="s1">allownone</span><span class="s2">=</span><span class="s4">True</span><span class="s2">)</span>
    <span class="s3">''' 
    Name of the screen currently shown, or the screen to show. 
 
    :: 
 
        from kivy.uix.screenmanager import ScreenManager, Screen 
 
        sm = ScreenManager() 
        sm.add_widget(Screen(name='first')) 
        sm.add_widget(Screen(name='second')) 
 
        # By default, the first added screen will be shown. If you want to 
        # show another one, just set the 'current' property. 
        sm.current = 'second' 
 
    :attr:`current` is a :class:`~kivy.properties.StringProperty` and defaults 
    to None. 
    '''</span>

    <span class="s1">transition </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">(</span><span class="s1">baseclass</span><span class="s2">=</span><span class="s1">TransitionBase</span><span class="s2">)</span>
    <span class="s3">'''Transition object to use for animating the transition from the current 
    screen to the next one being shown. 
 
    For example, if you want to use a :class:`WipeTransition` between 
    slides:: 
 
        from kivy.uix.screenmanager import ScreenManager, Screen, 
        WipeTransition 
 
        sm = ScreenManager(transition=WipeTransition()) 
        sm.add_widget(Screen(name='first')) 
        sm.add_widget(Screen(name='second')) 
 
        # by default, the first added screen will be shown. If you want to 
        # show another one, just set the 'current' property. 
        sm.current = 'second' 
 
    :attr:`transition` is an :class:`~kivy.properties.ObjectProperty` and 
    defaults to a :class:`SlideTransition`. 
 
    .. versionchanged:: 1.8.0 
 
        Default transition has been changed from :class:`SwapTransition` to 
        :class:`SlideTransition`. 
    '''</span>

    <span class="s1">screens </span><span class="s2">= </span><span class="s1">ListProperty</span><span class="s2">()</span>
    <span class="s3">'''List of all the :class:`Screen` widgets added. You should not change 
    this list manually. Use the 
    :meth:`add_widget &lt;kivy.uix.widget.Widget.add_widget&gt;` method instead. 
 
    :attr:`screens` is a :class:`~kivy.properties.ListProperty` and defaults to 
    [], read-only. 
    '''</span>

    <span class="s1">current_screen </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">, </span><span class="s1">allownone</span><span class="s2">=</span><span class="s4">True</span><span class="s2">)</span>
    <span class="s3">'''Contains the currently displayed screen. You must not change this 
    property manually, use :attr:`current` instead. 
 
    :attr:`current_screen` is an :class:`~kivy.properties.ObjectProperty` and 
    defaults to None, read-only. 
    '''</span>

    <span class="s4">def </span><span class="s1">_get_screen_names</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s2">[</span><span class="s1">s</span><span class="s2">.</span><span class="s1">name </span><span class="s4">for </span><span class="s1">s </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">screens</span><span class="s2">]</span>

    <span class="s1">screen_names </span><span class="s2">= </span><span class="s1">AliasProperty</span><span class="s2">(</span><span class="s1">_get_screen_names</span><span class="s2">, </span><span class="s1">bind</span><span class="s2">=(</span><span class="s3">'screens'</span><span class="s2">,))</span>
    <span class="s3">'''List of the names of all the :class:`Screen` widgets added. The list 
    is read only. 
 
    :attr:`screens_names` is an :class:`~kivy.properties.AliasProperty` and 
    is read-only. It is updated if the screen list changes or the name 
    of a screen changes. 
    '''</span>

    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s3">'transition' </span><span class="s4">not in </span><span class="s1">kwargs</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">transition </span><span class="s2">= </span><span class="s1">SlideTransition</span><span class="s2">()</span>
        <span class="s1">super</span><span class="s2">(</span><span class="s1">ScreenManager</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">__init__</span><span class="s2">(**</span><span class="s1">kwargs</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">fbind</span><span class="s2">(</span><span class="s3">'pos'</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_update_pos</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">_screen_name_changed</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">screen</span><span class="s2">, </span><span class="s1">name</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">property</span><span class="s2">(</span><span class="s3">'screen_names'</span><span class="s2">).</span><span class="s1">dispatch</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">screen </span><span class="s2">== </span><span class="s1">self</span><span class="s2">.</span><span class="s1">current_screen</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">current </span><span class="s2">= </span><span class="s1">name</span>

    <span class="s4">def </span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">widget</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s0">''' 
        .. versionchanged:: 2.1.0 
            Renamed argument `screen` to `widget`. 
        '''</span>
        <span class="s4">if not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, </span><span class="s1">Screen</span><span class="s2">):</span>
            <span class="s4">raise </span><span class="s1">ScreenManagerException</span><span class="s2">(</span>
                <span class="s3">'ScreenManager accepts only Screen widget.'</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">widget</span><span class="s2">.</span><span class="s1">manager</span><span class="s2">:</span>
            <span class="s4">if </span><span class="s1">widget</span><span class="s2">.</span><span class="s1">manager </span><span class="s4">is </span><span class="s1">self</span><span class="s2">:</span>
                <span class="s4">raise </span><span class="s1">ScreenManagerException</span><span class="s2">(</span>
                    <span class="s3">'Screen already managed by this ScreenManager (are you '</span>
                    <span class="s3">'calling `switch_to` when you should be setting '</span>
                    <span class="s3">'`current`?)'</span><span class="s2">)</span>
            <span class="s4">raise </span><span class="s1">ScreenManagerException</span><span class="s2">(</span>
                <span class="s3">'Screen already managed by another ScreenManager.'</span><span class="s2">)</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">manager </span><span class="s2">= </span><span class="s1">self</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">name</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_screen_name_changed</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">screens</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">current </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">current </span><span class="s2">= </span><span class="s1">widget</span><span class="s2">.</span><span class="s1">name</span>

    <span class="s4">def </span><span class="s1">remove_widget</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">widget</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s4">if not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, </span><span class="s1">Screen</span><span class="s2">):</span>
            <span class="s4">raise </span><span class="s1">ScreenManagerException</span><span class="s2">(</span>
                <span class="s3">'ScreenManager uses remove_widget only for removing Screens.'</span><span class="s2">)</span>

        <span class="s4">if </span><span class="s1">widget </span><span class="s4">not in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">screens</span><span class="s2">:</span>
            <span class="s4">return</span>

        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">current_screen </span><span class="s2">== </span><span class="s1">widget</span><span class="s2">:</span>
            <span class="s1">other </span><span class="s2">= </span><span class="s1">next</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>
            <span class="s4">if </span><span class="s1">widget</span><span class="s2">.</span><span class="s1">name </span><span class="s2">== </span><span class="s1">other</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">current </span><span class="s2">= </span><span class="s4">None</span>
                <span class="s1">widget</span><span class="s2">.</span><span class="s1">parent</span><span class="s2">.</span><span class="s1">real_remove_widget</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">)</span>
            <span class="s4">else</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">current </span><span class="s2">= </span><span class="s1">other</span>

        <span class="s1">widget</span><span class="s2">.</span><span class="s1">manager </span><span class="s2">= </span><span class="s4">None</span>
        <span class="s1">widget</span><span class="s2">.</span><span class="s1">unbind</span><span class="s2">(</span><span class="s1">name</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_screen_name_changed</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">screens</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">clear_widgets</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">children</span><span class="s2">=</span><span class="s4">None</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s0">''' 
        .. versionchanged:: 2.1.0 
            Renamed argument `screens` to `children`. 
        '''</span>
        <span class="s4">if </span><span class="s1">children </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s6"># iterate over a copy of screens, as self.remove_widget</span>
            <span class="s6"># modifies self.screens in place</span>
            <span class="s1">children </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">screens</span><span class="s2">[:]</span>
        <span class="s1">remove_widget </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">remove_widget</span>
        <span class="s4">for </span><span class="s1">widget </span><span class="s4">in </span><span class="s1">children</span><span class="s2">:</span>
            <span class="s1">remove_widget</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">real_add_widget</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">screen</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">):</span>
        <span class="s6"># ensure screen is removed from its previous parent</span>
        <span class="s1">parent </span><span class="s2">= </span><span class="s1">screen</span><span class="s2">.</span><span class="s1">parent</span>
        <span class="s4">if </span><span class="s1">parent</span><span class="s2">:</span>
            <span class="s1">parent</span><span class="s2">.</span><span class="s1">real_remove_widget</span><span class="s2">(</span><span class="s1">screen</span><span class="s2">)</span>
        <span class="s1">super</span><span class="s2">(</span><span class="s1">ScreenManager</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">screen</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">real_remove_widget</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">screen</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">):</span>
        <span class="s1">super</span><span class="s2">(</span><span class="s1">ScreenManager</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">remove_widget</span><span class="s2">(</span><span class="s1">screen</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">on_current</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">value </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">transition</span><span class="s2">.</span><span class="s1">stop</span><span class="s2">()</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">current_screen </span><span class="s2">= </span><span class="s4">None</span>
            <span class="s4">return</span>

        <span class="s1">screen </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">get_screen</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">screen </span><span class="s2">== </span><span class="s1">self</span><span class="s2">.</span><span class="s1">current_screen</span><span class="s2">:</span>
            <span class="s4">return</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">transition</span><span class="s2">.</span><span class="s1">stop</span><span class="s2">()</span>

        <span class="s1">previous_screen </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">current_screen</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">current_screen </span><span class="s2">= </span><span class="s1">screen</span>
        <span class="s4">if </span><span class="s1">previous_screen</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">transition</span><span class="s2">.</span><span class="s1">screen_in </span><span class="s2">= </span><span class="s1">screen</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">transition</span><span class="s2">.</span><span class="s1">screen_out </span><span class="s2">= </span><span class="s1">previous_screen</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">transition</span><span class="s2">.</span><span class="s1">start</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">real_add_widget</span><span class="s2">(</span><span class="s1">screen</span><span class="s2">)</span>
            <span class="s1">screen</span><span class="s2">.</span><span class="s1">pos </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">pos</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">do_layout</span><span class="s2">()</span>
            <span class="s1">screen</span><span class="s2">.</span><span class="s1">dispatch</span><span class="s2">(</span><span class="s3">'on_pre_enter'</span><span class="s2">)</span>
            <span class="s1">screen</span><span class="s2">.</span><span class="s1">dispatch</span><span class="s2">(</span><span class="s3">'on_enter'</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">get_screen</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">):</span>
        <span class="s0">'''Return the screen widget associated with the name or raise a 
        :class:`ScreenManagerException` if not found. 
        '''</span>
        <span class="s1">matches </span><span class="s2">= [</span><span class="s1">s </span><span class="s4">for </span><span class="s1">s </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">screens </span><span class="s4">if </span><span class="s1">s</span><span class="s2">.</span><span class="s1">name </span><span class="s2">== </span><span class="s1">name</span><span class="s2">]</span>
        <span class="s1">num_matches </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">matches</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">num_matches </span><span class="s2">== </span><span class="s5">0</span><span class="s2">:</span>
            <span class="s4">raise </span><span class="s1">ScreenManagerException</span><span class="s2">(</span><span class="s3">'No Screen with name &quot;%s&quot;.' </span><span class="s2">% </span><span class="s1">name</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">num_matches </span><span class="s2">&gt; </span><span class="s5">1</span><span class="s2">:</span>
            <span class="s1">Logger</span><span class="s2">.</span><span class="s1">warn</span><span class="s2">(</span><span class="s3">'Multiple screens named &quot;%s&quot;: %s' </span><span class="s2">% (</span><span class="s1">name</span><span class="s2">, </span><span class="s1">matches</span><span class="s2">))</span>
        <span class="s4">return </span><span class="s1">matches</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]</span>

    <span class="s4">def </span><span class="s1">has_screen</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">):</span>
        <span class="s0">'''Return True if a screen with the `name` has been found. 
 
        .. versionadded:: 1.6.0 
        '''</span>
        <span class="s4">return </span><span class="s1">bool</span><span class="s2">([</span><span class="s1">s </span><span class="s4">for </span><span class="s1">s </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">screens </span><span class="s4">if </span><span class="s1">s</span><span class="s2">.</span><span class="s1">name </span><span class="s2">== </span><span class="s1">name</span><span class="s2">])</span>

    <span class="s4">def </span><span class="s1">__next__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">'''Py2K backwards compatibility without six or other lib. 
        '''</span>
        <span class="s1">screens </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">screens</span>
        <span class="s4">if not </span><span class="s1">screens</span><span class="s2">:</span>
            <span class="s4">return</span>
        <span class="s4">try</span><span class="s2">:</span>
            <span class="s1">index </span><span class="s2">= </span><span class="s1">screens</span><span class="s2">.</span><span class="s1">index</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">current_screen</span><span class="s2">)</span>
            <span class="s1">index </span><span class="s2">= (</span><span class="s1">index </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">) % </span><span class="s1">len</span><span class="s2">(</span><span class="s1">screens</span><span class="s2">)</span>
            <span class="s4">return </span><span class="s1">screens</span><span class="s2">[</span><span class="s1">index</span><span class="s2">].</span><span class="s1">name</span>
        <span class="s4">except </span><span class="s1">ValueError</span><span class="s2">:</span>
            <span class="s4">return</span>

    <span class="s4">def </span><span class="s1">next</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">'''Return the name of the next screen from the screen list.'''</span>
        <span class="s4">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__next__</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">previous</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">'''Return the name of the previous screen from the screen list. 
        '''</span>
        <span class="s1">screens </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">screens</span>
        <span class="s4">if not </span><span class="s1">screens</span><span class="s2">:</span>
            <span class="s4">return</span>
        <span class="s4">try</span><span class="s2">:</span>
            <span class="s1">index </span><span class="s2">= </span><span class="s1">screens</span><span class="s2">.</span><span class="s1">index</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">current_screen</span><span class="s2">)</span>
            <span class="s1">index </span><span class="s2">= (</span><span class="s1">index </span><span class="s2">- </span><span class="s5">1</span><span class="s2">) % </span><span class="s1">len</span><span class="s2">(</span><span class="s1">screens</span><span class="s2">)</span>
            <span class="s4">return </span><span class="s1">screens</span><span class="s2">[</span><span class="s1">index</span><span class="s2">].</span><span class="s1">name</span>
        <span class="s4">except </span><span class="s1">ValueError</span><span class="s2">:</span>
            <span class="s4">return</span>

    <span class="s4">def </span><span class="s1">switch_to</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">screen</span><span class="s2">, **</span><span class="s1">options</span><span class="s2">):</span>
        <span class="s0">'''Add a new or existing screen to the ScreenManager and switch to it. 
        The previous screen will be &quot;switched away&quot; from. `options` are the 
        :attr:`transition` options that will be changed before the animation 
        happens. 
 
        If no previous screens are available, the screen will be used as the 
        main one:: 
 
            sm = ScreenManager() 
            sm.switch_to(screen1) 
            # later 
            sm.switch_to(screen2, direction='left') 
            # later 
            sm.switch_to(screen3, direction='right', duration=1.) 
 
        If any animation is in progress, it will be stopped and replaced by 
        this one: you should avoid this because the animation will just look 
        weird. Use either :meth:`switch_to` or :attr:`current` but not both. 
 
        The `screen` name will be changed if there is any conflict with the 
        current screen. 
 
        .. versionadded: 1.8.0 
        '''</span>
        <span class="s4">assert </span><span class="s1">screen </span><span class="s4">is not None</span>

        <span class="s4">if not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">screen</span><span class="s2">, </span><span class="s1">Screen</span><span class="s2">):</span>
            <span class="s4">raise </span><span class="s1">ScreenManagerException</span><span class="s2">(</span>
                <span class="s3">'ScreenManager accepts only Screen widget.'</span><span class="s2">)</span>

        <span class="s6"># stop any transition that might be happening already</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">transition</span><span class="s2">.</span><span class="s1">stop</span><span class="s2">()</span>

        <span class="s6"># ensure the screen name will be unique</span>
        <span class="s4">if </span><span class="s1">screen </span><span class="s4">not in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">screens</span><span class="s2">:</span>
            <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">has_screen</span><span class="s2">(</span><span class="s1">screen</span><span class="s2">.</span><span class="s1">name</span><span class="s2">):</span>
                <span class="s1">screen</span><span class="s2">.</span><span class="s1">name </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_generate_screen_name</span><span class="s2">()</span>

        <span class="s6"># change the transition if given explicitly</span>
        <span class="s1">old_transition </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">transition</span>
        <span class="s1">specified_transition </span><span class="s2">= </span><span class="s1">options</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">(</span><span class="s3">&quot;transition&quot;</span><span class="s2">, </span><span class="s4">None</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">specified_transition</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">transition </span><span class="s2">= </span><span class="s1">specified_transition</span>

        <span class="s6"># change the transition options</span>
        <span class="s4">for </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value </span><span class="s4">in </span><span class="s1">iteritems</span><span class="s2">(</span><span class="s1">options</span><span class="s2">):</span>
            <span class="s1">setattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">transition</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>

        <span class="s6"># add and leave if we are set as the current screen</span>
        <span class="s4">if </span><span class="s1">screen</span><span class="s2">.</span><span class="s1">manager </span><span class="s4">is not </span><span class="s1">self</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">screen</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">current_screen </span><span class="s4">is </span><span class="s1">screen</span><span class="s2">:</span>
            <span class="s4">return</span>

        <span class="s1">old_current </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">current_screen</span>

        <span class="s4">def </span><span class="s1">remove_old_screen</span><span class="s2">(</span><span class="s1">transition</span><span class="s2">):</span>
            <span class="s4">if </span><span class="s1">old_current </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">children</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">remove_widget</span><span class="s2">(</span><span class="s1">old_current</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">transition </span><span class="s2">= </span><span class="s1">old_transition</span>
            <span class="s1">transition</span><span class="s2">.</span><span class="s1">unbind</span><span class="s2">(</span><span class="s1">on_complete</span><span class="s2">=</span><span class="s1">remove_old_screen</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">transition</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">on_complete</span><span class="s2">=</span><span class="s1">remove_old_screen</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">current </span><span class="s2">= </span><span class="s1">screen</span><span class="s2">.</span><span class="s1">name</span>

    <span class="s4">def </span><span class="s1">_generate_screen_name</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">i </span><span class="s2">= </span><span class="s5">0</span>
        <span class="s4">while True</span><span class="s2">:</span>
            <span class="s1">name </span><span class="s2">= </span><span class="s3">'_screen{}'</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">i</span><span class="s2">)</span>
            <span class="s4">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">has_screen</span><span class="s2">(</span><span class="s1">name</span><span class="s2">):</span>
                <span class="s4">return </span><span class="s1">name</span>
            <span class="s1">i </span><span class="s2">+= </span><span class="s5">1</span>

    <span class="s4">def </span><span class="s1">_update_pos</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s4">for </span><span class="s1">child </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">children</span><span class="s2">:</span>
            <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">transition</span><span class="s2">.</span><span class="s1">is_active </span><span class="s4">and </span><span class="s1">\</span>
                <span class="s2">(</span><span class="s1">child </span><span class="s2">== </span><span class="s1">self</span><span class="s2">.</span><span class="s1">transition</span><span class="s2">.</span><span class="s1">screen_in </span><span class="s4">or</span>
                 <span class="s1">child </span><span class="s2">== </span><span class="s1">self</span><span class="s2">.</span><span class="s1">transition</span><span class="s2">.</span><span class="s1">screen_out</span><span class="s2">):</span>
                <span class="s4">continue</span>
            <span class="s1">child</span><span class="s2">.</span><span class="s1">pos </span><span class="s2">= </span><span class="s1">value</span>

    <span class="s4">def </span><span class="s1">on_motion</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">etype</span><span class="s2">, </span><span class="s1">me</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">transition</span><span class="s2">.</span><span class="s1">is_active</span><span class="s2">:</span>
            <span class="s4">return False</span>
        <span class="s4">return </span><span class="s1">super</span><span class="s2">().</span><span class="s1">on_motion</span><span class="s2">(</span><span class="s1">etype</span><span class="s2">, </span><span class="s1">me</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">on_touch_down</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">touch</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">transition</span><span class="s2">.</span><span class="s1">is_active</span><span class="s2">:</span>
            <span class="s4">return False</span>
        <span class="s4">return </span><span class="s1">super</span><span class="s2">(</span><span class="s1">ScreenManager</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">on_touch_down</span><span class="s2">(</span><span class="s1">touch</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">on_touch_move</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">touch</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">transition</span><span class="s2">.</span><span class="s1">is_active</span><span class="s2">:</span>
            <span class="s4">return False</span>
        <span class="s4">return </span><span class="s1">super</span><span class="s2">(</span><span class="s1">ScreenManager</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">on_touch_move</span><span class="s2">(</span><span class="s1">touch</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">on_touch_up</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">touch</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">transition</span><span class="s2">.</span><span class="s1">is_active</span><span class="s2">:</span>
            <span class="s4">return False</span>
        <span class="s4">return </span><span class="s1">super</span><span class="s2">(</span><span class="s1">ScreenManager</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">on_touch_up</span><span class="s2">(</span><span class="s1">touch</span><span class="s2">)</span>


<span class="s4">if </span><span class="s1">__name__ </span><span class="s2">== </span><span class="s3">'__main__'</span><span class="s2">:</span>
    <span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">app </span><span class="s4">import </span><span class="s1">App</span>
    <span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">button </span><span class="s4">import </span><span class="s1">Button</span>
    <span class="s1">Builder</span><span class="s2">.</span><span class="s1">load_string</span><span class="s2">(</span><span class="s3">''' 
&lt;Screen&gt;: 
    canvas: 
        Color: 
            rgb: .2, .2, .2 
        Rectangle: 
            size: self.size 
 
    GridLayout: 
        cols: 2 
        Button: 
            text: 'Hello world' 
        Button: 
            text: 'Hello world' 
        Button: 
            text: 'Hello world' 
        Button: 
            text: 'Hello world' 
'''</span><span class="s2">)</span>

    <span class="s4">class </span><span class="s1">TestApp</span><span class="s2">(</span><span class="s1">App</span><span class="s2">):</span>

        <span class="s4">def </span><span class="s1">change_view</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">l</span><span class="s2">):</span>
            <span class="s6"># d = ('left', 'up', 'down', 'right')</span>
            <span class="s6"># di = d.index(self.sm.transition.direction)</span>
            <span class="s6"># self.sm.transition.direction = d[(di + 1) % len(d)]</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">sm</span><span class="s2">.</span><span class="s1">current </span><span class="s2">= </span><span class="s1">next</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">sm</span><span class="s2">)</span>

        <span class="s4">def </span><span class="s1">remove_screen</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">l</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">sm</span><span class="s2">.</span><span class="s1">remove_widget</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">sm</span><span class="s2">.</span><span class="s1">get_screen</span><span class="s2">(</span><span class="s3">'test1'</span><span class="s2">))</span>

        <span class="s4">def </span><span class="s1">build</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
            <span class="s1">root </span><span class="s2">= </span><span class="s1">FloatLayout</span><span class="s2">()</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">sm </span><span class="s2">= </span><span class="s1">sm </span><span class="s2">= </span><span class="s1">ScreenManager</span><span class="s2">(</span><span class="s1">transition</span><span class="s2">=</span><span class="s1">SwapTransition</span><span class="s2">())</span>

            <span class="s1">sm</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">Screen</span><span class="s2">(</span><span class="s1">name</span><span class="s2">=</span><span class="s3">'test1'</span><span class="s2">))</span>
            <span class="s1">sm</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">Screen</span><span class="s2">(</span><span class="s1">name</span><span class="s2">=</span><span class="s3">'test2'</span><span class="s2">))</span>

            <span class="s1">btn </span><span class="s2">= </span><span class="s1">Button</span><span class="s2">(</span><span class="s1">size_hint</span><span class="s2">=(</span><span class="s4">None</span><span class="s2">, </span><span class="s4">None</span><span class="s2">))</span>
            <span class="s1">btn</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">on_release</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">change_view</span><span class="s2">)</span>

            <span class="s1">btn2 </span><span class="s2">= </span><span class="s1">Button</span><span class="s2">(</span><span class="s1">size_hint</span><span class="s2">=(</span><span class="s4">None</span><span class="s2">, </span><span class="s4">None</span><span class="s2">), </span><span class="s1">x</span><span class="s2">=</span><span class="s5">100</span><span class="s2">)</span>
            <span class="s1">btn2</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">on_release</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">remove_screen</span><span class="s2">)</span>

            <span class="s1">root</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">sm</span><span class="s2">)</span>
            <span class="s1">root</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">btn</span><span class="s2">)</span>
            <span class="s1">root</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">btn2</span><span class="s2">)</span>
            <span class="s4">return </span><span class="s1">root</span>

    <span class="s1">TestApp</span><span class="s2">().</span><span class="s1">run</span><span class="s2">()</span>
</pre>
</body>
</html>