<html>
<head>
<title>tabbedpanel.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #cf8e6d;}
.s5 { color: #7a7e85;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
tabbedpanel.py</font>
</center></td></tr></table>
<pre><span class="s0">''' 
TabbedPanel 
=========== 
 
.. image:: images/tabbed_panel.jpg 
    :align: right 
 
.. versionadded:: 1.3.0 
 
 
The `TabbedPanel` widget manages different widgets in tabs, with a header area 
for the actual tab buttons and a content area for showing the current tab 
content. 
 
The :class:`TabbedPanel` provides one default tab. 
 
Simple example 
-------------- 
 
.. include:: ../../examples/widgets/tabbedpanel.py 
    :literal: 
 
.. note:: 
 
    A new class :class:`TabbedPanelItem` has been introduced in 1.5.0 for 
    convenience. So now one can simply add a :class:`TabbedPanelItem` to a 
    :class:`TabbedPanel` and `content` to the :class:`TabbedPanelItem` 
    as in the example provided above. 
 
Customize the Tabbed Panel 
-------------------------- 
 
You can choose the position in which the tabs are displayed:: 
 
    tab_pos = 'top_mid' 
 
An individual tab is called a TabbedPanelHeader. It is a special button 
containing a `content` property. You add the TabbedPanelHeader first, and set 
its `content` property separately:: 
 
    tp = TabbedPanel() 
    th = TabbedPanelHeader(text='Tab2') 
    tp.add_widget(th) 
 
An individual tab, represented by a TabbedPanelHeader, needs its content set. 
This content can be any widget. It could be a layout with a deep 
hierarchy of widgets, or it could be an individual widget, such as a label or a 
button:: 
 
    th.content = your_content_instance 
 
There is one &quot;shared&quot; main content area active at any given time, for all 
the tabs. Your app is responsible for adding the content of individual tabs 
and for managing them, but it's not responsible for content switching. The 
tabbed panel handles switching of the main content object as per user action. 
 
There is a default tab added when the tabbed panel is instantiated. 
Tabs that you add individually as above, are added in addition to the default 
tab. Thus, depending on your needs and design, you will want to customize the 
default tab:: 
 
    tp.default_tab_text = 'Something Specific To Your Use' 
 
 
The default tab machinery requires special consideration and management. 
Accordingly, an `on_default_tab` event is provided for associating a callback:: 
 
    tp.bind(default_tab = my_default_tab_callback) 
 
It's important to note that by default, :attr:`default_tab_cls` is of type 
:class:`TabbedPanelHeader` and thus has the same properties as other tabs. 
 
Since 1.5.0, it is now possible to disable the creation of the 
:attr:`default_tab` by setting :attr:`do_default_tab` to False. 
 
Tabs and content can be removed in several ways:: 
 
    tp.remove_widget(widget/tabbed_panel_header) 
    or 
    tp.clear_widgets() # to clear all the widgets in the content area 
    or 
    tp.clear_tabs() # to remove the TabbedPanelHeaders 
 
To access the children of the tabbed panel, use content.children:: 
 
    tp.content.children 
 
To access the list of tabs:: 
 
    tp.tab_list 
 
To change the appearance of the main tabbed panel content:: 
 
    background_color = (1, 0, 0, .5) #50% translucent red 
    border = [0, 0, 0, 0] 
    background_image = 'path/to/background/image' 
 
To change the background of a individual tab, use these two properties:: 
 
    tab_header_instance.background_normal = 'path/to/tab_head/img' 
    tab_header_instance.background_down = 'path/to/tab_head/img_pressed' 
 
A TabbedPanelStrip contains the individual tab headers. To change the 
appearance of this tab strip, override the canvas of TabbedPanelStrip. 
For example, in the kv language: 
 
.. code-block:: kv 
 
    &lt;TabbedPanelStrip&gt; 
        canvas: 
            Color: 
                rgba: (0, 1, 0, 1) # green 
            Rectangle: 
                size: self.size 
                pos: self.pos 
 
By default the tabbed panel strip takes its background image and color from the 
tabbed panel's background_image and background_color. 
 
'''</span>

<span class="s1">__all__ </span><span class="s2">= (</span><span class="s3">'StripLayout'</span><span class="s2">, </span><span class="s3">'TabbedPanel'</span><span class="s2">, </span><span class="s3">'TabbedPanelContent'</span><span class="s2">,</span>
           <span class="s3">'TabbedPanelHeader'</span><span class="s2">, </span><span class="s3">'TabbedPanelItem'</span><span class="s2">, </span><span class="s3">'TabbedPanelStrip'</span><span class="s2">,</span>
           <span class="s3">'TabbedPanelException'</span><span class="s2">)</span>

<span class="s4">from </span><span class="s1">functools </span><span class="s4">import </span><span class="s1">partial</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">clock </span><span class="s4">import </span><span class="s1">Clock</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">compat </span><span class="s4">import </span><span class="s1">string_types</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">factory </span><span class="s4">import </span><span class="s1">Factory</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">togglebutton </span><span class="s4">import </span><span class="s1">ToggleButton</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">widget </span><span class="s4">import </span><span class="s1">Widget</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">scatter </span><span class="s4">import </span><span class="s1">Scatter</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">scrollview </span><span class="s4">import </span><span class="s1">ScrollView</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">gridlayout </span><span class="s4">import </span><span class="s1">GridLayout</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">floatlayout </span><span class="s4">import </span><span class="s1">FloatLayout</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">logger </span><span class="s4">import </span><span class="s1">Logger</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">metrics </span><span class="s4">import </span><span class="s1">dp</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">properties </span><span class="s4">import </span><span class="s1">ObjectProperty</span><span class="s2">, </span><span class="s1">StringProperty</span><span class="s2">, </span><span class="s1">OptionProperty</span><span class="s2">, </span><span class="s1">\</span>
    <span class="s1">ListProperty</span><span class="s2">, </span><span class="s1">NumericProperty</span><span class="s2">, </span><span class="s1">AliasProperty</span><span class="s2">, </span><span class="s1">BooleanProperty</span><span class="s2">, </span><span class="s1">\</span>
    <span class="s1">ColorProperty</span>


<span class="s4">class </span><span class="s1">TabbedPanelException</span><span class="s2">(</span><span class="s1">Exception</span><span class="s2">):</span>
    <span class="s0">'''The TabbedPanelException class. 
    '''</span>
    <span class="s4">pass</span>


<span class="s4">class </span><span class="s1">TabbedPanelHeader</span><span class="s2">(</span><span class="s1">ToggleButton</span><span class="s2">):</span>
    <span class="s0">'''A Base for implementing a Tabbed Panel Head. A button intended to be 
    used as a Heading/Tab for a TabbedPanel widget. 
 
    You can use this TabbedPanelHeader widget to add a new tab to a 
    TabbedPanel. 
    '''</span>

    <span class="s1">content </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">, </span><span class="s1">allownone</span><span class="s2">=</span><span class="s4">True</span><span class="s2">)</span>
    <span class="s3">'''Content to be loaded when this tab header is selected. 
 
    :attr:`content` is an :class:`~kivy.properties.ObjectProperty` and defaults 
    to None. 
    '''</span>

    <span class="s5"># only allow selecting the tab if not already selected</span>
    <span class="s4">def </span><span class="s1">on_touch_down</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">touch</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">state </span><span class="s2">== </span><span class="s3">'down'</span><span class="s2">:</span>
            <span class="s5"># dispatch to children, not to self</span>
            <span class="s4">for </span><span class="s1">child </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">children</span><span class="s2">:</span>
                <span class="s1">child</span><span class="s2">.</span><span class="s1">dispatch</span><span class="s2">(</span><span class="s3">'on_touch_down'</span><span class="s2">, </span><span class="s1">touch</span><span class="s2">)</span>
            <span class="s4">return</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">super</span><span class="s2">(</span><span class="s1">TabbedPanelHeader</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">on_touch_down</span><span class="s2">(</span><span class="s1">touch</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">on_release</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">largs</span><span class="s2">):</span>
        <span class="s5"># Tabbed panel header is a child of tab_strib which has a</span>
        <span class="s5"># `tabbed_panel` property</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">parent</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">parent</span><span class="s2">.</span><span class="s1">tabbed_panel</span><span class="s2">.</span><span class="s1">switch_to</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s5"># tab removed before we could switch to it. Switch back to</span>
            <span class="s5"># previous tab</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">panel</span><span class="s2">.</span><span class="s1">switch_to</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">panel</span><span class="s2">.</span><span class="s1">current_tab</span><span class="s2">)</span>


<span class="s4">class </span><span class="s1">TabbedPanelItem</span><span class="s2">(</span><span class="s1">TabbedPanelHeader</span><span class="s2">):</span>
    <span class="s0">'''This is a convenience class that provides a header of type 
    TabbedPanelHeader and links it with the content automatically. Thus 
    facilitating you to simply do the following in kv language: 
 
    .. code-block:: kv 
 
        &lt;TabbedPanel&gt;: 
            # ...other settings 
            TabbedPanelItem: 
                BoxLayout: 
                    Label: 
                        text: 'Second tab content area' 
                    Button: 
                        text: 'Button that does nothing' 
 
    .. versionadded:: 1.5.0 
    '''</span>

    <span class="s4">def </span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">widget</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">content </span><span class="s2">= </span><span class="s1">widget</span>
        <span class="s4">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">parent</span><span class="s2">:</span>
            <span class="s4">return</span>
        <span class="s1">panel </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">parent</span><span class="s2">.</span><span class="s1">tabbed_panel</span>
        <span class="s4">if </span><span class="s1">panel</span><span class="s2">.</span><span class="s1">current_tab </span><span class="s2">== </span><span class="s1">self</span><span class="s2">:</span>
            <span class="s1">panel</span><span class="s2">.</span><span class="s1">switch_to</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">remove_widget</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">content </span><span class="s2">= </span><span class="s4">None</span>
        <span class="s4">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">parent</span><span class="s2">:</span>
            <span class="s4">return</span>
        <span class="s1">panel </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">parent</span><span class="s2">.</span><span class="s1">tabbed_panel</span>
        <span class="s4">if </span><span class="s1">panel</span><span class="s2">.</span><span class="s1">current_tab </span><span class="s2">== </span><span class="s1">self</span><span class="s2">:</span>
            <span class="s1">panel</span><span class="s2">.</span><span class="s1">remove_widget</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>


<span class="s4">class </span><span class="s1">TabbedPanelStrip</span><span class="s2">(</span><span class="s1">GridLayout</span><span class="s2">):</span>
    <span class="s0">'''A strip intended to be used as background for Heading/Tab. 
    This does not cover the blank areas in case the tabs don't cover 
    the entire width/height of the TabbedPanel(use :class:`StripLayout` 
    for that). 
    '''</span>
    <span class="s1">tabbed_panel </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">)</span>
    <span class="s3">'''Link to the panel that the tab strip is a part of. 
 
    :attr:`tabbed_panel` is an :class:`~kivy.properties.ObjectProperty` and 
    defaults to None . 
    '''</span>


<span class="s4">class </span><span class="s1">StripLayout</span><span class="s2">(</span><span class="s1">GridLayout</span><span class="s2">):</span>
    <span class="s0">''' The main layout that is used to house the entire tabbedpanel strip 
    including the blank areas in case the tabs don't cover the entire 
    width/height. 
 
    .. versionadded:: 1.8.0 
 
    '''</span>

    <span class="s1">border </span><span class="s2">= </span><span class="s1">ListProperty</span><span class="s2">([</span><span class="s6">4</span><span class="s2">, </span><span class="s6">4</span><span class="s2">, </span><span class="s6">4</span><span class="s2">, </span><span class="s6">4</span><span class="s2">])</span>
    <span class="s3">'''Border property for the :attr:`background_image`. 
 
    :attr:`border` is a :class:`~kivy.properties.ListProperty` and defaults 
    to [4, 4, 4, 4] 
    '''</span>

    <span class="s1">background_image </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span>
        <span class="s3">'atlas://data/images/defaulttheme/action_view'</span><span class="s2">)</span>
    <span class="s3">'''Background image to be used for the Strip layout of the TabbedPanel. 
 
    :attr:`background_image` is a :class:`~kivy.properties.StringProperty` and 
    defaults to a transparent image. 
    '''</span>


<span class="s4">class </span><span class="s1">TabbedPanelContent</span><span class="s2">(</span><span class="s1">FloatLayout</span><span class="s2">):</span>
    <span class="s0">'''The TabbedPanelContent class. 
    '''</span>
    <span class="s4">pass</span>


<span class="s4">class </span><span class="s1">TabbedPanel</span><span class="s2">(</span><span class="s1">GridLayout</span><span class="s2">):</span>
    <span class="s0">'''The TabbedPanel class. See module documentation for more information. 
    '''</span>

    <span class="s1">background_color </span><span class="s2">= </span><span class="s1">ColorProperty</span><span class="s2">([</span><span class="s6">1</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s6">1</span><span class="s2">])</span>
    <span class="s3">'''Background color, in the format (r, g, b, a). 
 
    :attr:`background_color` is a :class:`~kivy.properties.ColorProperty` and 
    defaults to [1, 1, 1, 1]. 
 
    .. versionchanged:: 2.0.0 
        Changed from :class:`~kivy.properties.ListProperty` to 
        :class:`~kivy.properties.ColorProperty`. 
    '''</span>

    <span class="s1">border </span><span class="s2">= </span><span class="s1">ListProperty</span><span class="s2">([</span><span class="s6">16</span><span class="s2">, </span><span class="s6">16</span><span class="s2">, </span><span class="s6">16</span><span class="s2">, </span><span class="s6">16</span><span class="s2">])</span>
    <span class="s3">'''Border used for :class:`~kivy.graphics.vertex_instructions.BorderImage` 
    graphics instruction, used itself for :attr:`background_image`. 
    Can be changed for a custom background. 
 
    It must be a list of four values: (bottom, right, top, left). Read the 
    BorderImage instructions for more information. 
 
    :attr:`border` is a :class:`~kivy.properties.ListProperty` and 
    defaults to (16, 16, 16, 16) 
    '''</span>

    <span class="s1">background_image </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span><span class="s3">'atlas://data/images/defaulttheme/tab'</span><span class="s2">)</span>
    <span class="s3">'''Background image of the main shared content object. 
 
    :attr:`background_image` is a :class:`~kivy.properties.StringProperty` and 
    defaults to 'atlas://data/images/defaulttheme/tab'. 
    '''</span>

    <span class="s1">background_disabled_image </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span>
        <span class="s3">'atlas://data/images/defaulttheme/tab_disabled'</span><span class="s2">)</span>
    <span class="s3">'''Background image of the main shared content object when disabled. 
 
    .. versionadded:: 1.8.0 
 
    :attr:`background_disabled_image` is a 
    :class:`~kivy.properties.StringProperty` and defaults to 
    'atlas://data/images/defaulttheme/tab'. 
    '''</span>

    <span class="s1">strip_image </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span>
        <span class="s3">'atlas://data/images/defaulttheme/action_view'</span><span class="s2">)</span>
    <span class="s3">'''Background image of the tabbed strip. 
 
    .. versionadded:: 1.8.0 
 
    :attr:`strip_image` is a :class:`~kivy.properties.StringProperty` 
    and defaults to a empty image. 
    '''</span>

    <span class="s1">strip_border </span><span class="s2">= </span><span class="s1">ListProperty</span><span class="s2">([</span><span class="s6">4</span><span class="s2">, </span><span class="s6">4</span><span class="s2">, </span><span class="s6">4</span><span class="s2">, </span><span class="s6">4</span><span class="s2">])</span>
    <span class="s3">'''Border to be used on :attr:`strip_image`. 
 
    .. versionadded:: 1.8.0 
 
    :attr:`strip_border` is a :class:`~kivy.properties.ListProperty` and 
    defaults to [4, 4, 4, 4]. 
    '''</span>

    <span class="s1">_current_tab </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">get_current_tab</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_current_tab</span>

    <span class="s1">current_tab </span><span class="s2">= </span><span class="s1">AliasProperty</span><span class="s2">(</span><span class="s1">get_current_tab</span><span class="s2">, </span><span class="s4">None</span><span class="s2">, </span><span class="s1">bind</span><span class="s2">=(</span><span class="s3">'_current_tab'</span><span class="s2">, ))</span>
    <span class="s3">'''Links to the currently selected or active tab. 
 
    .. versionadded:: 1.4.0 
 
    :attr:`current_tab` is an :class:`~kivy.AliasProperty`, read-only. 
    '''</span>

    <span class="s1">tab_pos </span><span class="s2">= </span><span class="s1">OptionProperty</span><span class="s2">(</span>
        <span class="s3">'top_left'</span><span class="s2">,</span>
        <span class="s1">options</span><span class="s2">=(</span><span class="s3">'left_top'</span><span class="s2">, </span><span class="s3">'left_mid'</span><span class="s2">, </span><span class="s3">'left_bottom'</span><span class="s2">, </span><span class="s3">'top_left'</span><span class="s2">,</span>
                 <span class="s3">'top_mid'</span><span class="s2">, </span><span class="s3">'top_right'</span><span class="s2">, </span><span class="s3">'right_top'</span><span class="s2">, </span><span class="s3">'right_mid'</span><span class="s2">,</span>
                 <span class="s3">'right_bottom'</span><span class="s2">, </span><span class="s3">'bottom_left'</span><span class="s2">, </span><span class="s3">'bottom_mid'</span><span class="s2">, </span><span class="s3">'bottom_right'</span><span class="s2">))</span>
    <span class="s3">'''Specifies the position of the tabs relative to the content. 
    Can be one of: `left_top`, `left_mid`, `left_bottom`, `top_left`, 
    `top_mid`, `top_right`, `right_top`, `right_mid`, `right_bottom`, 
    `bottom_left`, `bottom_mid`, `bottom_right`. 
 
    :attr:`tab_pos` is an :class:`~kivy.properties.OptionProperty` and 
    defaults to 'top_left'. 
    '''</span>

    <span class="s1">tab_height </span><span class="s2">= </span><span class="s1">NumericProperty</span><span class="s2">(</span><span class="s3">'40dp'</span><span class="s2">)</span>
    <span class="s3">'''Specifies the height of the tab header. 
 
    :attr:`tab_height` is a :class:`~kivy.properties.NumericProperty` and 
    defaults to 40. 
    '''</span>

    <span class="s1">tab_width </span><span class="s2">= </span><span class="s1">NumericProperty</span><span class="s2">(</span><span class="s3">'100dp'</span><span class="s2">, </span><span class="s1">allownone</span><span class="s2">=</span><span class="s4">True</span><span class="s2">)</span>
    <span class="s3">'''Specifies the width of the tab header. 
 
    :attr:`tab_width` is a :class:`~kivy.properties.NumericProperty` and 
    defaults to 100. 
    '''</span>

    <span class="s1">bar_width </span><span class="s2">= </span><span class="s1">NumericProperty</span><span class="s2">(</span><span class="s3">'2dp'</span><span class="s2">)</span>
    <span class="s3">'''Width of the horizontal scroll bar. The width is interpreted 
    as a height for the horizontal bar. 
 
    .. versionadded:: 2.2.0 
 
    :attr:`bar_width` is a :class:`~kivy.properties.NumericProperty` and 
    defaults to 2. 
    '''</span>

    <span class="s1">scroll_type </span><span class="s2">= </span><span class="s1">OptionProperty</span><span class="s2">([</span><span class="s3">'content'</span><span class="s2">], </span><span class="s1">options</span><span class="s2">=([</span><span class="s3">'content'</span><span class="s2">], [</span><span class="s3">'bars'</span><span class="s2">],</span>
                                 <span class="s2">[</span><span class="s3">'bars'</span><span class="s2">, </span><span class="s3">'content'</span><span class="s2">], [</span><span class="s3">'content'</span><span class="s2">, </span><span class="s3">'bars'</span><span class="s2">]))</span>

    <span class="s3">'''Sets the type of scrolling to use for the content of the scrollview. 
    Available options are: ['content'], ['bars'], ['bars', 'content']. 
 
    .. versionadded:: 2.2.0 
 
    :attr:`scroll_type` is an :class:`~kivy.properties.OptionProperty` and 
    defaults to ['content']. 
    '''</span>

    <span class="s1">do_default_tab </span><span class="s2">= </span><span class="s1">BooleanProperty</span><span class="s2">(</span><span class="s4">True</span><span class="s2">)</span>
    <span class="s3">'''Specifies whether a default_tab head is provided. 
 
    .. versionadded:: 1.5.0 
 
    :attr:`do_default_tab` is a :class:`~kivy.properties.BooleanProperty` and 
    defaults to 'True'. 
    '''</span>

    <span class="s1">default_tab_text </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span><span class="s3">'Default tab'</span><span class="s2">)</span>
    <span class="s3">'''Specifies the text displayed on the default tab header. 
 
    :attr:`default_tab_text` is a :class:`~kivy.properties.StringProperty` and 
    defaults to 'default tab'. 
    '''</span>

    <span class="s1">default_tab_cls </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">(</span><span class="s1">TabbedPanelHeader</span><span class="s2">)</span>
    <span class="s3">'''Specifies the class to use for the styling of the default tab. 
 
    .. versionadded:: 1.4.0 
 
    .. warning:: 
        `default_tab_cls` should be subclassed from `TabbedPanelHeader` 
 
    :attr:`default_tab_cls` is an :class:`~kivy.properties.ObjectProperty` 
    and defaults to `TabbedPanelHeader`. If you set a string, the 
    :class:`~kivy.factory.Factory` will be used to resolve the class. 
 
    .. versionchanged:: 1.8.0 
        The :class:`~kivy.factory.Factory` will resolve the class if a string 
        is set. 
    '''</span>

    <span class="s4">def </span><span class="s1">get_tab_list</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_tab_strip</span><span class="s2">:</span>
            <span class="s4">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_tab_strip</span><span class="s2">.</span><span class="s1">children</span>
        <span class="s4">return </span><span class="s6">1.</span>

    <span class="s1">tab_list </span><span class="s2">= </span><span class="s1">AliasProperty</span><span class="s2">(</span><span class="s1">get_tab_list</span><span class="s2">, </span><span class="s4">None</span><span class="s2">)</span>
    <span class="s3">'''List of all the tab headers. 
 
    :attr:`tab_list` is an :class:`~kivy.properties.AliasProperty` and is 
    read-only. 
    '''</span>

    <span class="s1">content </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">)</span>
    <span class="s3">'''This is the object holding (current_tab's content is added to this) 
    the content of the current tab. To Listen to the changes in the content 
    of the current tab, you should bind to current_tabs `content` property. 
 
    :attr:`content` is an :class:`~kivy.properties.ObjectProperty` and 
    defaults to 'None'. 
    '''</span>

    <span class="s1">_default_tab </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">, </span><span class="s1">allow_none</span><span class="s2">=</span><span class="s4">True</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">get_def_tab</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_default_tab</span>

    <span class="s4">def </span><span class="s1">set_def_tab</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">new_tab</span><span class="s2">):</span>
        <span class="s4">if not </span><span class="s1">issubclass</span><span class="s2">(</span><span class="s1">new_tab</span><span class="s2">.</span><span class="s1">__class__</span><span class="s2">, </span><span class="s1">TabbedPanelHeader</span><span class="s2">):</span>
            <span class="s4">raise </span><span class="s1">TabbedPanelException</span><span class="s2">(</span><span class="s3">'`default_tab_class` should be</span><span class="s4">\ 
                </span><span class="s3">subclassed from `TabbedPanelHeader`'</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_default_tab </span><span class="s2">== </span><span class="s1">new_tab</span><span class="s2">:</span>
            <span class="s4">return</span>
        <span class="s1">oltab </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_default_tab</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_default_tab </span><span class="s2">= </span><span class="s1">new_tab</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">remove_widget</span><span class="s2">(</span><span class="s1">oltab</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_original_tab </span><span class="s2">= </span><span class="s4">None</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">switch_to</span><span class="s2">(</span><span class="s1">new_tab</span><span class="s2">)</span>
        <span class="s1">new_tab</span><span class="s2">.</span><span class="s1">state </span><span class="s2">= </span><span class="s3">'down'</span>

    <span class="s1">default_tab </span><span class="s2">= </span><span class="s1">AliasProperty</span><span class="s2">(</span><span class="s1">get_def_tab</span><span class="s2">, </span><span class="s1">set_def_tab</span><span class="s2">,</span>
                                <span class="s1">bind</span><span class="s2">=(</span><span class="s3">'_default_tab'</span><span class="s2">, ))</span>
    <span class="s3">'''Holds the default tab. 
 
    .. Note:: For convenience, the automatically provided default tab is 
              deleted when you change default_tab to something else. 
              As of 1.5.0, this behavior has been extended to every 
              `default_tab` for consistency and not just the automatically 
              provided one. 
 
    :attr:`default_tab` is an :class:`~kivy.properties.AliasProperty`. 
    '''</span>

    <span class="s4">def </span><span class="s1">get_def_tab_content</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">default_tab</span><span class="s2">.</span><span class="s1">content</span>

    <span class="s4">def </span><span class="s1">set_def_tab_content</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">l</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">default_tab</span><span class="s2">.</span><span class="s1">content </span><span class="s2">= </span><span class="s1">l</span><span class="s2">[</span><span class="s6">0</span><span class="s2">]</span>

    <span class="s1">default_tab_content </span><span class="s2">= </span><span class="s1">AliasProperty</span><span class="s2">(</span><span class="s1">get_def_tab_content</span><span class="s2">,</span>
                                        <span class="s1">set_def_tab_content</span><span class="s2">)</span>
    <span class="s3">'''Holds the default tab content. 
 
    :attr:`default_tab_content` is an :class:`~kivy.properties.AliasProperty`. 
    '''</span>

    <span class="s1">_update_top_ev </span><span class="s2">= </span><span class="s1">_update_tab_ev </span><span class="s2">= </span><span class="s1">_update_tabs_ev </span><span class="s2">= </span><span class="s4">None</span>

    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s5"># these variables need to be initialized before the kv lang is</span>
        <span class="s5"># processed setup the base layout for the tabbed panel</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_childrens </span><span class="s2">= []</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_tab_layout </span><span class="s2">= </span><span class="s1">StripLayout</span><span class="s2">(</span><span class="s1">rows</span><span class="s2">=</span><span class="s6">1</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rows </span><span class="s2">= </span><span class="s6">1</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_tab_strip </span><span class="s2">= </span><span class="s1">TabbedPanelStrip</span><span class="s2">(</span>
            <span class="s1">tabbed_panel</span><span class="s2">=</span><span class="s1">self</span><span class="s2">,</span>
            <span class="s1">rows</span><span class="s2">=</span><span class="s6">1</span><span class="s2">, </span><span class="s1">size_hint</span><span class="s2">=(</span><span class="s4">None</span><span class="s2">, </span><span class="s4">None</span><span class="s2">),</span>
            <span class="s1">height</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">tab_height</span><span class="s2">, </span><span class="s1">width</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">tab_width</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">_partial_update_scrollview </span><span class="s2">= </span><span class="s4">None</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">content </span><span class="s2">= </span><span class="s1">TabbedPanelContent</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_current_tab </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_original_tab \</span>
            <span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_default_tab </span><span class="s2">= </span><span class="s1">TabbedPanelHeader</span><span class="s2">()</span>

        <span class="s1">super</span><span class="s2">(</span><span class="s1">TabbedPanel</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">__init__</span><span class="s2">(**</span><span class="s1">kwargs</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">fbind</span><span class="s2">(</span><span class="s3">'size'</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_reposition_tabs</span><span class="s2">)</span>
        <span class="s4">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">do_default_tab</span><span class="s2">:</span>
            <span class="s1">Clock</span><span class="s2">.</span><span class="s1">schedule_once</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_switch_to_first_tab</span><span class="s2">)</span>
            <span class="s4">return</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_setup_default_tab</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">switch_to</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">default_tab</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">switch_to</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">header</span><span class="s2">, </span><span class="s1">do_scroll</span><span class="s2">=</span><span class="s4">False</span><span class="s2">):</span>
        <span class="s0">'''Switch to a specific panel header. 
 
        .. versionchanged:: 1.10.0 
 
        If used with `do_scroll=True`, it scrolls 
        to the header's tab too. 
 
        :meth:`switch_to` cannot be called from within the 
        :class:`TabbedPanel` or its subclass' ``__init__`` method. 
        If that is required, use the ``Clock`` to schedule it. See `discussion 
        &lt;https://github.com/kivy/kivy/issues/3493#issuecomment-121567969&gt;`_ 
        for full example. 
        '''</span>
        <span class="s1">header_content </span><span class="s2">= </span><span class="s1">header</span><span class="s2">.</span><span class="s1">content</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_current_tab</span><span class="s2">.</span><span class="s1">state </span><span class="s2">= </span><span class="s3">'normal'</span>
        <span class="s1">header</span><span class="s2">.</span><span class="s1">state </span><span class="s2">= </span><span class="s3">'down'</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_current_tab </span><span class="s2">= </span><span class="s1">header</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">clear_widgets</span><span class="s2">()</span>
        <span class="s4">if </span><span class="s1">header_content </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s4">return</span>
        <span class="s5"># if content has a previous parent remove it from that parent</span>
        <span class="s1">parent </span><span class="s2">= </span><span class="s1">header_content</span><span class="s2">.</span><span class="s1">parent</span>
        <span class="s4">if </span><span class="s1">parent</span><span class="s2">:</span>
            <span class="s1">parent</span><span class="s2">.</span><span class="s1">remove_widget</span><span class="s2">(</span><span class="s1">header_content</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">header_content</span><span class="s2">)</span>

        <span class="s4">if </span><span class="s1">do_scroll</span><span class="s2">:</span>
            <span class="s1">tabs </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_tab_strip</span>
            <span class="s1">tabs</span><span class="s2">.</span><span class="s1">parent</span><span class="s2">.</span><span class="s1">scroll_to</span><span class="s2">(</span><span class="s1">header</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">clear_tabs</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">l</span><span class="s2">):</span>
        <span class="s1">self_tabs </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_tab_strip</span>
        <span class="s1">self_tabs</span><span class="s2">.</span><span class="s1">clear_widgets</span><span class="s2">()</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">do_default_tab</span><span class="s2">:</span>
            <span class="s1">self_default_tab </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_default_tab</span>
            <span class="s1">self_tabs</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">self_default_tab</span><span class="s2">)</span>
            <span class="s1">self_tabs</span><span class="s2">.</span><span class="s1">width </span><span class="s2">= </span><span class="s1">self_default_tab</span><span class="s2">.</span><span class="s1">width</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_reposition_tabs</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">widget</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s1">content </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">content</span>
        <span class="s4">if </span><span class="s1">content </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s4">return</span>
        <span class="s1">parent </span><span class="s2">= </span><span class="s1">widget</span><span class="s2">.</span><span class="s1">parent</span>
        <span class="s4">if </span><span class="s1">parent</span><span class="s2">:</span>
            <span class="s1">parent</span><span class="s2">.</span><span class="s1">remove_widget</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">widget </span><span class="s4">in </span><span class="s2">(</span><span class="s1">content</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_tab_layout</span><span class="s2">):</span>
            <span class="s1">super</span><span class="s2">(</span><span class="s1">TabbedPanel</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>
        <span class="s4">elif </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, </span><span class="s1">TabbedPanelHeader</span><span class="s2">):</span>
            <span class="s1">self_tabs </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_tab_strip</span>
            <span class="s1">self_tabs</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>
            <span class="s1">widget</span><span class="s2">.</span><span class="s1">group </span><span class="s2">= </span><span class="s3">'__tab%r__' </span><span class="s2">% </span><span class="s1">self_tabs</span><span class="s2">.</span><span class="s1">uid</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">on_tab_width</span><span class="s2">()</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">widget</span><span class="s2">.</span><span class="s1">pos_hint </span><span class="s2">= {</span><span class="s3">'x'</span><span class="s2">: </span><span class="s6">0</span><span class="s2">, </span><span class="s3">'top'</span><span class="s2">: </span><span class="s6">1</span><span class="s2">}</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_childrens</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">)</span>
            <span class="s1">content</span><span class="s2">.</span><span class="s1">disabled </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">current_tab</span><span class="s2">.</span><span class="s1">disabled</span>
            <span class="s1">content</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">remove_widget</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">widget</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s1">content </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">content</span>
        <span class="s4">if </span><span class="s1">content </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s4">return</span>
        <span class="s4">if </span><span class="s1">widget </span><span class="s4">in </span><span class="s2">(</span><span class="s1">content</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_tab_layout</span><span class="s2">):</span>
            <span class="s1">super</span><span class="s2">(</span><span class="s1">TabbedPanel</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">remove_widget</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>
        <span class="s4">elif </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, </span><span class="s1">TabbedPanelHeader</span><span class="s2">):</span>
            <span class="s4">if not </span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">do_default_tab </span><span class="s4">and </span><span class="s1">widget </span><span class="s4">is </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_default_tab</span><span class="s2">):</span>
                <span class="s1">self_tabs </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_tab_strip</span>
                <span class="s1">self_tabs</span><span class="s2">.</span><span class="s1">width </span><span class="s2">-= </span><span class="s1">widget</span><span class="s2">.</span><span class="s1">width</span>
                <span class="s1">self_tabs</span><span class="s2">.</span><span class="s1">remove_widget</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">)</span>
                <span class="s4">if </span><span class="s1">widget</span><span class="s2">.</span><span class="s1">state </span><span class="s2">== </span><span class="s3">'down' </span><span class="s4">and </span><span class="s1">self</span><span class="s2">.</span><span class="s1">do_default_tab</span><span class="s2">:</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">_default_tab</span><span class="s2">.</span><span class="s1">on_release</span><span class="s2">()</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">_reposition_tabs</span><span class="s2">()</span>
            <span class="s4">else</span><span class="s2">:</span>
                <span class="s1">Logger</span><span class="s2">.</span><span class="s1">info</span><span class="s2">(</span><span class="s3">'TabbedPanel: default tab! can</span><span class="s4">\'</span><span class="s3">t be removed.</span><span class="s4">\n</span><span class="s3">' </span><span class="s2">+</span>
                            <span class="s3">'Change `default_tab` to a different tab.'</span><span class="s2">)</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s4">if </span><span class="s1">widget </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_childrens</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">_childrens</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">)</span>
            <span class="s4">if </span><span class="s1">widget </span><span class="s4">in </span><span class="s1">content</span><span class="s2">.</span><span class="s1">children</span><span class="s2">:</span>
                <span class="s1">content</span><span class="s2">.</span><span class="s1">remove_widget</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">clear_widgets</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">content</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">content</span><span class="s2">.</span><span class="s1">clear_widgets</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">on_strip_image</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s4">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_tab_layout</span><span class="s2">:</span>
            <span class="s4">return</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_tab_layout</span><span class="s2">.</span><span class="s1">background_image </span><span class="s2">= </span><span class="s1">value</span>

    <span class="s4">def </span><span class="s1">on_strip_border</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s4">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_tab_layout</span><span class="s2">:</span>
            <span class="s4">return</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_tab_layout</span><span class="s2">.</span><span class="s1">border </span><span class="s2">= </span><span class="s1">value</span>

    <span class="s4">def </span><span class="s1">on_do_default_tab</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s4">if not </span><span class="s1">value</span><span class="s2">:</span>
            <span class="s1">dft </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">default_tab</span>
            <span class="s4">if </span><span class="s1">dft </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">tab_list</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">remove_widget</span><span class="s2">(</span><span class="s1">dft</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">_switch_to_first_tab</span><span class="s2">()</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">_default_tab </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_current_tab</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_current_tab</span><span class="s2">.</span><span class="s1">state </span><span class="s2">= </span><span class="s3">'normal'</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_setup_default_tab</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">on_default_tab_text</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_default_tab</span><span class="s2">.</span><span class="s1">text </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">default_tab_text</span>

    <span class="s4">def </span><span class="s1">on_tab_width</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">l</span><span class="s2">):</span>
        <span class="s1">ev </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_update_tab_ev</span>
        <span class="s4">if </span><span class="s1">ev </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s1">ev </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_update_tab_ev </span><span class="s2">= </span><span class="s1">Clock</span><span class="s2">.</span><span class="s1">create_trigger</span><span class="s2">(</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">_update_tab_width</span><span class="s2">, </span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">ev</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">on_tab_height</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">l</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_tab_layout</span><span class="s2">.</span><span class="s1">height </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_tab_strip</span><span class="s2">.</span><span class="s1">height </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">tab_height</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_reposition_tabs</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">on_tab_pos</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">l</span><span class="s2">):</span>
        <span class="s5"># ensure canvas</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_reposition_tabs</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">_setup_default_tab</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_default_tab </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">tab_list</span><span class="s2">:</span>
            <span class="s4">return</span>
        <span class="s1">content </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_default_tab</span><span class="s2">.</span><span class="s1">content</span>
        <span class="s1">_tabs </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_tab_strip</span>
        <span class="s1">cls </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">default_tab_cls</span>

        <span class="s4">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">, </span><span class="s1">string_types</span><span class="s2">):</span>
            <span class="s1">cls </span><span class="s2">= </span><span class="s1">Factory</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">)</span>

        <span class="s4">if not </span><span class="s1">issubclass</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">, </span><span class="s1">TabbedPanelHeader</span><span class="s2">):</span>
            <span class="s4">raise </span><span class="s1">TabbedPanelException</span><span class="s2">(</span><span class="s3">'`default_tab_class` should be</span><span class="s4">\ 
                </span><span class="s3">subclassed from `TabbedPanelHeader`'</span><span class="s2">)</span>

        <span class="s5"># no need to instantiate if class is TabbedPanelHeader</span>
        <span class="s4">if </span><span class="s1">cls </span><span class="s2">!= </span><span class="s1">TabbedPanelHeader</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_current_tab </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_original_tab </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_default_tab </span><span class="s2">= </span><span class="s1">cls</span><span class="s2">()</span>

        <span class="s1">default_tab </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">default_tab</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_original_tab </span><span class="s2">== </span><span class="s1">self</span><span class="s2">.</span><span class="s1">default_tab</span><span class="s2">:</span>
            <span class="s1">default_tab</span><span class="s2">.</span><span class="s1">text </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">default_tab_text</span>

        <span class="s1">default_tab</span><span class="s2">.</span><span class="s1">height </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">tab_height</span>
        <span class="s1">default_tab</span><span class="s2">.</span><span class="s1">group </span><span class="s2">= </span><span class="s3">'__tab%r__' </span><span class="s2">% </span><span class="s1">_tabs</span><span class="s2">.</span><span class="s1">uid</span>
        <span class="s1">default_tab</span><span class="s2">.</span><span class="s1">state </span><span class="s2">= </span><span class="s3">'down'</span>
        <span class="s1">default_tab</span><span class="s2">.</span><span class="s1">width </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">tab_width </span><span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">tab_width </span><span class="s4">else </span><span class="s6">100</span>
        <span class="s1">default_tab</span><span class="s2">.</span><span class="s1">content </span><span class="s2">= </span><span class="s1">content</span>

        <span class="s1">tl </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">tab_list</span>
        <span class="s4">if </span><span class="s1">default_tab </span><span class="s4">not in </span><span class="s1">tl</span><span class="s2">:</span>
            <span class="s1">_tabs</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">default_tab</span><span class="s2">, </span><span class="s1">len</span><span class="s2">(</span><span class="s1">tl</span><span class="s2">))</span>

        <span class="s4">if </span><span class="s1">default_tab</span><span class="s2">.</span><span class="s1">content</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">clear_widgets</span><span class="s2">()</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">default_tab</span><span class="s2">.</span><span class="s1">content</span><span class="s2">)</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">Clock</span><span class="s2">.</span><span class="s1">schedule_once</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_load_default_tab_content</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_current_tab </span><span class="s2">= </span><span class="s1">default_tab</span>

    <span class="s4">def </span><span class="s1">_switch_to_first_tab</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">l</span><span class="s2">):</span>
        <span class="s1">ltl </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">tab_list</span><span class="s2">) - </span><span class="s6">1</span>
        <span class="s4">if </span><span class="s1">ltl </span><span class="s2">&gt; -</span><span class="s6">1</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_current_tab </span><span class="s2">= </span><span class="s1">dt </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_original_tab \</span>
                <span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">tab_list</span><span class="s2">[</span><span class="s1">ltl</span><span class="s2">]</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">switch_to</span><span class="s2">(</span><span class="s1">dt</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">_load_default_tab_content</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">dt</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">default_tab</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">switch_to</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">default_tab</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">_reposition_tabs</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">l</span><span class="s2">):</span>
        <span class="s1">ev </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_update_tabs_ev</span>
        <span class="s4">if </span><span class="s1">ev </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s1">ev </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_update_tabs_ev </span><span class="s2">= </span><span class="s1">Clock</span><span class="s2">.</span><span class="s1">create_trigger</span><span class="s2">(</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">_update_tabs</span><span class="s2">, </span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">ev</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">_update_tabs</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">l</span><span class="s2">):</span>
        <span class="s1">self_content </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">content</span>
        <span class="s4">if not </span><span class="s1">self_content</span><span class="s2">:</span>
            <span class="s4">return</span>
        <span class="s5"># cache variables for faster access</span>
        <span class="s1">tab_pos </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">tab_pos</span>
        <span class="s1">tab_layout </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_tab_layout</span>
        <span class="s1">tab_layout</span><span class="s2">.</span><span class="s1">clear_widgets</span><span class="s2">()</span>
        <span class="s1">scrl_v </span><span class="s2">= </span><span class="s1">ScrollView</span><span class="s2">(</span><span class="s1">size_hint</span><span class="s2">=(</span><span class="s4">None</span><span class="s2">, </span><span class="s6">1</span><span class="s2">), </span><span class="s1">always_overscroll</span><span class="s2">=</span><span class="s4">False</span><span class="s2">,</span>
                            <span class="s1">bar_width</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">bar_width</span><span class="s2">,</span>
                            <span class="s1">scroll_type</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">scroll_type</span><span class="s2">)</span>
        <span class="s1">tabs </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_tab_strip</span>
        <span class="s1">parent </span><span class="s2">= </span><span class="s1">tabs</span><span class="s2">.</span><span class="s1">parent</span>
        <span class="s4">if </span><span class="s1">parent</span><span class="s2">:</span>
            <span class="s1">parent</span><span class="s2">.</span><span class="s1">remove_widget</span><span class="s2">(</span><span class="s1">tabs</span><span class="s2">)</span>
        <span class="s1">scrl_v</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">tabs</span><span class="s2">)</span>
        <span class="s1">scrl_v</span><span class="s2">.</span><span class="s1">pos </span><span class="s2">= (</span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">self_update_scrollview </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_update_scrollview</span>

        <span class="s5"># update scrlv width when tab width changes depends on tab_pos</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_partial_update_scrollview </span><span class="s4">is not None</span><span class="s2">:</span>
            <span class="s1">tabs</span><span class="s2">.</span><span class="s1">unbind</span><span class="s2">(</span><span class="s1">width</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_partial_update_scrollview</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_partial_update_scrollview </span><span class="s2">= </span><span class="s1">partial</span><span class="s2">(</span>
            <span class="s1">self_update_scrollview</span><span class="s2">, </span><span class="s1">scrl_v</span><span class="s2">)</span>
        <span class="s1">tabs</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">width</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_partial_update_scrollview</span><span class="s2">)</span>

        <span class="s5"># remove all widgets from the tab_strip</span>
        <span class="s1">super</span><span class="s2">(</span><span class="s1">TabbedPanel</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">clear_widgets</span><span class="s2">()</span>
        <span class="s1">tab_height </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">tab_height</span>

        <span class="s1">widget_list </span><span class="s2">= []</span>
        <span class="s1">tab_list </span><span class="s2">= []</span>
        <span class="s1">pos_letter </span><span class="s2">= </span><span class="s1">tab_pos</span><span class="s2">[</span><span class="s6">0</span><span class="s2">]</span>
        <span class="s4">if </span><span class="s1">pos_letter </span><span class="s2">== </span><span class="s3">'b' </span><span class="s4">or </span><span class="s1">pos_letter </span><span class="s2">== </span><span class="s3">'t'</span><span class="s2">:</span>
            <span class="s5"># bottom or top positions</span>
            <span class="s5"># one col containing the tab_strip and the content</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">cols </span><span class="s2">= </span><span class="s6">1</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">rows </span><span class="s2">= </span><span class="s6">2</span>
            <span class="s5"># tab_layout contains the scrollview containing tabs and two blank</span>
            <span class="s5"># dummy widgets for spacing</span>
            <span class="s1">tab_layout</span><span class="s2">.</span><span class="s1">rows </span><span class="s2">= </span><span class="s6">1</span>
            <span class="s1">tab_layout</span><span class="s2">.</span><span class="s1">cols </span><span class="s2">= </span><span class="s6">3</span>
            <span class="s1">tab_layout</span><span class="s2">.</span><span class="s1">size_hint </span><span class="s2">= (</span><span class="s6">1</span><span class="s2">, </span><span class="s4">None</span><span class="s2">)</span>
            <span class="s1">tab_layout</span><span class="s2">.</span><span class="s1">height </span><span class="s2">= (</span><span class="s1">tab_height </span><span class="s2">+ </span><span class="s1">tab_layout</span><span class="s2">.</span><span class="s1">padding</span><span class="s2">[</span><span class="s6">1</span><span class="s2">] +</span>
                                 <span class="s1">tab_layout</span><span class="s2">.</span><span class="s1">padding</span><span class="s2">[</span><span class="s6">3</span><span class="s2">] + </span><span class="s1">dp</span><span class="s2">(</span><span class="s6">2</span><span class="s2">))</span>
            <span class="s1">self_update_scrollview</span><span class="s2">(</span><span class="s1">scrl_v</span><span class="s2">)</span>

            <span class="s4">if </span><span class="s1">pos_letter </span><span class="s2">== </span><span class="s3">'b'</span><span class="s2">:</span>
                <span class="s5"># bottom</span>
                <span class="s4">if </span><span class="s1">tab_pos </span><span class="s2">== </span><span class="s3">'bottom_mid'</span><span class="s2">:</span>
                    <span class="s1">tab_list </span><span class="s2">= (</span><span class="s1">Widget</span><span class="s2">(), </span><span class="s1">scrl_v</span><span class="s2">, </span><span class="s1">Widget</span><span class="s2">())</span>
                    <span class="s1">widget_list </span><span class="s2">= (</span><span class="s1">self_content</span><span class="s2">, </span><span class="s1">tab_layout</span><span class="s2">)</span>
                <span class="s4">else</span><span class="s2">:</span>
                    <span class="s4">if </span><span class="s1">tab_pos </span><span class="s2">== </span><span class="s3">'bottom_left'</span><span class="s2">:</span>
                        <span class="s1">tab_list </span><span class="s2">= (</span><span class="s1">scrl_v</span><span class="s2">, </span><span class="s1">Widget</span><span class="s2">(), </span><span class="s1">Widget</span><span class="s2">())</span>
                    <span class="s4">elif </span><span class="s1">tab_pos </span><span class="s2">== </span><span class="s3">'bottom_right'</span><span class="s2">:</span>
                        <span class="s5"># add two dummy widgets</span>
                        <span class="s1">tab_list </span><span class="s2">= (</span><span class="s1">Widget</span><span class="s2">(), </span><span class="s1">Widget</span><span class="s2">(), </span><span class="s1">scrl_v</span><span class="s2">)</span>
                    <span class="s1">widget_list </span><span class="s2">= (</span><span class="s1">self_content</span><span class="s2">, </span><span class="s1">tab_layout</span><span class="s2">)</span>
            <span class="s4">else</span><span class="s2">:</span>
                <span class="s5"># top</span>
                <span class="s4">if </span><span class="s1">tab_pos </span><span class="s2">== </span><span class="s3">'top_mid'</span><span class="s2">:</span>
                    <span class="s1">tab_list </span><span class="s2">= (</span><span class="s1">Widget</span><span class="s2">(), </span><span class="s1">scrl_v</span><span class="s2">, </span><span class="s1">Widget</span><span class="s2">())</span>
                <span class="s4">elif </span><span class="s1">tab_pos </span><span class="s2">== </span><span class="s3">'top_left'</span><span class="s2">:</span>
                    <span class="s1">tab_list </span><span class="s2">= (</span><span class="s1">scrl_v</span><span class="s2">, </span><span class="s1">Widget</span><span class="s2">(), </span><span class="s1">Widget</span><span class="s2">())</span>
                <span class="s4">elif </span><span class="s1">tab_pos </span><span class="s2">== </span><span class="s3">'top_right'</span><span class="s2">:</span>
                    <span class="s1">tab_list </span><span class="s2">= (</span><span class="s1">Widget</span><span class="s2">(), </span><span class="s1">Widget</span><span class="s2">(), </span><span class="s1">scrl_v</span><span class="s2">)</span>
                <span class="s1">widget_list </span><span class="s2">= (</span><span class="s1">tab_layout</span><span class="s2">, </span><span class="s1">self_content</span><span class="s2">)</span>
        <span class="s4">elif </span><span class="s1">pos_letter </span><span class="s2">== </span><span class="s3">'l' </span><span class="s4">or </span><span class="s1">pos_letter </span><span class="s2">== </span><span class="s3">'r'</span><span class="s2">:</span>
            <span class="s5"># left or right positions</span>
            <span class="s5"># one row containing the tab_strip and the content</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">cols </span><span class="s2">= </span><span class="s6">2</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">rows </span><span class="s2">= </span><span class="s6">1</span>
            <span class="s5"># tab_layout contains two blank dummy widgets for spacing</span>
            <span class="s5"># &quot;vertically&quot; and the scatter containing scrollview</span>
            <span class="s5"># containing tabs</span>
            <span class="s1">tab_layout</span><span class="s2">.</span><span class="s1">rows </span><span class="s2">= </span><span class="s6">3</span>
            <span class="s1">tab_layout</span><span class="s2">.</span><span class="s1">cols </span><span class="s2">= </span><span class="s6">1</span>
            <span class="s1">tab_layout</span><span class="s2">.</span><span class="s1">size_hint </span><span class="s2">= (</span><span class="s4">None</span><span class="s2">, </span><span class="s6">1</span><span class="s2">)</span>
            <span class="s1">tab_layout</span><span class="s2">.</span><span class="s1">width </span><span class="s2">= </span><span class="s1">tab_height</span>
            <span class="s1">scrl_v</span><span class="s2">.</span><span class="s1">height </span><span class="s2">= </span><span class="s1">tab_height</span>
            <span class="s1">self_update_scrollview</span><span class="s2">(</span><span class="s1">scrl_v</span><span class="s2">)</span>

            <span class="s5"># rotate the scatter for vertical positions</span>
            <span class="s1">rotation </span><span class="s2">= </span><span class="s6">90 </span><span class="s4">if </span><span class="s1">tab_pos</span><span class="s2">[</span><span class="s6">0</span><span class="s2">] == </span><span class="s3">'l' </span><span class="s4">else </span><span class="s2">-</span><span class="s6">90</span>
            <span class="s1">sctr </span><span class="s2">= </span><span class="s1">Scatter</span><span class="s2">(</span><span class="s1">do_translation</span><span class="s2">=</span><span class="s4">False</span><span class="s2">,</span>
                           <span class="s1">rotation</span><span class="s2">=</span><span class="s1">rotation</span><span class="s2">,</span>
                           <span class="s1">do_rotation</span><span class="s2">=</span><span class="s4">False</span><span class="s2">,</span>
                           <span class="s1">do_scale</span><span class="s2">=</span><span class="s4">False</span><span class="s2">,</span>
                           <span class="s1">size_hint</span><span class="s2">=(</span><span class="s4">None</span><span class="s2">, </span><span class="s4">None</span><span class="s2">),</span>
                           <span class="s1">auto_bring_to_front</span><span class="s2">=</span><span class="s4">False</span><span class="s2">,</span>
                           <span class="s1">size</span><span class="s2">=</span><span class="s1">scrl_v</span><span class="s2">.</span><span class="s1">size</span><span class="s2">)</span>
            <span class="s1">sctr</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">scrl_v</span><span class="s2">)</span>

            <span class="s1">lentab_pos </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">tab_pos</span><span class="s2">)</span>

            <span class="s5"># Update scatter's top when its pos changes.</span>
            <span class="s5"># Needed for repositioning scatter to the correct place after its</span>
            <span class="s5"># added to the parent. Use clock_schedule_once to ensure top is</span>
            <span class="s5"># calculated after the parent's pos on canvas has been calculated.</span>
            <span class="s5"># This is needed for when tab_pos changes to correctly position</span>
            <span class="s5"># scatter. Without clock.schedule_once the positions would look</span>
            <span class="s5"># fine but touch won't translate to the correct position</span>

            <span class="s4">if </span><span class="s1">tab_pos</span><span class="s2">[</span><span class="s1">lentab_pos </span><span class="s2">- </span><span class="s6">4</span><span class="s2">:] == </span><span class="s3">'_top'</span><span class="s2">:</span>
                <span class="s5"># on positions 'left_top' and 'right_top'</span>
                <span class="s1">sctr</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">pos</span><span class="s2">=</span><span class="s1">partial</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_update_top</span><span class="s2">, </span><span class="s1">sctr</span><span class="s2">, </span><span class="s3">'top'</span><span class="s2">, </span><span class="s4">None</span><span class="s2">))</span>
                <span class="s1">tab_list </span><span class="s2">= (</span><span class="s1">sctr</span><span class="s2">, )</span>
            <span class="s4">elif </span><span class="s1">tab_pos</span><span class="s2">[</span><span class="s1">lentab_pos </span><span class="s2">- </span><span class="s6">4</span><span class="s2">:] == </span><span class="s3">'_mid'</span><span class="s2">:</span>
                <span class="s5"># calculate top of scatter</span>
                <span class="s1">sctr</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">pos</span><span class="s2">=</span><span class="s1">partial</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_update_top</span><span class="s2">, </span><span class="s1">sctr</span><span class="s2">, </span><span class="s3">'mid'</span><span class="s2">,</span>
                                      <span class="s1">scrl_v</span><span class="s2">.</span><span class="s1">width</span><span class="s2">))</span>
                <span class="s1">tab_list </span><span class="s2">= (</span><span class="s1">Widget</span><span class="s2">(), </span><span class="s1">sctr</span><span class="s2">, </span><span class="s1">Widget</span><span class="s2">())</span>
            <span class="s4">elif </span><span class="s1">tab_pos</span><span class="s2">[</span><span class="s1">lentab_pos </span><span class="s2">- </span><span class="s6">7</span><span class="s2">:] == </span><span class="s3">'_bottom'</span><span class="s2">:</span>
                <span class="s1">tab_list </span><span class="s2">= (</span><span class="s1">Widget</span><span class="s2">(), </span><span class="s1">Widget</span><span class="s2">(), </span><span class="s1">sctr</span><span class="s2">)</span>

            <span class="s4">if </span><span class="s1">pos_letter </span><span class="s2">== </span><span class="s3">'l'</span><span class="s2">:</span>
                <span class="s1">widget_list </span><span class="s2">= (</span><span class="s1">tab_layout</span><span class="s2">, </span><span class="s1">self_content</span><span class="s2">)</span>
            <span class="s4">else</span><span class="s2">:</span>
                <span class="s1">widget_list </span><span class="s2">= (</span><span class="s1">self_content</span><span class="s2">, </span><span class="s1">tab_layout</span><span class="s2">)</span>

        <span class="s5"># add widgets to tab_layout</span>
        <span class="s1">add </span><span class="s2">= </span><span class="s1">tab_layout</span><span class="s2">.</span><span class="s1">add_widget</span>
        <span class="s4">for </span><span class="s1">widg </span><span class="s4">in </span><span class="s1">tab_list</span><span class="s2">:</span>
            <span class="s1">add</span><span class="s2">(</span><span class="s1">widg</span><span class="s2">)</span>

        <span class="s5"># add widgets to self</span>
        <span class="s1">add </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">add_widget</span>
        <span class="s4">for </span><span class="s1">widg </span><span class="s4">in </span><span class="s1">widget_list</span><span class="s2">:</span>
            <span class="s1">add</span><span class="s2">(</span><span class="s1">widg</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">_update_tab_width</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">l</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">tab_width</span><span class="s2">:</span>
            <span class="s4">for </span><span class="s1">tab </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">tab_list</span><span class="s2">:</span>
                <span class="s1">tab</span><span class="s2">.</span><span class="s1">size_hint_x </span><span class="s2">= </span><span class="s6">1</span>
            <span class="s1">tsw </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">tab_width </span><span class="s2">* </span><span class="s1">len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_tab_strip</span><span class="s2">.</span><span class="s1">children</span><span class="s2">)</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s5"># tab_width = None</span>
            <span class="s1">tsw </span><span class="s2">= </span><span class="s6">0</span>
            <span class="s4">for </span><span class="s1">tab </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">tab_list</span><span class="s2">:</span>
                <span class="s4">if </span><span class="s1">tab</span><span class="s2">.</span><span class="s1">size_hint_x</span><span class="s2">:</span>
                    <span class="s5"># size_hint_x: x/.xyz</span>
                    <span class="s1">tab</span><span class="s2">.</span><span class="s1">size_hint_x </span><span class="s2">= </span><span class="s6">1</span>
                    <span class="s5"># drop to default tab_width</span>
                    <span class="s1">tsw </span><span class="s2">+= </span><span class="s6">100</span>
                <span class="s4">else</span><span class="s2">:</span>
                    <span class="s5"># size_hint_x: None</span>
                    <span class="s1">tsw </span><span class="s2">+= </span><span class="s1">tab</span><span class="s2">.</span><span class="s1">width</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_tab_strip</span><span class="s2">.</span><span class="s1">width </span><span class="s2">= </span><span class="s1">tsw</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_reposition_tabs</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">_update_top</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">):</span>
        <span class="s1">sctr</span><span class="s2">, </span><span class="s1">top</span><span class="s2">, </span><span class="s1">scrl_v_width</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">args</span>
        <span class="s1">ev </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_update_top_ev</span>
        <span class="s4">if </span><span class="s1">ev </span><span class="s4">is not None</span><span class="s2">:</span>
            <span class="s1">ev</span><span class="s2">.</span><span class="s1">cancel</span><span class="s2">()</span>

        <span class="s1">ev </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_update_top_ev </span><span class="s2">= </span><span class="s1">Clock</span><span class="s2">.</span><span class="s1">schedule_once</span><span class="s2">(</span>
            <span class="s1">partial</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_updt_top</span><span class="s2">, </span><span class="s1">sctr</span><span class="s2">, </span><span class="s1">top</span><span class="s2">, </span><span class="s1">scrl_v_width</span><span class="s2">), </span><span class="s6">0</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">_updt_top</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">sctr</span><span class="s2">, </span><span class="s1">top</span><span class="s2">, </span><span class="s1">scrl_v_width</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">top</span><span class="s2">[</span><span class="s6">0</span><span class="s2">] == </span><span class="s3">'t'</span><span class="s2">:</span>
            <span class="s1">sctr</span><span class="s2">.</span><span class="s1">top </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">top</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">sctr</span><span class="s2">.</span><span class="s1">top </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">top </span><span class="s2">- (</span><span class="s1">self</span><span class="s2">.</span><span class="s1">height </span><span class="s2">- </span><span class="s1">scrl_v_width</span><span class="s2">) / </span><span class="s6">2</span>

    <span class="s4">def </span><span class="s1">_update_scrollview</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">scrl_v</span><span class="s2">, *</span><span class="s1">l</span><span class="s2">):</span>
        <span class="s1">self_tab_pos </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">tab_pos</span>
        <span class="s1">self_tabs </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_tab_strip</span>
        <span class="s4">if </span><span class="s1">self_tab_pos</span><span class="s2">[</span><span class="s6">0</span><span class="s2">] == </span><span class="s3">'b' </span><span class="s4">or </span><span class="s1">self_tab_pos</span><span class="s2">[</span><span class="s6">0</span><span class="s2">] == </span><span class="s3">'t'</span><span class="s2">:</span>
            <span class="s5"># bottom or top</span>
            <span class="s1">scrl_v</span><span class="s2">.</span><span class="s1">width </span><span class="s2">= </span><span class="s1">min</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">width</span><span class="s2">, </span><span class="s1">self_tabs</span><span class="s2">.</span><span class="s1">width</span><span class="s2">)</span>
            <span class="s5"># required for situations when scrl_v's pos is calculated</span>
            <span class="s5"># when it has no parent</span>
            <span class="s1">scrl_v</span><span class="s2">.</span><span class="s1">top </span><span class="s2">+= </span><span class="s6">1</span>
            <span class="s1">scrl_v</span><span class="s2">.</span><span class="s1">top </span><span class="s2">-= </span><span class="s6">1</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s5"># left or right</span>
            <span class="s1">scrl_v</span><span class="s2">.</span><span class="s1">width </span><span class="s2">= </span><span class="s1">min</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">height</span><span class="s2">, </span><span class="s1">self_tabs</span><span class="s2">.</span><span class="s1">width</span><span class="s2">)</span>
            <span class="s1">self_tabs</span><span class="s2">.</span><span class="s1">pos </span><span class="s2">= (</span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">)</span>
</pre>
</body>
</html>