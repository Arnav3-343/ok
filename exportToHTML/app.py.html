<html>
<head>
<title>app.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #cf8e6d;}
.s5 { color: #7a7e85;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
app.py</font>
</center></td></tr></table>
<pre><span class="s0">''' 
Application 
=========== 
 
The :class:`App` class is the base for creating Kivy applications. 
Think of it as your main entry point into the Kivy run loop. In most 
cases, you subclass this class and make your own app. You create an 
instance of your specific app class and then, when you are ready to 
start the application's life cycle, you call your instance's 
:meth:`App.run` method. 
 
 
Creating an Application 
----------------------- 
 
Method using build() override 
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ 
 
To initialize your app with a widget tree, override the :meth:`~App.build` 
method in your app class and return the widget tree you constructed. 
 
Here's an example of a very simple application that just shows a button: 
 
.. include:: ../../examples/application/app_with_build.py 
   :literal: 
 
The file is also available in the examples folder at 
:file:`kivy/examples/application/app_with_build.py`. 
 
Here, no widget tree was constructed (or if you will, a tree with only 
the root node). 
 
 
Method using kv file 
~~~~~~~~~~~~~~~~~~~~ 
 
You can also use the :doc:`api-kivy.lang` for creating applications. The 
.kv can contain rules and root widget definitions at the same time. Here 
is the same example as the Button one in a kv file. 
 
Contents of 'test.kv': 
 
.. include:: ../../examples/application/test.kv 
   :literal: 
 
Contents of 'main.py': 
 
.. include:: ../../examples/application/app_with_kv.py 
   :literal: 
 
See :file:`kivy/examples/application/app_with_kv.py`. 
 
The relationship between main.py and test.kv is explained in 
:meth:`App.load_kv`. 
 
.. _Application configuration: 
 
Application configuration 
------------------------- 
 
Use the configuration file 
~~~~~~~~~~~~~~~~~~~~~~~~~~ 
 
Your application might need its own configuration file. The 
:class:`App` class handles 'ini' files automatically if you add 
the section key-value pair to the :meth:`App.build_config` method using the 
`config` parameter (an instance of :class:`~kivy.config.ConfigParser`):: 
 
    class TestApp(App): 
        def build_config(self, config): 
            config.setdefaults('section1', { 
                'key1': 'value1', 
                'key2': '42' 
            }) 
 
As soon as you add one section to the config, a file is created on the 
disk (see :attr:`~App.get_application_config` for its location) and 
named based your class name. &quot;TestApp&quot; will give a config file named 
&quot;test.ini&quot; with the content:: 
 
    [section1] 
    key1 = value1 
    key2 = 42 
 
The &quot;test.ini&quot; will be automatically loaded at runtime and you can access the 
configuration in your :meth:`App.build` method:: 
 
    class TestApp(App): 
        def build_config(self, config): 
            config.setdefaults('section1', { 
                'key1': 'value1', 
                'key2': '42' 
            }) 
 
        def build(self): 
            config = self.config 
            return Label(text='key1 is %s and key2 is %d' % ( 
                config.get('section1', 'key1'), 
                config.getint('section1', 'key2'))) 
 
Create a settings panel 
~~~~~~~~~~~~~~~~~~~~~~~ 
 
Your application can have a settings panel to let your user configure some of 
your config tokens. Here is an example done in the KinectViewer example 
(available in the examples directory): 
 
    .. image:: images/app-settings.jpg 
        :align: center 
 
You can add your own panels of settings by extending 
the :meth:`App.build_settings` method. 
Check the :class:`~kivy.uix.settings.Settings` about how to create a panel, 
because you need a JSON file / data first. 
 
Let's take as an example the previous snippet of TestApp with custom 
config. We could create a JSON like this:: 
 
    [ 
        { &quot;type&quot;: &quot;title&quot;, 
          &quot;title&quot;: &quot;Test application&quot; }, 
 
        { &quot;type&quot;: &quot;options&quot;, 
          &quot;title&quot;: &quot;My first key&quot;, 
          &quot;desc&quot;: &quot;Description of my first key&quot;, 
          &quot;section&quot;: &quot;section1&quot;, 
          &quot;key&quot;: &quot;key1&quot;, 
          &quot;options&quot;: [&quot;value1&quot;, &quot;value2&quot;, &quot;another value&quot;] }, 
 
        { &quot;type&quot;: &quot;numeric&quot;, 
          &quot;title&quot;: &quot;My second key&quot;, 
          &quot;desc&quot;: &quot;Description of my second key&quot;, 
          &quot;section&quot;: &quot;section1&quot;, 
          &quot;key&quot;: &quot;key2&quot; } 
    ] 
 
Then, we can create a panel using this JSON to automatically create all the 
options and link them to our :attr:`App.config` ConfigParser instance:: 
 
    class TestApp(App): 
        # ... 
        def build_settings(self, settings): 
            jsondata = &quot;&quot;&quot;... put the json data here ...&quot;&quot;&quot; 
            settings.add_json_panel('Test application', 
                self.config, data=jsondata) 
 
That's all! Now you can press F1 (default keystroke) to toggle the 
settings panel or press the &quot;settings&quot; key on your android device. You 
can manually call :meth:`App.open_settings` and 
:meth:`App.close_settings` if you want to handle this manually. Every 
change in the panel is automatically saved in the config file. 
 
You can also use :meth:`App.build_settings` to modify properties of 
the settings panel. For instance, the default panel has a sidebar for 
switching between json panels whose width defaults to 200dp. If you'd 
prefer this to be narrower, you could add:: 
 
    settings.interface.menu.width = dp(100) 
 
to your :meth:`build_settings` method. 
 
You might want to know when a config value has been changed by the 
user in order to adapt or reload your UI. You can then overload the 
:meth:`on_config_change` method:: 
 
    class TestApp(App): 
        # ... 
        def on_config_change(self, config, section, key, value): 
            if config is self.config: 
                token = (section, key) 
                if token == ('section1', 'key1'): 
                    print('Our key1 has been changed to', value) 
                elif token == ('section1', 'key2'): 
                    print('Our key2 has been changed to', value) 
 
The Kivy configuration panel is added by default to the settings 
instance. If you don't want this panel, you can declare your Application as 
follows:: 
 
    class TestApp(App): 
        use_kivy_settings = False 
        # ... 
 
This only removes the Kivy panel but does not stop the settings instance 
from appearing. If you want to prevent the settings instance from appearing 
altogether, you can do this:: 
 
    class TestApp(App): 
        def open_settings(self, *largs): 
            pass 
 
.. versionadded:: 1.0.7 
 
Profiling with on_start and on_stop 
----------------------------------- 
 
It is often useful to profile python code in order to discover locations to 
optimise. The standard library profilers 
(http://docs.python.org/2/library/profile.html) provides multiple options for 
profiling code. For profiling the entire program, the natural 
approaches of using profile as a module or profile's run method does not work 
with Kivy. It is however, possible to use :meth:`App.on_start` and 
:meth:`App.on_stop` methods:: 
 
    import cProfile 
 
    class MyApp(App): 
        def on_start(self): 
            self.profile = cProfile.Profile() 
            self.profile.enable() 
 
        def on_stop(self): 
            self.profile.disable() 
            self.profile.dump_stats('myapp.profile') 
 
This will create a file called `myapp.profile` when you exit your app. 
 
Customising layout 
------------------ 
 
You can choose different settings widget layouts by setting 
:attr:`App.settings_cls`. By default, this is a 
:class:`~kivy.uix.settings.Settings` class which provides the pictured 
sidebar layout, but you could set it to any of the other layouts 
provided in :mod:`kivy.uix.settings` or create your own. See the 
module documentation for :mod:`kivy.uix.settings` for more 
information. 
 
You can customise how the settings panel is displayed by 
overriding :meth:`App.display_settings` which is called before 
displaying the settings panel on the screen. By default, it 
simply draws the panel on top of the window, but you could modify it 
to (for instance) show the settings in a 
:class:`~kivy.uix.popup.Popup` or add it to your app's 
:class:`~kivy.uix.screenmanager.ScreenManager` if you are using 
one. If you do so, you should also modify :meth:`App.close_settings` 
to exit the panel appropriately. For instance, to have the settings 
panel appear in a popup you can do:: 
 
    def display_settings(self, settings): 
        try: 
            p = self.settings_popup 
        except AttributeError: 
            self.settings_popup = Popup(content=settings, 
                                        title='Settings', 
                                        size_hint=(0.8, 0.8)) 
            p = self.settings_popup 
        if p.content is not settings: 
            p.content = settings 
        p.open() 
 
    def close_settings(self, *args): 
        try: 
            p = self.settings_popup 
            p.dismiss() 
        except AttributeError: 
            pass # Settings popup doesn't exist 
 
Finally, if you want to replace the current settings panel widget, you 
can remove the internal references to it using 
:meth:`App.destroy_settings`. If you have modified 
:meth:`App.display_settings`, you should be careful to detect if the 
settings panel has been replaced. 
 
Pause mode 
---------- 
 
.. versionadded:: 1.1.0 
 
On tablets and phones, the user can switch at any moment to another 
application. By default, your application will close and the 
:meth:`App.on_stop` event will be fired. 
 
If you support Pause mode, when switching to another application, your 
application will wait indefinitely until the user 
switches back to your application. There is an issue with OpenGL on Android 
devices: it is not guaranteed that the OpenGL ES Context will be restored when 
your app resumes. The mechanism for restoring all the OpenGL data is not yet 
implemented in Kivy. 
 
The currently implemented Pause mechanism is: 
 
    #. Kivy checks every frame if Pause mode is activated by the Operating 
       System due to the user switching to another application, a phone 
       shutdown or any other reason. 
    #. :meth:`App.on_pause` is called: 
    #. If False is returned or :meth:`App.on_pause` has no return statement, 
       then :meth:`App.on_stop` is called. 
    #. If True is returned or :meth:`App.on_pause` is not defined, the 
       application will sleep until the OS resumes our App. 
    #. When the app is resumed, :meth:`App.on_resume` is called. 
    #. If our app memory has been reclaimed by the OS, then nothing will be 
       called. 
 
Here is a simple example of how on_pause() should be used:: 
 
   class TestApp(App): 
 
      def on_pause(self): 
         # Here you can save data if needed 
         return True 
 
      def on_resume(self): 
         # Here you can check if any data needs replacing (usually nothing) 
         pass 
 
.. warning:: 
 
    Both `on_pause` and `on_stop` must save important data because after 
    `on_pause` is called, `on_resume` may not be called at all. 
 
Asynchronous app 
---------------- 
 
In addition to running an app normally, 
Kivy can be run within an async event loop such as provided by the standard 
library asyncio package or the trio package (highly recommended). 
 
Background 
~~~~~~~~~~ 
 
Normally, when a Kivy app is run, it blocks the thread that runs it until the 
app exits. Internally, at each clock iteration it executes all the app 
callbacks, handles graphics and input, and idles by sleeping for any remaining 
time. 
 
To be able to run asynchronously, the Kivy app may not sleep, but instead must 
release control of the running context to the asynchronous event loop running 
the Kivy app. We do this when idling by calling the appropriate functions of 
the async package being used instead of sleeping. 
 
Async configuration 
~~~~~~~~~~~~~~~~~~~ 
 
To run a Kivy app asynchronously, either the :func:`async_runTouchApp` or 
:meth:`App.async_run` coroutine must be scheduled to run in the event loop of 
the async library being used. 
 
The environmental variable ``KIVY_EVENTLOOP`` or the ``async_lib`` parameter in 
:func:`async_runTouchApp` and :meth:`App.async_run` set the async 
library that Kivy uses internally when the app is run with 
:func:`async_runTouchApp` and :meth:`App.async_run`. It can be set to one of 
`&quot;asyncio&quot;` when the standard library `asyncio` is used, or `&quot;trio&quot;` if the 
trio library is used. If the environment variable is not set and ``async_lib`` 
is not provided, the stdlib ``asyncio`` is used. 
 
:meth:`~kivy.clock.ClockBaseBehavior.init_async_lib` can also be directly 
called to set the async library to use, but it may only be called before the 
app has begun running with :func:`async_runTouchApp` or :meth:`App.async_run`. 
 
To run the app asynchronously, one schedules :func:`async_runTouchApp` 
or :meth:`App.async_run` to run within the given library's async event loop as 
in the examples shown below. Kivy is then treated as just another coroutine 
that the given library runs in its event loop. Internally, Kivy will use the 
specified async library's API, so ``KIVY_EVENTLOOP`` or ``async_lib`` must 
match the async library that is running Kivy. 
 
 
For a fuller basic and more advanced examples, see the demo apps in 
``examples/async``. 
 
Asyncio example 
~~~~~~~~~~~~~-- 
 
.. code-block:: python 
 
    import asyncio 
 
    from kivy.app import async_runTouchApp 
    from kivy.uix.label import Label 
 
 
    loop = asyncio.get_event_loop() 
    loop.run_until_complete( 
        async_runTouchApp(Label(text='Hello, World!'), async_lib='asyncio')) 
    loop.close() 
 
Trio example 
~~~~~~~~~~-- 
 
.. code-block:: python 
 
    import trio 
 
    from kivy.app import async_runTouchApp 
    from kivy.uix.label import Label 
 
    from functools import partial 
 
    # use functools.partial() to pass keyword arguments: 
    async_runTouchApp_func = partial(async_runTouchApp, async_lib='trio') 
 
    trio.run(async_runTouchApp_func, Label(text='Hello, World!')) 
 
Interacting with Kivy app from other coroutines 
----------------------------------------------- 
 
It is fully safe to interact with any kivy object from other coroutines 
running within the same async event loop. This is because they are all running 
from the same thread and the other coroutines are only executed when Kivy 
is idling. 
 
Similarly, the kivy callbacks may safely interact with objects from other 
coroutines running in the same event loop. Normal single threaded rules apply 
to both case. 
 
.. versionadded:: 2.0.0 
 
'''</span>

<span class="s1">__all__ </span><span class="s2">= (</span><span class="s3">'App'</span><span class="s2">, </span><span class="s3">'runTouchApp'</span><span class="s2">, </span><span class="s3">'async_runTouchApp'</span><span class="s2">, </span><span class="s3">'stopTouchApp'</span><span class="s2">)</span>

<span class="s4">import </span><span class="s1">os</span>
<span class="s4">from </span><span class="s1">inspect </span><span class="s4">import </span><span class="s1">getfile</span>
<span class="s4">from </span><span class="s1">os</span><span class="s2">.</span><span class="s1">path </span><span class="s4">import </span><span class="s1">dirname</span><span class="s2">, </span><span class="s1">join</span><span class="s2">, </span><span class="s1">exists</span><span class="s2">, </span><span class="s1">sep</span><span class="s2">, </span><span class="s1">expanduser</span><span class="s2">, </span><span class="s1">isfile</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">config </span><span class="s4">import </span><span class="s1">ConfigParser</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">base </span><span class="s4">import </span><span class="s1">runTouchApp</span><span class="s2">, </span><span class="s1">async_runTouchApp</span><span class="s2">, </span><span class="s1">stopTouchApp</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">compat </span><span class="s4">import </span><span class="s1">string_types</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">factory </span><span class="s4">import </span><span class="s1">Factory</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">logger </span><span class="s4">import </span><span class="s1">Logger</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">event </span><span class="s4">import </span><span class="s1">EventDispatcher</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">lang </span><span class="s4">import </span><span class="s1">Builder</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">resources </span><span class="s4">import </span><span class="s1">resource_find</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">utils </span><span class="s4">import </span><span class="s1">platform</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">widget </span><span class="s4">import </span><span class="s1">Widget</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">properties </span><span class="s4">import </span><span class="s1">ObjectProperty</span><span class="s2">, </span><span class="s1">StringProperty</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">setupconfig </span><span class="s4">import </span><span class="s1">USE_SDL2</span>


<span class="s4">class </span><span class="s1">App</span><span class="s2">(</span><span class="s1">EventDispatcher</span><span class="s2">):</span>
    <span class="s0">''' Application class, see module documentation for more information. 
 
    :Events: 
        `on_start`: 
            Fired when the application is being started (before the 
            :func:`~kivy.base.runTouchApp` call. 
        `on_stop`: 
            Fired when the application stops. 
        `on_pause`: 
            Fired when the application is paused by the OS. 
        `on_resume`: 
            Fired when the application is resumed from pause by the OS. Beware: 
            you have no guarantee that this event will be fired after the 
            `on_pause` event has been called. 
 
    .. versionchanged:: 1.7.0 
        Parameter `kv_file` added. 
 
    .. versionchanged:: 1.8.0 
        Parameters `kv_file` and `kv_directory` are now properties of App. 
    '''</span>

    <span class="s1">title </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">)</span>
    <span class="s3">''' 
    Title of your application. You can set this as follows:: 
 
        class MyApp(App): 
            def build(self): 
                self.title = 'Hello world' 
 
    .. versionadded:: 1.0.5 
 
    .. versionchanged:: 1.8.0 
        `title` is now a :class:`~kivy.properties.StringProperty`. Don't 
        set the title in the class as previously stated in the documentation. 
 
    .. note:: 
 
        For Kivy &lt; 1.8.0, you can set this as follows:: 
 
            class MyApp(App): 
                title = 'Custom title' 
 
        If you want to dynamically change the title, you can do:: 
 
            from kivy.base import EventLoop 
            EventLoop.window.title = 'New title' 
 
    '''</span>

    <span class="s1">icon </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">)</span>
    <span class="s3">'''Icon of your application. 
    The icon can be located in the same directory as your main file. You can 
    set this as follows:: 
 
        class MyApp(App): 
            def build(self): 
                self.icon = 'myicon.png' 
 
    .. versionadded:: 1.0.5 
 
    .. versionchanged:: 1.8.0 
        `icon` is now a :class:`~kivy.properties.StringProperty`. Don't set the 
        icon in the class as previously stated in the documentation. 
 
    .. note:: 
 
        For Kivy prior to 1.8.0, you need to set this as follows:: 
 
            class MyApp(App): 
                icon = 'customicon.png' 
 
        Recommended 256x256 or 1024x1024? for GNU/Linux and Mac OSX 
        32x32 for Windows7 or less. &lt;= 256x256 for windows 8 
        256x256 does work (on Windows 8 at least), but is scaled 
        down and doesn't look as good as a 32x32 icon. 
    '''</span>

    <span class="s1">use_kivy_settings </span><span class="s2">= </span><span class="s4">True</span>
    <span class="s3">'''.. versionadded:: 1.0.7 
 
    If True, the application settings will also include the Kivy settings. If 
    you don't want the user to change any kivy settings from your settings UI, 
    change this to False. 
    '''</span>

    <span class="s1">settings_cls </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">)</span>
    <span class="s3">'''.. versionadded:: 1.8.0 
 
    The class used to construct the settings panel and 
    the instance passed to :meth:`build_config`. You should 
    use either :class:`~kivy.uix.settings.Settings` or one of the provided 
    subclasses with different layouts 
    (:class:`~kivy.uix.settings.SettingsWithSidebar`, 
    :class:`~kivy.uix.settings.SettingsWithSpinner`, 
    :class:`~kivy.uix.settings.SettingsWithTabbedPanel`, 
    :class:`~kivy.uix.settings.SettingsWithNoMenu`). You can also create your 
    own Settings subclass. See the documentation 
    of :mod:`~kivy.uix.settings.Settings` for more information. 
 
    :attr:`~App.settings_cls` is an :class:`~kivy.properties.ObjectProperty` 
    and defaults to :class:`~kivy.uix.settings.SettingsWithSpinner` which 
    displays settings panels with a spinner to switch between them. If you set 
    a string, the :class:`~kivy.factory.Factory` will be used to resolve the 
    class. 
 
    '''</span>

    <span class="s1">kv_directory </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">)</span>
    <span class="s3">'''Path of the directory where application kv is stored, defaults to None 
 
    .. versionadded:: 1.8.0 
 
    If a kv_directory is set, it will be used to get the initial kv file. By 
    default, the file is assumed to be in the same directory as the current App 
    definition file. 
    '''</span>

    <span class="s1">kv_file </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">)</span>
    <span class="s3">'''Filename of the Kv file to load, defaults to None. 
 
    .. versionadded:: 1.8.0 
 
    If a kv_file is set, it will be loaded when the application starts. The 
    loading of the &quot;default&quot; kv file will be prevented. 
    '''</span>

    <span class="s5"># Return the current running App instance</span>
    <span class="s1">_running_app </span><span class="s2">= </span><span class="s4">None</span>

    <span class="s1">__events__ </span><span class="s2">= (</span><span class="s3">'on_start'</span><span class="s2">, </span><span class="s3">'on_stop'</span><span class="s2">, </span><span class="s3">'on_pause'</span><span class="s2">, </span><span class="s3">'on_resume'</span><span class="s2">,</span>
                  <span class="s3">'on_config_change'</span><span class="s2">, )</span>

    <span class="s5"># Stored so that we only need to determine this once</span>
    <span class="s1">_user_data_dir </span><span class="s2">= </span><span class="s3">&quot;&quot;</span>

    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s1">App</span><span class="s2">.</span><span class="s1">_running_app </span><span class="s2">= </span><span class="s1">self</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_app_directory </span><span class="s2">= </span><span class="s4">None</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_app_name </span><span class="s2">= </span><span class="s4">None</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_app_settings </span><span class="s2">= </span><span class="s4">None</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_app_window </span><span class="s2">= </span><span class="s4">None</span>
        <span class="s1">super</span><span class="s2">(</span><span class="s1">App</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">__init__</span><span class="s2">(**</span><span class="s1">kwargs</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">built </span><span class="s2">= </span><span class="s4">False</span>

        <span class="s5">#: Options passed to the __init__ of the App</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">options </span><span class="s2">= </span><span class="s1">kwargs</span>

        <span class="s5">#: Returns an instance of the :class:`~kivy.config.ConfigParser` for</span>
        <span class="s5">#: the application configuration. You can use this to query some config</span>
        <span class="s5">#: tokens in the :meth:`build` method.</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">config </span><span class="s2">= </span><span class="s4">None</span>

        <span class="s5">#: The *root* widget returned by the :meth:`build` method or by the</span>
        <span class="s5">#: :meth:`load_kv` method if the kv file contains a root widget.</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">root </span><span class="s2">= </span><span class="s4">None</span>

    <span class="s4">def </span><span class="s1">build</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">'''Initializes the application; it will be called only once. 
        If this method returns a widget (tree), it will be used as the root 
        widget and added to the window. 
 
        :return: 
            None or a root :class:`~kivy.uix.widget.Widget` instance 
            if no self.root exists.'''</span>

        <span class="s4">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">root</span><span class="s2">:</span>
            <span class="s4">return </span><span class="s1">Widget</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">build_config</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">config</span><span class="s2">):</span>
        <span class="s0">'''.. versionadded:: 1.0.7 
 
        This method is called before the application is initialized to 
        construct your :class:`~kivy.config.ConfigParser` object. This 
        is where you can put any default section / key / value for your 
        config. If anything is set, the configuration will be 
        automatically saved in the file returned by 
        :meth:`get_application_config`. 
 
        :Parameters: 
            `config`: :class:`~kivy.config.ConfigParser` 
                Use this to add default section / key / value items 
 
        '''</span>

    <span class="s4">def </span><span class="s1">build_settings</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">settings</span><span class="s2">):</span>
        <span class="s0">'''.. versionadded:: 1.0.7 
 
        This method is called when the user (or you) want to show the 
        application settings. It is called once when the settings panel 
        is first opened, after which the panel is cached. It may be 
        called again if the cached settings panel is removed by 
        :meth:`destroy_settings`. 
 
        You can use this method to add settings panels and to 
        customise the settings widget e.g. by changing the sidebar 
        width. See the module documentation for full details. 
 
        :Parameters: 
            `settings`: :class:`~kivy.uix.settings.Settings` 
                Settings instance for adding panels 
 
        '''</span>

    <span class="s4">def </span><span class="s1">load_kv</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">filename</span><span class="s2">=</span><span class="s4">None</span><span class="s2">):</span>
        <span class="s0">'''This method is invoked the first time the app is being run if no 
        widget tree has been constructed before for this app. 
        This method then looks for a matching kv file in the same directory as 
        the file that contains the application class. 
 
        For example, say you have a file named main.py that contains:: 
 
            class ShowcaseApp(App): 
                pass 
 
        This method will search for a file named `showcase.kv` in 
        the directory that contains main.py. The name of the kv file has to be 
        the lowercase name of the class, without the 'App' postfix at the end 
        if it exists. 
 
        You can define rules and a root widget in your kv file:: 
 
            &lt;ClassName&gt;: # this is a rule 
                ... 
 
            ClassName: # this is a root widget 
                ... 
 
        There must be only one root widget. See the :doc:`api-kivy.lang` 
        documentation for more information on how to create kv files. If your 
        kv file contains a root widget, it will be used as self.root, the root 
        widget for the application. 
 
        .. note:: 
 
            This function is called from :meth:`run`, therefore, any widget 
            whose styling is defined in this kv file and is created before 
            :meth:`run` is called (e.g. in `__init__`), won't have its styling 
            applied. Note that :meth:`build` is called after :attr:`load_kv` 
            has been called. 
        '''</span>
        <span class="s5"># Detect filename automatically if it was not specified.</span>
        <span class="s4">if </span><span class="s1">filename</span><span class="s2">:</span>
            <span class="s1">filename </span><span class="s2">= </span><span class="s1">resource_find</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">)</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s4">try</span><span class="s2">:</span>
                <span class="s1">default_kv_directory </span><span class="s2">= </span><span class="s1">dirname</span><span class="s2">(</span><span class="s1">getfile</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__class__</span><span class="s2">))</span>
                <span class="s4">if </span><span class="s1">default_kv_directory </span><span class="s2">== </span><span class="s3">''</span><span class="s2">:</span>
                    <span class="s1">default_kv_directory </span><span class="s2">= </span><span class="s3">'.'</span>
            <span class="s4">except </span><span class="s1">TypeError</span><span class="s2">:</span>
                <span class="s5"># if it's a builtin module.. use the current dir.</span>
                <span class="s1">default_kv_directory </span><span class="s2">= </span><span class="s3">'.'</span>

            <span class="s1">kv_directory </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">kv_directory </span><span class="s4">or </span><span class="s1">default_kv_directory</span>
            <span class="s1">clsname </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__class__</span><span class="s2">.</span><span class="s1">__name__</span><span class="s2">.</span><span class="s1">lower</span><span class="s2">()</span>
            <span class="s4">if </span><span class="s2">(</span><span class="s1">clsname</span><span class="s2">.</span><span class="s1">endswith</span><span class="s2">(</span><span class="s3">'app'</span><span class="s2">) </span><span class="s4">and</span>
                    <span class="s4">not </span><span class="s1">isfile</span><span class="s2">(</span><span class="s1">join</span><span class="s2">(</span><span class="s1">kv_directory</span><span class="s2">, </span><span class="s3">'%s.kv' </span><span class="s2">% </span><span class="s1">clsname</span><span class="s2">))):</span>
                <span class="s1">clsname </span><span class="s2">= </span><span class="s1">clsname</span><span class="s2">[:-</span><span class="s6">3</span><span class="s2">]</span>
            <span class="s1">filename </span><span class="s2">= </span><span class="s1">join</span><span class="s2">(</span><span class="s1">kv_directory</span><span class="s2">, </span><span class="s3">'%s.kv' </span><span class="s2">% </span><span class="s1">clsname</span><span class="s2">)</span>

        <span class="s5"># Load KV file</span>
        <span class="s1">Logger</span><span class="s2">.</span><span class="s1">debug</span><span class="s2">(</span><span class="s3">'App: Loading kv &lt;{0}&gt;'</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">))</span>
        <span class="s1">rfilename </span><span class="s2">= </span><span class="s1">resource_find</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">rfilename </span><span class="s4">is None or not </span><span class="s1">exists</span><span class="s2">(</span><span class="s1">rfilename</span><span class="s2">):</span>
            <span class="s1">Logger</span><span class="s2">.</span><span class="s1">debug</span><span class="s2">(</span><span class="s3">'App: kv &lt;%s&gt; not found' </span><span class="s2">% </span><span class="s1">filename</span><span class="s2">)</span>
            <span class="s4">return False</span>
        <span class="s1">root </span><span class="s2">= </span><span class="s1">Builder</span><span class="s2">.</span><span class="s1">load_file</span><span class="s2">(</span><span class="s1">rfilename</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">root</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">root </span><span class="s2">= </span><span class="s1">root</span>
        <span class="s4">return True</span>

    <span class="s4">def </span><span class="s1">get_application_name</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">'''Return the name of the application. 
        '''</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">title </span><span class="s4">is not None</span><span class="s2">:</span>
            <span class="s4">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">title</span>
        <span class="s1">clsname </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__class__</span><span class="s2">.</span><span class="s1">__name__</span>
        <span class="s4">if </span><span class="s1">clsname</span><span class="s2">.</span><span class="s1">endswith</span><span class="s2">(</span><span class="s3">'App'</span><span class="s2">):</span>
            <span class="s1">clsname </span><span class="s2">= </span><span class="s1">clsname</span><span class="s2">[:-</span><span class="s6">3</span><span class="s2">]</span>
        <span class="s4">return </span><span class="s1">clsname</span>

    <span class="s4">def </span><span class="s1">get_application_icon</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">'''Return the icon of the application. 
        '''</span>
        <span class="s4">if not </span><span class="s1">resource_find</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">icon</span><span class="s2">):</span>
            <span class="s4">return </span><span class="s3">''</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s4">return </span><span class="s1">resource_find</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">icon</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">get_application_config</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">defaultpath</span><span class="s2">=</span><span class="s3">'%(appdir)s/%(appname)s.ini'</span><span class="s2">):</span>
        <span class="s0">''' 
        Return the filename of your application configuration. Depending 
        on the platform, the application file will be stored in 
        different locations: 
 
            - on iOS: &lt;appdir&gt;/Documents/.&lt;appname&gt;.ini 
            - on Android: &lt;user_data_dir&gt;/.&lt;appname&gt;.ini 
            - otherwise: &lt;appdir&gt;/&lt;appname&gt;.ini 
 
        When you are distributing your application on Desktops, please 
        note that if the application is meant to be installed 
        system-wide, the user might not have write-access to the 
        application directory. If you want to store user settings, you 
        should overload this method and change the default behavior to 
        save the configuration file in the user directory. :: 
 
            class TestApp(App): 
                def get_application_config(self): 
                    return super(TestApp, self).get_application_config( 
                        '~/.%(appname)s.ini') 
 
        Some notes: 
 
        - The tilda '~' will be expanded to the user directory. 
        - %(appdir)s will be replaced with the application :attr:`directory` 
        - %(appname)s will be replaced with the application :attr:`name` 
 
        .. versionadded:: 1.0.7 
 
        .. versionchanged:: 1.4.0 
            Customized the defaultpath for iOS and Android platforms. Added a 
            defaultpath parameter for desktop OS's (not applicable to iOS 
            and Android.) 
 
        .. versionchanged:: 1.11.0 
            Changed the Android version to make use of the 
            :attr:`~App.user_data_dir` and added a missing dot to the iOS 
            config file name. 
        '''</span>

        <span class="s4">if </span><span class="s1">platform </span><span class="s2">== </span><span class="s3">'android'</span><span class="s2">:</span>
            <span class="s4">return </span><span class="s1">join</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">user_data_dir</span><span class="s2">, </span><span class="s3">'.{0}.ini'</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">name</span><span class="s2">))</span>
        <span class="s4">elif </span><span class="s1">platform </span><span class="s2">== </span><span class="s3">'ios'</span><span class="s2">:</span>
            <span class="s1">defaultpath </span><span class="s2">= </span><span class="s3">'~/Documents/.%(appname)s.ini'</span>
        <span class="s4">elif </span><span class="s1">platform </span><span class="s2">== </span><span class="s3">'win'</span><span class="s2">:</span>
            <span class="s1">defaultpath </span><span class="s2">= </span><span class="s1">defaultpath</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s3">'/'</span><span class="s2">, </span><span class="s1">sep</span><span class="s2">)</span>
        <span class="s4">return </span><span class="s1">expanduser</span><span class="s2">(</span><span class="s1">defaultpath</span><span class="s2">) % {</span>
            <span class="s3">'appname'</span><span class="s2">: </span><span class="s1">self</span><span class="s2">.</span><span class="s1">name</span><span class="s2">, </span><span class="s3">'appdir'</span><span class="s2">: </span><span class="s1">self</span><span class="s2">.</span><span class="s1">directory</span><span class="s2">}</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s4">def </span><span class="s1">root_window</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">'''.. versionadded:: 1.9.0 
 
        Returns the root window instance used by :meth:`run`. 
        '''</span>
        <span class="s4">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_app_window</span>

    <span class="s4">def </span><span class="s1">load_config</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">'''(internal) This function is used for returning a ConfigParser with 
        the application configuration. It's doing 3 things: 
 
            #. Creating an instance of a ConfigParser 
            #. Loading the default configuration by calling 
               :meth:`build_config`, then 
            #. If it exists, it loads the application configuration file, 
               otherwise it creates one. 
 
        :return: 
            :class:`~kivy.config.ConfigParser` instance 
        '''</span>
        <span class="s4">try</span><span class="s2">:</span>
            <span class="s1">config </span><span class="s2">= </span><span class="s1">ConfigParser</span><span class="s2">.</span><span class="s1">get_configparser</span><span class="s2">(</span><span class="s3">'app'</span><span class="s2">)</span>
        <span class="s4">except </span><span class="s1">KeyError</span><span class="s2">:</span>
            <span class="s1">config </span><span class="s2">= </span><span class="s4">None</span>
        <span class="s4">if </span><span class="s1">config </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s1">config </span><span class="s2">= </span><span class="s1">ConfigParser</span><span class="s2">(</span><span class="s1">name</span><span class="s2">=</span><span class="s3">'app'</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">config </span><span class="s2">= </span><span class="s1">config</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">build_config</span><span class="s2">(</span><span class="s1">config</span><span class="s2">)</span>
        <span class="s5"># if no sections are created, that's mean the user don't have</span>
        <span class="s5"># configuration.</span>
        <span class="s4">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">config</span><span class="s2">.</span><span class="s1">sections</span><span class="s2">()) == </span><span class="s6">0</span><span class="s2">:</span>
            <span class="s4">return</span>
        <span class="s5"># ok, the user have some sections, read the default file if exist</span>
        <span class="s5"># or write it !</span>
        <span class="s1">filename </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">get_application_config</span><span class="s2">()</span>
        <span class="s4">if </span><span class="s1">filename </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s4">return </span><span class="s1">config</span>
        <span class="s1">Logger</span><span class="s2">.</span><span class="s1">debug</span><span class="s2">(</span><span class="s3">'App: Loading configuration &lt;{0}&gt;'</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">))</span>
        <span class="s4">if </span><span class="s1">exists</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">):</span>
            <span class="s4">try</span><span class="s2">:</span>
                <span class="s1">config</span><span class="s2">.</span><span class="s1">read</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">)</span>
            <span class="s4">except</span><span class="s2">:</span>
                <span class="s1">Logger</span><span class="s2">.</span><span class="s1">error</span><span class="s2">(</span><span class="s3">'App: Corrupted config file, ignored.'</span><span class="s2">)</span>
                <span class="s1">config</span><span class="s2">.</span><span class="s1">name </span><span class="s2">= </span><span class="s3">''</span>
                <span class="s4">try</span><span class="s2">:</span>
                    <span class="s1">config </span><span class="s2">= </span><span class="s1">ConfigParser</span><span class="s2">.</span><span class="s1">get_configparser</span><span class="s2">(</span><span class="s3">'app'</span><span class="s2">)</span>
                <span class="s4">except </span><span class="s1">KeyError</span><span class="s2">:</span>
                    <span class="s1">config </span><span class="s2">= </span><span class="s4">None</span>
                <span class="s4">if </span><span class="s1">config </span><span class="s4">is None</span><span class="s2">:</span>
                    <span class="s1">config </span><span class="s2">= </span><span class="s1">ConfigParser</span><span class="s2">(</span><span class="s1">name</span><span class="s2">=</span><span class="s3">'app'</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">config </span><span class="s2">= </span><span class="s1">config</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">build_config</span><span class="s2">(</span><span class="s1">config</span><span class="s2">)</span>
                <span class="s4">pass</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">Logger</span><span class="s2">.</span><span class="s1">debug</span><span class="s2">(</span><span class="s3">'App: First configuration, create &lt;{0}&gt;'</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span>
                <span class="s1">filename</span><span class="s2">))</span>
            <span class="s1">config</span><span class="s2">.</span><span class="s1">filename </span><span class="s2">= </span><span class="s1">filename</span>
            <span class="s1">config</span><span class="s2">.</span><span class="s1">write</span><span class="s2">()</span>
        <span class="s4">return </span><span class="s1">config</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s4">def </span><span class="s1">directory</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">'''.. versionadded:: 1.0.7 
 
        Return the directory where the application lives. 
        '''</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_app_directory </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s4">try</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">_app_directory </span><span class="s2">= </span><span class="s1">dirname</span><span class="s2">(</span><span class="s1">getfile</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__class__</span><span class="s2">))</span>
                <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_app_directory </span><span class="s2">== </span><span class="s3">''</span><span class="s2">:</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">_app_directory </span><span class="s2">= </span><span class="s3">'.'</span>
            <span class="s4">except </span><span class="s1">TypeError</span><span class="s2">:</span>
                <span class="s5"># if it's a builtin module.. use the current dir.</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">_app_directory </span><span class="s2">= </span><span class="s3">'.'</span>
        <span class="s4">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_app_directory</span>

    <span class="s4">def </span><span class="s1">_get_user_data_dir</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Determine and return the user_data_dir.</span>
        <span class="s1">data_dir </span><span class="s2">= </span><span class="s3">&quot;&quot;</span>
        <span class="s4">if </span><span class="s1">platform </span><span class="s2">== </span><span class="s3">'ios'</span><span class="s2">:</span>
            <span class="s1">data_dir </span><span class="s2">= </span><span class="s1">expanduser</span><span class="s2">(</span><span class="s1">join</span><span class="s2">(</span><span class="s3">'~/Documents'</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">name</span><span class="s2">))</span>
        <span class="s4">elif </span><span class="s1">platform </span><span class="s2">== </span><span class="s3">'android'</span><span class="s2">:</span>
            <span class="s4">from </span><span class="s1">jnius </span><span class="s4">import </span><span class="s1">autoclass</span><span class="s2">, </span><span class="s1">cast</span>
            <span class="s1">PythonActivity </span><span class="s2">= </span><span class="s1">autoclass</span><span class="s2">(</span><span class="s3">'org.kivy.android.PythonActivity'</span><span class="s2">)</span>
            <span class="s1">context </span><span class="s2">= </span><span class="s1">cast</span><span class="s2">(</span><span class="s3">'android.content.Context'</span><span class="s2">, </span><span class="s1">PythonActivity</span><span class="s2">.</span><span class="s1">mActivity</span><span class="s2">)</span>
            <span class="s1">file_p </span><span class="s2">= </span><span class="s1">cast</span><span class="s2">(</span><span class="s3">'java.io.File'</span><span class="s2">, </span><span class="s1">context</span><span class="s2">.</span><span class="s1">getFilesDir</span><span class="s2">())</span>
            <span class="s1">data_dir </span><span class="s2">= </span><span class="s1">file_p</span><span class="s2">.</span><span class="s1">getAbsolutePath</span><span class="s2">()</span>
        <span class="s4">elif </span><span class="s1">platform </span><span class="s2">== </span><span class="s3">'win'</span><span class="s2">:</span>
            <span class="s1">data_dir </span><span class="s2">= </span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">os</span><span class="s2">.</span><span class="s1">environ</span><span class="s2">[</span><span class="s3">'APPDATA'</span><span class="s2">], </span><span class="s1">self</span><span class="s2">.</span><span class="s1">name</span><span class="s2">)</span>
        <span class="s4">elif </span><span class="s1">platform </span><span class="s2">== </span><span class="s3">'macosx'</span><span class="s2">:</span>
            <span class="s1">data_dir </span><span class="s2">= </span><span class="s3">'~/Library/Application Support/{}'</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">name</span><span class="s2">)</span>
            <span class="s1">data_dir </span><span class="s2">= </span><span class="s1">expanduser</span><span class="s2">(</span><span class="s1">data_dir</span><span class="s2">)</span>
        <span class="s4">else</span><span class="s2">:  </span><span class="s5"># _platform == 'linux' or anything else...:</span>
            <span class="s1">data_dir </span><span class="s2">= </span><span class="s1">os</span><span class="s2">.</span><span class="s1">environ</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s3">'XDG_CONFIG_HOME'</span><span class="s2">, </span><span class="s3">'~/.config'</span><span class="s2">)</span>
            <span class="s1">data_dir </span><span class="s2">= </span><span class="s1">expanduser</span><span class="s2">(</span><span class="s1">join</span><span class="s2">(</span><span class="s1">data_dir</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">name</span><span class="s2">))</span>
        <span class="s4">if not </span><span class="s1">exists</span><span class="s2">(</span><span class="s1">data_dir</span><span class="s2">):</span>
            <span class="s1">os</span><span class="s2">.</span><span class="s1">mkdir</span><span class="s2">(</span><span class="s1">data_dir</span><span class="s2">)</span>
        <span class="s4">return </span><span class="s1">data_dir</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s4">def </span><span class="s1">user_data_dir</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">''' 
        .. versionadded:: 1.7.0 
 
        Returns the path to the directory in the users file system which the 
        application can use to store additional data. 
 
        Different platforms have different conventions with regards to where 
        the user can store data such as preferences, saved games and settings. 
        This function implements these conventions. The &lt;app_name&gt; directory 
        is created when the property is called, unless it already exists. 
 
        On iOS, `~/Documents/&lt;app_name&gt;` is returned (which is inside the 
        app's sandbox). 
 
        On Windows, `%APPDATA%/&lt;app_name&gt;` is returned. 
 
        On OS X, `~/Library/Application Support/&lt;app_name&gt;` is returned. 
 
        On Linux, `$XDG_CONFIG_HOME/&lt;app_name&gt;` is returned. 
 
        On Android, `Context.GetFilesDir 
        &lt;https://developer.android.com/reference/android/content/\ 
Context.html#getFilesDir()&gt;`_ is returned. 
 
        .. versionchanged:: 1.11.0 
 
            On Android, this function previously returned 
            `/sdcard/&lt;app_name&gt;`. This folder became read-only by default 
            in Android API 26 and the user_data_dir has therefore been moved 
            to a writeable location. 
 
        '''</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_user_data_dir </span><span class="s2">== </span><span class="s3">&quot;&quot;</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_user_data_dir </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_get_user_data_dir</span><span class="s2">()</span>
        <span class="s4">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_user_data_dir</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s4">def </span><span class="s1">name</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">'''.. versionadded:: 1.0.7 
 
        Return the name of the application based on the class name. 
        '''</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_app_name </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s1">clsname </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__class__</span><span class="s2">.</span><span class="s1">__name__</span>
            <span class="s4">if </span><span class="s1">clsname</span><span class="s2">.</span><span class="s1">endswith</span><span class="s2">(</span><span class="s3">'App'</span><span class="s2">):</span>
                <span class="s1">clsname </span><span class="s2">= </span><span class="s1">clsname</span><span class="s2">[:-</span><span class="s6">3</span><span class="s2">]</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_app_name </span><span class="s2">= </span><span class="s1">clsname</span><span class="s2">.</span><span class="s1">lower</span><span class="s2">()</span>
        <span class="s4">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_app_name</span>

    <span class="s4">def </span><span class="s1">_run_prepare</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">built</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">load_config</span><span class="s2">()</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">load_kv</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">kv_file</span><span class="s2">)</span>
            <span class="s1">root </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">build</span><span class="s2">()</span>
            <span class="s4">if </span><span class="s1">root</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">root </span><span class="s2">= </span><span class="s1">root</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">root</span><span class="s2">:</span>
            <span class="s4">if not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">root</span><span class="s2">, </span><span class="s1">Widget</span><span class="s2">):</span>
                <span class="s1">Logger</span><span class="s2">.</span><span class="s1">critical</span><span class="s2">(</span><span class="s3">'App.root must be an _instance_ of Widget'</span><span class="s2">)</span>
                <span class="s4">raise </span><span class="s1">Exception</span><span class="s2">(</span><span class="s3">'Invalid instance in App.root'</span><span class="s2">)</span>
            <span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">core</span><span class="s2">.</span><span class="s1">window </span><span class="s4">import </span><span class="s1">Window</span>
            <span class="s1">Window</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">root</span><span class="s2">)</span>

        <span class="s5"># Check if the window is already created</span>
        <span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">base </span><span class="s4">import </span><span class="s1">EventLoop</span>
        <span class="s1">window </span><span class="s2">= </span><span class="s1">EventLoop</span><span class="s2">.</span><span class="s1">window</span>
        <span class="s4">if </span><span class="s1">window</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_app_window </span><span class="s2">= </span><span class="s1">window</span>
            <span class="s1">window</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">get_application_name</span><span class="s2">())</span>
            <span class="s1">icon </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">get_application_icon</span><span class="s2">()</span>
            <span class="s4">if </span><span class="s1">icon</span><span class="s2">:</span>
                <span class="s1">window</span><span class="s2">.</span><span class="s1">set_icon</span><span class="s2">(</span><span class="s1">icon</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_install_settings_keys</span><span class="s2">(</span><span class="s1">window</span><span class="s2">)</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">Logger</span><span class="s2">.</span><span class="s1">critical</span><span class="s2">(</span><span class="s3">&quot;Application: No window is created.&quot;</span>
                            <span class="s3">&quot; Terminating application run.&quot;</span><span class="s2">)</span>
            <span class="s4">return</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">dispatch</span><span class="s2">(</span><span class="s3">'on_start'</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">run</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">'''Launches the app in standalone mode. 
        '''</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_run_prepare</span><span class="s2">()</span>
        <span class="s1">runTouchApp</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_stop</span><span class="s2">()</span>

    <span class="s4">async def </span><span class="s1">async_run</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">async_lib</span><span class="s2">=</span><span class="s4">None</span><span class="s2">):</span>
        <span class="s0">'''Identical to :meth:`run`, but is a coroutine and can be 
        scheduled in a running async event loop. 
 
        See :mod:`kivy.app` for example usage. 
 
        .. versionadded:: 2.0.0 
        '''</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_run_prepare</span><span class="s2">()</span>
        <span class="s4">await </span><span class="s1">async_runTouchApp</span><span class="s2">(</span><span class="s1">async_lib</span><span class="s2">=</span><span class="s1">async_lib</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_stop</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">stop</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">largs</span><span class="s2">):</span>
        <span class="s0">'''Stop the application. 
 
        If you use this method, the whole application will stop by issuing 
        a call to :func:`~kivy.base.stopTouchApp`. 
        Except on Android, set Android state to stop, Kivy state then follows. 
        '''</span>
        <span class="s4">if </span><span class="s1">platform </span><span class="s2">== </span><span class="s3">'android'</span><span class="s2">:</span>
            <span class="s4">from </span><span class="s1">android </span><span class="s4">import </span><span class="s1">mActivity</span>
            <span class="s1">mActivity</span><span class="s2">.</span><span class="s1">finishAndRemoveTask</span><span class="s2">()</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_stop</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">_stop</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">largs</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dispatch</span><span class="s2">(</span><span class="s3">'on_stop'</span><span class="s2">)</span>
        <span class="s1">stopTouchApp</span><span class="s2">()</span>

        <span class="s5"># Clear the window children</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_app_window</span><span class="s2">:</span>
            <span class="s4">for </span><span class="s1">child </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_app_window</span><span class="s2">.</span><span class="s1">children</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">_app_window</span><span class="s2">.</span><span class="s1">remove_widget</span><span class="s2">(</span><span class="s1">child</span><span class="s2">)</span>
        <span class="s1">App</span><span class="s2">.</span><span class="s1">_running_app </span><span class="s2">= </span><span class="s4">None</span>

    <span class="s4">def </span><span class="s1">pause</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">largs</span><span class="s2">):</span>
        <span class="s0">'''Pause the application. 
 
        On Android set OS state to pause, Kivy app state follows. 
        No functionality on other OS. 
        .. versionadded:: 2.2.0 
        '''</span>
        <span class="s4">if </span><span class="s1">platform </span><span class="s2">== </span><span class="s3">'android'</span><span class="s2">:</span>
            <span class="s4">from </span><span class="s1">android </span><span class="s4">import </span><span class="s1">mActivity</span>
            <span class="s1">mActivity</span><span class="s2">.</span><span class="s1">moveTaskToBack</span><span class="s2">(</span><span class="s4">True</span><span class="s2">)</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">Logger</span><span class="s2">.</span><span class="s1">info</span><span class="s2">(</span><span class="s3">'App.pause() is not available on this OS.'</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">on_start</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">'''Event handler for the `on_start` event which is fired after 
        initialization (after build() has been called) but before the 
        application has started running. 
        '''</span>
        <span class="s4">pass</span>

    <span class="s4">def </span><span class="s1">on_stop</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">'''Event handler for the `on_stop` event which is fired when the 
        application has finished running (i.e. the window is about to be 
        closed). 
        '''</span>
        <span class="s4">pass</span>

    <span class="s4">def </span><span class="s1">on_pause</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">'''Event handler called when Pause mode is requested. You should 
        return True if your app can go into Pause mode, otherwise 
        return False and your application will be stopped. 
 
        You cannot control when the application is going to go into this mode. 
        It's determined by the Operating System and mostly used for mobile 
        devices (android/ios) and for resizing. 
 
        The default return value is True. 
 
        .. versionadded:: 1.1.0 
        .. versionchanged:: 1.10.0 
            The default return value is now True. 
        '''</span>
        <span class="s4">return True</span>

    <span class="s4">def </span><span class="s1">on_resume</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">'''Event handler called when your application is resuming from 
        the Pause mode. 
 
        .. versionadded:: 1.1.0 
 
        .. warning:: 
 
            When resuming, the OpenGL Context might have been damaged / freed. 
            This is where you can reconstruct some of your OpenGL state 
            e.g. FBO content. 
        '''</span>
        <span class="s4">pass</span>

    <span class="s2">@</span><span class="s1">staticmethod</span>
    <span class="s4">def </span><span class="s1">get_running_app</span><span class="s2">():</span>
        <span class="s0">'''Return the currently running application instance. 
 
        .. versionadded:: 1.1.0 
        '''</span>
        <span class="s4">return </span><span class="s1">App</span><span class="s2">.</span><span class="s1">_running_app</span>

    <span class="s4">def </span><span class="s1">on_config_change</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">config</span><span class="s2">, </span><span class="s1">section</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s0">'''Event handler fired when a configuration token has been changed by 
        the settings page. 
 
        .. versionchanged:: 1.10.1 
           Added corresponding ``on_config_change`` event. 
        '''</span>
        <span class="s4">pass</span>

    <span class="s4">def </span><span class="s1">open_settings</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">largs</span><span class="s2">):</span>
        <span class="s0">'''Open the application settings panel. It will be created the very 
        first time, or recreated if the previously cached panel has been 
        removed by :meth:`destroy_settings`. The settings panel will be 
        displayed with the 
        :meth:`display_settings` method, which by default adds the 
        settings panel to the Window attached to your application. You 
        should override that method if you want to display the 
        settings panel differently. 
 
        :return: 
            True if the settings has been opened. 
 
        '''</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_app_settings </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_app_settings </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">create_settings</span><span class="s2">()</span>
        <span class="s1">displayed </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">display_settings</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_app_settings</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">displayed</span><span class="s2">:</span>
            <span class="s4">return True</span>
        <span class="s4">return False</span>

    <span class="s4">def </span><span class="s1">display_settings</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">settings</span><span class="s2">):</span>
        <span class="s0">'''.. versionadded:: 1.8.0 
 
        Display the settings panel. By default, the panel is drawn directly 
        on top of the window. You can define other behavior by overriding 
        this method, such as adding it to a ScreenManager or Popup. 
 
        You should return True if the display is successful, otherwise False. 
 
        :Parameters: 
            `settings`: :class:`~kivy.uix.settings.Settings` 
                You can modify this object in order to modify the settings 
                display. 
 
        '''</span>
        <span class="s1">win </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_app_window</span>
        <span class="s4">if not </span><span class="s1">win</span><span class="s2">:</span>
            <span class="s4">raise </span><span class="s1">Exception</span><span class="s2">(</span><span class="s3">'No windows are set on the application, you cannot'</span>
                            <span class="s3">' open settings yet.'</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">settings </span><span class="s4">not in </span><span class="s1">win</span><span class="s2">.</span><span class="s1">children</span><span class="s2">:</span>
            <span class="s1">win</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">settings</span><span class="s2">)</span>
            <span class="s4">return True</span>
        <span class="s4">return False</span>

    <span class="s4">def </span><span class="s1">close_settings</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">largs</span><span class="s2">):</span>
        <span class="s0">'''Close the previously opened settings panel. 
 
        :return: 
            True if the settings has been closed. 
        '''</span>
        <span class="s1">win </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_app_window</span>
        <span class="s1">settings </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_app_settings</span>
        <span class="s4">if </span><span class="s1">win </span><span class="s4">is None or </span><span class="s1">settings </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s4">return</span>
        <span class="s4">if </span><span class="s1">settings </span><span class="s4">in </span><span class="s1">win</span><span class="s2">.</span><span class="s1">children</span><span class="s2">:</span>
            <span class="s1">win</span><span class="s2">.</span><span class="s1">remove_widget</span><span class="s2">(</span><span class="s1">settings</span><span class="s2">)</span>
            <span class="s4">return True</span>
        <span class="s4">return False</span>

    <span class="s4">def </span><span class="s1">create_settings</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">'''Create the settings panel. This method will normally 
        be called only one time per 
        application life-time and the result is cached internally, 
        but it may be called again if the cached panel is removed 
        by :meth:`destroy_settings`. 
 
        By default, it will build a settings panel according to 
        :attr:`settings_cls`, call :meth:`build_settings`, add a Kivy panel if 
        :attr:`use_kivy_settings` is True, and bind to 
        on_close/on_config_change. 
 
        If you want to plug your own way of doing settings, without the Kivy 
        panel or close/config change events, this is the method you want to 
        overload. 
 
        .. versionadded:: 1.8.0 
        '''</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">settings_cls </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">settings </span><span class="s4">import </span><span class="s1">SettingsWithSpinner</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">settings_cls </span><span class="s2">= </span><span class="s1">SettingsWithSpinner</span>
        <span class="s4">elif </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">settings_cls</span><span class="s2">, </span><span class="s1">string_types</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">settings_cls </span><span class="s2">= </span><span class="s1">Factory</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">settings_cls</span><span class="s2">)</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">settings_cls</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">build_settings</span><span class="s2">(</span><span class="s1">s</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">use_kivy_settings</span><span class="s2">:</span>
            <span class="s1">s</span><span class="s2">.</span><span class="s1">add_kivy_panel</span><span class="s2">()</span>
        <span class="s1">s</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">on_close</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">close_settings</span><span class="s2">,</span>
               <span class="s1">on_config_change</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_on_config_change</span><span class="s2">)</span>
        <span class="s4">return </span><span class="s1">s</span>

    <span class="s4">def </span><span class="s1">destroy_settings</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">'''.. versionadded:: 1.8.0 
 
        Dereferences the current settings panel if one 
        exists. This means that when :meth:`App.open_settings` is next 
        run, a new panel will be created and displayed. It doesn't 
        affect any of the contents of the panel, but lets you (for 
        instance) refresh the settings panel layout if you have 
        changed the settings widget in response to a screen size 
        change. 
 
        If you have modified :meth:`~App.open_settings` or 
        :meth:`~App.display_settings`, you should be careful to 
        correctly detect if the previous settings widget has been 
        destroyed. 
 
        '''</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_app_settings </span><span class="s4">is not None</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_app_settings </span><span class="s2">= </span><span class="s4">None</span>

    <span class="s5">#</span>
    <span class="s5"># privates</span>
    <span class="s5">#</span>

    <span class="s4">def </span><span class="s1">_on_config_change</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">largs</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dispatch</span><span class="s2">(</span><span class="s3">'on_config_change'</span><span class="s2">, *</span><span class="s1">largs</span><span class="s2">[</span><span class="s6">1</span><span class="s2">:])</span>

    <span class="s4">def </span><span class="s1">_install_settings_keys</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">window</span><span class="s2">):</span>
        <span class="s1">window</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">on_keyboard</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_on_keyboard_settings</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">_on_keyboard_settings</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">window</span><span class="s2">, *</span><span class="s1">largs</span><span class="s2">):</span>
        <span class="s1">key </span><span class="s2">= </span><span class="s1">largs</span><span class="s2">[</span><span class="s6">0</span><span class="s2">]</span>
        <span class="s1">setting_key </span><span class="s2">= </span><span class="s6">282  </span><span class="s5"># F1</span>

        <span class="s5"># android hack, if settings key is pygame K_MENU</span>
        <span class="s4">if </span><span class="s1">platform </span><span class="s2">== </span><span class="s3">'android' </span><span class="s4">and not </span><span class="s1">USE_SDL2</span><span class="s2">:</span>
            <span class="s4">import </span><span class="s1">pygame</span>
            <span class="s1">setting_key </span><span class="s2">= </span><span class="s1">pygame</span><span class="s2">.</span><span class="s1">K_MENU</span>

        <span class="s4">if </span><span class="s1">key </span><span class="s2">== </span><span class="s1">setting_key</span><span class="s2">:</span>
            <span class="s5"># toggle settings panel</span>
            <span class="s4">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">open_settings</span><span class="s2">():</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">close_settings</span><span class="s2">()</span>
            <span class="s4">return True</span>
        <span class="s4">if </span><span class="s1">key </span><span class="s2">== </span><span class="s6">27</span><span class="s2">:</span>
            <span class="s4">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">close_settings</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">on_title</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">, </span><span class="s1">title</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_app_window</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_app_window</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s1">title</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">on_icon</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">, </span><span class="s1">icon</span><span class="s2">):</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_app_window</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_app_window</span><span class="s2">.</span><span class="s1">set_icon</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">get_application_icon</span><span class="s2">())</span>
</pre>
</body>
</html>