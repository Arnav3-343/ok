<html>
<head>
<title>test_tuples.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #7a7e85;}
.s5 { color: #2aacb8;}
.s6 { color: #5f826b; font-style: italic;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_tuples.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">collections</span>
<span class="s0">import </span><span class="s1">itertools</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>

<span class="s0">from </span><span class="s1">numba </span><span class="s0">import </span><span class="s1">njit</span><span class="s2">, </span><span class="s1">jit</span><span class="s2">, </span><span class="s1">typeof</span><span class="s2">, </span><span class="s1">literally</span>
<span class="s0">from </span><span class="s1">numba</span><span class="s2">.</span><span class="s1">core </span><span class="s0">import </span><span class="s1">types</span><span class="s2">, </span><span class="s1">errors</span><span class="s2">, </span><span class="s1">utils</span>
<span class="s0">from </span><span class="s1">numba</span><span class="s2">.</span><span class="s1">tests</span><span class="s2">.</span><span class="s1">support </span><span class="s0">import </span><span class="s1">TestCase</span><span class="s2">, </span><span class="s1">MemoryLeakMixin</span><span class="s2">, </span><span class="s1">tag</span>
<span class="s0">import </span><span class="s1">unittest</span>


<span class="s1">Rect </span><span class="s2">= </span><span class="s1">collections</span><span class="s2">.</span><span class="s1">namedtuple</span><span class="s2">(</span><span class="s3">'Rect'</span><span class="s2">, (</span><span class="s3">'width'</span><span class="s2">, </span><span class="s3">'height'</span><span class="s2">))</span>

<span class="s1">Point </span><span class="s2">= </span><span class="s1">collections</span><span class="s2">.</span><span class="s1">namedtuple</span><span class="s2">(</span><span class="s3">'Point'</span><span class="s2">, (</span><span class="s3">'x'</span><span class="s2">, </span><span class="s3">'y'</span><span class="s2">, </span><span class="s3">'z'</span><span class="s2">))</span>

<span class="s1">Point2 </span><span class="s2">= </span><span class="s1">collections</span><span class="s2">.</span><span class="s1">namedtuple</span><span class="s2">(</span><span class="s3">'Point2'</span><span class="s2">, (</span><span class="s3">'x'</span><span class="s2">, </span><span class="s3">'y'</span><span class="s2">, </span><span class="s3">'z'</span><span class="s2">))</span>

<span class="s1">Empty </span><span class="s2">= </span><span class="s1">collections</span><span class="s2">.</span><span class="s1">namedtuple</span><span class="s2">(</span><span class="s3">'Empty'</span><span class="s2">, ())</span>

<span class="s0">def </span><span class="s1">tuple_return_usecase</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span>

<span class="s0">def </span><span class="s1">tuple_first</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">):</span>
    <span class="s1">a</span><span class="s2">, </span><span class="s1">b </span><span class="s2">= </span><span class="s1">tup</span>
    <span class="s0">return </span><span class="s1">a</span>

<span class="s0">def </span><span class="s1">tuple_second</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">):</span>
    <span class="s1">a</span><span class="s2">, </span><span class="s1">b </span><span class="s2">= </span><span class="s1">tup</span>
    <span class="s0">return </span><span class="s1">b</span>

<span class="s0">def </span><span class="s1">tuple_index</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">tup</span><span class="s2">[</span><span class="s1">idx</span><span class="s2">]</span>

<span class="s0">def </span><span class="s1">tuple_index_static</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">):</span>
    <span class="s4"># Note the negative index</span>
    <span class="s0">return </span><span class="s1">tup</span><span class="s2">[-</span><span class="s5">2</span><span class="s2">]</span>

<span class="s0">def </span><span class="s1">tuple_slice2</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">tup</span><span class="s2">[</span><span class="s5">1</span><span class="s2">:-</span><span class="s5">1</span><span class="s2">]</span>

<span class="s0">def </span><span class="s1">tuple_slice3</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">tup</span><span class="s2">[</span><span class="s5">1</span><span class="s2">::</span><span class="s5">2</span><span class="s2">]</span>

<span class="s0">def </span><span class="s1">len_usecase</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">len</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">add_usecase</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">a </span><span class="s2">+ </span><span class="s1">b</span>

<span class="s0">def </span><span class="s1">eq_usecase</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">a </span><span class="s2">== </span><span class="s1">b</span>

<span class="s0">def </span><span class="s1">ne_usecase</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">a </span><span class="s2">!= </span><span class="s1">b</span>

<span class="s0">def </span><span class="s1">gt_usecase</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">a </span><span class="s2">&gt; </span><span class="s1">b</span>

<span class="s0">def </span><span class="s1">ge_usecase</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">a </span><span class="s2">&gt;= </span><span class="s1">b</span>

<span class="s0">def </span><span class="s1">lt_usecase</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">a </span><span class="s2">&lt; </span><span class="s1">b</span>

<span class="s0">def </span><span class="s1">le_usecase</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">a </span><span class="s2">&lt;= </span><span class="s1">b</span>

<span class="s0">def </span><span class="s1">in_usecase</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">a </span><span class="s0">in </span><span class="s1">b</span>

<span class="s0">def </span><span class="s1">bool_usecase</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">bool</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">), (</span><span class="s5">3 </span><span class="s0">if </span><span class="s1">tup </span><span class="s0">else </span><span class="s5">2</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">getattr_usecase</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">tup</span><span class="s2">.</span><span class="s1">z</span><span class="s2">, </span><span class="s1">tup</span><span class="s2">.</span><span class="s1">y</span><span class="s2">, </span><span class="s1">tup</span><span class="s2">.</span><span class="s1">x</span>

<span class="s0">def </span><span class="s1">make_point</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">c</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">Point</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">c</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">make_point_kws</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">c</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">Point</span><span class="s2">(</span><span class="s1">z</span><span class="s2">=</span><span class="s1">c</span><span class="s2">, </span><span class="s1">y</span><span class="s2">=</span><span class="s1">b</span><span class="s2">, </span><span class="s1">x</span><span class="s2">=</span><span class="s1">a</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">make_point_nrt</span><span class="s2">(</span><span class="s1">n</span><span class="s2">):</span>
    <span class="s1">r </span><span class="s2">= </span><span class="s1">Rect</span><span class="s2">(</span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">)), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s1">n </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">))</span>
    <span class="s4"># This also exercises attribute access</span>
    <span class="s1">p </span><span class="s2">= </span><span class="s1">Point</span><span class="s2">(</span><span class="s1">r</span><span class="s2">, </span><span class="s1">len</span><span class="s2">(</span><span class="s1">r</span><span class="s2">.</span><span class="s1">width</span><span class="s2">), </span><span class="s1">len</span><span class="s2">(</span><span class="s1">r</span><span class="s2">.</span><span class="s1">height</span><span class="s2">))</span>
    <span class="s0">return </span><span class="s1">p</span>

<span class="s0">def </span><span class="s1">type_usecase</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">type</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">)(*</span><span class="s1">args</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">identity</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">tup</span>

<span class="s0">def </span><span class="s1">index_method_usecase</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">tup</span><span class="s2">.</span><span class="s1">index</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">tuple_unpack_static_getitem_err</span><span class="s2">():</span>
    <span class="s4"># see issue3895, `c` is imprecise</span>
    <span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">c</span><span class="s2">, </span><span class="s1">d </span><span class="s2">= [], [], [], </span><span class="s5">0.0</span>
    <span class="s1">a</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">b</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s0">return</span>


<span class="s0">class </span><span class="s1">TestTupleLengthError</span><span class="s2">(</span><span class="s1">unittest</span><span class="s2">.</span><span class="s1">TestCase</span><span class="s2">):</span>

    <span class="s0">def </span><span class="s1">test_tuple_length_error</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># issue 2195</span>
        <span class="s4"># raise an error on tuples greater than 1000 in length</span>
        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">eattuple</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s1">len</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">.</span><span class="s1">UnsupportedError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">tup </span><span class="s2">= </span><span class="s1">tuple</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s5">1001</span><span class="s2">))</span>
            <span class="s1">eattuple</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">)</span>

        <span class="s1">expected </span><span class="s2">= </span><span class="s3">&quot;Tuple 'tup' length must be smaller than 1000&quot;</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">))</span>

<span class="s0">class </span><span class="s1">TestTupleTypeNotIterable</span><span class="s2">(</span><span class="s1">unittest</span><span class="s2">.</span><span class="s1">TestCase</span><span class="s2">):</span>
    <span class="s6">''' 
    issue 4369 
    raise an error if 'type' is not iterable 
    '''</span>
    <span class="s0">def </span><span class="s1">test_namedtuple_types_exception</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">.</span><span class="s1">TypingError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">types</span><span class="s2">.</span><span class="s1">NamedTuple</span><span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">, </span><span class="s3">'p'</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span>
            <span class="s3">&quot;Argument 'types' is not iterable&quot;</span><span class="s2">,</span>
            <span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">)</span>
        <span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_tuple_types_exception</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">.</span><span class="s1">TypingError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">types</span><span class="s2">.</span><span class="s1">Tuple</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">))</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span>
            <span class="s3">&quot;Argument 'types' is not iterable&quot;</span><span class="s2">,</span>
            <span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">)</span>
        <span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestTupleReturn</span><span class="s2">(</span><span class="s1">TestCase</span><span class="s2">):</span>

    <span class="s0">def </span><span class="s1">test_array_tuple</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">aryty </span><span class="s2">= </span><span class="s1">types</span><span class="s2">.</span><span class="s1">Array</span><span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s3">'C'</span><span class="s2">)</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">njit</span><span class="s2">((</span><span class="s1">aryty</span><span class="s2">, </span><span class="s1">aryty</span><span class="s2">))(</span><span class="s1">tuple_return_usecase</span><span class="s2">)</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">b </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">5</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">'float64'</span><span class="s2">)</span>
        <span class="s1">ra</span><span class="s2">, </span><span class="s1">rb </span><span class="s2">= </span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">ra</span><span class="s2">, </span><span class="s1">a</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">rb</span><span class="s2">, </span><span class="s1">b</span><span class="s2">)</span>
        <span class="s0">del </span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">ra</span><span class="s2">, </span><span class="s1">rb</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_scalar_tuple</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">scalarty </span><span class="s2">= </span><span class="s1">types</span><span class="s2">.</span><span class="s1">float32</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">njit</span><span class="s2">((</span><span class="s1">scalarty</span><span class="s2">, </span><span class="s1">scalarty</span><span class="s2">))(</span><span class="s1">tuple_return_usecase</span><span class="s2">)</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">b </span><span class="s2">= </span><span class="s5">1</span>
        <span class="s1">ra</span><span class="s2">, </span><span class="s1">rb </span><span class="s2">= </span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">ra</span><span class="s2">, </span><span class="s1">a</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">rb</span><span class="s2">, </span><span class="s1">b</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_hetero_tuple</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">alltypes </span><span class="s2">= []</span>
        <span class="s1">allvalues </span><span class="s2">= []</span>

        <span class="s1">alltypes</span><span class="s2">.</span><span class="s1">append</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">))</span>
        <span class="s1">allvalues</span><span class="s2">.</span><span class="s1">append</span><span class="s2">((</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">))</span>

        <span class="s1">alltypes</span><span class="s2">.</span><span class="s1">append</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">))</span>
        <span class="s1">allvalues</span><span class="s2">.</span><span class="s1">append</span><span class="s2">((</span><span class="s5">1.125</span><span class="s2">, </span><span class="s5">.25</span><span class="s2">))</span>

        <span class="s1">alltypes</span><span class="s2">.</span><span class="s1">append</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">))</span>
        <span class="s1">allvalues</span><span class="s2">.</span><span class="s1">append</span><span class="s2">((</span><span class="s5">1231</span><span class="s2">, </span><span class="s5">.5</span><span class="s2">))</span>

        <span class="s0">for </span><span class="s2">(</span><span class="s1">ta</span><span class="s2">, </span><span class="s1">tb</span><span class="s2">), (</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">) </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">alltypes</span><span class="s2">, </span><span class="s1">allvalues</span><span class="s2">):</span>
            <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">njit</span><span class="s2">((</span><span class="s1">ta</span><span class="s2">, </span><span class="s1">tb</span><span class="s2">))(</span><span class="s1">tuple_return_usecase</span><span class="s2">)</span>
            <span class="s1">ra</span><span class="s2">, </span><span class="s1">rb </span><span class="s2">= </span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">((</span><span class="s1">ra</span><span class="s2">, </span><span class="s1">rb</span><span class="s2">), (</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">))</span>


<span class="s0">class </span><span class="s1">TestTuplePassing</span><span class="s2">(</span><span class="s1">TestCase</span><span class="s2">):</span>

    <span class="s0">def </span><span class="s1">test_unituple</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">tuple_type </span><span class="s2">= </span><span class="s1">types</span><span class="s2">.</span><span class="s1">UniTuple</span><span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>
        <span class="s1">cf_first </span><span class="s2">= </span><span class="s1">njit</span><span class="s2">((</span><span class="s1">tuple_type</span><span class="s2">,))(</span><span class="s1">tuple_first</span><span class="s2">)</span>
        <span class="s1">cf_second </span><span class="s2">= </span><span class="s1">njit</span><span class="s2">((</span><span class="s1">tuple_type</span><span class="s2">,))(</span><span class="s1">tuple_second</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cf_first</span><span class="s2">((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">)), </span><span class="s5">4</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cf_second</span><span class="s2">((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">)), </span><span class="s5">5</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_hetero_tuple</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">tuple_type </span><span class="s2">= </span><span class="s1">types</span><span class="s2">.</span><span class="s1">Tuple</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">))</span>
        <span class="s1">cf_first </span><span class="s2">= </span><span class="s1">njit</span><span class="s2">((</span><span class="s1">tuple_type</span><span class="s2">,))(</span><span class="s1">tuple_first</span><span class="s2">)</span>
        <span class="s1">cf_second </span><span class="s2">= </span><span class="s1">njit</span><span class="s2">((</span><span class="s1">tuple_type</span><span class="s2">,))(</span><span class="s1">tuple_second</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cf_first</span><span class="s2">((</span><span class="s5">2</span><span class="s2">**</span><span class="s5">61</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">)), </span><span class="s5">2</span><span class="s2">**</span><span class="s5">61</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cf_second</span><span class="s2">((</span><span class="s5">2</span><span class="s2">**</span><span class="s5">61</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">)), </span><span class="s5">1.5</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_size_mismatch</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># Issue #1638: tuple size should be checked when unboxing</span>
        <span class="s1">tuple_type </span><span class="s2">= </span><span class="s1">types</span><span class="s2">.</span><span class="s1">UniTuple</span><span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">njit</span><span class="s2">((</span><span class="s1">tuple_type</span><span class="s2">,))(</span><span class="s1">tuple_first</span><span class="s2">)</span>
        <span class="s1">entry_point </span><span class="s2">= </span><span class="s1">cfunc</span><span class="s2">.</span><span class="s1">overloads</span><span class="s2">[</span><span class="s1">cfunc</span><span class="s2">.</span><span class="s1">signatures</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]].</span><span class="s1">entry_point</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">entry_point</span><span class="s2">((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">))</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">),</span>
                         <span class="s2">(</span><span class="s3">&quot;size mismatch for tuple, &quot;</span>
                          <span class="s3">&quot;expected 2 element(s) but got 3&quot;</span><span class="s2">))</span>


<span class="s0">class </span><span class="s1">TestOperations</span><span class="s2">(</span><span class="s1">TestCase</span><span class="s2">):</span>

    <span class="s0">def </span><span class="s1">test_len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">len_usecase</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">njit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">Tuple</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">)),))(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">)), </span><span class="s5">2</span><span class="s2">)</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">njit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">UniTuple</span><span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">, </span><span class="s5">3</span><span class="s2">),))(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">)), </span><span class="s5">3</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_index_literal</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># issue #6023, test non-static getitem with IntegerLiteral index</span>
        <span class="s0">def </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">):</span>
            <span class="s1">idx </span><span class="s2">= </span><span class="s1">literally</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">)</span>
            <span class="s0">return </span><span class="s1">tup</span><span class="s2">[</span><span class="s1">idx</span><span class="s2">]</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">njit</span><span class="s2">(</span><span class="s1">pyfunc</span><span class="s2">)</span>

        <span class="s1">tup </span><span class="s2">= (</span><span class="s5">4</span><span class="s2">, </span><span class="s5">3.1</span><span class="s2">, </span><span class="s3">'sss'</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">)):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">, </span><span class="s1">i</span><span class="s2">), </span><span class="s1">tup</span><span class="s2">[</span><span class="s1">i</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">test_index</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">tuple_index</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">njit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">UniTuple</span><span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">, </span><span class="s5">3</span><span class="s2">), </span><span class="s1">types</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">),)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">tup </span><span class="s2">= (</span><span class="s5">4</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">6</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">)):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">, </span><span class="s1">i</span><span class="s2">), </span><span class="s1">tup</span><span class="s2">[</span><span class="s1">i</span><span class="s2">])</span>

        <span class="s4"># test negative indexing</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">) + </span><span class="s5">1</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">, -</span><span class="s1">i</span><span class="s2">), </span><span class="s1">tup</span><span class="s2">[-</span><span class="s1">i</span><span class="s2">])</span>

        <span class="s4"># oob indexes, +ve then -ve</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">IndexError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">cfunc</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">, </span><span class="s1">len</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">))</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s3">&quot;tuple index out of range&quot;</span><span class="s2">, </span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">))</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">IndexError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">cfunc</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">, -(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">) + </span><span class="s5">1</span><span class="s2">))</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s3">&quot;tuple index out of range&quot;</span><span class="s2">, </span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">))</span>

        <span class="s4"># Test empty tuple, this is a bit unusual as `njit` will infer the empty</span>
        <span class="s4"># tuple arg as a types.Tuple and not match the compiled signature, this</span>
        <span class="s4"># is essentially because the test originally relied on</span>
        <span class="s4"># `compile_isolated`.</span>
        <span class="s1">args </span><span class="s2">= (</span><span class="s1">types</span><span class="s2">.</span><span class="s1">UniTuple</span><span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">, </span><span class="s5">0</span><span class="s2">), </span><span class="s1">types</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">,)</span>
        <span class="s1">cr </span><span class="s2">= </span><span class="s1">njit</span><span class="s2">(</span><span class="s1">args</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">).</span><span class="s1">overloads</span><span class="s2">[</span><span class="s1">args</span><span class="s2">]</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">IndexError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">cr</span><span class="s2">.</span><span class="s1">entry_point</span><span class="s2">((), </span><span class="s5">0</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s3">&quot;tuple index out of range&quot;</span><span class="s2">, </span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">))</span>

        <span class="s4"># test uintp indexing (because, e.g., parfor generates unsigned prange)</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">njit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">UniTuple</span><span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">, </span><span class="s5">3</span><span class="s2">), </span><span class="s1">types</span><span class="s2">.</span><span class="s1">uintp</span><span class="s2">,),)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">)):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">uintp</span><span class="s2">(</span><span class="s1">i</span><span class="s2">)), </span><span class="s1">tup</span><span class="s2">[</span><span class="s1">i</span><span class="s2">])</span>

        <span class="s4"># With a compile-time static index (the code generation path is</span>
        <span class="s4"># different)</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">tuple_index_static</span>
        <span class="s0">for </span><span class="s1">typ </span><span class="s0">in </span><span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">UniTuple</span><span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">, </span><span class="s5">4</span><span class="s2">),</span>
                    <span class="s1">types</span><span class="s2">.</span><span class="s1">Tuple</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">))):</span>
            <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">njit</span><span class="s2">((</span><span class="s1">typ</span><span class="s2">,))(</span><span class="s1">pyfunc</span><span class="s2">)</span>
            <span class="s1">tup </span><span class="s2">= (</span><span class="s5">4</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">42</span><span class="s2">, </span><span class="s5">6</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">))</span>

        <span class="s1">typ </span><span class="s2">= </span><span class="s1">types</span><span class="s2">.</span><span class="s1">UniTuple</span><span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertTypingError</span><span class="s2">():</span>
            <span class="s1">njit</span><span class="s2">((</span><span class="s1">typ</span><span class="s2">,))(</span><span class="s1">pyfunc</span><span class="s2">)</span>

        <span class="s4"># test unpack, staticgetitem with imprecise type (issue #3895)</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">tuple_unpack_static_getitem_err</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertTypingError</span><span class="s2">() </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">njit</span><span class="s2">((),)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">msg </span><span class="s2">= (</span><span class="s3">&quot;Cannot infer the type of variable 'c', have imprecise type: &quot;</span>
               <span class="s3">&quot;list(undefined)&lt;iv=None&gt;.&quot;</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s1">msg</span><span class="s2">, </span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_in</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">in_usecase</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">njit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">UniTuple</span><span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">, </span><span class="s5">3</span><span class="s2">),),)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">tup </span><span class="s2">= (</span><span class="s5">4</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">5</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">5</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">i</span><span class="s2">, </span><span class="s1">tup</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">i</span><span class="s2">, </span><span class="s1">tup</span><span class="s2">))</span>

        <span class="s4"># Test the empty case</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">njit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">Tuple</span><span class="s2">([]),),)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, ()), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, ()))</span>

    <span class="s0">def </span><span class="s1">check_slice</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">pyfunc</span><span class="s2">):</span>
        <span class="s1">tup </span><span class="s2">= (</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">7</span><span class="s2">)</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">njit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">UniTuple</span><span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">, </span><span class="s5">4</span><span class="s2">),),)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">))</span>
        <span class="s1">args </span><span class="s2">= </span><span class="s1">types</span><span class="s2">.</span><span class="s1">Tuple</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">))</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">njit</span><span class="s2">((</span><span class="s1">args</span><span class="s2">,))(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_slice2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_slice</span><span class="s2">(</span><span class="s1">tuple_slice2</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_slice3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_slice</span><span class="s2">(</span><span class="s1">tuple_slice3</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_bool</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">bool_usecase</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">njit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">Tuple</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">)),),)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">args </span><span class="s2">= ((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">),)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">))</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">njit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">UniTuple</span><span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">, </span><span class="s5">3</span><span class="s2">),),)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">args </span><span class="s2">= ((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">),)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">))</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">njit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">Tuple</span><span class="s2">(()),),)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(()), </span><span class="s1">pyfunc</span><span class="s2">(()))</span>

    <span class="s0">def </span><span class="s1">test_add</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">add_usecase</span>
        <span class="s1">samples </span><span class="s2">= [(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">Tuple</span><span class="s2">(()), ()),</span>
                   <span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">UniTuple</span><span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">, </span><span class="s5">0</span><span class="s2">), ()),</span>
                   <span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">UniTuple</span><span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), (</span><span class="s5">42</span><span class="s2">,)),</span>
                   <span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">Tuple</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">)), (</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4.5</span><span class="s2">)),</span>
                   <span class="s2">]</span>
        <span class="s0">for </span><span class="s2">(</span><span class="s1">ta</span><span class="s2">, </span><span class="s1">a</span><span class="s2">), (</span><span class="s1">tb</span><span class="s2">, </span><span class="s1">b</span><span class="s2">) </span><span class="s0">in </span><span class="s1">itertools</span><span class="s2">.</span><span class="s1">product</span><span class="s2">(</span><span class="s1">samples</span><span class="s2">, </span><span class="s1">samples</span><span class="s2">):</span>
            <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">njit</span><span class="s2">((</span><span class="s1">ta</span><span class="s2">, </span><span class="s1">tb</span><span class="s2">),)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">)</span>
            <span class="s1">got </span><span class="s2">= </span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">got</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">, </span><span class="s1">msg</span><span class="s2">=(</span><span class="s1">ta</span><span class="s2">, </span><span class="s1">tb</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">_test_compare</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">pyfunc</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">eq</span><span class="s2">(</span><span class="s1">pyfunc</span><span class="s2">, </span><span class="s1">cfunc</span><span class="s2">, </span><span class="s1">args</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIs</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">),</span>
                          <span class="s3">&quot;mismatch for arguments %s&quot; </span><span class="s2">% (</span><span class="s1">args</span><span class="s2">,))</span>

        <span class="s4"># Same-sized tuples</span>
        <span class="s1">argtypes </span><span class="s2">= [</span><span class="s1">types</span><span class="s2">.</span><span class="s1">Tuple</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">)),</span>
                    <span class="s1">types</span><span class="s2">.</span><span class="s1">UniTuple</span><span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)]</span>
        <span class="s0">for </span><span class="s1">ta</span><span class="s2">, </span><span class="s1">tb </span><span class="s0">in </span><span class="s1">itertools</span><span class="s2">.</span><span class="s1">product</span><span class="s2">(</span><span class="s1">argtypes</span><span class="s2">, </span><span class="s1">argtypes</span><span class="s2">):</span>
            <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">njit</span><span class="s2">((</span><span class="s1">ta</span><span class="s2">, </span><span class="s1">tb</span><span class="s2">),)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
            <span class="s0">for </span><span class="s1">args </span><span class="s0">in </span><span class="s2">[((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">), (</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">)),</span>
                         <span class="s2">((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">), (</span><span class="s5">4</span><span class="s2">, </span><span class="s5">6</span><span class="s2">)),</span>
                         <span class="s2">((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">6</span><span class="s2">), (</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">)),</span>
                         <span class="s2">((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">), (</span><span class="s5">5</span><span class="s2">, </span><span class="s5">4</span><span class="s2">))]:</span>
                <span class="s1">eq</span><span class="s2">(</span><span class="s1">pyfunc</span><span class="s2">, </span><span class="s1">cfunc</span><span class="s2">, </span><span class="s1">args</span><span class="s2">)</span>
        <span class="s4"># Different-sized tuples</span>
        <span class="s1">argtypes </span><span class="s2">= [</span><span class="s1">types</span><span class="s2">.</span><span class="s1">Tuple</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">)),</span>
                    <span class="s1">types</span><span class="s2">.</span><span class="s1">UniTuple</span><span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)]</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">njit</span><span class="s2">(</span><span class="s1">tuple</span><span class="s2">(</span><span class="s1">argtypes</span><span class="s2">),)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">args </span><span class="s0">in </span><span class="s2">[((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">), (</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">)),</span>
                     <span class="s2">((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">), (</span><span class="s5">4</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">6</span><span class="s2">)),</span>
                     <span class="s2">((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">), (</span><span class="s5">4</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">7</span><span class="s2">))]:</span>
            <span class="s1">eq</span><span class="s2">(</span><span class="s1">pyfunc</span><span class="s2">, </span><span class="s1">cfunc</span><span class="s2">, </span><span class="s1">args</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_eq</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_compare</span><span class="s2">(</span><span class="s1">eq_usecase</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_ne</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_compare</span><span class="s2">(</span><span class="s1">ne_usecase</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_gt</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_compare</span><span class="s2">(</span><span class="s1">gt_usecase</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_ge</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_compare</span><span class="s2">(</span><span class="s1">ge_usecase</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_lt</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_compare</span><span class="s2">(</span><span class="s1">lt_usecase</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_le</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_compare</span><span class="s2">(</span><span class="s1">le_usecase</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestNamedTuple</span><span class="s2">(</span><span class="s1">TestCase</span><span class="s2">, </span><span class="s1">MemoryLeakMixin</span><span class="s2">):</span>

    <span class="s0">def </span><span class="s1">test_unpack</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">check</span><span class="s2">(</span><span class="s1">p</span><span class="s2">):</span>
            <span class="s0">for </span><span class="s1">pyfunc </span><span class="s0">in </span><span class="s1">tuple_first</span><span class="s2">, </span><span class="s1">tuple_second</span><span class="s2">:</span>
                <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">p</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">p</span><span class="s2">))</span>

        <span class="s4"># Homogeneous</span>
        <span class="s1">check</span><span class="s2">(</span><span class="s1">Rect</span><span class="s2">(</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">))</span>
        <span class="s4"># Heterogeneous</span>
        <span class="s1">check</span><span class="s2">(</span><span class="s1">Rect</span><span class="s2">(</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5.5</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">check</span><span class="s2">(</span><span class="s1">p</span><span class="s2">):</span>
            <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">len_usecase</span>
            <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">p</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">p</span><span class="s2">))</span>

        <span class="s4"># Homogeneous</span>
        <span class="s1">check</span><span class="s2">(</span><span class="s1">Rect</span><span class="s2">(</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">))</span>
        <span class="s1">check</span><span class="s2">(</span><span class="s1">Point</span><span class="s2">(</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">))</span>
        <span class="s4"># Heterogeneous</span>
        <span class="s1">check</span><span class="s2">(</span><span class="s1">Rect</span><span class="s2">(</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5.5</span><span class="s2">))</span>
        <span class="s1">check</span><span class="s2">(</span><span class="s1">Point</span><span class="s2">(</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5.5</span><span class="s2">, </span><span class="s5">6j</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_index</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">tuple_index</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>

        <span class="s1">p </span><span class="s2">= </span><span class="s1">Point</span><span class="s2">(</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">p</span><span class="s2">)):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, </span><span class="s1">i</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, </span><span class="s1">i</span><span class="s2">))</span>

        <span class="s4"># test uintp indexing (because, e.g., parfor generates unsigned prange)</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">p</span><span class="s2">)):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">uintp</span><span class="s2">(</span><span class="s1">i</span><span class="s2">)), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, </span><span class="s1">i</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_bool</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">check</span><span class="s2">(</span><span class="s1">p</span><span class="s2">):</span>
            <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">bool_usecase</span>
            <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">p</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">p</span><span class="s2">))</span>

        <span class="s4"># Homogeneous</span>
        <span class="s1">check</span><span class="s2">(</span><span class="s1">Rect</span><span class="s2">(</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">))</span>
        <span class="s4"># Heterogeneous</span>
        <span class="s1">check</span><span class="s2">(</span><span class="s1">Rect</span><span class="s2">(</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5.5</span><span class="s2">))</span>
        <span class="s1">check</span><span class="s2">(</span><span class="s1">Empty</span><span class="s2">())</span>

    <span class="s0">def </span><span class="s1">_test_compare</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">pyfunc</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">eq</span><span class="s2">(</span><span class="s1">pyfunc</span><span class="s2">, </span><span class="s1">cfunc</span><span class="s2">, </span><span class="s1">args</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIs</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">),</span>
                          <span class="s3">&quot;mismatch for arguments %s&quot; </span><span class="s2">% (</span><span class="s1">args</span><span class="s2">,))</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>

        <span class="s4"># Same-sized named tuples</span>
        <span class="s0">for </span><span class="s1">a</span><span class="s2">, </span><span class="s1">b </span><span class="s0">in </span><span class="s2">[((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">), (</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">)),</span>
                     <span class="s2">((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">), (</span><span class="s5">4</span><span class="s2">, </span><span class="s5">6</span><span class="s2">)),</span>
                     <span class="s2">((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">6</span><span class="s2">), (</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">)),</span>
                     <span class="s2">((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">), (</span><span class="s5">5</span><span class="s2">, </span><span class="s5">4</span><span class="s2">))]:</span>
            <span class="s1">eq</span><span class="s2">(</span><span class="s1">pyfunc</span><span class="s2">, </span><span class="s1">cfunc</span><span class="s2">, (</span><span class="s1">Rect</span><span class="s2">(*</span><span class="s1">a</span><span class="s2">), </span><span class="s1">Rect</span><span class="s2">(*</span><span class="s1">b</span><span class="s2">)))</span>

        <span class="s4"># Different-sized named tuples</span>
        <span class="s0">for </span><span class="s1">a</span><span class="s2">, </span><span class="s1">b </span><span class="s0">in </span><span class="s2">[((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">), (</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">)),</span>
                     <span class="s2">((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">), (</span><span class="s5">4</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">6</span><span class="s2">)),</span>
                     <span class="s2">((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">), (</span><span class="s5">4</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">7</span><span class="s2">))]:</span>
            <span class="s1">eq</span><span class="s2">(</span><span class="s1">pyfunc</span><span class="s2">, </span><span class="s1">cfunc</span><span class="s2">, (</span><span class="s1">Rect</span><span class="s2">(*</span><span class="s1">a</span><span class="s2">), </span><span class="s1">Point</span><span class="s2">(*</span><span class="s1">b</span><span class="s2">)))</span>

    <span class="s0">def </span><span class="s1">test_eq</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_compare</span><span class="s2">(</span><span class="s1">eq_usecase</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_ne</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_compare</span><span class="s2">(</span><span class="s1">ne_usecase</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_gt</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_compare</span><span class="s2">(</span><span class="s1">gt_usecase</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_ge</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_compare</span><span class="s2">(</span><span class="s1">ge_usecase</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_lt</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_compare</span><span class="s2">(</span><span class="s1">lt_usecase</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_le</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_test_compare</span><span class="s2">(</span><span class="s1">le_usecase</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">getattr_usecase</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>

        <span class="s0">for </span><span class="s1">args </span><span class="s0">in </span><span class="s2">(</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">), (</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5.5</span><span class="s2">, </span><span class="s5">6j</span><span class="s2">):</span>
            <span class="s1">p </span><span class="s2">= </span><span class="s1">Point</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">p</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">p</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_construct</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">check</span><span class="s2">(</span><span class="s1">pyfunc</span><span class="s2">):</span>
            <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
            <span class="s0">for </span><span class="s1">args </span><span class="s0">in </span><span class="s2">(</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">), (</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5.5</span><span class="s2">, </span><span class="s5">6j</span><span class="s2">):</span>
                <span class="s1">expected </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">)</span>
                <span class="s1">got </span><span class="s2">= </span><span class="s1">cfunc</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIs</span><span class="s2">(</span><span class="s1">type</span><span class="s2">(</span><span class="s1">got</span><span class="s2">), </span><span class="s1">type</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">))</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">got</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s1">check</span><span class="s2">(</span><span class="s1">make_point</span><span class="s2">)</span>
        <span class="s1">check</span><span class="s2">(</span><span class="s1">make_point_kws</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_type</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># Test the type() built-in on named tuples</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">type_usecase</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>

        <span class="s1">arg_tuples </span><span class="s2">= [(</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">), (</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5.5</span><span class="s2">, </span><span class="s5">6j</span><span class="s2">)]</span>
        <span class="s0">for </span><span class="s1">tup_args</span><span class="s2">, </span><span class="s1">args </span><span class="s0">in </span><span class="s1">itertools</span><span class="s2">.</span><span class="s1">product</span><span class="s2">(</span><span class="s1">arg_tuples</span><span class="s2">, </span><span class="s1">arg_tuples</span><span class="s2">):</span>
            <span class="s1">tup </span><span class="s2">= </span><span class="s1">Point</span><span class="s2">(*</span><span class="s1">tup_args</span><span class="s2">)</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">)</span>
            <span class="s1">got </span><span class="s2">= </span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">tup</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIs</span><span class="s2">(</span><span class="s1">type</span><span class="s2">(</span><span class="s1">got</span><span class="s2">), </span><span class="s1">type</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">))</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">got</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_literal_unification</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># Test for #3565.</span>
        <span class="s2">@</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s0">def </span><span class="s1">Data1</span><span class="s2">(</span><span class="s1">value</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s1">Rect</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, -</span><span class="s5">321</span><span class="s2">)</span>

        <span class="s2">@</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s0">def </span><span class="s1">call</span><span class="s2">(</span><span class="s1">i</span><span class="s2">, </span><span class="s1">j</span><span class="s2">):</span>
            <span class="s0">if </span><span class="s1">j </span><span class="s2">== </span><span class="s5">0</span><span class="s2">:</span>
                <span class="s4"># In the error, `result` is typed to `Rect(int, LiteralInt)`</span>
                <span class="s4"># because of the `-321` literal.  This doesn't match the</span>
                <span class="s4"># `result` type in the other branch.</span>
                <span class="s1">result </span><span class="s2">= </span><span class="s1">Data1</span><span class="s2">(</span><span class="s1">i</span><span class="s2">)</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s4"># `result` is typed to be `Rect(int, int)`</span>
                <span class="s1">result </span><span class="s2">= </span><span class="s1">Rect</span><span class="s2">(</span><span class="s1">i</span><span class="s2">, </span><span class="s1">j</span><span class="s2">)</span>
            <span class="s0">return </span><span class="s1">result</span>

        <span class="s1">r </span><span class="s2">= </span><span class="s1">call</span><span class="s2">(</span><span class="s5">123</span><span class="s2">, </span><span class="s5">1321</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">r</span><span class="s2">, </span><span class="s1">Rect</span><span class="s2">(</span><span class="s1">width</span><span class="s2">=</span><span class="s5">123</span><span class="s2">, </span><span class="s1">height</span><span class="s2">=</span><span class="s5">1321</span><span class="s2">))</span>
        <span class="s1">r </span><span class="s2">= </span><span class="s1">call</span><span class="s2">(</span><span class="s5">123</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">r</span><span class="s2">, </span><span class="s1">Rect</span><span class="s2">(</span><span class="s1">width</span><span class="s2">=</span><span class="s5">123</span><span class="s2">, </span><span class="s1">height</span><span class="s2">=-</span><span class="s5">321</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_string_literal_in_ctor</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># Test for issue #3813</span>

        <span class="s2">@</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">():</span>
            <span class="s0">return </span><span class="s1">Rect</span><span class="s2">(</span><span class="s5">10</span><span class="s2">, </span><span class="s3">'somestring'</span><span class="s2">)</span>

        <span class="s1">r </span><span class="s2">= </span><span class="s1">foo</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">r</span><span class="s2">, </span><span class="s1">Rect</span><span class="s2">(</span><span class="s1">width</span><span class="s2">=</span><span class="s5">10</span><span class="s2">, </span><span class="s1">height</span><span class="s2">=</span><span class="s3">'somestring'</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_dispatcher_mistreat</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># Test for issue #5215 that mistreat namedtuple as tuples</span>
        <span class="s2">@</span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s1">x</span>

        <span class="s1">in1 </span><span class="s2">= (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">,  </span><span class="s5">3</span><span class="s2">)</span>
        <span class="s1">out1 </span><span class="s2">= </span><span class="s1">foo</span><span class="s2">(</span><span class="s1">in1</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">in1</span><span class="s2">, </span><span class="s1">out1</span><span class="s2">)</span>

        <span class="s1">in2 </span><span class="s2">= </span><span class="s1">Point</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)</span>
        <span class="s1">out2 </span><span class="s2">= </span><span class="s1">foo</span><span class="s2">(</span><span class="s1">in2</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">in2</span><span class="s2">, </span><span class="s1">out2</span><span class="s2">)</span>

        <span class="s4"># Check the signatures</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">foo</span><span class="s2">.</span><span class="s1">nopython_signatures</span><span class="s2">), </span><span class="s5">2</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">foo</span><span class="s2">.</span><span class="s1">nopython_signatures</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">args</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">typeof</span><span class="s2">(</span><span class="s1">in1</span><span class="s2">))</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">foo</span><span class="s2">.</span><span class="s1">nopython_signatures</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">args</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">typeof</span><span class="s2">(</span><span class="s1">in2</span><span class="s2">))</span>

        <span class="s4"># Differently named</span>
        <span class="s1">in3 </span><span class="s2">= </span><span class="s1">Point2</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)</span>
        <span class="s1">out3 </span><span class="s2">= </span><span class="s1">foo</span><span class="s2">(</span><span class="s1">in3</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">in3</span><span class="s2">, </span><span class="s1">out3</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">foo</span><span class="s2">.</span><span class="s1">nopython_signatures</span><span class="s2">), </span><span class="s5">3</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">foo</span><span class="s2">.</span><span class="s1">nopython_signatures</span><span class="s2">[</span><span class="s5">2</span><span class="s2">].</span><span class="s1">args</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">typeof</span><span class="s2">(</span><span class="s1">in3</span><span class="s2">))</span>


<span class="s0">class </span><span class="s1">TestTupleNRT</span><span class="s2">(</span><span class="s1">TestCase</span><span class="s2">, </span><span class="s1">MemoryLeakMixin</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">test_tuple_add</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">3</span><span class="s2">)</span>
            <span class="s0">return </span><span class="s2">(</span><span class="s1">a</span><span class="s2">,) + (</span><span class="s1">x</span><span class="s2">,)</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s5">123</span>
        <span class="s1">expect_a</span><span class="s2">, </span><span class="s1">expect_x </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>
        <span class="s1">got_a</span><span class="s2">, </span><span class="s1">got_x </span><span class="s2">= </span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">got_a</span><span class="s2">, </span><span class="s1">expect_a</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">got_x</span><span class="s2">, </span><span class="s1">expect_x</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestNamedTupleNRT</span><span class="s2">(</span><span class="s1">TestCase</span><span class="s2">, </span><span class="s1">MemoryLeakMixin</span><span class="s2">):</span>

    <span class="s0">def </span><span class="s1">test_return</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># Check returning a namedtuple with a list inside it</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">make_point_nrt</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>

        <span class="s0">for </span><span class="s1">arg </span><span class="s0">in </span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">0</span><span class="s2">):</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">)</span>
            <span class="s1">got </span><span class="s2">= </span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIs</span><span class="s2">(</span><span class="s1">type</span><span class="s2">(</span><span class="s1">got</span><span class="s2">), </span><span class="s1">type</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">))</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">got</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestConversions</span><span class="s2">(</span><span class="s1">TestCase</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot; 
    Test implicit conversions between tuple types. 
    &quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">check_conversion</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">fromty</span><span class="s2">, </span><span class="s1">toty</span><span class="s2">, </span><span class="s1">val</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">identity</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">njit</span><span class="s2">(</span><span class="s1">toty</span><span class="s2">(</span><span class="s1">fromty</span><span class="s2">))(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">val</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">val</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_conversions</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">check </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">check_conversion</span>
        <span class="s1">fromty </span><span class="s2">= </span><span class="s1">types</span><span class="s2">.</span><span class="s1">UniTuple</span><span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>
        <span class="s1">check</span><span class="s2">(</span><span class="s1">fromty</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">UniTuple</span><span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">, </span><span class="s5">2</span><span class="s2">), (</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">))</span>
        <span class="s1">check</span><span class="s2">(</span><span class="s1">fromty</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">Tuple</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">)), (</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">))</span>
        <span class="s1">aty </span><span class="s2">= </span><span class="s1">types</span><span class="s2">.</span><span class="s1">UniTuple</span><span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)</span>
        <span class="s1">bty </span><span class="s2">= </span><span class="s1">types</span><span class="s2">.</span><span class="s1">Tuple</span><span class="s2">(())</span>
        <span class="s1">check</span><span class="s2">(</span><span class="s1">aty</span><span class="s2">, </span><span class="s1">bty</span><span class="s2">, ())</span>
        <span class="s1">check</span><span class="s2">(</span><span class="s1">bty</span><span class="s2">, </span><span class="s1">aty</span><span class="s2">, ())</span>

        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">.</span><span class="s1">TypingError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">check</span><span class="s2">(</span><span class="s1">fromty</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">Tuple</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">,)), (</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">))</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;No conversion from UniTuple(int32 x 2) to UniTuple(float32 x 1)&quot;</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s1">msg</span><span class="s2">, </span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">))</span>


<span class="s0">class </span><span class="s1">TestMethods</span><span class="s2">(</span><span class="s1">TestCase</span><span class="s2">):</span>

    <span class="s0">def </span><span class="s1">test_index</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">index_method_usecase</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">((</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">), </span><span class="s5">2</span><span class="s2">), </span><span class="s5">1</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">cfunc</span><span class="s2">((</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">), </span><span class="s5">4</span><span class="s2">)</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">'tuple.index(x): x not in tuple'</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">msg</span><span class="s2">, </span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">))</span>


<span class="s0">class </span><span class="s1">TestTupleBuild</span><span class="s2">(</span><span class="s1">TestCase</span><span class="s2">):</span>

    <span class="s0">def </span><span class="s1">test_build_unpack</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">check</span><span class="s2">(</span><span class="s1">p</span><span class="s2">):</span>
            <span class="s1">pyfunc </span><span class="s2">= </span><span class="s0">lambda </span><span class="s1">a</span><span class="s2">: (</span><span class="s5">1</span><span class="s2">, *</span><span class="s1">a</span><span class="s2">)</span>
            <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">p</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">p</span><span class="s2">))</span>

        <span class="s4"># Homogeneous</span>
        <span class="s1">check</span><span class="s2">((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">))</span>
        <span class="s4"># Heterogeneous</span>
        <span class="s1">check</span><span class="s2">((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5.5</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_build_unpack_assign_like</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># see #6534</span>
        <span class="s0">def </span><span class="s1">check</span><span class="s2">(</span><span class="s1">p</span><span class="s2">):</span>
            <span class="s1">pyfunc </span><span class="s2">= </span><span class="s0">lambda </span><span class="s1">a</span><span class="s2">: (*</span><span class="s1">a</span><span class="s2">,)</span>
            <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">p</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">p</span><span class="s2">))</span>

        <span class="s4"># Homogeneous</span>
        <span class="s1">check</span><span class="s2">((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">))</span>
        <span class="s4"># Heterogeneous</span>
        <span class="s1">check</span><span class="s2">((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5.5</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_build_unpack_fail_on_list_assign_like</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># see #6534</span>
        <span class="s0">def </span><span class="s1">check</span><span class="s2">(</span><span class="s1">p</span><span class="s2">):</span>
            <span class="s1">pyfunc </span><span class="s2">= </span><span class="s0">lambda </span><span class="s1">a</span><span class="s2">: (*</span><span class="s1">a</span><span class="s2">,)</span>
            <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">p</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">p</span><span class="s2">))</span>

        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">.</span><span class="s1">TypingError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">check</span><span class="s2">([</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">])</span>

        <span class="s4"># Python 3.9 has a peephole rewrite due to large changes in tuple</span>
        <span class="s4"># unpacking. It results in a tuple + list situation from the above</span>
        <span class="s4"># so the error message reflects that. Catching this specific and</span>
        <span class="s4"># seemingly rare sequence in the peephole rewrite is prohibitively</span>
        <span class="s4"># hard. Should it be reported numerous times, revisit then.</span>
        <span class="s1">msg1 </span><span class="s2">= </span><span class="s3">&quot;No implementation of function&quot;</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s1">msg1</span><span class="s2">, </span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">))</span>
        <span class="s1">msg2 </span><span class="s2">= </span><span class="s3">&quot;tuple(reflected list(&quot; </span><span class="s4"># ignore the rest of reflected list</span>
                                        <span class="s4"># part, it's repr is quite volatile.</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s1">msg2</span><span class="s2">, </span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_build_unpack_more</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">check</span><span class="s2">(</span><span class="s1">p</span><span class="s2">):</span>
            <span class="s1">pyfunc </span><span class="s2">= </span><span class="s0">lambda </span><span class="s1">a</span><span class="s2">: (</span><span class="s5">1</span><span class="s2">, *</span><span class="s1">a</span><span class="s2">, (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">), *</span><span class="s1">a</span><span class="s2">)</span>
            <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">p</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">p</span><span class="s2">))</span>

        <span class="s4"># Homogeneous</span>
        <span class="s1">check</span><span class="s2">((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">))</span>
        <span class="s4"># Heterogeneous</span>
        <span class="s1">check</span><span class="s2">((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5.5</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_build_unpack_call</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">check</span><span class="s2">(</span><span class="s1">p</span><span class="s2">):</span>
            <span class="s2">@</span><span class="s1">jit</span>
            <span class="s0">def </span><span class="s1">inner</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">):</span>
                <span class="s0">return </span><span class="s1">args</span>
            <span class="s1">pyfunc </span><span class="s2">= </span><span class="s0">lambda </span><span class="s1">a</span><span class="s2">: </span><span class="s1">inner</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, *</span><span class="s1">a</span><span class="s2">)</span>
            <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">p</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">p</span><span class="s2">))</span>

        <span class="s4"># Homogeneous</span>
        <span class="s1">check</span><span class="s2">((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">))</span>
        <span class="s4"># Heterogeneous</span>
        <span class="s1">check</span><span class="s2">((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5.5</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_build_unpack_call_more</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">check</span><span class="s2">(</span><span class="s1">p</span><span class="s2">):</span>
            <span class="s2">@</span><span class="s1">jit</span>
            <span class="s0">def </span><span class="s1">inner</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">):</span>
                <span class="s0">return </span><span class="s1">args</span>
            <span class="s1">pyfunc </span><span class="s2">= </span><span class="s0">lambda </span><span class="s1">a</span><span class="s2">: </span><span class="s1">inner</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, *</span><span class="s1">a</span><span class="s2">, *(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">), *</span><span class="s1">a</span><span class="s2">)</span>
            <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">p</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">p</span><span class="s2">))</span>

        <span class="s4"># Homogeneous</span>
        <span class="s1">check</span><span class="s2">((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">))</span>
        <span class="s4"># Heterogeneous</span>
        <span class="s1">check</span><span class="s2">((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5.5</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_tuple_constructor</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">check</span><span class="s2">(</span><span class="s1">pyfunc</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">):</span>
            <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">))</span>

        <span class="s4"># empty</span>
        <span class="s1">check</span><span class="s2">(</span><span class="s0">lambda </span><span class="s1">_</span><span class="s2">: </span><span class="s1">tuple</span><span class="s2">(), ())</span>
        <span class="s4"># Homogeneous</span>
        <span class="s1">check</span><span class="s2">(</span><span class="s0">lambda </span><span class="s1">a</span><span class="s2">: </span><span class="s1">tuple</span><span class="s2">(</span><span class="s1">a</span><span class="s2">), (</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">))</span>
        <span class="s4"># Heterogeneous</span>
        <span class="s1">check</span><span class="s2">(</span><span class="s0">lambda </span><span class="s1">a</span><span class="s2">: </span><span class="s1">tuple</span><span class="s2">(</span><span class="s1">a</span><span class="s2">), (</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5.5</span><span class="s2">))</span>

    <span class="s2">@</span><span class="s1">unittest</span><span class="s2">.</span><span class="s1">skipIf</span><span class="s2">(</span><span class="s1">utils</span><span class="s2">.</span><span class="s1">PYVERSION </span><span class="s2">&lt; (</span><span class="s5">3</span><span class="s2">, </span><span class="s5">9</span><span class="s2">), </span><span class="s3">&quot;needs Python 3.9+&quot;</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_unpack_with_predicate_fails</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># this fails as the list_to_tuple/list_extend peephole bytecode</span>
        <span class="s4"># rewriting needed for Python 3.9+ cannot yet traverse the CFG.</span>
        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">():</span>
            <span class="s1">a </span><span class="s2">= (</span><span class="s5">1</span><span class="s2">,)</span>
            <span class="s1">b </span><span class="s2">= (</span><span class="s5">3</span><span class="s2">,</span><span class="s5">2</span><span class="s2">,  </span><span class="s5">4</span><span class="s2">)</span>
            <span class="s0">return </span><span class="s2">(*(</span><span class="s1">b </span><span class="s0">if </span><span class="s1">a</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] </span><span class="s0">else </span><span class="s2">(</span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">)),)</span>

        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">.</span><span class="s1">UnsupportedError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">foo</span><span class="s2">()</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;op_LIST_EXTEND at the start of a block&quot;</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s1">msg</span><span class="s2">, </span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_build_unpack_with_calls_in_unpack</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">check</span><span class="s2">(</span><span class="s1">p</span><span class="s2">):</span>
            <span class="s0">def </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">a</span><span class="s2">):</span>
                <span class="s1">z </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]</span>
                <span class="s0">return </span><span class="s2">(*</span><span class="s1">a</span><span class="s2">, </span><span class="s1">z</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s5">3</span><span class="s2">), </span><span class="s1">z</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">(</span><span class="s1">a</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s5">3</span><span class="s2">)), </span><span class="s1">z</span>

            <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">p</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">p</span><span class="s2">))</span>

        <span class="s1">check</span><span class="s2">((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_build_unpack_complicated</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">check</span><span class="s2">(</span><span class="s1">p</span><span class="s2">):</span>
            <span class="s0">def </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">a</span><span class="s2">):</span>
                <span class="s1">z </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]</span>
                <span class="s0">return </span><span class="s2">(*</span><span class="s1">a</span><span class="s2">, *(*</span><span class="s1">a</span><span class="s2">, </span><span class="s1">a</span><span class="s2">), *(</span><span class="s1">a</span><span class="s2">, (*(</span><span class="s1">a</span><span class="s2">, (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">), *(</span><span class="s5">3</span><span class="s2">,), *</span><span class="s1">a</span><span class="s2">),</span>
                        <span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, (</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">), *</span><span class="s1">a</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), (</span><span class="s5">1</span><span class="s2">,))),</span>
                        <span class="s2">*(</span><span class="s1">z</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s5">4</span><span class="s2">), </span><span class="s1">z</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">(</span><span class="s1">a</span><span class="s2">))), </span><span class="s1">z</span>

            <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">p</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">p</span><span class="s2">))</span>

        <span class="s1">check</span><span class="s2">((</span><span class="s5">10</span><span class="s2">, </span><span class="s5">20</span><span class="s2">))</span>


<span class="s0">if </span><span class="s1">__name__ </span><span class="s2">== </span><span class="s3">'__main__'</span><span class="s2">:</span>
    <span class="s1">unittest</span><span class="s2">.</span><span class="s1">main</span><span class="s2">()</span>
</pre>
</body>
</html>