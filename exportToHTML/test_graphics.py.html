<html>
<head>
<title>test_graphics.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #7a7e85;}
.s5 { color: #2aacb8;}
.s6 { color: #a5c261;}
.s7 { color: #6aab73;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_graphics.py</font>
</center></td></tr></table>
<pre><span class="s0">''' 
Graphics tests 
============== 
 
Testing the simple vertex instructions 
'''</span>

<span class="s2">import </span><span class="s1">sys</span>
<span class="s2">import </span><span class="s1">pytest</span>
<span class="s2">import </span><span class="s1">itertools</span>
<span class="s2">from </span><span class="s1">threading </span><span class="s2">import </span><span class="s1">Thread</span>
<span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">tests</span><span class="s3">.</span><span class="s1">common </span><span class="s2">import </span><span class="s1">GraphicUnitTest</span><span class="s3">, </span><span class="s1">requires_graphics</span>


<span class="s2">class </span><span class="s1">BoxShadowTest</span><span class="s3">(</span><span class="s1">GraphicUnitTest</span><span class="s3">):</span>

    <span class="s2">def </span><span class="s1">test_create</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">graphics</span><span class="s3">.</span><span class="s1">boxshadow </span><span class="s2">import </span><span class="s1">BoxShadow</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">uix</span><span class="s3">.</span><span class="s1">widget </span><span class="s2">import </span><span class="s1">Widget</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">graphics </span><span class="s2">import </span><span class="s1">Color</span>

        <span class="s1">r </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">render</span>

        <span class="s4"># with initial arguments</span>
        <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
            <span class="s1">Color</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">1</span><span class="s3">)</span>
            <span class="s1">bs </span><span class="s3">= </span><span class="s1">BoxShadow</span><span class="s3">(</span>
                <span class="s1">pos</span><span class="s3">=(</span><span class="s5">50</span><span class="s3">, </span><span class="s5">50</span><span class="s3">),</span>
                <span class="s1">size</span><span class="s3">=(</span><span class="s5">150</span><span class="s3">, </span><span class="s5">150</span><span class="s3">),</span>
                <span class="s1">offset</span><span class="s3">=(</span><span class="s5">0</span><span class="s3">, </span><span class="s5">10</span><span class="s3">),</span>
                <span class="s1">spread_radius</span><span class="s3">=(</span><span class="s5">10</span><span class="s3">, -</span><span class="s5">10</span><span class="s3">),</span>
                <span class="s1">border_radius</span><span class="s3">=(</span><span class="s5">10</span><span class="s3">, </span><span class="s5">10</span><span class="s3">, </span><span class="s5">10</span><span class="s3">, </span><span class="s5">10</span><span class="s3">),</span>
                <span class="s1">blur_radius</span><span class="s3">=</span><span class="s5">80</span><span class="s3">,</span>
            <span class="s3">)</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>

        <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
            <span class="s1">Color</span><span class="s3">(</span><span class="s5">0</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">1</span><span class="s3">)</span>
            <span class="s1">bs </span><span class="s3">= </span><span class="s1">BoxShadow</span><span class="s3">(</span>
                <span class="s1">inset</span><span class="s3">=</span><span class="s2">True</span><span class="s3">,</span>
                <span class="s1">pos</span><span class="s3">=(</span><span class="s5">50</span><span class="s3">, </span><span class="s5">50</span><span class="s3">),</span>
                <span class="s1">size</span><span class="s3">=(</span><span class="s5">150</span><span class="s3">, </span><span class="s5">150</span><span class="s3">),</span>
                <span class="s1">offset</span><span class="s3">=(</span><span class="s5">0</span><span class="s3">, </span><span class="s5">10</span><span class="s3">),</span>
                <span class="s1">spread_radius</span><span class="s3">=(</span><span class="s5">10</span><span class="s3">, -</span><span class="s5">10</span><span class="s3">),</span>
                <span class="s1">border_radius</span><span class="s3">=(</span><span class="s5">10</span><span class="s3">, </span><span class="s5">10</span><span class="s3">, </span><span class="s5">10</span><span class="s3">, </span><span class="s5">10</span><span class="s3">),</span>
                <span class="s1">blur_radius</span><span class="s3">=</span><span class="s5">80</span><span class="s3">,</span>
            <span class="s3">)</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>

        <span class="s4"># changing properties later</span>
        <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
            <span class="s1">Color</span><span class="s3">(</span><span class="s5">0</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">)</span>
            <span class="s1">bs </span><span class="s3">= </span><span class="s1">BoxShadow</span><span class="s3">()</span>
        <span class="s1">bs</span><span class="s3">.</span><span class="s1">inset </span><span class="s3">= </span><span class="s2">True</span>
        <span class="s1">bs</span><span class="s3">.</span><span class="s1">pos </span><span class="s3">= [</span><span class="s5">50</span><span class="s3">, </span><span class="s5">50</span><span class="s3">]</span>
        <span class="s1">bs</span><span class="s3">.</span><span class="s1">size </span><span class="s3">= [</span><span class="s5">150</span><span class="s3">, </span><span class="s5">150</span><span class="s3">]</span>
        <span class="s1">bs</span><span class="s3">.</span><span class="s1">offset </span><span class="s3">= [</span><span class="s5">0</span><span class="s3">, </span><span class="s5">10</span><span class="s3">]</span>
        <span class="s1">bs</span><span class="s3">.</span><span class="s1">spread_radius </span><span class="s3">= [</span><span class="s5">10</span><span class="s3">, -</span><span class="s5">10</span><span class="s3">]</span>
        <span class="s1">bs</span><span class="s3">.</span><span class="s1">border_radius </span><span class="s3">= [</span><span class="s5">10</span><span class="s3">, </span><span class="s5">10</span><span class="s3">, </span><span class="s5">10</span><span class="s3">, </span><span class="s5">10</span><span class="s3">]</span>
        <span class="s1">bs</span><span class="s3">.</span><span class="s1">blur_radius </span><span class="s3">= </span><span class="s5">40</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_adjusted_size</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">graphics</span><span class="s3">.</span><span class="s1">boxshadow </span><span class="s2">import </span><span class="s1">BoxShadow</span>

        <span class="s1">raw_size </span><span class="s3">= </span><span class="s5">150</span><span class="s3">, </span><span class="s5">150</span>

        <span class="s1">bs </span><span class="s3">= </span><span class="s1">BoxShadow</span><span class="s3">()</span>
        <span class="s1">bs</span><span class="s3">.</span><span class="s1">pos </span><span class="s3">= </span><span class="s5">50</span><span class="s3">, </span><span class="s5">50</span>
        <span class="s1">bs</span><span class="s3">.</span><span class="s1">size </span><span class="s3">= </span><span class="s1">raw_size</span>
        <span class="s1">bs</span><span class="s3">.</span><span class="s1">blur_radius </span><span class="s3">= </span><span class="s5">80</span>
        <span class="s1">bs</span><span class="s3">.</span><span class="s1">spread_radius </span><span class="s3">= -</span><span class="s5">10</span><span class="s3">, </span><span class="s5">10</span>

        <span class="s4"># The size of the rectangle containing the FBO texture (shadow) needs</span>
        <span class="s4"># to be adjusted according to the size of the shadow, otherwise there</span>
        <span class="s4"># will be an unwanted cropping behavior.</span>
        <span class="s1">adjusted_size </span><span class="s3">= (</span>
            <span class="s1">max</span><span class="s3">(</span>
                <span class="s5">0</span><span class="s3">,</span>
                <span class="s1">raw_size</span><span class="s3">[</span><span class="s5">0</span><span class="s3">] + </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">blur_radius </span><span class="s3">* </span><span class="s5">3 </span><span class="s3">+ </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">spread_radius</span><span class="s3">[</span><span class="s5">0</span><span class="s3">] * </span><span class="s5">2</span><span class="s3">,</span>
            <span class="s3">),</span>
            <span class="s1">max</span><span class="s3">(</span>
                <span class="s5">0</span><span class="s3">,</span>
                <span class="s1">raw_size</span><span class="s3">[</span><span class="s5">1</span><span class="s3">] + </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">blur_radius </span><span class="s3">* </span><span class="s5">3 </span><span class="s3">+ </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">spread_radius</span><span class="s3">[</span><span class="s5">1</span><span class="s3">] * </span><span class="s5">2</span><span class="s3">,</span>
            <span class="s3">),</span>
        <span class="s3">)</span>

        <span class="s2">assert </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">size </span><span class="s3">== </span><span class="s1">adjusted_size</span>

        <span class="s4"># Now we will turn on the inset mode, it is expected that</span>
        <span class="s4"># there will be no size adjustments.</span>
        <span class="s1">bs</span><span class="s3">.</span><span class="s1">inset </span><span class="s3">= </span><span class="s2">True</span>
        <span class="s2">assert </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">size </span><span class="s3">== </span><span class="s1">raw_size</span>

        <span class="s4"># Now turning off, and reverting back to the default mode.</span>
        <span class="s1">bs</span><span class="s3">.</span><span class="s1">inset </span><span class="s3">= </span><span class="s2">False</span>
        <span class="s2">assert </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">size </span><span class="s3">== </span><span class="s1">adjusted_size</span>

        <span class="s4"># Testing with initial arguments</span>
        <span class="s1">bs </span><span class="s3">= </span><span class="s1">BoxShadow</span><span class="s3">(</span>
            <span class="s1">inset</span><span class="s3">=</span><span class="s2">True</span><span class="s3">,</span>
            <span class="s1">pos</span><span class="s3">=(</span><span class="s5">50</span><span class="s3">, </span><span class="s5">50</span><span class="s3">),</span>
            <span class="s1">size</span><span class="s3">=</span><span class="s1">raw_size</span><span class="s3">,</span>
            <span class="s1">blur_radius</span><span class="s3">=</span><span class="s5">80</span><span class="s3">,</span>
            <span class="s1">spread_radius</span><span class="s3">=(</span><span class="s5">10</span><span class="s3">, -</span><span class="s5">10</span><span class="s3">)</span>
        <span class="s3">)</span>
        <span class="s1">adjusted_size </span><span class="s3">= (</span>
            <span class="s1">max</span><span class="s3">(</span>
                <span class="s5">0</span><span class="s3">,</span>
                <span class="s1">raw_size</span><span class="s3">[</span><span class="s5">0</span><span class="s3">] + </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">blur_radius </span><span class="s3">* </span><span class="s5">3 </span><span class="s3">+ </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">spread_radius</span><span class="s3">[</span><span class="s5">0</span><span class="s3">] * </span><span class="s5">2</span><span class="s3">,</span>
            <span class="s3">),</span>
            <span class="s1">max</span><span class="s3">(</span>
                <span class="s5">0</span><span class="s3">,</span>
                <span class="s1">raw_size</span><span class="s3">[</span><span class="s5">1</span><span class="s3">] + </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">blur_radius </span><span class="s3">* </span><span class="s5">3 </span><span class="s3">+ </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">spread_radius</span><span class="s3">[</span><span class="s5">1</span><span class="s3">] * </span><span class="s5">2</span><span class="s3">,</span>
            <span class="s3">),</span>
        <span class="s3">)</span>

        <span class="s2">assert </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">size </span><span class="s3">== </span><span class="s1">raw_size</span>

        <span class="s4"># Now turning off, and reverting back to the default mode.</span>
        <span class="s1">bs</span><span class="s3">.</span><span class="s1">inset </span><span class="s3">= </span><span class="s2">False</span>
        <span class="s2">assert </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">size </span><span class="s3">== </span><span class="s1">adjusted_size</span>

        <span class="s4"># Now we will turn on the inset mode, it is expected that</span>
        <span class="s4"># there will be no size adjustments.</span>
        <span class="s1">bs</span><span class="s3">.</span><span class="s1">inset </span><span class="s3">= </span><span class="s2">True</span>
        <span class="s2">assert </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">size </span><span class="s3">== </span><span class="s1">raw_size</span>

    <span class="s2">def </span><span class="s1">test_adjusted_pos</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">graphics</span><span class="s3">.</span><span class="s1">boxshadow </span><span class="s2">import </span><span class="s1">BoxShadow</span>

        <span class="s1">raw_pos </span><span class="s3">= </span><span class="s5">50</span><span class="s3">, </span><span class="s5">50</span>
        <span class="s1">raw_size </span><span class="s3">= </span><span class="s5">150</span><span class="s3">, </span><span class="s5">150</span>
        <span class="s1">offset </span><span class="s3">= </span><span class="s5">10</span><span class="s3">, -</span><span class="s5">100</span>

        <span class="s1">bs </span><span class="s3">= </span><span class="s1">BoxShadow</span><span class="s3">()</span>
        <span class="s1">bs</span><span class="s3">.</span><span class="s1">pos </span><span class="s3">= </span><span class="s1">raw_pos</span>
        <span class="s1">bs</span><span class="s3">.</span><span class="s1">size </span><span class="s3">= </span><span class="s1">raw_size</span>
        <span class="s1">bs</span><span class="s3">.</span><span class="s1">offset </span><span class="s3">= </span><span class="s1">offset</span>
        <span class="s1">bs</span><span class="s3">.</span><span class="s1">blur_radius </span><span class="s3">= </span><span class="s5">80</span>
        <span class="s1">bs</span><span class="s3">.</span><span class="s1">spread_radius </span><span class="s3">= -</span><span class="s5">10</span><span class="s3">, </span><span class="s5">10</span>

        <span class="s4"># If the size of the rectangle containing the FBO texture (shadow)</span>
        <span class="s4"># changes, its position will need to be adjusted.</span>
        <span class="s1">adjusted_pos </span><span class="s3">= (</span>
            <span class="s1">raw_pos</span><span class="s3">[</span><span class="s5">0</span><span class="s3">]</span>
            <span class="s3">- </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">blur_radius </span><span class="s3">* </span><span class="s5">1.5</span>
            <span class="s3">- </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">spread_radius</span><span class="s3">[</span><span class="s5">0</span><span class="s3">]</span>
            <span class="s3">+ </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">offset</span><span class="s3">[</span><span class="s5">0</span><span class="s3">],</span>
            <span class="s1">raw_pos</span><span class="s3">[</span><span class="s5">0</span><span class="s3">]</span>
            <span class="s3">- </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">blur_radius </span><span class="s3">* </span><span class="s5">1.5</span>
            <span class="s3">- </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">spread_radius</span><span class="s3">[</span><span class="s5">1</span><span class="s3">]</span>
            <span class="s3">+ </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">offset</span><span class="s3">[</span><span class="s5">1</span><span class="s3">],</span>
        <span class="s3">)</span>

        <span class="s2">assert </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">pos </span><span class="s3">== </span><span class="s1">adjusted_pos</span>

        <span class="s4"># Now we will turn on the inset mode, it is expected that</span>
        <span class="s4"># there will be no position adjustments.</span>
        <span class="s1">bs</span><span class="s3">.</span><span class="s1">inset </span><span class="s3">= </span><span class="s2">True</span>
        <span class="s2">assert </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">pos </span><span class="s3">== </span><span class="s1">raw_pos</span>

        <span class="s4"># Now turning off, and reverting back to the default mode.</span>
        <span class="s1">bs</span><span class="s3">.</span><span class="s1">inset </span><span class="s3">= </span><span class="s2">False</span>
        <span class="s2">assert </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">pos </span><span class="s3">== </span><span class="s1">adjusted_pos</span>

        <span class="s4"># Testing with initial arguments</span>
        <span class="s1">bs </span><span class="s3">= </span><span class="s1">BoxShadow</span><span class="s3">(</span>
            <span class="s1">inset</span><span class="s3">=</span><span class="s2">True</span><span class="s3">,</span>
            <span class="s1">pos</span><span class="s3">=</span><span class="s1">raw_pos</span><span class="s3">,</span>
            <span class="s1">size</span><span class="s3">=</span><span class="s1">raw_size</span><span class="s3">,</span>
            <span class="s1">offset</span><span class="s3">=</span><span class="s1">offset</span><span class="s3">,</span>
            <span class="s1">blur_radius</span><span class="s3">=</span><span class="s5">80</span><span class="s3">,</span>
            <span class="s1">spread_radius</span><span class="s3">=(</span><span class="s5">10</span><span class="s3">, -</span><span class="s5">10</span><span class="s3">)</span>
        <span class="s3">)</span>
        <span class="s1">adjusted_pos </span><span class="s3">= (</span>
            <span class="s1">raw_pos</span><span class="s3">[</span><span class="s5">0</span><span class="s3">]</span>
            <span class="s3">- </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">blur_radius </span><span class="s3">* </span><span class="s5">1.5</span>
            <span class="s3">- </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">spread_radius</span><span class="s3">[</span><span class="s5">0</span><span class="s3">]</span>
            <span class="s3">+ </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">offset</span><span class="s3">[</span><span class="s5">0</span><span class="s3">],</span>
            <span class="s1">raw_pos</span><span class="s3">[</span><span class="s5">0</span><span class="s3">]</span>
            <span class="s3">- </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">blur_radius </span><span class="s3">* </span><span class="s5">1.5</span>
            <span class="s3">- </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">spread_radius</span><span class="s3">[</span><span class="s5">1</span><span class="s3">]</span>
            <span class="s3">+ </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">offset</span><span class="s3">[</span><span class="s5">1</span><span class="s3">],</span>
        <span class="s3">)</span>

        <span class="s2">assert </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">pos </span><span class="s3">== </span><span class="s1">raw_pos</span>

        <span class="s4"># Now turning off, and reverting back to the default mode.</span>
        <span class="s1">bs</span><span class="s3">.</span><span class="s1">inset </span><span class="s3">= </span><span class="s2">False</span>
        <span class="s2">assert </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">pos </span><span class="s3">== </span><span class="s1">adjusted_pos</span>

        <span class="s4"># Now we will turn on the inset mode, it is expected that</span>
        <span class="s4"># there will be no position adjustments.</span>
        <span class="s1">bs</span><span class="s3">.</span><span class="s1">inset </span><span class="s3">= </span><span class="s2">True</span>
        <span class="s2">assert </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">pos </span><span class="s3">== </span><span class="s1">raw_pos</span>

    <span class="s2">def </span><span class="s1">test_bounded_properties</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">graphics</span><span class="s3">.</span><span class="s1">boxshadow </span><span class="s2">import </span><span class="s1">BoxShadow</span>

        <span class="s1">bs </span><span class="s3">= </span><span class="s1">BoxShadow</span><span class="s3">()</span>
        <span class="s1">bs</span><span class="s3">.</span><span class="s1">pos </span><span class="s3">= </span><span class="s5">50</span><span class="s3">, </span><span class="s5">50</span>
        <span class="s1">bs</span><span class="s3">.</span><span class="s1">size </span><span class="s3">= </span><span class="s5">150</span><span class="s3">, </span><span class="s5">150</span>
        <span class="s1">bs</span><span class="s3">.</span><span class="s1">offset </span><span class="s3">= </span><span class="s5">10</span><span class="s3">, -</span><span class="s5">100</span>
        <span class="s1">bs</span><span class="s3">.</span><span class="s1">blur_radius </span><span class="s3">= -</span><span class="s5">80</span>
        <span class="s1">bs</span><span class="s3">.</span><span class="s1">spread_radius </span><span class="s3">= -</span><span class="s5">200</span><span class="s3">, -</span><span class="s5">100</span>
        <span class="s1">bs</span><span class="s3">.</span><span class="s1">border_radius </span><span class="s3">= </span><span class="s5">0</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">0</span>

        <span class="s2">assert </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">size </span><span class="s3">== (</span><span class="s5">0</span><span class="s3">, </span><span class="s5">0</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">blur_radius </span><span class="s3">== </span><span class="s5">0</span>

        <span class="s4"># There is a bug in RoundedRectangle that distorts the texture if the</span>
        <span class="s4"># radius value is less than 1. Otherwise, it could be 0.</span>
        <span class="s2">assert </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">border_radius </span><span class="s3">== </span><span class="s1">tuple</span><span class="s3">(</span>
            <span class="s1">map</span><span class="s3">(</span>
                <span class="s2">lambda </span><span class="s1">value</span><span class="s3">: </span><span class="s1">max</span><span class="s3">(</span><span class="s5">1.0</span><span class="s3">, </span><span class="s1">min</span><span class="s3">(</span><span class="s1">value</span><span class="s3">, </span><span class="s1">min</span><span class="s3">(</span><span class="s1">bs</span><span class="s3">.</span><span class="s1">size</span><span class="s3">) / </span><span class="s5">2</span><span class="s3">)),</span>
                <span class="s1">bs</span><span class="s3">.</span><span class="s1">border_radius</span><span class="s3">,</span>
            <span class="s3">)</span>
        <span class="s3">)</span>

        <span class="s4"># Testing with initial arguments</span>
        <span class="s1">bs </span><span class="s3">= </span><span class="s1">BoxShadow</span><span class="s3">(</span>
            <span class="s1">pos</span><span class="s3">=(</span><span class="s5">50</span><span class="s3">, </span><span class="s5">50</span><span class="s3">),</span>
            <span class="s1">size</span><span class="s3">=(</span><span class="s5">150</span><span class="s3">, </span><span class="s5">150</span><span class="s3">),</span>
            <span class="s1">offset</span><span class="s3">=(</span><span class="s5">10</span><span class="s3">, -</span><span class="s5">100</span><span class="s3">),</span>
            <span class="s1">blur_radius</span><span class="s3">=-</span><span class="s5">80</span><span class="s3">,</span>
            <span class="s1">spread_radius</span><span class="s3">=(-</span><span class="s5">200</span><span class="s3">, -</span><span class="s5">100</span><span class="s3">),</span>
            <span class="s1">border_radius</span><span class="s3">=(</span><span class="s5">0</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">0</span><span class="s3">),</span>
        <span class="s3">)</span>

        <span class="s2">assert </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">size </span><span class="s3">== (</span><span class="s5">0</span><span class="s3">, </span><span class="s5">0</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">blur_radius </span><span class="s3">== </span><span class="s5">0</span>
        <span class="s2">assert </span><span class="s1">bs</span><span class="s3">.</span><span class="s1">border_radius </span><span class="s3">== </span><span class="s1">tuple</span><span class="s3">(</span>
            <span class="s1">map</span><span class="s3">(</span>
                <span class="s2">lambda </span><span class="s1">value</span><span class="s3">: </span><span class="s1">max</span><span class="s3">(</span><span class="s5">1.0</span><span class="s3">, </span><span class="s1">min</span><span class="s3">(</span><span class="s1">value</span><span class="s3">, </span><span class="s1">min</span><span class="s3">(</span><span class="s1">bs</span><span class="s3">.</span><span class="s1">size</span><span class="s3">) / </span><span class="s5">2</span><span class="s3">)),</span>
                <span class="s1">bs</span><span class="s3">.</span><span class="s1">border_radius</span><span class="s3">,</span>
            <span class="s3">)</span>
        <span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_canvas_management</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">graphics</span><span class="s3">.</span><span class="s1">boxshadow </span><span class="s2">import </span><span class="s1">BoxShadow</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">uix</span><span class="s3">.</span><span class="s1">widget </span><span class="s2">import </span><span class="s1">Widget</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">graphics </span><span class="s2">import </span><span class="s1">Color</span>

        <span class="s1">r </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">render</span>

        <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
            <span class="s1">bs </span><span class="s3">= </span><span class="s1">BoxShadow</span><span class="s3">()</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">bs </span><span class="s2">in </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">.</span><span class="s1">children</span>

        <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
        <span class="s1">bs </span><span class="s3">= </span><span class="s1">BoxShadow</span><span class="s3">()</span>
        <span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">Color</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">1</span><span class="s3">))</span>
        <span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">bs</span><span class="s3">)</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">bs </span><span class="s2">in </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">.</span><span class="s1">children</span>

        <span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">.</span><span class="s1">remove</span><span class="s3">(</span><span class="s1">bs</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">bs </span><span class="s2">not in </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">.</span><span class="s1">children</span>

        <span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">.</span><span class="s1">insert</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s1">bs</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">bs </span><span class="s2">in </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">.</span><span class="s1">children</span>
        <span class="s2">assert </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">.</span><span class="s1">children</span><span class="s3">.</span><span class="s1">index</span><span class="s3">(</span><span class="s1">bs</span><span class="s3">) == </span><span class="s5">1</span>


<span class="s2">class </span><span class="s1">VertexInstructionTest</span><span class="s3">(</span><span class="s1">GraphicUnitTest</span><span class="s3">):</span>

    <span class="s2">def </span><span class="s1">test_circle</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">uix</span><span class="s3">.</span><span class="s1">widget </span><span class="s2">import </span><span class="s1">Widget</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">graphics </span><span class="s2">import </span><span class="s1">Ellipse</span><span class="s3">, </span><span class="s1">Color</span>

        <span class="s1">r </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">render</span>

        <span class="s4"># basic circle</span>
        <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
            <span class="s1">Color</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">)</span>
            <span class="s1">Ellipse</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">=(</span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">), </span><span class="s1">size</span><span class="s3">=(</span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">))</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>

        <span class="s4"># reduced circle</span>
        <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
            <span class="s1">Color</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">)</span>
            <span class="s1">Ellipse</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">=(</span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">), </span><span class="s1">size</span><span class="s3">=(</span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">), </span><span class="s1">segments</span><span class="s3">=</span><span class="s5">10</span><span class="s3">)</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>

        <span class="s4"># moving circle</span>
        <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
            <span class="s1">Color</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">e </span><span class="s3">= </span><span class="s1">Ellipse</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">=(</span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">), </span><span class="s1">size</span><span class="s3">=(</span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">))</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">e</span><span class="s3">.</span><span class="s1">pos </span><span class="s3">= (</span><span class="s5">10</span><span class="s3">, </span><span class="s5">10</span><span class="s3">)</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_ellipse</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">uix</span><span class="s3">.</span><span class="s1">widget </span><span class="s2">import </span><span class="s1">Widget</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">graphics </span><span class="s2">import </span><span class="s1">Ellipse</span><span class="s3">, </span><span class="s1">Color</span>

        <span class="s1">r </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">render</span>

        <span class="s4"># ellipse</span>
        <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
            <span class="s1">Color</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">e </span><span class="s3">= </span><span class="s1">Ellipse</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">=(</span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">), </span><span class="s1">size</span><span class="s3">=(</span><span class="s5">200</span><span class="s3">, </span><span class="s5">100</span><span class="s3">))</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_point</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">uix</span><span class="s3">.</span><span class="s1">widget </span><span class="s2">import </span><span class="s1">Widget</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">graphics </span><span class="s2">import </span><span class="s1">Point</span><span class="s3">, </span><span class="s1">Color</span>

        <span class="s1">r </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">render</span>

        <span class="s4"># 1 point</span>
        <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
            <span class="s1">Color</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">)</span>
            <span class="s1">Point</span><span class="s3">(</span><span class="s1">points</span><span class="s3">=(</span><span class="s5">10</span><span class="s3">, </span><span class="s5">10</span><span class="s3">))</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>

        <span class="s4"># 25 points</span>
        <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
            <span class="s1">Color</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">)</span>
            <span class="s1">Point</span><span class="s3">(</span><span class="s1">points</span><span class="s3">=[</span><span class="s1">x </span><span class="s3">* </span><span class="s5">5 </span><span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s5">50</span><span class="s3">)])</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_point_add</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">uix</span><span class="s3">.</span><span class="s1">widget </span><span class="s2">import </span><span class="s1">Widget</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">graphics </span><span class="s2">import </span><span class="s1">Point</span><span class="s3">, </span><span class="s1">Color</span>

        <span class="s1">r </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">render</span>

        <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
            <span class="s1">Color</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">)</span>
            <span class="s1">p </span><span class="s3">= </span><span class="s1">Point</span><span class="s3">(</span><span class="s1">pointsize</span><span class="s3">=</span><span class="s5">10</span><span class="s3">)</span>

        <span class="s1">p</span><span class="s3">.</span><span class="s1">add_point</span><span class="s3">(</span><span class="s5">10</span><span class="s3">, </span><span class="s5">10</span><span class="s3">)</span>
        <span class="s1">p</span><span class="s3">.</span><span class="s1">add_point</span><span class="s3">(</span><span class="s5">90</span><span class="s3">, </span><span class="s5">10</span><span class="s3">)</span>
        <span class="s1">p</span><span class="s3">.</span><span class="s1">add_point</span><span class="s3">(</span><span class="s5">10</span><span class="s3">, </span><span class="s5">90</span><span class="s3">)</span>
        <span class="s1">p</span><span class="s3">.</span><span class="s1">add_point</span><span class="s3">(</span><span class="s5">50</span><span class="s3">, </span><span class="s5">50</span><span class="s3">)</span>
        <span class="s1">p</span><span class="s3">.</span><span class="s1">add_point</span><span class="s3">(</span><span class="s5">10</span><span class="s3">, </span><span class="s5">50</span><span class="s3">)</span>
        <span class="s1">p</span><span class="s3">.</span><span class="s1">add_point</span><span class="s3">(</span><span class="s5">50</span><span class="s3">, </span><span class="s5">10</span><span class="s3">)</span>

        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_line_rounded_rectangle</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">uix</span><span class="s3">.</span><span class="s1">widget </span><span class="s2">import </span><span class="s1">Widget</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">graphics </span><span class="s2">import </span><span class="s1">Line</span><span class="s3">, </span><span class="s1">Color</span>
        <span class="s1">r </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">render</span>

        <span class="s4"># basic rounded_rectangle</span>
        <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
            <span class="s1">Color</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">)</span>
            <span class="s1">line </span><span class="s3">= </span><span class="s1">Line</span><span class="s3">(</span>
                <span class="s1">rounded_rectangle</span><span class="s3">=(</span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">10</span><span class="s3">, </span><span class="s5">20</span><span class="s3">, </span><span class="s5">30</span><span class="s3">, </span><span class="s5">40</span><span class="s3">, </span><span class="s5">100</span><span class="s3">)</span>
            <span class="s3">)</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">line</span><span class="s3">.</span><span class="s1">rounded_rectangle </span><span class="s3">== (</span>
            <span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">10</span><span class="s3">, </span><span class="s5">20</span><span class="s3">, </span><span class="s5">30</span><span class="s3">, </span><span class="s5">40</span><span class="s3">, </span><span class="s5">100</span>
        <span class="s3">)</span>

        <span class="s4"># The largest angle allowed is equal to the smallest dimension (width</span>
        <span class="s4"># or height) minus the largest angle value between the anterior angle</span>
        <span class="s4"># and the posterior angle.</span>
        <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
            <span class="s1">Color</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">)</span>
            <span class="s1">line </span><span class="s3">= </span><span class="s1">Line</span><span class="s3">(</span>
                <span class="s1">rounded_rectangle</span><span class="s3">=(</span>
                    <span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">20</span><span class="s3">, </span><span class="s5">10</span><span class="s3">, </span><span class="s5">30</span><span class="s3">, </span><span class="s5">100</span>
                <span class="s3">)</span>
            <span class="s3">)</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">line</span><span class="s3">.</span><span class="s1">rounded_rectangle </span><span class="s3">== (</span>
            <span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">70</span><span class="s3">, </span><span class="s5">20</span><span class="s3">, </span><span class="s5">10</span><span class="s3">, </span><span class="s5">30</span><span class="s3">, </span><span class="s5">100</span>
        <span class="s3">)</span>

        <span class="s4"># Same approach as above</span>
        <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
            <span class="s1">Color</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">)</span>
            <span class="s1">line </span><span class="s3">= </span><span class="s1">Line</span><span class="s3">(</span>
                <span class="s1">rounded_rectangle</span><span class="s3">=(</span>
                    <span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">25</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">50</span><span class="s3">, </span><span class="s5">100</span>
                <span class="s3">)</span>
            <span class="s3">)</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">line</span><span class="s3">.</span><span class="s1">rounded_rectangle </span><span class="s3">== (</span>
            <span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">50</span><span class="s3">, </span><span class="s5">25</span><span class="s3">, </span><span class="s5">50</span><span class="s3">, </span><span class="s5">50</span><span class="s3">, </span><span class="s5">100</span>
        <span class="s3">)</span>

        <span class="s4"># A circle should be generated if width and height are equal, and all</span>
        <span class="s4"># angles passed are greater than or equal to the smallest dimension.</span>
        <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
            <span class="s1">Color</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">)</span>
            <span class="s1">line </span><span class="s3">= </span><span class="s1">Line</span><span class="s3">(</span>
                <span class="s1">rounded_rectangle</span><span class="s3">=(</span>
                    <span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">150</span><span class="s3">, </span><span class="s5">50</span><span class="s3">, </span><span class="s5">50.001</span><span class="s3">, </span><span class="s5">51</span><span class="s3">, </span><span class="s5">100</span>
                <span class="s3">)</span>
            <span class="s3">)</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">line</span><span class="s3">.</span><span class="s1">rounded_rectangle </span><span class="s3">== (</span>
            <span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">50</span><span class="s3">, </span><span class="s5">50</span><span class="s3">, </span><span class="s5">50</span><span class="s3">, </span><span class="s5">50</span><span class="s3">, </span><span class="s5">100</span>
        <span class="s3">)</span>

        <span class="s4"># Currently the minimum radius should be 1, to avoid rendering issues</span>
        <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
            <span class="s1">Color</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">)</span>
            <span class="s1">line </span><span class="s3">= </span><span class="s1">Line</span><span class="s3">(</span>
                <span class="s1">rounded_rectangle</span><span class="s3">=(</span>
                    <span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">100</span>
                <span class="s3">)</span>
            <span class="s3">)</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">line</span><span class="s3">.</span><span class="s1">rounded_rectangle </span><span class="s3">== (</span>
            <span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">100</span>
        <span class="s3">)</span>

        <span class="s4"># Angles adjustment + avoid issue if radius is less than 1</span>
        <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
            <span class="s1">Color</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">)</span>
            <span class="s1">line </span><span class="s3">= </span><span class="s1">Line</span><span class="s3">(</span>
                <span class="s1">rounded_rectangle</span><span class="s3">=(</span>
                    <span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">100</span>
                <span class="s3">)</span>
            <span class="s3">)</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">line</span><span class="s3">.</span><span class="s1">rounded_rectangle </span><span class="s3">== (</span>
            <span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">99</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">100</span>
        <span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_smoothline_rounded_rectangle</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">uix</span><span class="s3">.</span><span class="s1">widget </span><span class="s2">import </span><span class="s1">Widget</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">graphics </span><span class="s2">import </span><span class="s1">SmoothLine</span><span class="s3">, </span><span class="s1">Color</span>
        <span class="s1">r </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">render</span>

        <span class="s4"># If width and/or height &lt; 2px, the figure should not be rendered.</span>
        <span class="s4"># This avoids some known SmoothLine rendering issues.</span>
        <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
            <span class="s1">Color</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">)</span>
            <span class="s1">line </span><span class="s3">= </span><span class="s1">SmoothLine</span><span class="s3">(</span>
                <span class="s1">rounded_rectangle</span><span class="s3">=(</span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">0.5</span><span class="s3">, </span><span class="s5">1.99</span><span class="s3">, </span><span class="s5">30</span><span class="s3">, </span><span class="s5">30</span><span class="s3">, </span><span class="s5">30</span><span class="s3">, </span><span class="s5">30</span><span class="s3">, </span><span class="s5">100</span><span class="s3">)</span>
            <span class="s3">)</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">line</span><span class="s3">.</span><span class="s1">rounded_rectangle </span><span class="s2">is None</span>

    <span class="s2">def </span><span class="s1">test_enlarged_line</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">uix</span><span class="s3">.</span><span class="s1">widget </span><span class="s2">import </span><span class="s1">Widget</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">graphics </span><span class="s2">import </span><span class="s1">Line</span><span class="s3">, </span><span class="s1">Color</span><span class="s3">, </span><span class="s1">PushMatrix</span><span class="s3">, </span><span class="s1">PopMatrix</span><span class="s3">, </span><span class="s1">Scale</span><span class="s3">, </span><span class="s1">\</span>
            <span class="s1">Translate</span>
        <span class="s1">r </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">render</span>
        <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
            <span class="s1">Color</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">)</span>

            <span class="s4"># Normal line with width 1</span>
            <span class="s1">Line</span><span class="s3">(</span>
                <span class="s1">points</span><span class="s3">=(</span><span class="s5">10</span><span class="s3">, </span><span class="s5">10</span><span class="s3">, </span><span class="s5">10</span><span class="s3">, </span><span class="s5">90</span><span class="s3">),</span>
                <span class="s1">width</span><span class="s3">=</span><span class="s5">1</span>
            <span class="s3">)</span>

            <span class="s4"># Normal line with width 3</span>
            <span class="s1">Line</span><span class="s3">(</span>
                <span class="s1">points</span><span class="s3">=(</span><span class="s5">20</span><span class="s3">, </span><span class="s5">10</span><span class="s3">, </span><span class="s5">20</span><span class="s3">, </span><span class="s5">90</span><span class="s3">),</span>
                <span class="s1">width</span><span class="s3">=</span><span class="s5">3</span>
            <span class="s3">)</span>

            <span class="s4"># Enlarged line that should look width 3</span>
            <span class="s1">PushMatrix</span><span class="s3">()</span>
            <span class="s1">Translate</span><span class="s3">(</span><span class="s5">30</span><span class="s3">, </span><span class="s5">10</span><span class="s3">, </span><span class="s5">1</span><span class="s3">)  </span><span class="s4"># So the enlargement goes around 0, 0, 0</span>
            <span class="s1">Scale</span><span class="s3">(</span><span class="s5">3</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">)  </span><span class="s4"># X scaled by 3 so the line width should become 3</span>
            <span class="s1">Line</span><span class="s3">(</span>
                <span class="s1">points</span><span class="s3">=(</span><span class="s5">0</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">80</span><span class="s3">),</span>
                <span class="s1">width</span><span class="s3">=</span><span class="s5">1</span><span class="s3">,</span>
                <span class="s1">force_custom_drawing_method</span><span class="s3">=</span><span class="s2">True</span>
            <span class="s3">)</span>
            <span class="s1">PopMatrix</span><span class="s3">()</span>

        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">SmoothVertexInstructionTest</span><span class="s3">(</span><span class="s1">GraphicUnitTest</span><span class="s3">):</span>

    <span class="s4"># Code defined in the points setter of AntiAliasingLine class.</span>
    <span class="s2">def </span><span class="s1">_convert_points</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">points</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s1">points </span><span class="s2">and </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">points</span><span class="s3">[</span><span class="s5">0</span><span class="s3">], (</span><span class="s1">list</span><span class="s3">, </span><span class="s1">tuple</span><span class="s3">)):</span>
            <span class="s2">return </span><span class="s1">list</span><span class="s3">(</span><span class="s1">itertools</span><span class="s3">.</span><span class="s1">chain</span><span class="s3">(*</span><span class="s1">points</span><span class="s3">))</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s1">list</span><span class="s3">(</span><span class="s1">points</span><span class="s3">)</span>

    <span class="s4"># The same function present in the AntiAliasingLine code,</span>
    <span class="s4"># externalized for testing.</span>
    <span class="s2">def </span><span class="s1">_filtered_points</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">points</span><span class="s3">):</span>
        <span class="s1">index </span><span class="s3">= </span><span class="s5">0</span>
        <span class="s1">p </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_convert_points</span><span class="s3">(</span><span class="s1">points</span><span class="s3">)</span>

        <span class="s4"># At least 3 points are required, otherwise we will return an empty</span>
        <span class="s4"># list, which means there are no valid points.</span>
        <span class="s2">if </span><span class="s1">len</span><span class="s3">(</span><span class="s1">p</span><span class="s3">) &lt; </span><span class="s5">6</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s3">[]</span>

        <span class="s2">while </span><span class="s1">index </span><span class="s3">&lt; </span><span class="s1">len</span><span class="s3">(</span><span class="s1">p</span><span class="s3">) - </span><span class="s5">2</span><span class="s3">:</span>
            <span class="s1">x1</span><span class="s3">, </span><span class="s1">y1 </span><span class="s3">= </span><span class="s1">p</span><span class="s3">[</span><span class="s1">index</span><span class="s3">], </span><span class="s1">p</span><span class="s3">[</span><span class="s1">index </span><span class="s3">+ </span><span class="s5">1</span><span class="s3">]</span>
            <span class="s1">x2</span><span class="s3">, </span><span class="s1">y2 </span><span class="s3">= </span><span class="s1">p</span><span class="s3">[</span><span class="s1">index </span><span class="s3">+ </span><span class="s5">2</span><span class="s3">], </span><span class="s1">p</span><span class="s3">[</span><span class="s1">index </span><span class="s3">+ </span><span class="s5">3</span><span class="s3">]</span>
            <span class="s2">if </span><span class="s1">abs</span><span class="s3">(</span><span class="s1">x2 </span><span class="s3">- </span><span class="s1">x1</span><span class="s3">) &lt; </span><span class="s5">1.0 </span><span class="s2">and </span><span class="s1">abs</span><span class="s3">(</span><span class="s1">y2 </span><span class="s3">- </span><span class="s1">y1</span><span class="s3">) &lt; </span><span class="s5">1.0</span><span class="s3">:</span>
                <span class="s2">del </span><span class="s1">p</span><span class="s3">[</span><span class="s1">index </span><span class="s3">+ </span><span class="s5">2</span><span class="s3">: </span><span class="s1">index </span><span class="s3">+ </span><span class="s5">4</span><span class="s3">]</span>
            <span class="s2">else</span><span class="s3">:</span>
                <span class="s1">index </span><span class="s3">+= </span><span class="s5">2</span>
        <span class="s2">if </span><span class="s1">abs</span><span class="s3">(</span><span class="s1">p</span><span class="s3">[</span><span class="s5">0</span><span class="s3">] - </span><span class="s1">p</span><span class="s3">[-</span><span class="s5">2</span><span class="s3">]) &lt; </span><span class="s5">1.0 </span><span class="s2">and </span><span class="s1">abs</span><span class="s3">(</span><span class="s1">p</span><span class="s3">[</span><span class="s5">1</span><span class="s3">] - </span><span class="s1">p</span><span class="s3">[-</span><span class="s5">1</span><span class="s3">]) &lt; </span><span class="s5">1.0</span><span class="s3">:</span>
            <span class="s2">del </span><span class="s1">p</span><span class="s3">[:</span><span class="s5">2</span><span class="s3">]</span>
        <span class="s2">return </span><span class="s1">p</span>

    <span class="s2">def </span><span class="s1">_get_texture</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">graphics</span><span class="s3">.</span><span class="s1">texture </span><span class="s2">import </span><span class="s1">Texture</span>
        <span class="s2">return </span><span class="s1">Texture</span><span class="s3">.</span><span class="s1">create</span><span class="s3">()</span>

    <span class="s2">def </span><span class="s1">test_antialiasing_line</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">uix</span><span class="s3">.</span><span class="s1">widget </span><span class="s2">import </span><span class="s1">Widget</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">graphics </span><span class="s2">import </span><span class="s1">Color</span><span class="s3">, </span><span class="s1">Rectangle</span><span class="s3">, </span><span class="s1">Instruction</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">graphics</span><span class="s3">.</span><span class="s1">vertex_instructions </span><span class="s2">import </span><span class="s1">AntiAliasingLine</span>

        <span class="s1">r </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">render</span>

        <span class="s4"># We expect a type error to be thrown if stencil_mask is not an object</span>
        <span class="s4"># of type Instruction.</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">):</span>
            <span class="s1">AntiAliasingLine</span><span class="s3">(</span><span class="s2">None</span><span class="s3">, </span><span class="s1">points</span><span class="s3">=[</span><span class="s5">10</span><span class="s3">, </span><span class="s5">20</span><span class="s3">, </span><span class="s5">30</span><span class="s3">, </span><span class="s5">20</span><span class="s3">, </span><span class="s5">30</span><span class="s3">, </span><span class="s5">10</span><span class="s3">])</span>

        <span class="s4"># No TypeError here.</span>
        <span class="s1">target_rect </span><span class="s3">= </span><span class="s1">Rectangle</span><span class="s3">()</span>
        <span class="s1">AntiAliasingLine</span><span class="s3">(</span><span class="s1">target_rect</span><span class="s3">, </span><span class="s1">points</span><span class="s3">=[</span><span class="s5">10</span><span class="s3">, </span><span class="s5">20</span><span class="s3">, </span><span class="s5">30</span><span class="s3">, </span><span class="s5">40</span><span class="s3">, </span><span class="s5">50</span><span class="s3">, </span><span class="s5">60</span><span class="s3">])</span>

        <span class="s4"># Test the gradient responsible for the &quot;smooth line&quot; effect.</span>
        <span class="s1">pixels </span><span class="s3">= </span><span class="s6">b&quot;</span><span class="s2">\xff\xff\xff\x00\xff\xff\xff\xff\xff\xff\xff\x00</span><span class="s6">&quot;</span>
        <span class="s1">instruction </span><span class="s3">= </span><span class="s1">Instruction</span><span class="s3">()</span>
        <span class="s1">aa_line </span><span class="s3">= </span><span class="s1">AntiAliasingLine</span><span class="s3">(</span><span class="s1">instruction</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">aa_line</span><span class="s3">.</span><span class="s1">texture</span><span class="s3">.</span><span class="s1">pixels </span><span class="s3">== </span><span class="s1">pixels</span>
        <span class="s4"># check the width, defined through tests with the custom texture.</span>
        <span class="s2">assert </span><span class="s1">aa_line</span><span class="s3">.</span><span class="s1">width </span><span class="s3">== </span><span class="s5">2.5</span>

        <span class="s4"># This set of points must remain unchanged.</span>
        <span class="s1">points_1 </span><span class="s3">= [</span><span class="s5">51.0</span><span class="s3">, </span><span class="s5">649.0</span><span class="s3">, </span><span class="s5">199.0</span><span class="s3">, </span><span class="s5">649.0</span><span class="s3">, </span><span class="s5">199.0</span><span class="s3">, </span><span class="s5">501.0</span><span class="s3">, </span><span class="s5">51.0</span><span class="s3">, </span><span class="s5">501.0</span><span class="s3">]</span>

        <span class="s4"># This set of points should be reduced from 16 to 8.</span>
        <span class="s1">points_2 </span><span class="s3">= [</span>
            <span class="s5">261.0</span><span class="s3">, </span><span class="s5">275.0</span><span class="s3">,</span>
            <span class="s5">335.0</span><span class="s3">, </span><span class="s5">349.0</span><span class="s3">,</span>
            <span class="s5">335.0</span><span class="s3">, </span><span class="s5">349.0</span><span class="s3">,</span>
            <span class="s5">409.0</span><span class="s3">, </span><span class="s5">275.0</span><span class="s3">,</span>
            <span class="s5">409.0</span><span class="s3">, </span><span class="s5">275.0</span><span class="s3">,</span>
            <span class="s5">335.0</span><span class="s3">, </span><span class="s5">201.0</span><span class="s3">,</span>
            <span class="s5">335.0</span><span class="s3">, </span><span class="s5">201.0</span><span class="s3">,</span>
            <span class="s5">261.0</span><span class="s3">, </span><span class="s5">275.0</span>
        <span class="s3">]</span>

        <span class="s4"># This set of points should be reduced from 72 to 50.</span>
        <span class="s1">points_3 </span><span class="s3">= [</span>
            <span class="s5">260.0</span><span class="s3">, </span><span class="s5">275.0</span><span class="s3">,</span>
            <span class="s5">261.0</span><span class="s3">, </span><span class="s5">275.0</span><span class="s3">,</span>
            <span class="s5">261.0</span><span class="s3">, </span><span class="s5">275.0</span><span class="s3">,</span>
            <span class="s5">261.999999999999</span><span class="s3">, </span><span class="s5">275.99999999</span><span class="s3">,</span>
            <span class="s5">261.06667650085353</span><span class="s3">, </span><span class="s5">278.14064903651496</span><span class="s3">,</span>
            <span class="s5">261.26658584785304</span><span class="s3">, </span><span class="s5">281.2756384111877</span><span class="s3">,</span>
            <span class="s5">261.56658584785305</span><span class="s3">, </span><span class="s5">281.3756384111877</span><span class="s3">,</span>
            <span class="s5">261.5993677908431</span><span class="s3">, </span><span class="s5">284.39931866126904</span><span class="s3">,</span>
            <span class="s5">262.0644226342696</span><span class="s3">, </span><span class="s5">287.50606070381684</span><span class="s3">,</span>
            <span class="s5">262.0644226342696</span><span class="s3">, </span><span class="s5">287.50606070381684</span><span class="s3">,</span>
            <span class="s5">262.6609123178712</span><span class="s3">, </span><span class="s5">290.59026597968375</span><span class="s3">,</span>
            <span class="s5">263.3877619269211</span><span class="s3">, </span><span class="s5">293.6463765424993</span><span class="s3">,</span>
            <span class="s5">264.2436616292954</span><span class="s3">, </span><span class="s5">296.66888507446475</span><span class="s3">,</span>
            <span class="s5">265.22706903587977</span><span class="s3">, </span><span class="s5">299.65234481091227</span><span class="s3">,</span>
            <span class="s5">265.22706903587977</span><span class="s3">, </span><span class="s5">299.65234481091227</span><span class="s3">,</span>
            <span class="s5">266.3362119800583</span><span class="s3">, </span><span class="s5">302.59137935574284</span><span class="s3">,</span>
            <span class="s5">267.5690917112779</span><span class="s3">, </span><span class="s5">305.48069237005546</span><span class="s3">,</span>
            <span class="s5">268.9234864969319</span><span class="s3">, </span><span class="s5">308.31507711650784</span><span class="s3">,</span>
            <span class="s5">270.39695562607204</span><span class="s3">, </span><span class="s5">311.089425842209</span><span class="s3">,</span>
            <span class="s5">270.89695562607204</span><span class="s3">, </span><span class="s5">311.589425842209</span><span class="s3">,</span>
            <span class="s5">271.98684380773494</span><span class="s3">, </span><span class="s5">313.7987389832352</span><span class="s3">,</span>
            <span class="s5">273.69028595595563</span><span class="s3">, </span><span class="s5">316.4381341741821</span><span class="s3">,</span>
            <span class="s5">275.50421235284637</span><span class="s3">, </span><span class="s5">319.00285504651725</span><span class="s3">,</span>
            <span class="s5">275.50421235284637</span><span class="s3">, </span><span class="s5">319.00285504651725</span><span class="s3">,</span>
            <span class="s5">277.4253541804354</span><span class="s3">, </span><span class="s5">321.48827979987755</span><span class="s3">,</span>
            <span class="s5">279.45024941129833</span><span class="s3">, </span><span class="s5">323.8899295308661</span><span class="s3">,</span>
            <span class="s5">281.57524904736516</span><span class="s3">, </span><span class="s5">326.20347630433844</span><span class="s3">,</span>
            <span class="s5">283.79652369566156</span><span class="s3">, </span><span class="s5">328.4247509526349</span><span class="s3">,</span>
            <span class="s5">283.99652369566156</span><span class="s3">, </span><span class="s5">328.7247509526349</span><span class="s3">,</span>
            <span class="s5">286.1100704691339</span><span class="s3">, </span><span class="s5">330.54975058870167</span><span class="s3">,</span>
            <span class="s5">288.5117202001224</span><span class="s3">, </span><span class="s5">332.5746458195646</span><span class="s3">,</span>
            <span class="s5">288.5117202001224</span><span class="s3">, </span><span class="s5">332.5746458195646</span><span class="s3">,</span>
            <span class="s5">290.99714495348275</span><span class="s3">, </span><span class="s5">334.4957876471537</span><span class="s3">,</span>
            <span class="s5">293.5618658258179</span><span class="s3">, </span><span class="s5">336.3097140440444</span><span class="s3">,</span>
            <span class="s5">293.5618658258179</span><span class="s3">, </span><span class="s5">336.3097140440444</span><span class="s3">,</span>
            <span class="s5">293.2618658258179</span><span class="s3">, </span><span class="s5">336.1097140440444</span>
        <span class="s3">]</span>

        <span class="s4"># This set of points should be reduced to [].</span>
        <span class="s1">points_4 </span><span class="s3">= [</span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">200</span><span class="s3">, </span><span class="s5">100</span><span class="s3">]</span>

        <span class="s4"># line closed (default)</span>
        <span class="s2">for </span><span class="s1">points </span><span class="s2">in </span><span class="s3">(</span><span class="s1">points_1</span><span class="s3">, </span><span class="s1">points_2</span><span class="s3">, </span><span class="s1">points_3</span><span class="s3">, </span><span class="s1">points_4</span><span class="s3">):</span>
            <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
            <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
                <span class="s1">Color</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">0.5</span><span class="s3">)</span>
                <span class="s1">inst </span><span class="s3">= </span><span class="s1">Instruction</span><span class="s3">()</span>
                <span class="s1">aa_line </span><span class="s3">= </span><span class="s1">AntiAliasingLine</span><span class="s3">(</span><span class="s1">inst</span><span class="s3">, </span><span class="s1">points</span><span class="s3">=</span><span class="s1">points</span><span class="s3">)</span>
            <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
            <span class="s1">filtered_points </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_filtered_points</span><span class="s3">(</span><span class="s1">points</span><span class="s3">)</span>
            <span class="s2">assert </span><span class="s1">aa_line</span><span class="s3">.</span><span class="s1">points </span><span class="s3">== </span><span class="s1">filtered_points </span><span class="s3">+ </span><span class="s1">filtered_points</span><span class="s3">[:</span><span class="s5">2</span><span class="s3">]</span>

        <span class="s4"># without closing the line</span>
        <span class="s2">for </span><span class="s1">points </span><span class="s2">in </span><span class="s3">(</span><span class="s1">points_1</span><span class="s3">, </span><span class="s1">points_2</span><span class="s3">, </span><span class="s1">points_3</span><span class="s3">, </span><span class="s1">points_4</span><span class="s3">):</span>
            <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
            <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
                <span class="s1">Color</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">0.5</span><span class="s3">)</span>
                <span class="s1">inst </span><span class="s3">= </span><span class="s1">Instruction</span><span class="s3">()</span>
                <span class="s1">aa_line </span><span class="s3">= </span><span class="s1">AntiAliasingLine</span><span class="s3">(</span><span class="s1">inst</span><span class="s3">, </span><span class="s1">points</span><span class="s3">=</span><span class="s1">points</span><span class="s3">, </span><span class="s1">close</span><span class="s3">=</span><span class="s5">0</span><span class="s3">)</span>
            <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
            <span class="s2">assert </span><span class="s1">aa_line</span><span class="s3">.</span><span class="s1">points </span><span class="s3">== </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_filtered_points</span><span class="s3">(</span><span class="s1">points</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_smoothrectangle</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">uix</span><span class="s3">.</span><span class="s1">widget </span><span class="s2">import </span><span class="s1">Widget</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">graphics </span><span class="s2">import </span><span class="s1">Color</span><span class="s3">, </span><span class="s1">SmoothRectangle</span>

        <span class="s1">r </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">render</span>

        <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
            <span class="s1">Color</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">0.5</span><span class="s3">)</span>
            <span class="s1">rect </span><span class="s3">= </span><span class="s1">SmoothRectangle</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">=(</span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">), </span><span class="s1">size</span><span class="s3">=(</span><span class="s5">150</span><span class="s3">, </span><span class="s5">150</span><span class="s3">))</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s1">filtered_points </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_filtered_points</span><span class="s3">(</span><span class="s1">rect</span><span class="s3">.</span><span class="s1">points</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s3">(</span>
            <span class="s1">rect</span><span class="s3">.</span><span class="s1">antialiasing_line_points</span>
            <span class="s3">== </span><span class="s1">filtered_points </span><span class="s3">+ </span><span class="s1">filtered_points</span><span class="s3">[:</span><span class="s5">2</span><span class="s3">]</span>
        <span class="s3">)</span>

        <span class="s4"># test if antialiasing is disabled if the graphic has one of its</span>
        <span class="s4"># dimensions decreased to less than 4px.</span>
        <span class="s1">rect</span><span class="s3">.</span><span class="s1">size </span><span class="s3">= (</span><span class="s5">150</span><span class="s3">, -</span><span class="s5">2</span><span class="s3">)</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">rect</span><span class="s3">.</span><span class="s1">antialiasing_line_points </span><span class="s3">== []</span>

        <span class="s1">rect</span><span class="s3">.</span><span class="s1">size </span><span class="s3">= (</span><span class="s5">150</span><span class="s3">, </span><span class="s5">2</span><span class="s3">)</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">rect</span><span class="s3">.</span><span class="s1">antialiasing_line_points </span><span class="s3">== []</span>

        <span class="s4"># re-enable antialiasing line rendering.</span>
        <span class="s1">rect</span><span class="s3">.</span><span class="s1">size </span><span class="s3">= (</span><span class="s5">150</span><span class="s3">, </span><span class="s5">150</span><span class="s3">)</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s3">(</span>
            <span class="s1">rect</span><span class="s3">.</span><span class="s1">antialiasing_line_points</span>
            <span class="s3">== </span><span class="s1">filtered_points </span><span class="s3">+ </span><span class="s1">filtered_points</span><span class="s3">[:</span><span class="s5">2</span><span class="s3">]</span>
        <span class="s3">)</span>

        <span class="s4"># disabling antialiasing.</span>
        <span class="s1">rect</span><span class="s3">.</span><span class="s1">texture </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_get_texture</span><span class="s3">()</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">rect</span><span class="s3">.</span><span class="s1">antialiasing_line_points </span><span class="s3">== []</span>

        <span class="s4"># re-enable antialiasing.</span>
        <span class="s1">rect</span><span class="s3">.</span><span class="s1">source </span><span class="s3">= </span><span class="s7">&quot;&quot;</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s3">(</span>
            <span class="s1">rect</span><span class="s3">.</span><span class="s1">antialiasing_line_points</span>
            <span class="s3">== </span><span class="s1">filtered_points </span><span class="s3">+ </span><span class="s1">filtered_points</span><span class="s3">[:</span><span class="s5">2</span><span class="s3">]</span>
        <span class="s3">)</span>

        <span class="s4"># test if antialiasing is disabled if the graphic is initialized with</span>
        <span class="s4"># at least one of its dimensions less than 4px.</span>
        <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
            <span class="s1">Color</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">0.5</span><span class="s3">)</span>
            <span class="s1">rect </span><span class="s3">= </span><span class="s1">SmoothRectangle</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">=(</span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">), </span><span class="s1">size</span><span class="s3">=(</span><span class="s5">150</span><span class="s3">, -</span><span class="s5">3</span><span class="s3">))</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">rect</span><span class="s3">.</span><span class="s1">antialiasing_line_points </span><span class="s3">== []</span>

        <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
            <span class="s1">Color</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">0.5</span><span class="s3">)</span>
            <span class="s1">rect </span><span class="s3">= </span><span class="s1">SmoothRectangle</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">=(</span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">), </span><span class="s1">size</span><span class="s3">=(</span><span class="s5">3.99</span><span class="s3">, </span><span class="s5">3.99</span><span class="s3">))</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">rect</span><span class="s3">.</span><span class="s1">antialiasing_line_points </span><span class="s3">== []</span>

    <span class="s2">def </span><span class="s1">test_smoothroundedrectangle</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">uix</span><span class="s3">.</span><span class="s1">widget </span><span class="s2">import </span><span class="s1">Widget</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">graphics </span><span class="s2">import </span><span class="s1">Color</span><span class="s3">, </span><span class="s1">SmoothRoundedRectangle</span>

        <span class="s1">r </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">render</span>

        <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
            <span class="s1">Color</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">0.5</span><span class="s3">)</span>
            <span class="s1">rounded_rect </span><span class="s3">= </span><span class="s1">SmoothRoundedRectangle</span><span class="s3">(</span>
                <span class="s1">pos</span><span class="s3">=(</span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">),</span>
                <span class="s1">size</span><span class="s3">=(</span><span class="s5">150</span><span class="s3">, </span><span class="s5">150</span><span class="s3">),</span>
                <span class="s1">radius</span><span class="s3">=[(</span><span class="s5">10</span><span class="s3">, </span><span class="s5">50</span><span class="s3">), (</span><span class="s5">100</span><span class="s3">, </span><span class="s5">50</span><span class="s3">), (</span><span class="s5">0</span><span class="s3">, </span><span class="s5">150</span><span class="s3">), (</span><span class="s5">200</span><span class="s3">, </span><span class="s5">50</span><span class="s3">)],</span>
                <span class="s1">segments</span><span class="s3">=</span><span class="s5">60</span><span class="s3">,</span>
            <span class="s3">)</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s1">filtered_points </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_filtered_points</span><span class="s3">(</span><span class="s1">rounded_rect</span><span class="s3">.</span><span class="s1">points</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s3">(</span>
            <span class="s1">rounded_rect</span><span class="s3">.</span><span class="s1">antialiasing_line_points</span>
            <span class="s3">== </span><span class="s1">filtered_points </span><span class="s3">+ </span><span class="s1">filtered_points</span><span class="s3">[:</span><span class="s5">2</span><span class="s3">]</span>
        <span class="s3">)</span>

        <span class="s4"># test if antialiasing is disabled if the graphic has one of its</span>
        <span class="s4"># dimensions decreased to less than 4px.</span>
        <span class="s1">rounded_rect</span><span class="s3">.</span><span class="s1">size </span><span class="s3">= (</span><span class="s5">150</span><span class="s3">, -</span><span class="s5">2</span><span class="s3">)</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">rounded_rect</span><span class="s3">.</span><span class="s1">antialiasing_line_points </span><span class="s3">== []</span>

        <span class="s1">rounded_rect</span><span class="s3">.</span><span class="s1">size </span><span class="s3">= (</span><span class="s5">150</span><span class="s3">, </span><span class="s5">2</span><span class="s3">)</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">rounded_rect</span><span class="s3">.</span><span class="s1">antialiasing_line_points </span><span class="s3">== []</span>

        <span class="s4"># re-enable antialiasing line rendering.</span>
        <span class="s1">rounded_rect</span><span class="s3">.</span><span class="s1">size </span><span class="s3">= (</span><span class="s5">150</span><span class="s3">, </span><span class="s5">150</span><span class="s3">)</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s3">(</span>
            <span class="s1">rounded_rect</span><span class="s3">.</span><span class="s1">antialiasing_line_points</span>
            <span class="s3">== </span><span class="s1">filtered_points </span><span class="s3">+ </span><span class="s1">filtered_points</span><span class="s3">[:</span><span class="s5">2</span><span class="s3">]</span>
        <span class="s3">)</span>

        <span class="s4"># disabling antialiasing.</span>
        <span class="s1">rounded_rect</span><span class="s3">.</span><span class="s1">texture </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_get_texture</span><span class="s3">()</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">rounded_rect</span><span class="s3">.</span><span class="s1">antialiasing_line_points </span><span class="s3">== []</span>

        <span class="s4"># re-enable antialiasing.</span>
        <span class="s1">rounded_rect</span><span class="s3">.</span><span class="s1">source </span><span class="s3">= </span><span class="s7">&quot;&quot;</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s3">(</span>
            <span class="s1">rounded_rect</span><span class="s3">.</span><span class="s1">antialiasing_line_points</span>
            <span class="s3">== </span><span class="s1">filtered_points </span><span class="s3">+ </span><span class="s1">filtered_points</span><span class="s3">[:</span><span class="s5">2</span><span class="s3">]</span>
        <span class="s3">)</span>

        <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
            <span class="s1">Color</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">0.5</span><span class="s3">)</span>
            <span class="s1">rounded_rect </span><span class="s3">= </span><span class="s1">SmoothRoundedRectangle</span><span class="s3">(</span>
                <span class="s1">pos</span><span class="s3">=(</span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">), </span><span class="s1">size</span><span class="s3">=(</span><span class="s5">150</span><span class="s3">, </span><span class="s5">150</span><span class="s3">), </span><span class="s1">segments</span><span class="s3">=</span><span class="s5">0</span>
            <span class="s3">)</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s1">filtered_points </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_filtered_points</span><span class="s3">(</span><span class="s1">rounded_rect</span><span class="s3">.</span><span class="s1">points</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s3">(</span>
            <span class="s1">rounded_rect</span><span class="s3">.</span><span class="s1">antialiasing_line_points</span>
            <span class="s3">== </span><span class="s1">filtered_points </span><span class="s3">+ </span><span class="s1">filtered_points</span><span class="s3">[:</span><span class="s5">2</span><span class="s3">]</span>
        <span class="s3">)</span>

        <span class="s4"># test if antialiasing is disabled if the graphic is initialized with</span>
        <span class="s4"># at least one of its dimensions less than 4px.</span>
        <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
            <span class="s1">Color</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">0.5</span><span class="s3">)</span>
            <span class="s1">rounded_rect </span><span class="s3">= </span><span class="s1">SmoothRoundedRectangle</span><span class="s3">(</span>
                <span class="s1">pos</span><span class="s3">=(</span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">), </span><span class="s1">size</span><span class="s3">=(</span><span class="s5">150</span><span class="s3">, -</span><span class="s5">3</span><span class="s3">)</span>
            <span class="s3">)</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">rounded_rect</span><span class="s3">.</span><span class="s1">antialiasing_line_points </span><span class="s3">== []</span>

        <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
            <span class="s1">Color</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">0.5</span><span class="s3">)</span>
            <span class="s1">rounded_rect </span><span class="s3">= </span><span class="s1">SmoothRoundedRectangle</span><span class="s3">(</span>
                <span class="s1">pos</span><span class="s3">=(</span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">), </span><span class="s1">size</span><span class="s3">=(</span><span class="s5">3.99</span><span class="s3">, </span><span class="s5">3.99</span><span class="s3">)</span>
            <span class="s3">)</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">rounded_rect</span><span class="s3">.</span><span class="s1">antialiasing_line_points </span><span class="s3">== []</span>

    <span class="s2">def </span><span class="s1">test_smoothellipse</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">uix</span><span class="s3">.</span><span class="s1">widget </span><span class="s2">import </span><span class="s1">Widget</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">graphics </span><span class="s2">import </span><span class="s1">Color</span><span class="s3">, </span><span class="s1">SmoothEllipse</span>

        <span class="s1">r </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">render</span>

        <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
            <span class="s1">Color</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">0.5</span><span class="s3">)</span>
            <span class="s1">ellipse </span><span class="s3">= </span><span class="s1">SmoothEllipse</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">=(</span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">), </span><span class="s1">size</span><span class="s3">=(</span><span class="s5">150</span><span class="s3">, </span><span class="s5">150</span><span class="s3">))</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s1">ellipse_center </span><span class="s3">= [</span>
            <span class="s1">ellipse</span><span class="s3">.</span><span class="s1">pos</span><span class="s3">[</span><span class="s5">0</span><span class="s3">] + </span><span class="s1">ellipse</span><span class="s3">.</span><span class="s1">size</span><span class="s3">[</span><span class="s5">0</span><span class="s3">] / </span><span class="s5">2</span><span class="s3">,</span>
            <span class="s1">ellipse</span><span class="s3">.</span><span class="s1">pos</span><span class="s3">[</span><span class="s5">1</span><span class="s3">] + </span><span class="s1">ellipse</span><span class="s3">.</span><span class="s1">size</span><span class="s3">[</span><span class="s5">1</span><span class="s3">] / </span><span class="s5">2</span><span class="s3">,</span>
        <span class="s3">]</span>
        <span class="s1">filtered_points </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_filtered_points</span><span class="s3">(</span>
            <span class="s1">ellipse</span><span class="s3">.</span><span class="s1">points </span><span class="s3">+ </span><span class="s1">ellipse_center</span>
        <span class="s3">)</span>
        <span class="s2">assert </span><span class="s3">(</span>
            <span class="s1">ellipse</span><span class="s3">.</span><span class="s1">antialiasing_line_points</span>
            <span class="s3">== </span><span class="s1">filtered_points </span><span class="s3">+ </span><span class="s1">filtered_points</span><span class="s3">[:</span><span class="s5">2</span><span class="s3">]</span>
        <span class="s3">)</span>

        <span class="s4"># test if antialiasing is disabled if the graphic has one of its</span>
        <span class="s4"># dimensions decreased to less than 4px</span>
        <span class="s1">ellipse</span><span class="s3">.</span><span class="s1">size </span><span class="s3">= (</span><span class="s5">150</span><span class="s3">, -</span><span class="s5">2</span><span class="s3">)</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">ellipse</span><span class="s3">.</span><span class="s1">antialiasing_line_points </span><span class="s3">== []</span>

        <span class="s1">ellipse</span><span class="s3">.</span><span class="s1">size </span><span class="s3">= (</span><span class="s5">150</span><span class="s3">, </span><span class="s5">2</span><span class="s3">)</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">ellipse</span><span class="s3">.</span><span class="s1">antialiasing_line_points </span><span class="s3">== []</span>

        <span class="s4"># re-enable antialiasing line rendering.</span>
        <span class="s1">ellipse</span><span class="s3">.</span><span class="s1">size </span><span class="s3">= (</span><span class="s5">150</span><span class="s3">, </span><span class="s5">150</span><span class="s3">)</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s3">(</span>
            <span class="s1">ellipse</span><span class="s3">.</span><span class="s1">antialiasing_line_points</span>
            <span class="s3">== </span><span class="s1">filtered_points </span><span class="s3">+ </span><span class="s1">filtered_points</span><span class="s3">[:</span><span class="s5">2</span><span class="s3">]</span>
        <span class="s3">)</span>

        <span class="s4"># disabling antialiasing.</span>
        <span class="s1">ellipse</span><span class="s3">.</span><span class="s1">texture </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_get_texture</span><span class="s3">()</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">ellipse</span><span class="s3">.</span><span class="s1">antialiasing_line_points </span><span class="s3">== []</span>

        <span class="s4"># re-enable antialiasing.</span>
        <span class="s1">ellipse</span><span class="s3">.</span><span class="s1">source </span><span class="s3">= </span><span class="s7">&quot;&quot;</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s3">(</span>
            <span class="s1">ellipse</span><span class="s3">.</span><span class="s1">antialiasing_line_points</span>
            <span class="s3">== </span><span class="s1">filtered_points </span><span class="s3">+ </span><span class="s1">filtered_points</span><span class="s3">[:</span><span class="s5">2</span><span class="s3">]</span>
        <span class="s3">)</span>

        <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
            <span class="s1">Color</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">0.5</span><span class="s3">)</span>
            <span class="s1">ellipse </span><span class="s3">= </span><span class="s1">SmoothEllipse</span><span class="s3">(</span>
                <span class="s1">pos</span><span class="s3">=(</span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">), </span><span class="s1">size</span><span class="s3">=(</span><span class="s5">150</span><span class="s3">, </span><span class="s5">150</span><span class="s3">), </span><span class="s1">angle_start</span><span class="s3">=</span><span class="s5">90</span><span class="s3">, </span><span class="s1">angle_end</span><span class="s3">=-</span><span class="s5">120</span>
            <span class="s3">)</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s1">ellipse_center </span><span class="s3">= [</span>
            <span class="s1">ellipse</span><span class="s3">.</span><span class="s1">pos</span><span class="s3">[</span><span class="s5">0</span><span class="s3">] + </span><span class="s1">ellipse</span><span class="s3">.</span><span class="s1">size</span><span class="s3">[</span><span class="s5">0</span><span class="s3">] / </span><span class="s5">2</span><span class="s3">,</span>
            <span class="s1">ellipse</span><span class="s3">.</span><span class="s1">pos</span><span class="s3">[</span><span class="s5">1</span><span class="s3">] + </span><span class="s1">ellipse</span><span class="s3">.</span><span class="s1">size</span><span class="s3">[</span><span class="s5">1</span><span class="s3">] / </span><span class="s5">2</span><span class="s3">,</span>
        <span class="s3">]</span>
        <span class="s1">filtered_points </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_filtered_points</span><span class="s3">(</span>
            <span class="s1">ellipse</span><span class="s3">.</span><span class="s1">points </span><span class="s3">+ </span><span class="s1">ellipse_center</span>
        <span class="s3">)</span>
        <span class="s2">assert </span><span class="s3">(</span>
            <span class="s1">ellipse</span><span class="s3">.</span><span class="s1">antialiasing_line_points</span>
            <span class="s3">== </span><span class="s1">filtered_points </span><span class="s3">+ </span><span class="s1">filtered_points</span><span class="s3">[:</span><span class="s5">2</span><span class="s3">]</span>
        <span class="s3">)</span>

        <span class="s4"># test if antialiasing is disabled if the graphic is initialized with</span>
        <span class="s4"># at least one of its dimensions less than 4px.</span>
        <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
            <span class="s1">Color</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">0.5</span><span class="s3">)</span>
            <span class="s1">ellipse </span><span class="s3">= </span><span class="s1">SmoothEllipse</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">=(</span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">), </span><span class="s1">size</span><span class="s3">=(</span><span class="s5">150</span><span class="s3">, -</span><span class="s5">3</span><span class="s3">))</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">ellipse</span><span class="s3">.</span><span class="s1">antialiasing_line_points </span><span class="s3">== []</span>

        <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
            <span class="s1">Color</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">0.5</span><span class="s3">)</span>
            <span class="s1">ellipse </span><span class="s3">= </span><span class="s1">SmoothEllipse</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">=(</span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">), </span><span class="s1">size</span><span class="s3">=(</span><span class="s5">3.99</span><span class="s3">, </span><span class="s5">3.99</span><span class="s3">))</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">ellipse</span><span class="s3">.</span><span class="s1">antialiasing_line_points </span><span class="s3">== []</span>

    <span class="s2">def </span><span class="s1">test_smoothtriangle</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">uix</span><span class="s3">.</span><span class="s1">widget </span><span class="s2">import </span><span class="s1">Widget</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">graphics </span><span class="s2">import </span><span class="s1">Color</span><span class="s3">, </span><span class="s1">SmoothTriangle</span>

        <span class="s1">r </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">render</span>

        <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
            <span class="s1">Color</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">0.5</span><span class="s3">)</span>
            <span class="s1">triangle </span><span class="s3">= </span><span class="s1">SmoothTriangle</span><span class="s3">(</span>
                <span class="s1">points</span><span class="s3">=[</span>
                    <span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">,</span>
                    <span class="s5">200</span><span class="s3">, </span><span class="s5">100</span><span class="s3">,</span>
                    <span class="s5">150</span><span class="s3">, </span><span class="s5">200</span><span class="s3">,</span>
                    <span class="s5">500</span><span class="s3">, </span><span class="s5">500</span><span class="s3">, </span><span class="s5">400</span><span class="s3">, </span><span class="s5">400  </span><span class="s4"># Irrelevant, just for testing purposes</span>
                <span class="s3">]</span>
            <span class="s3">)</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s1">filtered_points </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_filtered_points</span><span class="s3">(</span><span class="s1">triangle</span><span class="s3">.</span><span class="s1">points</span><span class="s3">[:</span><span class="s5">6</span><span class="s3">])</span>
        <span class="s2">assert </span><span class="s3">(</span>
            <span class="s1">triangle</span><span class="s3">.</span><span class="s1">antialiasing_line_points</span>
            <span class="s3">== </span><span class="s1">filtered_points </span><span class="s3">+ </span><span class="s1">filtered_points</span><span class="s3">[:</span><span class="s5">2</span><span class="s3">]</span>
        <span class="s3">)</span>

        <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
            <span class="s1">Color</span><span class="s3">(</span><span class="s5">0</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">0.5</span><span class="s3">)</span>
            <span class="s1">triangle </span><span class="s3">= </span><span class="s1">SmoothTriangle</span><span class="s3">(</span>
                <span class="s1">points</span><span class="s3">=[</span>
                    <span class="s5">125</span><span class="s3">, </span><span class="s5">200</span><span class="s3">,</span>
                    <span class="s5">200</span><span class="s3">, </span><span class="s5">100</span><span class="s3">,</span>
                    <span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">,</span>
                    <span class="s5">500</span><span class="s3">, </span><span class="s5">500</span><span class="s3">, </span><span class="s5">400</span><span class="s3">, </span><span class="s5">400  </span><span class="s4"># Irrelevant, just for testing purposes</span>
                <span class="s3">]</span>
            <span class="s3">)</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s1">filtered_points </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_filtered_points</span><span class="s3">(</span><span class="s1">triangle</span><span class="s3">.</span><span class="s1">points</span><span class="s3">[:</span><span class="s5">6</span><span class="s3">])</span>
        <span class="s2">assert </span><span class="s3">(</span>
            <span class="s1">triangle</span><span class="s3">.</span><span class="s1">antialiasing_line_points</span>
            <span class="s3">== </span><span class="s1">filtered_points </span><span class="s3">+ </span><span class="s1">filtered_points</span><span class="s3">[:</span><span class="s5">2</span><span class="s3">]</span>
        <span class="s3">)</span>

        <span class="s4"># Test disabling antialiasing if the points are very close.</span>
        <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
            <span class="s1">Color</span><span class="s3">(</span><span class="s5">0</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">0.5</span><span class="s3">)</span>
            <span class="s1">triangle </span><span class="s3">= </span><span class="s1">SmoothTriangle</span><span class="s3">(</span>
                <span class="s1">points</span><span class="s3">=[</span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">100.5</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">100.5</span><span class="s3">]</span>
            <span class="s3">)</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">triangle</span><span class="s3">.</span><span class="s1">antialiasing_line_points </span><span class="s3">== []</span>

        <span class="s4"># re-enable antialiasing line rendering.</span>
        <span class="s1">triangle</span><span class="s3">.</span><span class="s1">points </span><span class="s3">= [</span><span class="s5">125</span><span class="s3">, </span><span class="s5">200</span><span class="s3">, </span><span class="s5">200</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">]</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s3">(</span>
            <span class="s1">triangle</span><span class="s3">.</span><span class="s1">antialiasing_line_points</span>
            <span class="s3">== </span><span class="s1">filtered_points </span><span class="s3">+ </span><span class="s1">filtered_points</span><span class="s3">[:</span><span class="s5">2</span><span class="s3">]</span>
        <span class="s3">)</span>

        <span class="s4"># disabling antialiasing.</span>
        <span class="s1">triangle</span><span class="s3">.</span><span class="s1">texture </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_get_texture</span><span class="s3">()</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">triangle</span><span class="s3">.</span><span class="s1">antialiasing_line_points </span><span class="s3">== []</span>

        <span class="s4"># re-enable antialiasing.</span>
        <span class="s1">triangle</span><span class="s3">.</span><span class="s1">source </span><span class="s3">= </span><span class="s7">&quot;&quot;</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s3">(</span>
            <span class="s1">triangle</span><span class="s3">.</span><span class="s1">antialiasing_line_points</span>
            <span class="s3">== </span><span class="s1">filtered_points </span><span class="s3">+ </span><span class="s1">filtered_points</span><span class="s3">[:</span><span class="s5">2</span><span class="s3">]</span>
        <span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_smoothquad</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">uix</span><span class="s3">.</span><span class="s1">widget </span><span class="s2">import </span><span class="s1">Widget</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">graphics </span><span class="s2">import </span><span class="s1">Color</span><span class="s3">, </span><span class="s1">SmoothQuad</span>

        <span class="s1">r </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">render</span>

        <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
            <span class="s1">Color</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">0.5</span><span class="s3">)</span>
            <span class="s1">quad </span><span class="s3">= </span><span class="s1">SmoothQuad</span><span class="s3">(</span><span class="s1">points</span><span class="s3">=[</span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">200</span><span class="s3">, </span><span class="s5">200</span><span class="s3">, </span><span class="s5">200</span><span class="s3">, </span><span class="s5">200</span><span class="s3">, </span><span class="s5">100</span><span class="s3">])</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s1">filtered_points </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_filtered_points</span><span class="s3">(</span><span class="s1">quad</span><span class="s3">.</span><span class="s1">points</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s3">(</span>
            <span class="s1">quad</span><span class="s3">.</span><span class="s1">antialiasing_line_points</span>
            <span class="s3">== </span><span class="s1">filtered_points </span><span class="s3">+ </span><span class="s1">filtered_points</span><span class="s3">[:</span><span class="s5">2</span><span class="s3">]</span>
        <span class="s3">)</span>

        <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
            <span class="s1">Color</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">0.5</span><span class="s3">)</span>
            <span class="s1">quad </span><span class="s3">= </span><span class="s1">SmoothQuad</span><span class="s3">(</span><span class="s1">points</span><span class="s3">=[</span><span class="s5">200</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">200</span><span class="s3">, </span><span class="s5">200</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">200</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">])</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s1">filtered_points </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_filtered_points</span><span class="s3">(</span><span class="s1">quad</span><span class="s3">.</span><span class="s1">points</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s3">(</span>
            <span class="s1">quad</span><span class="s3">.</span><span class="s1">antialiasing_line_points</span>
            <span class="s3">== </span><span class="s1">filtered_points </span><span class="s3">+ </span><span class="s1">filtered_points</span><span class="s3">[:</span><span class="s5">2</span><span class="s3">]</span>
        <span class="s3">)</span>

        <span class="s4"># Test disabling antialiasing if the points are very close.</span>
        <span class="s1">wid </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">wid</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
            <span class="s1">Color</span><span class="s3">(</span><span class="s5">0</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">0.5</span><span class="s3">)</span>
            <span class="s1">quad </span><span class="s3">= </span><span class="s1">SmoothQuad</span><span class="s3">(</span>
                <span class="s1">points</span><span class="s3">=[</span><span class="s5">200</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">200</span><span class="s3">, </span><span class="s5">100.8</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">100.8</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">]</span>
            <span class="s3">)</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">quad</span><span class="s3">.</span><span class="s1">antialiasing_line_points </span><span class="s3">== []</span>

        <span class="s4"># re-enable antialiasing line rendering.</span>
        <span class="s1">quad</span><span class="s3">.</span><span class="s1">points </span><span class="s3">= [</span><span class="s5">200</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">200</span><span class="s3">, </span><span class="s5">200</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">200</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">]</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s3">(</span>
            <span class="s1">quad</span><span class="s3">.</span><span class="s1">antialiasing_line_points</span>
            <span class="s3">== </span><span class="s1">filtered_points </span><span class="s3">+ </span><span class="s1">filtered_points</span><span class="s3">[:</span><span class="s5">2</span><span class="s3">]</span>
        <span class="s3">)</span>

        <span class="s4"># disabling antialiasing.</span>
        <span class="s1">quad</span><span class="s3">.</span><span class="s1">texture </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_get_texture</span><span class="s3">()</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">quad</span><span class="s3">.</span><span class="s1">antialiasing_line_points </span><span class="s3">== []</span>

        <span class="s4"># re-enable antialiasing.</span>
        <span class="s1">quad</span><span class="s3">.</span><span class="s1">source </span><span class="s3">= </span><span class="s7">&quot;&quot;</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">wid</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s3">(</span>
            <span class="s1">quad</span><span class="s3">.</span><span class="s1">antialiasing_line_points</span>
            <span class="s3">== </span><span class="s1">filtered_points </span><span class="s3">+ </span><span class="s1">filtered_points</span><span class="s3">[:</span><span class="s5">2</span><span class="s3">]</span>
        <span class="s3">)</span>


<span class="s2">class </span><span class="s1">FBOInstructionTestCase</span><span class="s3">(</span><span class="s1">GraphicUnitTest</span><span class="s3">):</span>

    <span class="s2">def </span><span class="s1">test_fbo_pixels</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">graphics </span><span class="s2">import </span><span class="s1">Fbo</span><span class="s3">, </span><span class="s1">ClearColor</span><span class="s3">, </span><span class="s1">ClearBuffers</span><span class="s3">, </span><span class="s1">Ellipse</span>

        <span class="s1">fbo </span><span class="s3">= </span><span class="s1">Fbo</span><span class="s3">(</span><span class="s1">size</span><span class="s3">=(</span><span class="s5">512</span><span class="s3">, </span><span class="s5">512</span><span class="s3">))</span>
        <span class="s2">with </span><span class="s1">fbo</span><span class="s3">:</span>
            <span class="s1">ClearColor</span><span class="s3">(</span><span class="s5">0</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">1</span><span class="s3">)</span>
            <span class="s1">ClearBuffers</span><span class="s3">()</span>
            <span class="s1">Ellipse</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">=(</span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">), </span><span class="s1">size</span><span class="s3">=(</span><span class="s5">100</span><span class="s3">, </span><span class="s5">100</span><span class="s3">))</span>
        <span class="s1">fbo</span><span class="s3">.</span><span class="s1">draw</span><span class="s3">()</span>
        <span class="s1">data </span><span class="s3">= </span><span class="s1">fbo</span><span class="s3">.</span><span class="s1">pixels</span>
        <span class="s1">fbo</span><span class="s3">.</span><span class="s1">texture</span><span class="s3">.</span><span class="s1">save</span><span class="s3">(</span><span class="s7">'results.png'</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">TransformationsTestCase</span><span class="s3">(</span><span class="s1">GraphicUnitTest</span><span class="s3">):</span>

    <span class="s2">def </span><span class="s1">test_identity_creation</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">graphics </span><span class="s2">import </span><span class="s1">LoadIdentity</span>

        <span class="s1">mat </span><span class="s3">= </span><span class="s1">LoadIdentity</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertTrue</span><span class="s3">(</span><span class="s1">mat</span><span class="s3">.</span><span class="s1">stack</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">check_transform_works</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">transform_type</span><span class="s3">):</span>
        <span class="s4"># Normal args</span>
        <span class="s1">transform </span><span class="s3">= </span><span class="s1">transform_type</span><span class="s3">(</span><span class="s5">0</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">2</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">transform</span><span class="s3">.</span><span class="s1">x</span><span class="s3">, </span><span class="s5">0</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">transform</span><span class="s3">.</span><span class="s1">y</span><span class="s3">, </span><span class="s5">1</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">transform</span><span class="s3">.</span><span class="s1">z</span><span class="s3">, </span><span class="s5">2</span><span class="s3">)</span>

        <span class="s4"># Key word args</span>
        <span class="s1">transform </span><span class="s3">= </span><span class="s1">transform_type</span><span class="s3">(</span><span class="s1">x</span><span class="s3">=</span><span class="s5">0</span><span class="s3">, </span><span class="s1">y</span><span class="s3">=</span><span class="s5">1</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">transform</span><span class="s3">.</span><span class="s1">x</span><span class="s3">, </span><span class="s5">0</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">transform</span><span class="s3">.</span><span class="s1">y</span><span class="s3">, </span><span class="s5">1</span><span class="s3">)</span>

        <span class="s1">transform </span><span class="s3">= </span><span class="s1">transform_type</span><span class="s3">(</span><span class="s1">x</span><span class="s3">=</span><span class="s5">0</span><span class="s3">, </span><span class="s1">y</span><span class="s3">=</span><span class="s5">1</span><span class="s3">, </span><span class="s1">z</span><span class="s3">=</span><span class="s5">2</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">transform</span><span class="s3">.</span><span class="s1">x</span><span class="s3">, </span><span class="s5">0</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">transform</span><span class="s3">.</span><span class="s1">y</span><span class="s3">, </span><span class="s5">1</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertEqual</span><span class="s3">(</span><span class="s1">transform</span><span class="s3">.</span><span class="s1">z</span><span class="s3">, </span><span class="s5">2</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_translate_creation</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">graphics </span><span class="s2">import </span><span class="s1">Translate</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">check_transform_works</span><span class="s3">(</span><span class="s1">Translate</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_scale_creation</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">graphics </span><span class="s2">import </span><span class="s1">Scale</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">check_transform_works</span><span class="s3">(</span><span class="s1">Scale</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">CallbackInstructionTest</span><span class="s3">(</span><span class="s1">GraphicUnitTest</span><span class="s3">):</span>

    <span class="s2">def </span><span class="s1">test_from_kv</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">from </span><span class="s1">textwrap </span><span class="s2">import </span><span class="s1">dedent</span>
        <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">lang </span><span class="s2">import </span><span class="s1">Builder</span>

        <span class="s1">root </span><span class="s3">= </span><span class="s1">Builder</span><span class="s3">.</span><span class="s1">load_string</span><span class="s3">(</span><span class="s1">dedent</span><span class="s3">(</span><span class="s7">&quot;&quot;&quot;</span><span class="s2">\ 
        </span><span class="s7">Widget: 
            canvas: 
                Callback: 
                    callback: lambda __: setattr(self, 'callback_test', 'TEST') 
        &quot;&quot;&quot;</span><span class="s3">))</span>
        <span class="s1">r </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">render</span>
        <span class="s1">r</span><span class="s3">(</span><span class="s1">root</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">assertTrue</span><span class="s3">(</span><span class="s1">root</span><span class="s3">.</span><span class="s1">callback_test </span><span class="s3">== </span><span class="s7">'TEST'</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">fixture</span>
<span class="s2">def </span><span class="s1">widget_verify_thread</span><span class="s3">(</span><span class="s1">request</span><span class="s3">):</span>
    <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">uix</span><span class="s3">.</span><span class="s1">widget </span><span class="s2">import </span><span class="s1">Widget</span>
    <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">config </span><span class="s2">import </span><span class="s1">Config</span>

    <span class="s1">original </span><span class="s3">= </span><span class="s1">Config</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s7">'graphics'</span><span class="s3">, </span><span class="s7">'verify_gl_main_thread'</span><span class="s3">)</span>
    <span class="s1">Config</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s7">'graphics'</span><span class="s3">, </span><span class="s7">'verify_gl_main_thread'</span><span class="s3">, </span><span class="s1">request</span><span class="s3">.</span><span class="s1">param</span><span class="s3">)</span>

    <span class="s1">widget </span><span class="s3">= </span><span class="s1">Widget</span><span class="s3">()</span>
    <span class="s2">yield </span><span class="s1">widget</span><span class="s3">, </span><span class="s1">request</span><span class="s3">.</span><span class="s1">param</span>

    <span class="s1">Config</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s7">'graphics'</span><span class="s3">, </span><span class="s7">'verify_gl_main_thread'</span><span class="s3">, </span><span class="s1">original</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">requires_graphics</span>
<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s7">'widget_verify_thread'</span><span class="s3">, [</span><span class="s7">'0'</span><span class="s3">, </span><span class="s7">'1'</span><span class="s3">], </span><span class="s1">indirect</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
<span class="s2">def </span><span class="s1">test_graphics_main_thread</span><span class="s3">(</span><span class="s1">widget_verify_thread</span><span class="s3">):</span>
    <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">graphics </span><span class="s2">import </span><span class="s1">Color</span>

    <span class="s1">widget</span><span class="s3">, </span><span class="s1">verify_thread </span><span class="s3">= </span><span class="s1">widget_verify_thread</span>
    <span class="s2">with </span><span class="s1">widget</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
        <span class="s1">color </span><span class="s3">= </span><span class="s1">Color</span><span class="s3">()</span>
    <span class="s1">color</span><span class="s3">.</span><span class="s1">rgb </span><span class="s3">= </span><span class="s5">.1</span><span class="s3">, </span><span class="s5">.2</span><span class="s3">, </span><span class="s5">.3</span>


<span class="s3">@</span><span class="s1">requires_graphics</span>
<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s7">'widget_verify_thread'</span><span class="s3">, [</span><span class="s7">'0'</span><span class="s3">, </span><span class="s7">'1'</span><span class="s3">], </span><span class="s1">indirect</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
<span class="s2">def </span><span class="s1">test_create_graphics_second_thread</span><span class="s3">(</span><span class="s1">widget_verify_thread</span><span class="s3">):</span>
    <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">graphics </span><span class="s2">import </span><span class="s1">Color</span>
    <span class="s1">widget</span><span class="s3">, </span><span class="s1">verify_thread </span><span class="s3">= </span><span class="s1">widget_verify_thread</span>
    <span class="s1">exception </span><span class="s3">= </span><span class="s2">None</span>

    <span class="s2">def </span><span class="s1">callback</span><span class="s3">():</span>
        <span class="s2">nonlocal </span><span class="s1">exception</span>
        <span class="s2">try</span><span class="s3">:</span>
            <span class="s2">with </span><span class="s1">widget</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
                <span class="s2">if </span><span class="s1">verify_thread </span><span class="s3">== </span><span class="s7">'1'</span><span class="s3">:</span>
                    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">):</span>
                        <span class="s1">Color</span><span class="s3">()</span>
                <span class="s2">else</span><span class="s3">:</span>
                    <span class="s1">Color</span><span class="s3">()</span>
        <span class="s2">except </span><span class="s1">BaseException </span><span class="s2">as </span><span class="s1">e</span><span class="s3">:</span>
            <span class="s1">exception </span><span class="s3">= </span><span class="s1">e</span><span class="s3">, </span><span class="s1">sys</span><span class="s3">.</span><span class="s1">exc_info</span><span class="s3">()[</span><span class="s5">2</span><span class="s3">]</span>
            <span class="s2">raise</span>

    <span class="s1">thread </span><span class="s3">= </span><span class="s1">Thread</span><span class="s3">(</span><span class="s1">target</span><span class="s3">=</span><span class="s1">callback</span><span class="s3">)</span>
    <span class="s1">thread</span><span class="s3">.</span><span class="s1">start</span><span class="s3">()</span>
    <span class="s1">thread</span><span class="s3">.</span><span class="s1">join</span><span class="s3">()</span>
    <span class="s2">if </span><span class="s1">exception </span><span class="s2">is not None</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">exception</span><span class="s3">[</span><span class="s5">0</span><span class="s3">].</span><span class="s1">with_traceback</span><span class="s3">(</span><span class="s1">exception</span><span class="s3">[</span><span class="s5">1</span><span class="s3">])</span>


<span class="s3">@</span><span class="s1">requires_graphics</span>
<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s7">'widget_verify_thread'</span><span class="s3">, [</span><span class="s7">'0'</span><span class="s3">, </span><span class="s7">'1'</span><span class="s3">], </span><span class="s1">indirect</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
<span class="s2">def </span><span class="s1">test_change_graphics_second_thread</span><span class="s3">(</span><span class="s1">widget_verify_thread</span><span class="s3">):</span>
    <span class="s2">from </span><span class="s1">kivy</span><span class="s3">.</span><span class="s1">graphics </span><span class="s2">import </span><span class="s1">Color</span>
    <span class="s1">widget</span><span class="s3">, </span><span class="s1">verify_thread </span><span class="s3">= </span><span class="s1">widget_verify_thread</span>
    <span class="s2">with </span><span class="s1">widget</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">:</span>
        <span class="s1">color </span><span class="s3">= </span><span class="s1">Color</span><span class="s3">()</span>

    <span class="s1">exception </span><span class="s3">= </span><span class="s2">None</span>

    <span class="s2">def </span><span class="s1">callback</span><span class="s3">():</span>
        <span class="s2">nonlocal </span><span class="s1">exception</span>
        <span class="s2">try</span><span class="s3">:</span>
            <span class="s2">if </span><span class="s1">verify_thread </span><span class="s3">== </span><span class="s7">'1'</span><span class="s3">:</span>
                <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">):</span>
                    <span class="s1">color</span><span class="s3">.</span><span class="s1">rgb </span><span class="s3">= </span><span class="s5">.1</span><span class="s3">, </span><span class="s5">.2</span><span class="s3">, </span><span class="s5">.3</span>
            <span class="s2">else</span><span class="s3">:</span>
                <span class="s1">color</span><span class="s3">.</span><span class="s1">rgb </span><span class="s3">= </span><span class="s5">.1</span><span class="s3">, </span><span class="s5">.2</span><span class="s3">, </span><span class="s5">.3</span>
        <span class="s2">except </span><span class="s1">BaseException </span><span class="s2">as </span><span class="s1">e</span><span class="s3">:</span>
            <span class="s1">exception </span><span class="s3">= </span><span class="s1">e</span><span class="s3">, </span><span class="s1">sys</span><span class="s3">.</span><span class="s1">exc_info</span><span class="s3">()[</span><span class="s5">2</span><span class="s3">]</span>
            <span class="s2">raise</span>

    <span class="s1">thread </span><span class="s3">= </span><span class="s1">Thread</span><span class="s3">(</span><span class="s1">target</span><span class="s3">=</span><span class="s1">callback</span><span class="s3">)</span>
    <span class="s1">thread</span><span class="s3">.</span><span class="s1">start</span><span class="s3">()</span>
    <span class="s1">thread</span><span class="s3">.</span><span class="s1">join</span><span class="s3">()</span>
    <span class="s2">if </span><span class="s1">exception </span><span class="s2">is not None</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">exception</span><span class="s3">[</span><span class="s5">0</span><span class="s3">].</span><span class="s1">with_traceback</span><span class="s3">(</span><span class="s1">exception</span><span class="s3">[</span><span class="s5">1</span><span class="s3">])</span>
</pre>
</body>
</html>