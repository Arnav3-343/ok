<html>
<head>
<title>actionbar.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #cf8e6d;}
.s5 { color: #2aacb8;}
.s6 { color: #7a7e85;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
actionbar.py</font>
</center></td></tr></table>
<pre><span class="s0">''' 
Action Bar 
========== 
 
.. versionadded:: 1.8.0 
 
.. image:: images/actionbar.png 
    :align: right 
 
The ActionBar widget is like Android's `ActionBar 
&lt;http://developer.android.com/guide/topics/ui/actionbar.html&gt;`_, where items 
are stacked horizontally. When the area becomes to small, widgets are moved 
into the :class:`ActionOverflow` area. 
 
An :class:`ActionBar` must contain an :class:`ActionView` with various 
:class:`ContextualActionViews &lt;kivy.uix.actionbar.ContextualActionView&gt;`. 
An :class:`ActionView` must contain a child :class:`ActionPrevious` which may 
have title, app_icon and previous_icon properties. :class:`ActionView` children 
must be 
subclasses of :class:`ActionItems &lt;ActionItem&gt;`. Some predefined ones include 
an :class:`ActionButton`, an :class:`ActionToggleButton`, an 
:class:`ActionCheck`, an :class:`ActionSeparator` and an :class:`ActionGroup`. 
 
An :class:`ActionGroup` is used to display :class:`ActionItems &lt;ActionItem&gt;` 
in a group. An :class:`ActionView` will always display an :class:`ActionGroup` 
after other :class:`ActionItems &lt;ActionItem&gt;`. An :class:`ActionView` contains 
an :class:`ActionOverflow`, but this is only made visible when required i.e. 
the available area is too small to fit all the widgets. A 
:class:`ContextualActionView` is a subclass of an:class:`ActionView`. 
 
.. versionchanged:: 1.10.1 
    :class:`ActionGroup` core rewritten from :class:`Spinner` to pure 
    :class:`DropDown` 
'''</span>

<span class="s1">__all__ </span><span class="s2">= (</span><span class="s3">'ActionBarException'</span><span class="s2">, </span><span class="s3">'ActionItem'</span><span class="s2">, </span><span class="s3">'ActionButton'</span><span class="s2">,</span>
           <span class="s3">'ActionToggleButton'</span><span class="s2">, </span><span class="s3">'ActionCheck'</span><span class="s2">, </span><span class="s3">'ActionSeparator'</span><span class="s2">,</span>
           <span class="s3">'ActionDropDown'</span><span class="s2">, </span><span class="s3">'ActionGroup'</span><span class="s2">, </span><span class="s3">'ActionOverflow'</span><span class="s2">,</span>
           <span class="s3">'ActionView'</span><span class="s2">, </span><span class="s3">'ContextualActionView'</span><span class="s2">, </span><span class="s3">'ActionPrevious'</span><span class="s2">,</span>
           <span class="s3">'ActionBar'</span><span class="s2">)</span>

<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">boxlayout </span><span class="s4">import </span><span class="s1">BoxLayout</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">dropdown </span><span class="s4">import </span><span class="s1">DropDown</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">widget </span><span class="s4">import </span><span class="s1">Widget</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">button </span><span class="s4">import </span><span class="s1">Button</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">togglebutton </span><span class="s4">import </span><span class="s1">ToggleButton</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">checkbox </span><span class="s4">import </span><span class="s1">CheckBox</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">spinner </span><span class="s4">import </span><span class="s1">Spinner</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">label </span><span class="s4">import </span><span class="s1">Label</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">config </span><span class="s4">import </span><span class="s1">Config</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">properties </span><span class="s4">import </span><span class="s1">ObjectProperty</span><span class="s2">, </span><span class="s1">NumericProperty</span><span class="s2">, </span><span class="s1">BooleanProperty</span><span class="s2">, </span><span class="s1">\</span>
    <span class="s1">StringProperty</span><span class="s2">, </span><span class="s1">ListProperty</span><span class="s2">, </span><span class="s1">OptionProperty</span><span class="s2">, </span><span class="s1">AliasProperty</span><span class="s2">, </span><span class="s1">ColorProperty</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">metrics </span><span class="s4">import </span><span class="s1">sp</span>
<span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">lang </span><span class="s4">import </span><span class="s1">Builder</span>
<span class="s4">from </span><span class="s1">functools </span><span class="s4">import </span><span class="s1">partial</span>


<span class="s1">window_icon </span><span class="s2">= </span><span class="s3">''</span>
<span class="s4">if </span><span class="s1">Config</span><span class="s2">:</span>
    <span class="s1">window_icon </span><span class="s2">= </span><span class="s1">Config</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s3">'kivy'</span><span class="s2">, </span><span class="s3">'window_icon'</span><span class="s2">)</span>


<span class="s4">class </span><span class="s1">ActionBarException</span><span class="s2">(</span><span class="s1">Exception</span><span class="s2">):</span>
    <span class="s0">''' 
    ActionBarException class 
    '''</span>
    <span class="s4">pass</span>


<span class="s4">class </span><span class="s1">ActionItem</span><span class="s2">(</span><span class="s1">object</span><span class="s2">):</span>
    <span class="s0">''' 
    ActionItem class, an abstract class for all ActionBar widgets. To create a 
    custom widget for an ActionBar, inherit from this class. See module 
    documentation for more information. 
    '''</span>

    <span class="s1">minimum_width </span><span class="s2">= </span><span class="s1">NumericProperty</span><span class="s2">(</span><span class="s3">'90sp'</span><span class="s2">)</span>
    <span class="s3">''' 
    Minimum Width required by an ActionItem. 
 
    :attr:`minimum_width` is a :class:`~kivy.properties.NumericProperty` and 
    defaults to '90sp'. 
    '''</span>

    <span class="s4">def </span><span class="s1">get_pack_width</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">return </span><span class="s1">max</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">minimum_width</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">width</span><span class="s2">)</span>

    <span class="s1">pack_width </span><span class="s2">= </span><span class="s1">AliasProperty</span><span class="s2">(</span><span class="s1">get_pack_width</span><span class="s2">,</span>
                               <span class="s1">bind</span><span class="s2">=(</span><span class="s3">'minimum_width'</span><span class="s2">, </span><span class="s3">'width'</span><span class="s2">),</span>
                               <span class="s1">cache</span><span class="s2">=</span><span class="s4">True</span><span class="s2">)</span>
    <span class="s3">''' 
    (read-only) The actual width to use when packing the items. Equal to the 
    greater of minimum_width and width. 
 
    :attr:`pack_width` is an :class:`~kivy.properties.AliasProperty`. 
    '''</span>

    <span class="s1">important </span><span class="s2">= </span><span class="s1">BooleanProperty</span><span class="s2">(</span><span class="s4">False</span><span class="s2">)</span>
    <span class="s3">''' 
    Determines if an ActionItem is important or not. If an item is important 
    and space is limited, this item will be displayed in preference to others. 
 
    :attr:`important` is a :class:`~kivy.properties.BooleanProperty` and 
    defaults to False. 
    '''</span>

    <span class="s1">inside_group </span><span class="s2">= </span><span class="s1">BooleanProperty</span><span class="s2">(</span><span class="s4">False</span><span class="s2">)</span>
    <span class="s3">''' 
    (internal) Determines if an ActionItem is displayed inside an 
    ActionGroup or not. 
 
    :attr:`inside_group` is a :class:`~kivy.properties.BooleanProperty` and 
    defaults to False. 
    '''</span>

    <span class="s1">background_normal </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span>
        <span class="s3">'atlas://data/images/defaulttheme/action_item'</span><span class="s2">)</span>
    <span class="s3">''' 
    Background image of the ActionItem used for the default graphical 
    representation when the ActionItem is not pressed. 
 
    :attr:`background_normal` is a :class:`~kivy.properties.StringProperty` 
    and defaults to 'atlas://data/images/defaulttheme/action_item'. 
    '''</span>

    <span class="s1">background_down </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span>
        <span class="s3">'atlas://data/images/defaulttheme/action_item_down'</span><span class="s2">)</span>
    <span class="s3">''' 
    Background image of the ActionItem used for the default graphical 
    representation when an ActionItem is pressed. 
 
    :attr:`background_down` is a :class:`~kivy.properties.StringProperty` 
    and defaults to 'atlas://data/images/defaulttheme/action_item_down'. 
    '''</span>

    <span class="s1">mipmap </span><span class="s2">= </span><span class="s1">BooleanProperty</span><span class="s2">(</span><span class="s4">True</span><span class="s2">)</span>
    <span class="s3">''' 
    Defines whether the image/icon dispayed on top of the button uses a 
    mipmap or not. 
 
    :attr:`mipmap` is a :class:`~kivy.properties.BooleanProperty` and 
    defaults to `True`. 
    '''</span>


<span class="s4">class </span><span class="s1">ActionButton</span><span class="s2">(</span><span class="s1">Button</span><span class="s2">, </span><span class="s1">ActionItem</span><span class="s2">):</span>
    <span class="s0">''' 
    ActionButton class, see module documentation for more information. 
 
    The text color, width and size_hint_x are set manually via the Kv language 
    file. It covers a lot of cases: with/without an icon, with/without a group 
    and takes care of the padding between elements. 
 
    You don't have much control over these properties, so if you want to 
    customize its appearance, we suggest you create you own button 
    representation. You can do this by creating a class that subclasses an 
    existing widget and an :class:`ActionItem`:: 
 
        class MyOwnActionButton(Button, ActionItem): 
            pass 
 
    You can then create your own style using the Kv language. 
    '''</span>

    <span class="s1">icon </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">, </span><span class="s1">allownone</span><span class="s2">=</span><span class="s4">True</span><span class="s2">)</span>
    <span class="s3">''' 
    Source image to use when the Button is part of the ActionBar. If the 
    Button is in a group, the text will be preferred. 
 
    :attr:`icon` is a :class:`~kivy.properties.StringProperty` and defaults 
    to None. 
    '''</span>


<span class="s4">class </span><span class="s1">ActionPrevious</span><span class="s2">(</span><span class="s1">BoxLayout</span><span class="s2">, </span><span class="s1">ActionItem</span><span class="s2">):</span>
    <span class="s0">''' 
    ActionPrevious class, see module documentation for more information. 
    '''</span>

    <span class="s1">with_previous </span><span class="s2">= </span><span class="s1">BooleanProperty</span><span class="s2">(</span><span class="s4">True</span><span class="s2">)</span>
    <span class="s3">''' 
    Specifies whether the previous_icon will be shown or not. Note that it is 
    up to the user to implement the desired behavior using the *on_press* or 
    similar events. 
 
    :attr:`with_previous` is a :class:`~kivy.properties.BooleanProperty` and 
    defaults to True. 
    '''</span>

    <span class="s1">app_icon </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span><span class="s1">window_icon</span><span class="s2">)</span>
    <span class="s3">''' 
    Application icon for the ActionView. 
 
    :attr:`app_icon` is a :class:`~kivy.properties.StringProperty` 
    and defaults to the window icon if set, otherwise 
    'data/logo/kivy-icon-32.png'. 
    '''</span>

    <span class="s1">app_icon_width </span><span class="s2">= </span><span class="s1">NumericProperty</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s3">''' 
    Width of app_icon image. 
 
    :attr:`app_icon_width` is a :class:`~kivy.properties.NumericProperty` and 
    defaults to 0. 
    '''</span>

    <span class="s1">app_icon_height </span><span class="s2">= </span><span class="s1">NumericProperty</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s3">''' 
    Height of app_icon image. 
 
    :attr:`app_icon_height` is a :class:`~kivy.properties.NumericProperty` 
    and defaults to 0. 
    '''</span>

    <span class="s1">color </span><span class="s2">= </span><span class="s1">ColorProperty</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">])</span>
    <span class="s3">''' 
    Text color, in the format (r, g, b, a) 
 
    :attr:`color` is a :class:`~kivy.properties.ColorProperty` and defaults 
    to [1, 1, 1, 1]. 
 
    .. versionchanged:: 2.0.0 
        Changed from :class:`~kivy.properties.ListProperty` to 
        :class:`~kivy.properties.ColorProperty`. 
    '''</span>

    <span class="s1">previous_image </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span>
        <span class="s3">'atlas://data/images/defaulttheme/previous_normal'</span><span class="s2">)</span>
    <span class="s3">''' 
    Image for the 'previous' ActionButtons default graphical representation. 
 
    :attr:`previous_image` is a :class:`~kivy.properties.StringProperty` and 
    defaults to 'atlas://data/images/defaulttheme/previous_normal'. 
    '''</span>

    <span class="s1">previous_image_width </span><span class="s2">= </span><span class="s1">NumericProperty</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s3">''' 
    Width of previous_image image. 
 
    :attr:`width` is a :class:`~kivy.properties.NumericProperty` and 
    defaults to 0. 
    '''</span>

    <span class="s1">previous_image_height </span><span class="s2">= </span><span class="s1">NumericProperty</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s3">''' 
    Height of previous_image image. 
 
    :attr:`app_icon_width` is a :class:`~kivy.properties.NumericProperty` and 
    defaults to 0. 
    '''</span>

    <span class="s1">title </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span><span class="s3">''</span><span class="s2">)</span>
    <span class="s3">''' 
    Title for ActionView. 
 
    :attr:`title` is a :class:`~kivy.properties.StringProperty` and 
    defaults to ''. 
    '''</span>

    <span class="s1">markup </span><span class="s2">= </span><span class="s1">BooleanProperty</span><span class="s2">(</span><span class="s4">False</span><span class="s2">)</span>
    <span class="s3">''' 
    If True, the text will be rendered using the 
    :class:`~kivy.core.text.markup.MarkupLabel`: you can change the style of 
    the text using tags. Check the :doc:`api-kivy.core.text.markup` 
    documentation for more information. 
 
    :attr:`markup` is a :class:`~kivy.properties.BooleanProperty` and 
    defaults to False. 
    '''</span>

    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">register_event_type</span><span class="s2">(</span><span class="s3">'on_press'</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">register_event_type</span><span class="s2">(</span><span class="s3">'on_release'</span><span class="s2">)</span>
        <span class="s1">super</span><span class="s2">(</span><span class="s1">ActionPrevious</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">__init__</span><span class="s2">(**</span><span class="s1">kwargs</span><span class="s2">)</span>
        <span class="s4">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">app_icon</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">app_icon </span><span class="s2">= </span><span class="s3">'data/logo/kivy-icon-32.png'</span>

    <span class="s4">def </span><span class="s1">on_press</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">pass</span>

    <span class="s4">def </span><span class="s1">on_release</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4">pass</span>


<span class="s4">class </span><span class="s1">ActionToggleButton</span><span class="s2">(</span><span class="s1">ActionItem</span><span class="s2">, </span><span class="s1">ToggleButton</span><span class="s2">):</span>
    <span class="s0">''' 
    ActionToggleButton class, see module documentation for more information. 
    '''</span>

    <span class="s1">icon </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">, </span><span class="s1">allownone</span><span class="s2">=</span><span class="s4">True</span><span class="s2">)</span>
    <span class="s3">''' 
    Source image to use when the Button is part of the ActionBar. If the 
    Button is in a group, the text will be preferred. 
    '''</span>


<span class="s4">class </span><span class="s1">ActionLabel</span><span class="s2">(</span><span class="s1">ActionItem</span><span class="s2">, </span><span class="s1">Label</span><span class="s2">):</span>
    <span class="s0">''' 
    ActionLabel class, see module documentation for more information. 
    '''</span>
    <span class="s4">pass</span>


<span class="s4">class </span><span class="s1">ActionCheck</span><span class="s2">(</span><span class="s1">ActionItem</span><span class="s2">, </span><span class="s1">CheckBox</span><span class="s2">):</span>
    <span class="s0">''' 
    ActionCheck class, see module documentation for more information. 
    '''</span>
    <span class="s4">pass</span>


<span class="s4">class </span><span class="s1">ActionSeparator</span><span class="s2">(</span><span class="s1">ActionItem</span><span class="s2">, </span><span class="s1">Widget</span><span class="s2">):</span>
    <span class="s0">''' 
    ActionSeparator class, see module documentation for more information. 
    '''</span>

    <span class="s1">background_image </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span>
        <span class="s3">'atlas://data/images/defaulttheme/separator'</span><span class="s2">)</span>
    <span class="s3">''' 
    Background image for the separators default graphical representation. 
 
    :attr:`background_image` is a :class:`~kivy.properties.StringProperty` 
    and defaults to 'atlas://data/images/defaulttheme/separator'. 
    '''</span>


<span class="s4">class </span><span class="s1">ActionDropDown</span><span class="s2">(</span><span class="s1">DropDown</span><span class="s2">):</span>
    <span class="s0">''' 
    ActionDropDown class, see module documentation for more information. 
    '''</span>


<span class="s4">class </span><span class="s1">ActionGroup</span><span class="s2">(</span><span class="s1">ActionItem</span><span class="s2">, </span><span class="s1">Button</span><span class="s2">):</span>
    <span class="s0">''' 
    ActionGroup class, see module documentation for more information. 
    '''</span>

    <span class="s1">use_separator </span><span class="s2">= </span><span class="s1">BooleanProperty</span><span class="s2">(</span><span class="s4">False</span><span class="s2">)</span>
    <span class="s3">''' 
    Specifies whether to use a separator after/before this group or not. 
 
    :attr:`use_separator` is a :class:`~kivy.properties.BooleanProperty` and 
    defaults to False. 
    '''</span>

    <span class="s1">separator_image </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span>
        <span class="s3">'atlas://data/images/defaulttheme/separator'</span><span class="s2">)</span>
    <span class="s3">''' 
    Background Image for an ActionSeparator in an ActionView. 
 
    :attr:`separator_image` is a :class:`~kivy.properties.StringProperty` 
    and defaults to 'atlas://data/images/defaulttheme/separator'. 
    '''</span>

    <span class="s1">separator_width </span><span class="s2">= </span><span class="s1">NumericProperty</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s3">''' 
    Width of the ActionSeparator in an ActionView. 
 
    :attr:`separator_width` is a :class:`~kivy.properties.NumericProperty` 
    and defaults to 0. 
    '''</span>

    <span class="s1">mode </span><span class="s2">= </span><span class="s1">OptionProperty</span><span class="s2">(</span><span class="s3">'normal'</span><span class="s2">, </span><span class="s1">options</span><span class="s2">=(</span><span class="s3">'normal'</span><span class="s2">, </span><span class="s3">'spinner'</span><span class="s2">))</span>
    <span class="s3">''' 
    Sets the current mode of an ActionGroup. If mode is 'normal', the 
    ActionGroups children will be displayed normally if there is enough 
    space, otherwise they will be displayed in a spinner. If mode is 
    'spinner', then the children will always be displayed in a spinner. 
 
    :attr:`mode` is an :class:`~kivy.properties.OptionProperty` and defaults 
    to 'normal'. 
    '''</span>

    <span class="s1">dropdown_width </span><span class="s2">= </span><span class="s1">NumericProperty</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s3">''' 
    If non zero, provides the width for the associated DropDown. This is 
    useful when some items in the ActionGroup's DropDown are wider than usual 
    and you don't want to make the ActionGroup widget itself wider. 
 
    :attr:`dropdown_width` is a :class:`~kivy.properties.NumericProperty` 
    and defaults to 0. 
 
    .. versionadded:: 1.10.0 
    '''</span>

    <span class="s1">is_open </span><span class="s2">= </span><span class="s1">BooleanProperty</span><span class="s2">(</span><span class="s4">False</span><span class="s2">)</span>
    <span class="s3">'''By default, the DropDown is not open. Set to True to open it. 
 
    :attr:`is_open` is a :class:`~kivy.properties.BooleanProperty` and 
    defaults to False. 
    '''</span>

    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">list_action_item </span><span class="s2">= []</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_list_overflow_items </span><span class="s2">= []</span>
        <span class="s1">super</span><span class="s2">(</span><span class="s1">ActionGroup</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">__init__</span><span class="s2">(**</span><span class="s1">kwargs</span><span class="s2">)</span>

        <span class="s6"># real is_open independent on public event</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_is_open </span><span class="s2">= </span><span class="s4">False</span>

        <span class="s6"># create DropDown for the group and save its state to _is_open</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_dropdown </span><span class="s2">= </span><span class="s1">ActionDropDown</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_dropdown</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">attach_to</span><span class="s2">=</span><span class="s4">lambda </span><span class="s1">ins</span><span class="s2">, </span><span class="s1">value</span><span class="s2">: </span><span class="s1">setattr</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">, </span><span class="s3">'_is_open'</span><span class="s2">, </span><span class="s4">True if </span><span class="s1">value </span><span class="s4">else False</span>
        <span class="s2">))</span>

        <span class="s6"># put open/close responsibility to the event</span>
        <span class="s6"># - trigger dropdown opening when clicked</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">on_release</span><span class="s2">=</span><span class="s4">lambda </span><span class="s2">*</span><span class="s1">args</span><span class="s2">: </span><span class="s1">setattr</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">, </span><span class="s3">'is_open'</span><span class="s2">, </span><span class="s4">True</span>
        <span class="s2">))</span>

        <span class="s6"># - trigger dropdown closing when an item</span>
        <span class="s6">#   in the dropdown is clicked</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_dropdown</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">on_dismiss</span><span class="s2">=</span><span class="s4">lambda </span><span class="s2">*</span><span class="s1">args</span><span class="s2">: </span><span class="s1">setattr</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">, </span><span class="s3">'is_open'</span><span class="s2">, </span><span class="s4">False</span>
        <span class="s2">))</span>

    <span class="s4">def </span><span class="s1">on_is_open</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s6"># opening only if the DropDown is closed</span>
        <span class="s4">if </span><span class="s1">value </span><span class="s4">and not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_is_open</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_toggle_dropdown</span><span class="s2">()</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_dropdown</span><span class="s2">.</span><span class="s1">open</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>
            <span class="s4">return</span>

        <span class="s6"># closing is_open manually, dismiss manually</span>
        <span class="s4">if not </span><span class="s1">value </span><span class="s4">and </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_is_open</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_dropdown</span><span class="s2">.</span><span class="s1">dismiss</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">_toggle_dropdown</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">largs</span><span class="s2">):</span>
        <span class="s1">ddn </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_dropdown</span>
        <span class="s1">ddn</span><span class="s2">.</span><span class="s1">size_hint_x </span><span class="s2">= </span><span class="s4">None</span>

        <span class="s6"># if container was set incorrectly and/or is missing</span>
        <span class="s4">if not </span><span class="s1">ddn</span><span class="s2">.</span><span class="s1">container</span><span class="s2">:</span>
            <span class="s4">return</span>
        <span class="s1">children </span><span class="s2">= </span><span class="s1">ddn</span><span class="s2">.</span><span class="s1">container</span><span class="s2">.</span><span class="s1">children</span>

        <span class="s6"># set DropDown width manually or if not set, then widen</span>
        <span class="s6"># the ActionGroup + DropDown until the widest child fits</span>
        <span class="s4">if </span><span class="s1">children</span><span class="s2">:</span>
            <span class="s1">ddn</span><span class="s2">.</span><span class="s1">width </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">dropdown_width </span><span class="s4">or </span><span class="s1">max</span><span class="s2">(</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">width</span><span class="s2">, </span><span class="s1">max</span><span class="s2">(</span><span class="s1">c</span><span class="s2">.</span><span class="s1">pack_width </span><span class="s4">for </span><span class="s1">c </span><span class="s4">in </span><span class="s1">children</span><span class="s2">)</span>
            <span class="s2">)</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">ddn</span><span class="s2">.</span><span class="s1">width </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">width</span>

        <span class="s6"># set the DropDown children's height</span>
        <span class="s4">for </span><span class="s1">item </span><span class="s4">in </span><span class="s1">children</span><span class="s2">:</span>
            <span class="s1">item</span><span class="s2">.</span><span class="s1">size_hint_y </span><span class="s2">= </span><span class="s4">None</span>
            <span class="s1">item</span><span class="s2">.</span><span class="s1">height </span><span class="s2">= </span><span class="s1">max</span><span class="s2">([</span><span class="s1">self</span><span class="s2">.</span><span class="s1">height</span><span class="s2">, </span><span class="s1">sp</span><span class="s2">(</span><span class="s5">48</span><span class="s2">)])</span>

            <span class="s6"># dismiss DropDown manually</span>
            <span class="s6"># auto_dismiss applies to touching outside of the DropDown</span>
            <span class="s1">item</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">on_release</span><span class="s2">=</span><span class="s1">ddn</span><span class="s2">.</span><span class="s1">dismiss</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">widget</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s0">''' 
        .. versionchanged:: 2.1.0 
            Renamed argument `item` to `widget`. 
        '''</span>
        <span class="s6"># if adding ActionSeparator ('normal' mode,</span>
        <span class="s6"># everything visible), add it to the parent</span>
        <span class="s4">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, </span><span class="s1">ActionSeparator</span><span class="s2">):</span>
            <span class="s1">super</span><span class="s2">(</span><span class="s1">ActionGroup</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>
            <span class="s4">return</span>

        <span class="s4">if not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, </span><span class="s1">ActionItem</span><span class="s2">):</span>
            <span class="s4">raise </span><span class="s1">ActionBarException</span><span class="s2">(</span><span class="s3">'ActionGroup only accepts ActionItem'</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">list_action_item</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">show_group</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6"># 'normal' mode, items can fit to the view</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">clear_widgets</span><span class="s2">()</span>
        <span class="s4">for </span><span class="s1">item </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_list_overflow_items </span><span class="s2">+ </span><span class="s1">self</span><span class="s2">.</span><span class="s1">list_action_item</span><span class="s2">:</span>
            <span class="s1">item</span><span class="s2">.</span><span class="s1">inside_group </span><span class="s2">= </span><span class="s4">True</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_dropdown</span><span class="s2">.</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">item</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">clear_widgets</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_dropdown</span><span class="s2">.</span><span class="s1">clear_widgets</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>


<span class="s4">class </span><span class="s1">ActionOverflow</span><span class="s2">(</span><span class="s1">ActionGroup</span><span class="s2">):</span>
    <span class="s0">''' 
    ActionOverflow class, see module documentation for more information. 
    '''</span>

    <span class="s1">overflow_image </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span>
        <span class="s3">'atlas://data/images/defaulttheme/overflow'</span><span class="s2">)</span>
    <span class="s3">''' 
    Image to be used as an Overflow Image. 
 
    :attr:`overflow_image` is a :class:`~kivy.properties.StringProperty` 
    and defaults to 'atlas://data/images/defaulttheme/overflow'. 
    '''</span>

    <span class="s4">def </span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">widget</span><span class="s2">, </span><span class="s1">index</span><span class="s2">=</span><span class="s5">0</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s0">''' 
        .. versionchanged:: 2.1.0 
             Renamed argument `action_item` to `widget`. 
        '''</span>
        <span class="s4">if </span><span class="s1">widget </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s4">return</span>

        <span class="s4">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, </span><span class="s1">ActionSeparator</span><span class="s2">):</span>
            <span class="s4">return</span>

        <span class="s4">if not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, </span><span class="s1">ActionItem</span><span class="s2">):</span>
            <span class="s4">raise </span><span class="s1">ActionBarException</span><span class="s2">(</span><span class="s3">'ActionView only accepts ActionItem'</span>
                                     <span class="s3">' (got {!r}'</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">))</span>

        <span class="s4">else</span><span class="s2">:</span>
            <span class="s4">if </span><span class="s1">index </span><span class="s2">== </span><span class="s5">0</span><span class="s2">:</span>
                <span class="s1">index </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_list_overflow_items</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_list_overflow_items</span><span class="s2">.</span><span class="s1">insert</span><span class="s2">(</span><span class="s1">index</span><span class="s2">, </span><span class="s1">widget</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">show_default_items</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">parent</span><span class="s2">):</span>
        <span class="s6"># display overflow and its items if widget's directly added to it</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_list_overflow_items </span><span class="s2">== []:</span>
            <span class="s4">return</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">show_group</span><span class="s2">()</span>
        <span class="s1">super</span><span class="s2">(</span><span class="s1">ActionView</span><span class="s2">, </span><span class="s1">parent</span><span class="s2">).</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>


<span class="s4">class </span><span class="s1">ActionView</span><span class="s2">(</span><span class="s1">BoxLayout</span><span class="s2">):</span>
    <span class="s0">''' 
    ActionView class, see module documentation for more information. 
    '''</span>

    <span class="s1">action_previous </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">)</span>
    <span class="s3">''' 
    Previous button for an ActionView. 
 
    :attr:`action_previous` is an :class:`~kivy.properties.ObjectProperty` 
    and defaults to None. 
    '''</span>

    <span class="s1">background_color </span><span class="s2">= </span><span class="s1">ColorProperty</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">])</span>
    <span class="s3">''' 
    Background color in the format (r, g, b, a). 
 
    :attr:`background_color` is a :class:`~kivy.properties.ColorProperty` and 
    defaults to [1, 1, 1, 1]. 
 
    .. versionchanged:: 2.0.0 
        Changed from :class:`~kivy.properties.ListProperty` to 
        :class:`~kivy.properties.ColorProperty`. 
    '''</span>

    <span class="s1">background_image </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span>
        <span class="s3">'atlas://data/images/defaulttheme/action_view'</span><span class="s2">)</span>
    <span class="s3">''' 
    Background image of an ActionViews default graphical representation. 
 
    :attr:`background_image` is a :class:`~kivy.properties.StringProperty` 
    and defaults to 'atlas://data/images/defaulttheme/action_view'. 
    '''</span>

    <span class="s1">use_separator </span><span class="s2">= </span><span class="s1">BooleanProperty</span><span class="s2">(</span><span class="s4">False</span><span class="s2">)</span>
    <span class="s3">''' 
    Specify whether to use a separator before every ActionGroup or not. 
 
    :attr:`use_separator` is a :class:`~kivy.properties.BooleanProperty` and 
    defaults to False. 
    '''</span>

    <span class="s1">overflow_group </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">)</span>
    <span class="s3">''' 
    Widget to be used for the overflow. 
 
    :attr:`overflow_group` is an :class:`~kivy.properties.ObjectProperty` and 
    defaults to an instance of :class:`ActionOverflow`. 
    '''</span>

    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_list_action_items </span><span class="s2">= []</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_list_action_group </span><span class="s2">= []</span>
        <span class="s1">super</span><span class="s2">(</span><span class="s1">ActionView</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">__init__</span><span class="s2">(**</span><span class="s1">kwargs</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_state </span><span class="s2">= </span><span class="s3">''</span>
        <span class="s4">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">overflow_group</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">overflow_group </span><span class="s2">= </span><span class="s1">ActionOverflow</span><span class="s2">(</span>
                <span class="s1">use_separator</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">use_separator</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">on_action_previous</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_list_action_items</span><span class="s2">.</span><span class="s1">insert</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">widget</span><span class="s2">, </span><span class="s1">index</span><span class="s2">=</span><span class="s5">0</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s0">''' 
        .. versionchanged:: 2.1.0 
            Renamed argument `action_item` to `widget`. 
        '''</span>
        <span class="s4">if </span><span class="s1">widget </span><span class="s4">is None</span><span class="s2">:</span>
            <span class="s4">return</span>

        <span class="s4">if not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, </span><span class="s1">ActionItem</span><span class="s2">):</span>
            <span class="s4">raise </span><span class="s1">ActionBarException</span><span class="s2">(</span><span class="s3">'ActionView only accepts ActionItem'</span>
                                     <span class="s3">' (got {!r}'</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">))</span>

        <span class="s4">elif </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, </span><span class="s1">ActionOverflow</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">overflow_group </span><span class="s2">= </span><span class="s1">widget</span>
            <span class="s1">widget</span><span class="s2">.</span><span class="s1">use_separator </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">use_separator</span>

        <span class="s4">elif </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, </span><span class="s1">ActionGroup</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_list_action_group</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">)</span>
            <span class="s1">widget</span><span class="s2">.</span><span class="s1">use_separator </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">use_separator</span>

        <span class="s4">elif </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, </span><span class="s1">ActionPrevious</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">action_previous </span><span class="s2">= </span><span class="s1">widget</span>

        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">super</span><span class="s2">(</span><span class="s1">ActionView</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, </span><span class="s1">index</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>
            <span class="s4">if </span><span class="s1">index </span><span class="s2">== </span><span class="s5">0</span><span class="s2">:</span>
                <span class="s1">index </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_list_action_items</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_list_action_items</span><span class="s2">.</span><span class="s1">insert</span><span class="s2">(</span><span class="s1">index</span><span class="s2">, </span><span class="s1">widget</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">on_use_separator</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s4">for </span><span class="s1">group </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_list_action_group</span><span class="s2">:</span>
            <span class="s1">group</span><span class="s2">.</span><span class="s1">use_separator </span><span class="s2">= </span><span class="s1">value</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">overflow_group</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">overflow_group</span><span class="s2">.</span><span class="s1">use_separator </span><span class="s2">= </span><span class="s1">value</span>

    <span class="s4">def </span><span class="s1">remove_widget</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">widget</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s1">super</span><span class="s2">(</span><span class="s1">ActionView</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">remove_widget</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, </span><span class="s1">ActionOverflow</span><span class="s2">):</span>
            <span class="s4">for </span><span class="s1">item </span><span class="s4">in </span><span class="s1">widget</span><span class="s2">.</span><span class="s1">list_action_item</span><span class="s2">:</span>
                <span class="s4">if </span><span class="s1">item </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_list_action_items</span><span class="s2">:</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">_list_action_items</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">item</span><span class="s2">)</span>

        <span class="s4">if </span><span class="s1">widget </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_list_action_items</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_list_action_items</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">_clear_all</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">lst </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_list_action_items</span><span class="s2">[:]</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">clear_widgets</span><span class="s2">()</span>
        <span class="s4">for </span><span class="s1">group </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_list_action_group</span><span class="s2">:</span>
            <span class="s1">group</span><span class="s2">.</span><span class="s1">clear_widgets</span><span class="s2">()</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">overflow_group</span><span class="s2">.</span><span class="s1">clear_widgets</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">overflow_group</span><span class="s2">.</span><span class="s1">list_action_item </span><span class="s2">= []</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_list_action_items </span><span class="s2">= </span><span class="s1">lst</span>

    <span class="s4">def </span><span class="s1">_layout_all</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6"># all the items can fit to the view, so expand everything</span>
        <span class="s1">super_add </span><span class="s2">= </span><span class="s1">super</span><span class="s2">(</span><span class="s1">ActionView</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">add_widget</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_state </span><span class="s2">= </span><span class="s3">'all'</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_clear_all</span><span class="s2">()</span>
        <span class="s4">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">action_previous</span><span class="s2">.</span><span class="s1">parent</span><span class="s2">:</span>
            <span class="s1">super_add</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">action_previous</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_list_action_items</span><span class="s2">) &gt; </span><span class="s5">1</span><span class="s2">:</span>
            <span class="s4">for </span><span class="s1">child </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_list_action_items</span><span class="s2">[</span><span class="s5">1</span><span class="s2">:]:</span>
                <span class="s1">child</span><span class="s2">.</span><span class="s1">inside_group </span><span class="s2">= </span><span class="s4">False</span>
                <span class="s1">super_add</span><span class="s2">(</span><span class="s1">child</span><span class="s2">)</span>

        <span class="s4">for </span><span class="s1">group </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_list_action_group</span><span class="s2">:</span>
            <span class="s4">if </span><span class="s1">group</span><span class="s2">.</span><span class="s1">mode </span><span class="s2">== </span><span class="s3">'spinner'</span><span class="s2">:</span>
                <span class="s1">super_add</span><span class="s2">(</span><span class="s1">group</span><span class="s2">)</span>
                <span class="s1">group</span><span class="s2">.</span><span class="s1">show_group</span><span class="s2">()</span>
            <span class="s4">else</span><span class="s2">:</span>
                <span class="s4">if </span><span class="s1">group</span><span class="s2">.</span><span class="s1">list_action_item </span><span class="s2">!= []:</span>
                    <span class="s1">super_add</span><span class="s2">(</span><span class="s1">ActionSeparator</span><span class="s2">())</span>
                <span class="s4">for </span><span class="s1">child </span><span class="s4">in </span><span class="s1">group</span><span class="s2">.</span><span class="s1">list_action_item</span><span class="s2">:</span>
                    <span class="s1">child</span><span class="s2">.</span><span class="s1">inside_group </span><span class="s2">= </span><span class="s4">False</span>
                    <span class="s1">super_add</span><span class="s2">(</span><span class="s1">child</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">overflow_group</span><span class="s2">.</span><span class="s1">show_default_items</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">_layout_group</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6"># layout all the items in order to pack them per group</span>
        <span class="s1">super_add </span><span class="s2">= </span><span class="s1">super</span><span class="s2">(</span><span class="s1">ActionView</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">add_widget</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_state </span><span class="s2">= </span><span class="s3">'group'</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_clear_all</span><span class="s2">()</span>
        <span class="s4">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">action_previous</span><span class="s2">.</span><span class="s1">parent</span><span class="s2">:</span>
            <span class="s1">super_add</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">action_previous</span><span class="s2">)</span>
        <span class="s4">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_list_action_items</span><span class="s2">) &gt; </span><span class="s5">1</span><span class="s2">:</span>
            <span class="s4">for </span><span class="s1">child </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_list_action_items</span><span class="s2">[</span><span class="s5">1</span><span class="s2">:]:</span>
                <span class="s1">super_add</span><span class="s2">(</span><span class="s1">child</span><span class="s2">)</span>
                <span class="s1">child</span><span class="s2">.</span><span class="s1">inside_group </span><span class="s2">= </span><span class="s4">False</span>

        <span class="s4">for </span><span class="s1">group </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_list_action_group</span><span class="s2">:</span>
            <span class="s1">super_add</span><span class="s2">(</span><span class="s1">group</span><span class="s2">)</span>
            <span class="s1">group</span><span class="s2">.</span><span class="s1">show_group</span><span class="s2">()</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">overflow_group</span><span class="s2">.</span><span class="s1">show_default_items</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">_layout_random</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6"># layout the items in order to pack all of them grouped, and display</span>
        <span class="s6"># only the action items having 'important'</span>
        <span class="s1">super_add </span><span class="s2">= </span><span class="s1">super</span><span class="s2">(</span><span class="s1">ActionView</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">add_widget</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_state </span><span class="s2">= </span><span class="s3">'random'</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_clear_all</span><span class="s2">()</span>
        <span class="s1">hidden_items </span><span class="s2">= []</span>
        <span class="s1">hidden_groups </span><span class="s2">= []</span>
        <span class="s1">total_width </span><span class="s2">= </span><span class="s5">0</span>
        <span class="s4">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">action_previous</span><span class="s2">.</span><span class="s1">parent</span><span class="s2">:</span>
            <span class="s1">super_add</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">action_previous</span><span class="s2">)</span>

        <span class="s1">width </span><span class="s2">= (</span><span class="s1">self</span><span class="s2">.</span><span class="s1">width </span><span class="s2">- </span><span class="s1">self</span><span class="s2">.</span><span class="s1">overflow_group</span><span class="s2">.</span><span class="s1">pack_width </span><span class="s2">-</span>
                 <span class="s1">self</span><span class="s2">.</span><span class="s1">action_previous</span><span class="s2">.</span><span class="s1">minimum_width</span><span class="s2">)</span>

        <span class="s4">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_list_action_items</span><span class="s2">):</span>
            <span class="s4">for </span><span class="s1">child </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_list_action_items</span><span class="s2">[</span><span class="s5">1</span><span class="s2">:]:</span>
                <span class="s4">if </span><span class="s1">child</span><span class="s2">.</span><span class="s1">important</span><span class="s2">:</span>
                    <span class="s4">if </span><span class="s1">child</span><span class="s2">.</span><span class="s1">pack_width </span><span class="s2">+ </span><span class="s1">total_width </span><span class="s2">&lt; </span><span class="s1">width</span><span class="s2">:</span>
                        <span class="s1">super_add</span><span class="s2">(</span><span class="s1">child</span><span class="s2">)</span>
                        <span class="s1">child</span><span class="s2">.</span><span class="s1">inside_group </span><span class="s2">= </span><span class="s4">False</span>
                        <span class="s1">total_width </span><span class="s2">+= </span><span class="s1">child</span><span class="s2">.</span><span class="s1">pack_width</span>
                    <span class="s4">else</span><span class="s2">:</span>
                        <span class="s1">hidden_items</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">child</span><span class="s2">)</span>
                <span class="s4">else</span><span class="s2">:</span>
                    <span class="s1">hidden_items</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">child</span><span class="s2">)</span>

        <span class="s6"># if space is left then display ActionItem inside their</span>
        <span class="s6"># ActionGroup</span>
        <span class="s4">if </span><span class="s1">total_width </span><span class="s2">&lt; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">width</span><span class="s2">:</span>
            <span class="s4">for </span><span class="s1">group </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_list_action_group</span><span class="s2">:</span>
                <span class="s4">if </span><span class="s1">group</span><span class="s2">.</span><span class="s1">pack_width </span><span class="s2">+ </span><span class="s1">total_width </span><span class="s2">+</span><span class="s1">\</span>
                        <span class="s1">group</span><span class="s2">.</span><span class="s1">separator_width </span><span class="s2">&lt; </span><span class="s1">width</span><span class="s2">:</span>
                    <span class="s1">super_add</span><span class="s2">(</span><span class="s1">group</span><span class="s2">)</span>
                    <span class="s1">group</span><span class="s2">.</span><span class="s1">show_group</span><span class="s2">()</span>
                    <span class="s1">total_width </span><span class="s2">+= (</span><span class="s1">group</span><span class="s2">.</span><span class="s1">pack_width </span><span class="s2">+</span>
                                    <span class="s1">group</span><span class="s2">.</span><span class="s1">separator_width</span><span class="s2">)</span>

                <span class="s4">else</span><span class="s2">:</span>
                    <span class="s1">hidden_groups</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">group</span><span class="s2">)</span>
        <span class="s1">group_index </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">children</span><span class="s2">) - </span><span class="s5">1</span>
        <span class="s6"># if space is left then display other ActionItems</span>
        <span class="s4">if </span><span class="s1">total_width </span><span class="s2">&lt; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">width</span><span class="s2">:</span>
            <span class="s4">for </span><span class="s1">child </span><span class="s4">in </span><span class="s1">hidden_items</span><span class="s2">[:]:</span>
                <span class="s4">if </span><span class="s1">child</span><span class="s2">.</span><span class="s1">pack_width </span><span class="s2">+ </span><span class="s1">total_width </span><span class="s2">&lt; </span><span class="s1">width</span><span class="s2">:</span>
                    <span class="s1">super_add</span><span class="s2">(</span><span class="s1">child</span><span class="s2">, </span><span class="s1">group_index</span><span class="s2">)</span>
                    <span class="s1">total_width </span><span class="s2">+= </span><span class="s1">child</span><span class="s2">.</span><span class="s1">pack_width</span>
                    <span class="s1">child</span><span class="s2">.</span><span class="s1">inside_group </span><span class="s2">= </span><span class="s4">False</span>
                    <span class="s1">hidden_items</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">child</span><span class="s2">)</span>

        <span class="s6"># for all the remaining ActionItems and ActionItems with in</span>
        <span class="s6"># ActionGroups, Display them inside overflow_group</span>
        <span class="s1">extend_hidden </span><span class="s2">= </span><span class="s1">hidden_items</span><span class="s2">.</span><span class="s1">extend</span>
        <span class="s4">for </span><span class="s1">group </span><span class="s4">in </span><span class="s1">hidden_groups</span><span class="s2">:</span>
            <span class="s1">extend_hidden</span><span class="s2">(</span><span class="s1">group</span><span class="s2">.</span><span class="s1">list_action_item</span><span class="s2">)</span>

        <span class="s1">overflow_group </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">overflow_group</span>

        <span class="s4">if </span><span class="s1">hidden_items </span><span class="s2">!= []:</span>
            <span class="s1">over_add </span><span class="s2">= </span><span class="s1">super</span><span class="s2">(</span><span class="s1">overflow_group</span><span class="s2">.</span><span class="s1">__class__</span><span class="s2">,</span>
                             <span class="s1">overflow_group</span><span class="s2">).</span><span class="s1">add_widget</span>
            <span class="s4">for </span><span class="s1">child </span><span class="s4">in </span><span class="s1">hidden_items</span><span class="s2">:</span>
                <span class="s1">over_add</span><span class="s2">(</span><span class="s1">child</span><span class="s2">)</span>

            <span class="s1">overflow_group</span><span class="s2">.</span><span class="s1">show_group</span><span class="s2">()</span>
            <span class="s4">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">overflow_group</span><span class="s2">.</span><span class="s1">parent</span><span class="s2">:</span>
                <span class="s1">super_add</span><span class="s2">(</span><span class="s1">overflow_group</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">on_width</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">width</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">):</span>
        <span class="s6"># determine the layout to use</span>

        <span class="s6"># can we display all of them?</span>
        <span class="s1">total_width </span><span class="s2">= </span><span class="s5">0</span>
        <span class="s4">for </span><span class="s1">child </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_list_action_items</span><span class="s2">:</span>
            <span class="s1">total_width </span><span class="s2">+= </span><span class="s1">child</span><span class="s2">.</span><span class="s1">pack_width</span>
        <span class="s4">for </span><span class="s1">group </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_list_action_group</span><span class="s2">:</span>
            <span class="s4">for </span><span class="s1">child </span><span class="s4">in </span><span class="s1">group</span><span class="s2">.</span><span class="s1">list_action_item</span><span class="s2">:</span>
                <span class="s1">total_width </span><span class="s2">+= </span><span class="s1">child</span><span class="s2">.</span><span class="s1">pack_width</span>
        <span class="s4">if </span><span class="s1">total_width </span><span class="s2">&lt;= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">width</span><span class="s2">:</span>
            <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_state </span><span class="s2">!= </span><span class="s3">'all'</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">_layout_all</span><span class="s2">()</span>
            <span class="s4">return</span>

        <span class="s6"># can we display them per group?</span>
        <span class="s1">total_width </span><span class="s2">= </span><span class="s5">0</span>
        <span class="s4">for </span><span class="s1">child </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_list_action_items</span><span class="s2">:</span>
            <span class="s1">total_width </span><span class="s2">+= </span><span class="s1">child</span><span class="s2">.</span><span class="s1">pack_width</span>
        <span class="s4">for </span><span class="s1">group </span><span class="s4">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_list_action_group</span><span class="s2">:</span>
            <span class="s1">total_width </span><span class="s2">+= </span><span class="s1">group</span><span class="s2">.</span><span class="s1">pack_width</span>
        <span class="s4">if </span><span class="s1">total_width </span><span class="s2">&lt; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">width</span><span class="s2">:</span>
            <span class="s6"># ok, we can display all the items grouped</span>
            <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_state </span><span class="s2">!= </span><span class="s3">'group'</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">_layout_group</span><span class="s2">()</span>
            <span class="s4">return</span>

        <span class="s6"># none of the solutions worked, display them in pack mode</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_layout_random</span><span class="s2">()</span>


<span class="s4">class </span><span class="s1">ContextualActionView</span><span class="s2">(</span><span class="s1">ActionView</span><span class="s2">):</span>
    <span class="s0">''' 
    ContextualActionView class, see the module documentation for more 
    information. 
    '''</span>
    <span class="s4">pass</span>


<span class="s4">class </span><span class="s1">ActionBar</span><span class="s2">(</span><span class="s1">BoxLayout</span><span class="s2">):</span>
    <span class="s0">''' 
    ActionBar class, which acts as the main container for an 
    :class:`ActionView` instance. The ActionBar determines the overall 
    styling aspects of the bar. :class:`ActionItem`\\s are not added to 
    this class directly, but to the contained :class:`ActionView` instance. 
 
    :Events: 
        `on_previous` 
            Fired when action_previous of action_view is pressed. 
 
    Please see the module documentation for more information. 
    '''</span>

    <span class="s1">action_view </span><span class="s2">= </span><span class="s1">ObjectProperty</span><span class="s2">(</span><span class="s4">None</span><span class="s2">)</span>
    <span class="s3">''' 
    action_view of the ActionBar. 
 
    :attr:`action_view` is an :class:`~kivy.properties.ObjectProperty` and 
    defaults to None or the last ActionView instance added to the ActionBar. 
    '''</span>

    <span class="s1">background_color </span><span class="s2">= </span><span class="s1">ColorProperty</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">])</span>
    <span class="s3">''' 
    Background color, in the format (r, g, b, a). 
 
    :attr:`background_color` is a :class:`~kivy.properties.ColorProperty` and 
    defaults to [1, 1, 1, 1]. 
 
    .. versionchanged:: 2.0.0 
        Changed from :class:`~kivy.properties.ListProperty` to 
        :class:`~kivy.properties.ColorProperty`. 
    '''</span>

    <span class="s1">background_image </span><span class="s2">= </span><span class="s1">StringProperty</span><span class="s2">(</span>
        <span class="s3">'atlas://data/images/defaulttheme/action_bar'</span><span class="s2">)</span>

    <span class="s3">''' 
    Background image of the ActionBars default graphical representation. 
 
    :attr:`background_image` is a :class:`~kivy.properties.StringProperty` 
    and defaults to 'atlas://data/images/defaulttheme/action_bar'. 
    '''</span>

    <span class="s1">border </span><span class="s2">= </span><span class="s1">ListProperty</span><span class="s2">([</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">])</span>
    <span class="s3">''' 
    The border to be applied to the :attr:`background_image`. 
 
    :attr:`border` is a :class:`~kivy.properties.ListProperty` and defaults to 
    [2, 2, 2, 2] 
    '''</span>

    <span class="s1">__events__ </span><span class="s2">= (</span><span class="s3">'on_previous'</span><span class="s2">,)</span>

    <span class="s4">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s1">super</span><span class="s2">(</span><span class="s1">ActionBar</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">__init__</span><span class="s2">(**</span><span class="s1">kwargs</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_stack_cont_action_view </span><span class="s2">= []</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_emit_previous </span><span class="s2">= </span><span class="s1">partial</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dispatch</span><span class="s2">, </span><span class="s3">'on_previous'</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">widget</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s0">''' 
        .. versionchanged:: 2.1.0 
            Renamed argument `view` to `widget`. 
        '''</span>
        <span class="s4">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, </span><span class="s1">ContextualActionView</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_stack_cont_action_view</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">)</span>
            <span class="s4">if </span><span class="s1">widget</span><span class="s2">.</span><span class="s1">action_previous </span><span class="s4">is not None</span><span class="s2">:</span>
                <span class="s1">widget</span><span class="s2">.</span><span class="s1">action_previous</span><span class="s2">.</span><span class="s1">unbind</span><span class="s2">(</span><span class="s1">on_release</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_emit_previous</span><span class="s2">)</span>
                <span class="s1">widget</span><span class="s2">.</span><span class="s1">action_previous</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s1">on_release</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_emit_previous</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">clear_widgets</span><span class="s2">()</span>
            <span class="s1">super</span><span class="s2">(</span><span class="s1">ActionBar</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>

        <span class="s4">elif </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, </span><span class="s1">ActionView</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">action_view </span><span class="s2">= </span><span class="s1">widget</span>
            <span class="s1">super</span><span class="s2">(</span><span class="s1">ActionBar</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">widget</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>

        <span class="s4">else</span><span class="s2">:</span>
            <span class="s4">raise </span><span class="s1">ActionBarException</span><span class="s2">(</span>
                <span class="s3">'ActionBar can only add ContextualActionView or ActionView'</span><span class="s2">)</span>

    <span class="s4">def </span><span class="s1">on_previous</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_pop_contextual_action_view</span><span class="s2">()</span>

    <span class="s4">def </span><span class="s1">_pop_contextual_action_view</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">'''Remove the current ContextualActionView and display either the 
           previous one or the ActionView. 
        '''</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_stack_cont_action_view</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">clear_widgets</span><span class="s2">()</span>
        <span class="s4">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_stack_cont_action_view </span><span class="s2">== []:</span>
            <span class="s1">super</span><span class="s2">(</span><span class="s1">ActionBar</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">action_view</span><span class="s2">)</span>
        <span class="s4">else</span><span class="s2">:</span>
            <span class="s1">super</span><span class="s2">(</span><span class="s1">ActionBar</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">add_widget</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_stack_cont_action_view</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">])</span>


<span class="s4">if </span><span class="s1">__name__ </span><span class="s2">== </span><span class="s3">&quot;__main__&quot;</span><span class="s2">:</span>
    <span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">base </span><span class="s4">import </span><span class="s1">runTouchApp</span>
    <span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">uix</span><span class="s2">.</span><span class="s1">floatlayout </span><span class="s4">import </span><span class="s1">FloatLayout</span>
    <span class="s4">from </span><span class="s1">kivy</span><span class="s2">.</span><span class="s1">factory </span><span class="s4">import </span><span class="s1">Factory</span>

    <span class="s6"># XXX clean the first registration done from '__main__' here.</span>
    <span class="s6"># otherwise kivy.uix.actionbar.ActionPrevious != __main__.ActionPrevious</span>
    <span class="s1">Factory</span><span class="s2">.</span><span class="s1">unregister</span><span class="s2">(</span><span class="s3">'ActionPrevious'</span><span class="s2">)</span>

    <span class="s1">Builder</span><span class="s2">.</span><span class="s1">load_string</span><span class="s2">(</span><span class="s3">''' 
&lt;MainWindow&gt;: 
    ActionBar: 
        pos_hint: {'top':1} 
        ActionView: 
            use_separator: True 
            ActionPrevious: 
                title: 'Action Bar' 
                with_previous: False 
            ActionOverflow: 
            ActionButton: 
                text: 'Btn0' 
                icon: 'atlas://data/images/defaulttheme/audio-volume-high' 
            ActionButton: 
                text: 'Btn1' 
            ActionButton: 
                text: 'Btn2' 
            ActionGroup: 
                text: 'Group 1' 
                ActionButton: 
                    text: 'Btn3' 
                ActionButton: 
                    text: 'Btn4' 
            ActionGroup: 
                dropdown_width: 200 
                text: 'Group 2' 
                ActionButton: 
                    text: 'Btn5' 
                ActionButton: 
                    text: 'Btn6' 
                ActionButton: 
                    text: 'Btn7' 
'''</span><span class="s2">)</span>

    <span class="s4">class </span><span class="s1">MainWindow</span><span class="s2">(</span><span class="s1">FloatLayout</span><span class="s2">):</span>
        <span class="s4">pass</span>

    <span class="s1">float_layout </span><span class="s2">= </span><span class="s1">MainWindow</span><span class="s2">()</span>
    <span class="s1">runTouchApp</span><span class="s2">(</span><span class="s1">float_layout</span><span class="s2">)</span>
</pre>
</body>
</html>