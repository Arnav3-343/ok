<html>
<head>
<title>test_builtins.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #2aacb8;}
.s5 { color: #7a7e85;}
.s6 { color: #a5c261;}
.s7 { color: #5f826b; font-style: italic;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_builtins.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">itertools</span>
<span class="s0">import </span><span class="s1">functools</span>
<span class="s0">import </span><span class="s1">sys</span>
<span class="s0">import </span><span class="s1">operator</span>
<span class="s0">from </span><span class="s1">collections </span><span class="s0">import </span><span class="s1">namedtuple</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>

<span class="s0">import </span><span class="s1">unittest</span>
<span class="s0">import </span><span class="s1">warnings</span>

<span class="s0">from </span><span class="s1">numba </span><span class="s0">import </span><span class="s1">jit</span><span class="s2">, </span><span class="s1">typeof</span><span class="s2">, </span><span class="s1">njit</span><span class="s2">, </span><span class="s1">typed</span>
<span class="s0">from </span><span class="s1">numba</span><span class="s2">.</span><span class="s1">core </span><span class="s0">import </span><span class="s1">errors</span><span class="s2">, </span><span class="s1">types</span><span class="s2">, </span><span class="s1">config</span>
<span class="s0">from </span><span class="s1">numba</span><span class="s2">.</span><span class="s1">tests</span><span class="s2">.</span><span class="s1">support </span><span class="s0">import </span><span class="s2">(</span><span class="s1">TestCase</span><span class="s2">, </span><span class="s1">tag</span><span class="s2">, </span><span class="s1">ignore_internal_warnings</span><span class="s2">,</span>
                                 <span class="s1">MemoryLeakMixin</span><span class="s2">)</span>
<span class="s0">from </span><span class="s1">numba</span><span class="s2">.</span><span class="s1">core</span><span class="s2">.</span><span class="s1">extending </span><span class="s0">import </span><span class="s1">overload_method</span><span class="s2">, </span><span class="s1">box</span>


<span class="s1">forceobj_flags </span><span class="s2">= {</span><span class="s3">'forceobj'</span><span class="s2">: </span><span class="s0">True</span><span class="s2">}</span>

<span class="s1">no_pyobj_flags </span><span class="s2">= {</span><span class="s3">'nopython'</span><span class="s2">: </span><span class="s0">True</span><span class="s2">, </span><span class="s3">'_nrt'</span><span class="s2">: </span><span class="s0">False</span><span class="s2">}</span>

<span class="s1">nrt_no_pyobj_flags </span><span class="s2">= {</span><span class="s3">'nopython'</span><span class="s2">: </span><span class="s0">True</span><span class="s2">}</span>


<span class="s0">def </span><span class="s1">abs_usecase</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">abs</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">all_usecase</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">):</span>
    <span class="s0">if </span><span class="s1">x </span><span class="s2">== </span><span class="s0">None and </span><span class="s1">y </span><span class="s2">== </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s1">all</span><span class="s2">([])</span>
    <span class="s0">elif </span><span class="s1">x </span><span class="s2">== </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s1">all</span><span class="s2">([</span><span class="s1">y</span><span class="s2">])</span>
    <span class="s0">elif </span><span class="s1">y </span><span class="s2">== </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s1">all</span><span class="s2">([</span><span class="s1">x</span><span class="s2">])</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s1">all</span><span class="s2">([</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">])</span>

<span class="s0">def </span><span class="s1">any_usecase</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">):</span>
    <span class="s0">if </span><span class="s1">x </span><span class="s2">== </span><span class="s0">None and </span><span class="s1">y </span><span class="s2">== </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s1">any</span><span class="s2">([])</span>
    <span class="s0">elif </span><span class="s1">x </span><span class="s2">== </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s1">any</span><span class="s2">([</span><span class="s1">y</span><span class="s2">])</span>
    <span class="s0">elif </span><span class="s1">y </span><span class="s2">== </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s1">any</span><span class="s2">([</span><span class="s1">x</span><span class="s2">])</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s1">any</span><span class="s2">([</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">])</span>

<span class="s0">def </span><span class="s1">bool_usecase</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">bool</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">complex_usecase</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">complex</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">divmod_usecase</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">divmod</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">enumerate_usecase</span><span class="s2">():</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s4">0</span>
    <span class="s0">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">j </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">((</span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.5</span><span class="s2">, </span><span class="s4">3.</span><span class="s2">)):</span>
        <span class="s1">result </span><span class="s2">+= </span><span class="s1">i </span><span class="s2">* </span><span class="s1">j</span>
    <span class="s0">return </span><span class="s1">result</span>

<span class="s0">def </span><span class="s1">enumerate_start_usecase</span><span class="s2">():</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s4">0</span>
    <span class="s0">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">j </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">((</span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.5</span><span class="s2">, </span><span class="s4">3.</span><span class="s2">), </span><span class="s4">42</span><span class="s2">):</span>
        <span class="s1">result </span><span class="s2">+= </span><span class="s1">i </span><span class="s2">* </span><span class="s1">j</span>
    <span class="s0">return </span><span class="s1">result</span>

<span class="s0">def </span><span class="s1">enumerate_invalid_start_usecase</span><span class="s2">():</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s4">0</span>
    <span class="s0">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">j </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">((</span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.5</span><span class="s2">, </span><span class="s4">3.</span><span class="s2">), </span><span class="s4">3.14159</span><span class="s2">):</span>
        <span class="s1">result </span><span class="s2">+= </span><span class="s1">i </span><span class="s2">* </span><span class="s1">j</span>
    <span class="s0">return </span><span class="s1">result</span>

<span class="s0">def </span><span class="s1">filter_usecase</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">filter_func</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">filter</span><span class="s2">(</span><span class="s1">filter_func</span><span class="s2">, </span><span class="s1">x</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">float_usecase</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">float</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">float_inf_usecase</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
    <span class="s1">d </span><span class="s2">= {</span>
        <span class="s4">0</span><span class="s2">: </span><span class="s1">float</span><span class="s2">(</span><span class="s3">'inf'</span><span class="s2">),</span>
        <span class="s4">1</span><span class="s2">: </span><span class="s1">float</span><span class="s2">(</span><span class="s3">'INF'</span><span class="s2">),</span>
        <span class="s4">2</span><span class="s2">: </span><span class="s1">float</span><span class="s2">(</span><span class="s3">'-inf'</span><span class="s2">),</span>
        <span class="s4">3</span><span class="s2">: </span><span class="s1">float</span><span class="s2">(</span><span class="s3">'-INF'</span><span class="s2">),</span>
        <span class="s4">4</span><span class="s2">: </span><span class="s1">float</span><span class="s2">(</span><span class="s3">'</span><span class="s0">\r\n</span><span class="s3">INF</span><span class="s0">\r       </span><span class="s3">'</span><span class="s2">),</span>
        <span class="s4">5</span><span class="s2">: </span><span class="s1">float</span><span class="s2">(</span><span class="s3">'       </span><span class="s0">\r\n\t</span><span class="s3">-INF'</span><span class="s2">),</span>
        <span class="s4">6</span><span class="s2">: </span><span class="s1">float</span><span class="s2">(</span><span class="s3">'1234.45'</span><span class="s2">),</span>
        <span class="s4">7</span><span class="s2">: </span><span class="s1">float</span><span class="s2">(</span><span class="s3">'</span><span class="s0">\n</span><span class="s3">-123.4</span><span class="s0">\r</span><span class="s3">'</span><span class="s2">),</span>
    <span class="s2">}</span>
    <span class="s0">return </span><span class="s1">d</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">format_usecase</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">x</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">y</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">globals_usecase</span><span class="s2">():</span>
    <span class="s0">return </span><span class="s1">globals</span><span class="s2">()</span>

<span class="s5"># NOTE: hash() is tested in test_hashing</span>

<span class="s0">def </span><span class="s1">hex_usecase</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">hex</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">str_usecase</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">str</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">int_usecase</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">base</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">int</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">base</span><span class="s2">=</span><span class="s1">base</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">iter_next_usecase</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
    <span class="s1">it </span><span class="s2">= </span><span class="s1">iter</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">next</span><span class="s2">(</span><span class="s1">it</span><span class="s2">), </span><span class="s1">next</span><span class="s2">(</span><span class="s1">it</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">locals_usecase</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s4">5</span>
    <span class="s0">return </span><span class="s1">locals</span><span class="s2">()[</span><span class="s3">'y'</span><span class="s2">]</span>

<span class="s0">def </span><span class="s1">long_usecase</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">base</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">long</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">base</span><span class="s2">=</span><span class="s1">base</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">map_usecase</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">map_func</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">map</span><span class="s2">(</span><span class="s1">map_func</span><span class="s2">, </span><span class="s1">x</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">max_usecase1</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">max</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">max_usecase2</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">max</span><span class="s2">([</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">])</span>

<span class="s0">def </span><span class="s1">max_usecase3</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">max</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">max_usecase4</span><span class="s2">():</span>
    <span class="s0">return </span><span class="s1">max</span><span class="s2">(())</span>


<span class="s0">def </span><span class="s1">min_usecase1</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">min</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">min_usecase2</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">min</span><span class="s2">([</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">])</span>

<span class="s0">def </span><span class="s1">min_usecase3</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">min</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">min_usecase4</span><span class="s2">():</span>
    <span class="s0">return </span><span class="s1">min</span><span class="s2">(())</span>

<span class="s0">def </span><span class="s1">oct_usecase</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">oct</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">reduce_usecase</span><span class="s2">(</span><span class="s1">reduce_func</span><span class="s2">, </span><span class="s1">x</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">functools</span><span class="s2">.</span><span class="s1">reduce</span><span class="s2">(</span><span class="s1">reduce_func</span><span class="s2">, </span><span class="s1">x</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">round_usecase1</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">round</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">round_usecase2</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">n</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">round</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">n</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">sum_usecase</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">sum</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">type_unary_usecase</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">type</span><span class="s2">(</span><span class="s1">a</span><span class="s2">)(</span><span class="s1">b</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">truth_usecase</span><span class="s2">(</span><span class="s1">p</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">operator</span><span class="s2">.</span><span class="s1">truth</span><span class="s2">(</span><span class="s1">p</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">unichr_usecase</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">unichr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">zip_usecase</span><span class="s2">():</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s4">0</span>
    <span class="s0">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">j </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">((</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">), (</span><span class="s4">4.5</span><span class="s2">, </span><span class="s4">6.7</span><span class="s2">)):</span>
        <span class="s1">result </span><span class="s2">+= </span><span class="s1">i </span><span class="s2">* </span><span class="s1">j</span>
    <span class="s0">return </span><span class="s1">result</span>

<span class="s0">def </span><span class="s1">zip_0_usecase</span><span class="s2">():</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s4">0</span>
    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">():</span>
        <span class="s1">result </span><span class="s2">+= </span><span class="s4">1</span>
    <span class="s0">return </span><span class="s1">result</span>

<span class="s0">def </span><span class="s1">zip_1_usecase</span><span class="s2">():</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s4">0</span>
    <span class="s0">for </span><span class="s1">i</span><span class="s2">, </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">((</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)):</span>
        <span class="s1">result </span><span class="s2">+= </span><span class="s1">i</span>
    <span class="s0">return </span><span class="s1">result</span>


<span class="s0">def </span><span class="s1">zip_3_usecase</span><span class="s2">():</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s4">0</span>
    <span class="s0">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">j</span><span class="s2">, </span><span class="s1">k </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">((</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">), (</span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s2">), (</span><span class="s4">6.7</span><span class="s2">, </span><span class="s4">8.9</span><span class="s2">)):</span>
        <span class="s1">result </span><span class="s2">+= </span><span class="s1">i </span><span class="s2">* </span><span class="s1">j </span><span class="s2">* </span><span class="s1">k</span>
    <span class="s0">return </span><span class="s1">result</span>


<span class="s0">def </span><span class="s1">zip_first_exhausted</span><span class="s2">():</span>
    <span class="s1">iterable </span><span class="s2">= </span><span class="s1">range</span><span class="s2">(</span><span class="s4">7</span><span class="s2">)</span>
    <span class="s1">n </span><span class="s2">= </span><span class="s4">3</span>
    <span class="s1">it </span><span class="s2">= </span><span class="s1">iter</span><span class="s2">(</span><span class="s1">iterable</span><span class="s2">)</span>
    <span class="s5"># 1st iterator is shorter</span>
    <span class="s1">front </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">zip</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">), </span><span class="s1">it</span><span class="s2">))</span>
    <span class="s5"># Make sure that we didn't skip one in `it`</span>
    <span class="s1">back </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">it</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">front</span><span class="s2">, </span><span class="s1">back</span>


<span class="s0">def </span><span class="s1">pow_op_usecase</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">x </span><span class="s2">** </span><span class="s1">y</span>


<span class="s0">def </span><span class="s1">pow_usecase</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">pow</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">sum_usecase</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">sum</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">sum_kwarg_usecase</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=</span><span class="s4">0</span><span class="s2">):</span>
    <span class="s1">ret </span><span class="s2">= </span><span class="s1">sum</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">start</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">sum</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=</span><span class="s1">start</span><span class="s2">), </span><span class="s1">ret</span>


<span class="s0">def </span><span class="s1">isinstance_usecase</span><span class="s2">(</span><span class="s1">a</span><span class="s2">):</span>
    <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, (</span><span class="s1">int</span><span class="s2">, </span><span class="s1">float</span><span class="s2">)):</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">int</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s1">a </span><span class="s2">+ </span><span class="s4">1</span><span class="s2">, </span><span class="s3">'int'</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">float</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s1">a </span><span class="s2">+ </span><span class="s4">2.0</span><span class="s2">, </span><span class="s3">'float'</span>
    <span class="s0">elif </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">str</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">a </span><span class="s2">+ </span><span class="s3">&quot;, world!&quot;</span><span class="s2">, </span><span class="s3">'str'</span>
    <span class="s0">elif </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">complex</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">a</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">, </span><span class="s3">'complex'</span>
    <span class="s0">elif </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, (</span><span class="s1">tuple</span><span class="s2">, </span><span class="s1">list</span><span class="s2">)):</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">tuple</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s3">'tuple'</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s3">'list'</span>
    <span class="s0">elif </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">set</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s3">'set'</span>
    <span class="s0">elif </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">bytes</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s3">'bytes'</span>
    <span class="s0">return </span><span class="s3">'no match'</span>


<span class="s0">def </span><span class="s1">isinstance_dict</span><span class="s2">():</span>
    <span class="s1">a </span><span class="s2">= {</span><span class="s4">1</span><span class="s2">: </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">: </span><span class="s4">4</span><span class="s2">}</span>
    <span class="s1">b </span><span class="s2">= {</span><span class="s3">'a'</span><span class="s2">: </span><span class="s4">10</span><span class="s2">, </span><span class="s3">'b'</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s4">3</span><span class="s2">)}</span>
    <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">) </span><span class="s0">and </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s3">'dict'</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s3">'not dict'</span>


<span class="s0">def </span><span class="s1">isinstance_usecase_numba_types</span><span class="s2">(</span><span class="s1">a</span><span class="s2">):</span>
    <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">typed</span><span class="s2">.</span><span class="s1">List</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s3">'typed list'</span>
    <span class="s0">elif </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, (</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">)):</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s3">'int32'</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s3">'int64'</span>
    <span class="s0">elif </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, (</span><span class="s1">types</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)):</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s3">'float32'</span>
        <span class="s0">elif </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s3">'float64'</span>
    <span class="s0">elif </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">typed</span><span class="s2">.</span><span class="s1">Dict</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s3">'typed dict'</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s3">'no match'</span>


<span class="s0">def </span><span class="s1">isinstance_usecase_numba_types_2</span><span class="s2">():</span>
    <span class="s5"># some types cannot be passed as argument to njit functions</span>
    <span class="s1">a </span><span class="s2">= </span><span class="s6">b'hello'</span>
    <span class="s1">b </span><span class="s2">= </span><span class="s1">range</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)</span>
    <span class="s1">c </span><span class="s2">= </span><span class="s1">dict</span><span class="s2">()</span>
    <span class="s1">c</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] = </span><span class="s4">3</span>
    <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">bytes</span><span class="s2">) </span><span class="s0">and </span><span class="s1">\</span>
            <span class="s1">isinstance</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">range</span><span class="s2">) </span><span class="s0">and </span><span class="s1">\</span>
            <span class="s1">isinstance</span><span class="s2">(</span><span class="s1">c</span><span class="s2">, </span><span class="s1">dict</span><span class="s2">):</span>
        <span class="s0">return True</span>
    <span class="s0">return False</span>


<span class="s0">def </span><span class="s1">invalid_isinstance_usecase</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
    <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, (</span><span class="s3">'foo'</span><span class="s2">,)):</span>
        <span class="s0">return </span><span class="s3">'true branch'</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s3">'false branch'</span>


<span class="s0">def </span><span class="s1">isinstance_usecase_invalid_type</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
    <span class="s5"># this should be a valid call when x := float</span>
    <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, (</span><span class="s1">float</span><span class="s2">, </span><span class="s3">'not a type'</span><span class="s2">)):</span>
        <span class="s0">return True</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s0">return False</span>


<span class="s0">def </span><span class="s1">invalid_isinstance_usecase_phi_nopropagate</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
    <span class="s0">if </span><span class="s1">x </span><span class="s2">&gt; </span><span class="s4">4</span><span class="s2">:</span>
        <span class="s1">z </span><span class="s2">= </span><span class="s4">10</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">z </span><span class="s2">= </span><span class="s3">'a'</span>
    <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">int</span><span class="s2">):</span>
        <span class="s0">return True</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s0">return False</span>


<span class="s0">def </span><span class="s1">invalid_isinstance_usecase_phi_nopropagate2</span><span class="s2">(</span><span class="s1">a</span><span class="s2">):</span>
    <span class="s5"># Numba issue #9125</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s4">0</span>
    <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">int</span><span class="s2">):</span>
        <span class="s1">a </span><span class="s2">= (</span><span class="s1">a</span><span class="s2">, </span><span class="s1">a</span><span class="s2">)</span>

    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">a</span><span class="s2">)):</span>
        <span class="s1">x </span><span class="s2">+= </span><span class="s1">i</span>
    <span class="s0">return </span><span class="s1">x</span>


<span class="s0">def </span><span class="s1">invalid_isinstance_optional_usecase</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
    <span class="s0">if </span><span class="s1">x </span><span class="s2">&gt; </span><span class="s4">4</span><span class="s2">:</span>
        <span class="s1">z </span><span class="s2">= </span><span class="s4">10</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">z </span><span class="s2">= </span><span class="s0">None</span>
    <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">int</span><span class="s2">):</span>
        <span class="s0">return True</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s0">return False</span>

<span class="s0">def </span><span class="s1">invalid_isinstance_unsupported_type_usecase</span><span class="s2">():</span>
    <span class="s1">ntpl </span><span class="s2">= </span><span class="s1">namedtuple</span><span class="s2">(</span><span class="s3">'ntpl'</span><span class="s2">, [</span><span class="s3">'a'</span><span class="s2">, </span><span class="s3">'b'</span><span class="s2">])</span>
    <span class="s1">inst </span><span class="s2">= </span><span class="s1">ntpl</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">impl</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">inst</span><span class="s2">, </span><span class="s1">ntpl</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">impl</span>

<span class="s0">class </span><span class="s1">TestBuiltins</span><span class="s2">(</span><span class="s1">TestCase</span><span class="s2">):</span>

    <span class="s0">def </span><span class="s1">run_nullary_func</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">pyfunc</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">):</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(), </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_abs</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">abs_usecase</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">,), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s2">[-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">))</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">,), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s2">[-</span><span class="s4">1.1</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">1.1</span><span class="s2">]:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s3">'single'</span><span class="s2">)</span>

        <span class="s1">complex_values </span><span class="s2">= [-</span><span class="s4">1.1 </span><span class="s2">+ </span><span class="s4">0.5j</span><span class="s2">, </span><span class="s4">0.0 </span><span class="s2">+ </span><span class="s4">0j</span><span class="s2">, </span><span class="s4">1.1 </span><span class="s2">+ </span><span class="s4">3j</span><span class="s2">,</span>
                          <span class="s1">float</span><span class="s2">(</span><span class="s3">'inf'</span><span class="s2">) + </span><span class="s4">1j </span><span class="s2">* </span><span class="s1">float</span><span class="s2">(</span><span class="s3">'nan'</span><span class="s2">),</span>
                          <span class="s1">float</span><span class="s2">(</span><span class="s3">'nan'</span><span class="s2">) - </span><span class="s4">1j </span><span class="s2">* </span><span class="s1">float</span><span class="s2">(</span><span class="s3">'inf'</span><span class="s2">)]</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">complex64</span><span class="s2">,), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">complex_values</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s3">'single'</span><span class="s2">)</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">complex128</span><span class="s2">,), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">complex_values</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">))</span>

        <span class="s0">for </span><span class="s1">unsigned_type </span><span class="s0">in </span><span class="s1">types</span><span class="s2">.</span><span class="s1">unsigned_domain</span><span class="s2">:</span>
            <span class="s1">unsigned_values </span><span class="s2">= [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">2 </span><span class="s2">** </span><span class="s1">unsigned_type</span><span class="s2">.</span><span class="s1">bitwidth </span><span class="s2">- </span><span class="s4">1</span><span class="s2">]</span>
            <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((</span><span class="s1">unsigned_type</span><span class="s2">,), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
            <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">unsigned_values</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_abs_npm</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">test_abs</span><span class="s2">(</span><span class="s1">flags</span><span class="s2">=</span><span class="s1">no_pyobj_flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_all</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">all_usecase</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">,</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">x_operands </span><span class="s2">= [-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s0">None</span><span class="s2">]</span>
        <span class="s1">y_operands </span><span class="s2">= [-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s0">None</span><span class="s2">]</span>
        <span class="s0">for </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s0">in </span><span class="s1">itertools</span><span class="s2">.</span><span class="s1">product</span><span class="s2">(</span><span class="s1">x_operands</span><span class="s2">, </span><span class="s1">y_operands</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_all_npm</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertTypingError</span><span class="s2">():</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">test_all</span><span class="s2">(</span><span class="s1">flags</span><span class="s2">=</span><span class="s1">no_pyobj_flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_any</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">any_usecase</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">,</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">x_operands </span><span class="s2">= [-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s0">None</span><span class="s2">]</span>
        <span class="s1">y_operands </span><span class="s2">= [-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s0">None</span><span class="s2">]</span>
        <span class="s0">for </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s0">in </span><span class="s1">itertools</span><span class="s2">.</span><span class="s1">product</span><span class="s2">(</span><span class="s1">x_operands</span><span class="s2">, </span><span class="s1">y_operands</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_any_npm</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertTypingError</span><span class="s2">():</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">test_any</span><span class="s2">(</span><span class="s1">flags</span><span class="s2">=</span><span class="s1">no_pyobj_flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_bool</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">bool_usecase</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">,), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s2">[-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">))</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">,), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s2">[</span><span class="s4">0.0</span><span class="s2">, -</span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">1.5</span><span class="s2">, </span><span class="s1">float</span><span class="s2">(</span><span class="s3">'inf'</span><span class="s2">), </span><span class="s1">float</span><span class="s2">(</span><span class="s3">'nan'</span><span class="s2">)]:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">))</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">complex128</span><span class="s2">,), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s2">[</span><span class="s1">complex</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s1">float</span><span class="s2">(</span><span class="s3">'inf'</span><span class="s2">)), </span><span class="s1">complex</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s1">float</span><span class="s2">(</span><span class="s3">'nan'</span><span class="s2">))]:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_bool_npm</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">test_bool</span><span class="s2">(</span><span class="s1">flags</span><span class="s2">=</span><span class="s1">no_pyobj_flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_bool_nonnumber</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">bool_usecase</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">string</span><span class="s2">,), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s2">[</span><span class="s3">'x'</span><span class="s2">, </span><span class="s3">''</span><span class="s2">]:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">))</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">Dummy</span><span class="s2">(</span><span class="s3">'list'</span><span class="s2">),), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s2">[[</span><span class="s4">1</span><span class="s2">], []]:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_bool_nonnumber_npm</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertTypingError</span><span class="s2">():</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">test_bool_nonnumber</span><span class="s2">(</span><span class="s1">flags</span><span class="s2">=</span><span class="s1">no_pyobj_flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_complex</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">complex_usecase</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>

        <span class="s1">x_operands </span><span class="s2">= [-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]</span>
        <span class="s1">y_operands </span><span class="s2">= [-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]</span>
        <span class="s0">for </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s0">in </span><span class="s1">itertools</span><span class="s2">.</span><span class="s1">product</span><span class="s2">(</span><span class="s1">x_operands</span><span class="s2">, </span><span class="s1">y_operands</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_complex_npm</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">test_complex</span><span class="s2">(</span><span class="s1">flags</span><span class="s2">=</span><span class="s1">no_pyobj_flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_divmod_ints</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">divmod_usecase</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>

        <span class="s0">def </span><span class="s1">truncate_result</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">bits</span><span class="s2">=</span><span class="s4">64</span><span class="s2">):</span>
            <span class="s5"># Remove any extraneous bits (since Numba will return</span>
            <span class="s5"># a 64-bit result by definition)</span>
            <span class="s0">if </span><span class="s1">x </span><span class="s2">&gt;= </span><span class="s4">0</span><span class="s2">:</span>
                <span class="s1">x </span><span class="s2">&amp;= (</span><span class="s4">1 </span><span class="s2">&lt;&lt; (</span><span class="s1">bits </span><span class="s2">- </span><span class="s4">1</span><span class="s2">)) - </span><span class="s4">1</span>
            <span class="s0">return </span><span class="s1">x</span>

        <span class="s1">denominators </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">15</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">3</span><span class="s2">, -</span><span class="s4">7</span><span class="s2">, -</span><span class="s4">15</span><span class="s2">, </span><span class="s4">2</span><span class="s2">**</span><span class="s4">63 </span><span class="s2">- </span><span class="s4">1</span><span class="s2">, -</span><span class="s4">2</span><span class="s2">**</span><span class="s4">63</span><span class="s2">]</span>
        <span class="s1">numerators </span><span class="s2">= </span><span class="s1">denominators </span><span class="s2">+ [</span><span class="s4">0</span><span class="s2">]</span>
        <span class="s0">for </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s0">in </span><span class="s1">itertools</span><span class="s2">.</span><span class="s1">product</span><span class="s2">(</span><span class="s1">numerators</span><span class="s2">, </span><span class="s1">denominators</span><span class="s2">):</span>
            <span class="s1">expected_quot</span><span class="s2">, </span><span class="s1">expected_rem </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
            <span class="s1">quot</span><span class="s2">, </span><span class="s1">rem </span><span class="s2">= </span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
            <span class="s1">f </span><span class="s2">= </span><span class="s1">truncate_result</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">((</span><span class="s1">f</span><span class="s2">(</span><span class="s1">quot</span><span class="s2">), </span><span class="s1">f</span><span class="s2">(</span><span class="s1">rem</span><span class="s2">)),</span>
                                    <span class="s2">(</span><span class="s1">f</span><span class="s2">(</span><span class="s1">expected_quot</span><span class="s2">), </span><span class="s1">f</span><span class="s2">(</span><span class="s1">expected_rem</span><span class="s2">)))</span>

        <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">numerators</span><span class="s2">:</span>
            <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">ZeroDivisionError</span><span class="s2">):</span>
                <span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s4">0</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_divmod_ints_npm</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">test_divmod_ints</span><span class="s2">(</span><span class="s1">flags</span><span class="s2">=</span><span class="s1">no_pyobj_flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_divmod_floats</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">divmod_usecase</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>

        <span class="s1">denominators </span><span class="s2">= [</span><span class="s4">1.</span><span class="s2">, </span><span class="s4">3.5</span><span class="s2">, </span><span class="s4">1e100</span><span class="s2">, -</span><span class="s4">2.</span><span class="s2">, -</span><span class="s4">7.5</span><span class="s2">, -</span><span class="s4">1e101</span><span class="s2">,</span>
                        <span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">, -</span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">]</span>
        <span class="s1">numerators </span><span class="s2">= </span><span class="s1">denominators </span><span class="s2">+ [-</span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">]</span>
        <span class="s0">for </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s0">in </span><span class="s1">itertools</span><span class="s2">.</span><span class="s1">product</span><span class="s2">(</span><span class="s1">numerators</span><span class="s2">, </span><span class="s1">denominators</span><span class="s2">):</span>
            <span class="s1">expected_quot</span><span class="s2">, </span><span class="s1">expected_rem </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
            <span class="s1">quot</span><span class="s2">, </span><span class="s1">rem </span><span class="s2">= </span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">((</span><span class="s1">quot</span><span class="s2">, </span><span class="s1">rem</span><span class="s2">), (</span><span class="s1">expected_quot</span><span class="s2">, </span><span class="s1">expected_rem</span><span class="s2">))</span>

        <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">numerators</span><span class="s2">:</span>
            <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">ZeroDivisionError</span><span class="s2">):</span>
                <span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_divmod_floats_npm</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">test_divmod_floats</span><span class="s2">(</span><span class="s1">flags</span><span class="s2">=</span><span class="s1">no_pyobj_flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_enumerate</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">run_nullary_func</span><span class="s2">(</span><span class="s1">enumerate_usecase</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_enumerate_npm</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">test_enumerate</span><span class="s2">(</span><span class="s1">flags</span><span class="s2">=</span><span class="s1">no_pyobj_flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_enumerate_start</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">run_nullary_func</span><span class="s2">(</span><span class="s1">enumerate_start_usecase</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_enumerate_start_npm</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">test_enumerate_start</span><span class="s2">(</span><span class="s1">flags</span><span class="s2">=</span><span class="s1">no_pyobj_flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_enumerate_start_invalid_start_type</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">enumerate_invalid_start_usecase</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((), **</span><span class="s1">forceobj_flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">cfunc</span><span class="s2">()</span>

        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;'float' object cannot be interpreted as an integer&quot;</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s1">msg</span><span class="s2">, </span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_enumerate_start_invalid_start_type_npm</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">enumerate_invalid_start_usecase</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">.</span><span class="s1">TypingError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">jit</span><span class="s2">((), **</span><span class="s1">no_pyobj_flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;Only integers supported as start value in enumerate&quot;</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s1">msg</span><span class="s2">, </span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_filter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">filter_usecase</span>
        <span class="s1">argtys </span><span class="s2">= (</span><span class="s1">types</span><span class="s2">.</span><span class="s1">Dummy</span><span class="s2">(</span><span class="s3">'list'</span><span class="s2">), </span><span class="s1">types</span><span class="s2">.</span><span class="s1">Dummy</span><span class="s2">(</span><span class="s3">'function_ptr'</span><span class="s2">))</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">argtys</span><span class="s2">, **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>

        <span class="s1">filter_func </span><span class="s2">= </span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s1">x </span><span class="s2">% </span><span class="s4">2</span>
        <span class="s1">x </span><span class="s2">= [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">]</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertSequenceEqual</span><span class="s2">(</span><span class="s1">list</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">filter_func</span><span class="s2">)),</span>
                                 <span class="s1">list</span><span class="s2">(</span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">filter_func</span><span class="s2">)))</span>

    <span class="s0">def </span><span class="s1">test_filter_npm</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertTypingError</span><span class="s2">():</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">test_filter</span><span class="s2">(</span><span class="s1">flags</span><span class="s2">=</span><span class="s1">no_pyobj_flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_float</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">float_usecase</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">,), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s2">[-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">))</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">,), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s2">[-</span><span class="s4">1.1</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">1.1</span><span class="s2">]:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s3">'single'</span><span class="s2">)</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">string</span><span class="s2">,), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s2">[</span><span class="s3">'-1.1'</span><span class="s2">, </span><span class="s3">'0.0'</span><span class="s2">, </span><span class="s3">'1.1'</span><span class="s2">, </span><span class="s3">'inf'</span><span class="s2">, </span><span class="s3">'-inf'</span><span class="s2">, </span><span class="s3">'INF'</span><span class="s2">, </span><span class="s3">'-INF'</span><span class="s2">]:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_float_npm</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertTypingError</span><span class="s2">():</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">test_float</span><span class="s2">(</span><span class="s1">flags</span><span class="s2">=</span><span class="s1">no_pyobj_flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_float_string_literal</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">float_inf_usecase</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">njit</span><span class="s2">(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">8</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_format</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">format_usecase</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">string</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">,), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s3">'{0}'</span>
        <span class="s0">for </span><span class="s1">y </span><span class="s0">in </span><span class="s2">[-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">))</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">string</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">,), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s3">'{0}'</span>
        <span class="s0">for </span><span class="s1">y </span><span class="s0">in </span><span class="s2">[-</span><span class="s4">1.1</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">1.1</span><span class="s2">]:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">))</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">string</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">string</span><span class="s2">,), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s3">'{0}'</span>
        <span class="s0">for </span><span class="s1">y </span><span class="s0">in </span><span class="s2">[</span><span class="s3">'a'</span><span class="s2">, </span><span class="s3">'b'</span><span class="s2">, </span><span class="s3">'c'</span><span class="s2">]:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_format_npm</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertTypingError</span><span class="s2">():</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">test_format</span><span class="s2">(</span><span class="s1">flags</span><span class="s2">=</span><span class="s1">no_pyobj_flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_globals</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">globals_usecase</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">g </span><span class="s2">= </span><span class="s1">cfunc</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIs</span><span class="s2">(</span><span class="s1">g</span><span class="s2">, </span><span class="s1">globals</span><span class="s2">())</span>

    <span class="s0">def </span><span class="s1">test_globals_npm</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertTypingError</span><span class="s2">():</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">test_globals</span><span class="s2">(</span><span class="s1">flags</span><span class="s2">=</span><span class="s1">no_pyobj_flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_globals_jit</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s5"># Issue #416: weird behaviour of globals() in combination with</span>
        <span class="s5"># the @jit decorator.</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">globals_usecase</span>
        <span class="s1">jitted </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(**</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIs</span><span class="s2">(</span><span class="s1">jitted</span><span class="s2">(), </span><span class="s1">globals</span><span class="s2">())</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIs</span><span class="s2">(</span><span class="s1">jitted</span><span class="s2">(), </span><span class="s1">globals</span><span class="s2">())</span>

    <span class="s0">def </span><span class="s1">test_globals_jit_npm</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertTypingError</span><span class="s2">():</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">test_globals_jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_hex</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">hex_usecase</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">,), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s2">[-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_hex_npm</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertTypingError</span><span class="s2">():</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">test_hex</span><span class="s2">(</span><span class="s1">flags</span><span class="s2">=</span><span class="s1">no_pyobj_flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_int_str</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">str_usecase</span>

        <span class="s1">small_inputs </span><span class="s2">= [</span>
            <span class="s4">1234</span><span class="s2">,</span>
            <span class="s4">1</span><span class="s2">,</span>
            <span class="s4">0</span><span class="s2">,</span>
            <span class="s4">10</span><span class="s2">,</span>
            <span class="s4">1000</span><span class="s2">,</span>
        <span class="s2">]</span>

        <span class="s1">large_inputs </span><span class="s2">= [</span>
            <span class="s4">123456789</span><span class="s2">,</span>
            <span class="s4">2222222</span><span class="s2">,</span>
            <span class="s4">1000000</span><span class="s2">,</span>
            <span class="s2">~</span><span class="s4">0x0</span>
        <span class="s2">]</span>

        <span class="s1">args </span><span class="s2">= [*</span><span class="s1">small_inputs</span><span class="s2">, *</span><span class="s1">large_inputs</span><span class="s2">]</span>

        <span class="s1">typs </span><span class="s2">= [</span>
            <span class="s1">types</span><span class="s2">.</span><span class="s1">int8</span><span class="s2">,</span>
            <span class="s1">types</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">,</span>
            <span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">,</span>
            <span class="s1">types</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">,</span>
            <span class="s1">types</span><span class="s2">.</span><span class="s1">uint</span><span class="s2">,</span>
            <span class="s1">types</span><span class="s2">.</span><span class="s1">uint8</span><span class="s2">,</span>
            <span class="s1">types</span><span class="s2">.</span><span class="s1">uint16</span><span class="s2">,</span>
            <span class="s1">types</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">,</span>
            <span class="s1">types</span><span class="s2">.</span><span class="s1">uint64</span><span class="s2">,</span>
        <span class="s2">]</span>

        <span class="s0">for </span><span class="s1">typ </span><span class="s0">in </span><span class="s1">typs</span><span class="s2">:</span>
            <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((</span><span class="s1">typ</span><span class="s2">,), **</span><span class="s1">nrt_no_pyobj_flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
            <span class="s0">for </span><span class="s1">v </span><span class="s0">in </span><span class="s1">args</span><span class="s2">:</span>
                <span class="s1">tp_info </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">iinfo</span><span class="s2">(</span><span class="s1">typ</span><span class="s2">.</span><span class="s1">key</span><span class="s2">)</span>
                <span class="s0">if not </span><span class="s2">(</span><span class="s1">tp_info</span><span class="s2">.</span><span class="s1">min </span><span class="s2">&lt;= </span><span class="s1">v </span><span class="s2">&lt;= </span><span class="s1">tp_info</span><span class="s2">.</span><span class="s1">max</span><span class="s2">):</span>
                    <span class="s0">continue</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">typ</span><span class="s2">(</span><span class="s1">v</span><span class="s2">)), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">typ</span><span class="s2">(</span><span class="s1">v</span><span class="s2">)))</span>

                <span class="s0">if </span><span class="s1">typ</span><span class="s2">.</span><span class="s1">signed</span><span class="s2">:</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">typ</span><span class="s2">(-</span><span class="s1">v</span><span class="s2">)), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">typ</span><span class="s2">(-</span><span class="s1">v</span><span class="s2">)))</span>

    <span class="s0">def </span><span class="s1">test_int</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">int_usecase</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">string</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">,), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>

        <span class="s1">x_operands </span><span class="s2">= [</span><span class="s3">'-1'</span><span class="s2">, </span><span class="s3">'0'</span><span class="s2">, </span><span class="s3">'1'</span><span class="s2">, </span><span class="s3">'10'</span><span class="s2">]</span>
        <span class="s1">y_operands </span><span class="s2">= [</span><span class="s4">2</span><span class="s2">, </span><span class="s4">8</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s4">16</span><span class="s2">]</span>
        <span class="s0">for </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s0">in </span><span class="s1">itertools</span><span class="s2">.</span><span class="s1">product</span><span class="s2">(</span><span class="s1">x_operands</span><span class="s2">, </span><span class="s1">y_operands</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_int_npm</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertTypingError</span><span class="s2">():</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">test_int</span><span class="s2">(</span><span class="s1">flags</span><span class="s2">=</span><span class="s1">no_pyobj_flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_iter_next</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">iter_next_usecase</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">UniTuple</span><span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">, </span><span class="s4">3</span><span class="s2">),), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">((</span><span class="s4">1</span><span class="s2">, </span><span class="s4">42</span><span class="s2">, </span><span class="s4">5</span><span class="s2">)), (</span><span class="s4">1</span><span class="s2">, </span><span class="s4">42</span><span class="s2">))</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">UniTuple</span><span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">, </span><span class="s4">1</span><span class="s2">),), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">StopIteration</span><span class="s2">):</span>
            <span class="s1">cfunc</span><span class="s2">((</span><span class="s4">1</span><span class="s2">,))</span>

    <span class="s0">def </span><span class="s1">test_iter_next_npm</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">test_iter_next</span><span class="s2">(</span><span class="s1">flags</span><span class="s2">=</span><span class="s1">no_pyobj_flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_locals</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">locals_usecase</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">.</span><span class="s1">ForbiddenConstruct</span><span class="s2">):</span>
            <span class="s1">jit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">,), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_locals_forceobj</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">test_locals</span><span class="s2">(</span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_locals_npm</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertTypingError</span><span class="s2">():</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">test_locals</span><span class="s2">(</span><span class="s1">flags</span><span class="s2">=</span><span class="s1">no_pyobj_flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_map</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">map_usecase</span>
        <span class="s1">argtys </span><span class="s2">= (</span><span class="s1">types</span><span class="s2">.</span><span class="s1">Dummy</span><span class="s2">(</span><span class="s3">'list'</span><span class="s2">), </span><span class="s1">types</span><span class="s2">.</span><span class="s1">Dummy</span><span class="s2">(</span><span class="s3">'function_ptr'</span><span class="s2">))</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">argtys</span><span class="s2">, **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>

        <span class="s1">map_func </span><span class="s2">= </span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s1">x </span><span class="s2">* </span><span class="s4">2</span>
        <span class="s1">x </span><span class="s2">= [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">]</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertSequenceEqual</span><span class="s2">(</span><span class="s1">list</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">map_func</span><span class="s2">)),</span>
                                 <span class="s1">list</span><span class="s2">(</span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">map_func</span><span class="s2">)))</span>

    <span class="s0">def </span><span class="s1">test_map_npm</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertTypingError</span><span class="s2">():</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">test_map</span><span class="s2">(</span><span class="s1">flags</span><span class="s2">=</span><span class="s1">no_pyobj_flags</span><span class="s2">)</span>

    <span class="s5">#</span>
    <span class="s5"># min() and max()</span>
    <span class="s5">#</span>

    <span class="s0">def </span><span class="s1">check_minmax_1</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">pyfunc</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">):</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>

        <span class="s1">x_operands </span><span class="s2">= [-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]</span>
        <span class="s1">y_operands </span><span class="s2">= [-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]</span>
        <span class="s0">for </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s0">in </span><span class="s1">itertools</span><span class="s2">.</span><span class="s1">product</span><span class="s2">(</span><span class="s1">x_operands</span><span class="s2">, </span><span class="s1">y_operands</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_max_1</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s7">&quot;&quot;&quot; 
        max(*args) 
        &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_minmax_1</span><span class="s2">(</span><span class="s1">max_usecase1</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_min_1</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s7">&quot;&quot;&quot; 
        min(*args) 
        &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_minmax_1</span><span class="s2">(</span><span class="s1">min_usecase1</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_max_npm_1</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">test_max_1</span><span class="s2">(</span><span class="s1">flags</span><span class="s2">=</span><span class="s1">no_pyobj_flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_min_npm_1</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">test_min_1</span><span class="s2">(</span><span class="s1">flags</span><span class="s2">=</span><span class="s1">no_pyobj_flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">check_minmax_2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">pyfunc</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">):</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>

        <span class="s1">x_operands </span><span class="s2">= [-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]</span>
        <span class="s1">y_operands </span><span class="s2">= [-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]</span>
        <span class="s0">for </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s0">in </span><span class="s1">itertools</span><span class="s2">.</span><span class="s1">product</span><span class="s2">(</span><span class="s1">x_operands</span><span class="s2">, </span><span class="s1">y_operands</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_max_2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s7">&quot;&quot;&quot; 
        max(list) 
        &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_minmax_2</span><span class="s2">(</span><span class="s1">max_usecase2</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_min_2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s7">&quot;&quot;&quot; 
        min(list) 
        &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_minmax_2</span><span class="s2">(</span><span class="s1">min_usecase2</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_max_npm_2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertTypingError</span><span class="s2">():</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">test_max_2</span><span class="s2">(</span><span class="s1">flags</span><span class="s2">=</span><span class="s1">no_pyobj_flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_min_npm_2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertTypingError</span><span class="s2">():</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">test_min_2</span><span class="s2">(</span><span class="s1">flags</span><span class="s2">=</span><span class="s1">no_pyobj_flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">check_minmax_3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">pyfunc</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">check</span><span class="s2">(</span><span class="s1">argty</span><span class="s2">):</span>
            <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((</span><span class="s1">argty</span><span class="s2">,), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
            <span class="s5"># Check that the algorithm matches Python's with a non-total order</span>
            <span class="s1">tup </span><span class="s2">= (</span><span class="s4">1.5</span><span class="s2">, </span><span class="s1">float</span><span class="s2">(</span><span class="s3">'nan'</span><span class="s2">), </span><span class="s4">2.5</span><span class="s2">)</span>
            <span class="s0">for </span><span class="s1">val </span><span class="s0">in </span><span class="s2">[</span><span class="s1">tup</span><span class="s2">, </span><span class="s1">tup</span><span class="s2">[::-</span><span class="s4">1</span><span class="s2">]]:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">val</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">val</span><span class="s2">))</span>

        <span class="s1">check</span><span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">UniTuple</span><span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">, </span><span class="s4">3</span><span class="s2">))</span>
        <span class="s1">check</span><span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">Tuple</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">)))</span>

    <span class="s0">def </span><span class="s1">test_max_3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s7">&quot;&quot;&quot; 
        max(tuple) 
        &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_minmax_3</span><span class="s2">(</span><span class="s1">max_usecase3</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_min_3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s7">&quot;&quot;&quot; 
        min(tuple) 
        &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_minmax_3</span><span class="s2">(</span><span class="s1">min_usecase3</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_max_npm_3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">test_max_3</span><span class="s2">(</span><span class="s1">flags</span><span class="s2">=</span><span class="s1">no_pyobj_flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_min_npm_3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">test_min_3</span><span class="s2">(</span><span class="s1">flags</span><span class="s2">=</span><span class="s1">no_pyobj_flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">check_min_max_invalid_types</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">pyfunc</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">Dummy</span><span class="s2">(</span><span class="s3">'list'</span><span class="s2">),), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">cfunc</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">test_max_1_invalid_types</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">check_min_max_invalid_types</span><span class="s2">(</span><span class="s1">max_usecase1</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_max_1_invalid_types_npm</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertTypingError</span><span class="s2">():</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">check_min_max_invalid_types</span><span class="s2">(</span><span class="s1">max_usecase1</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">no_pyobj_flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_min_1_invalid_types</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">check_min_max_invalid_types</span><span class="s2">(</span><span class="s1">min_usecase1</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_min_1_invalid_types_npm</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertTypingError</span><span class="s2">():</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">check_min_max_invalid_types</span><span class="s2">(</span><span class="s1">min_usecase1</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">no_pyobj_flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">check_minmax_bool1</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">pyfunc</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">):</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">bool_</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">bool_</span><span class="s2">), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>

        <span class="s1">operands </span><span class="s2">= (</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s0">in </span><span class="s1">itertools</span><span class="s2">.</span><span class="s1">product</span><span class="s2">(</span><span class="s1">operands</span><span class="s2">, </span><span class="s1">operands</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_max_bool1</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s5"># tests max(&lt;booleans&gt;)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_minmax_bool1</span><span class="s2">(</span><span class="s1">max_usecase1</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_min_bool1</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s5"># tests min(&lt;booleans&gt;)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_minmax_bool1</span><span class="s2">(</span><span class="s1">min_usecase1</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">)</span>

    <span class="s5"># Test that max(1) and min(1) fail</span>

    <span class="s0">def </span><span class="s1">check_min_max_unary_non_iterable</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">pyfunc</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">,), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">cfunc</span><span class="s2">(</span><span class="s4">1</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_max_unary_non_iterable</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">check_min_max_unary_non_iterable</span><span class="s2">(</span><span class="s1">max_usecase3</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_max_unary_non_iterable_npm</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertTypingError</span><span class="s2">():</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">check_min_max_unary_non_iterable</span><span class="s2">(</span><span class="s1">max_usecase3</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_min_unary_non_iterable</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">check_min_max_unary_non_iterable</span><span class="s2">(</span><span class="s1">min_usecase3</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_min_unary_non_iterable_npm</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertTypingError</span><span class="s2">():</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">check_min_max_unary_non_iterable</span><span class="s2">(</span><span class="s1">min_usecase3</span><span class="s2">)</span>

    <span class="s5"># Test that max(()) and min(()) fail</span>

    <span class="s0">def </span><span class="s1">check_min_max_empty_tuple</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">pyfunc</span><span class="s2">, </span><span class="s1">func_name</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertTypingError</span><span class="s2">() </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">jit</span><span class="s2">((), **</span><span class="s1">no_pyobj_flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s3">&quot;%s() argument is an empty tuple&quot; </span><span class="s2">% </span><span class="s1">func_name</span><span class="s2">,</span>
                      <span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_max_empty_tuple</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_min_max_empty_tuple</span><span class="s2">(</span><span class="s1">max_usecase4</span><span class="s2">, </span><span class="s3">&quot;max&quot;</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_min_empty_tuple</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">check_min_max_empty_tuple</span><span class="s2">(</span><span class="s1">min_usecase4</span><span class="s2">, </span><span class="s3">&quot;min&quot;</span><span class="s2">)</span>


    <span class="s0">def </span><span class="s1">test_oct</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">oct_usecase</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">,), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s2">[-</span><span class="s4">8</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">8</span><span class="s2">]:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_oct_npm</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertTypingError</span><span class="s2">():</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">test_oct</span><span class="s2">(</span><span class="s1">flags</span><span class="s2">=</span><span class="s1">no_pyobj_flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_reduce</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">reduce_usecase</span>
        <span class="s1">argtys </span><span class="s2">= (</span><span class="s1">types</span><span class="s2">.</span><span class="s1">Dummy</span><span class="s2">(</span><span class="s3">'function_ptr'</span><span class="s2">), </span><span class="s1">types</span><span class="s2">.</span><span class="s1">Dummy</span><span class="s2">(</span><span class="s3">'list'</span><span class="s2">))</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">argtys</span><span class="s2">, **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>

        <span class="s1">reduce_func </span><span class="s2">= </span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">: </span><span class="s1">x </span><span class="s2">+ </span><span class="s1">y</span>

        <span class="s1">x </span><span class="s2">= </span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">reduce_func</span><span class="s2">, </span><span class="s1">x</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">reduce_func</span><span class="s2">, </span><span class="s1">x</span><span class="s2">))</span>

        <span class="s1">x </span><span class="s2">= [</span><span class="s1">x </span><span class="s2">+ </span><span class="s1">x</span><span class="s2">/</span><span class="s4">10.0 </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)]</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">reduce_func</span><span class="s2">, </span><span class="s1">x</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">reduce_func</span><span class="s2">, </span><span class="s1">x</span><span class="s2">))</span>

        <span class="s1">x </span><span class="s2">= [</span><span class="s1">complex</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">) </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)]</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">reduce_func</span><span class="s2">, </span><span class="s1">x</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">reduce_func</span><span class="s2">, </span><span class="s1">x</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_reduce_npm</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertTypingError</span><span class="s2">():</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">test_reduce</span><span class="s2">(</span><span class="s1">flags</span><span class="s2">=</span><span class="s1">no_pyobj_flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_round1</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">round_usecase1</span>

        <span class="s0">for </span><span class="s1">tp </span><span class="s0">in </span><span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">):</span>
            <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((</span><span class="s1">tp</span><span class="s2">,), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
            <span class="s1">values </span><span class="s2">= [-</span><span class="s4">1.6</span><span class="s2">, -</span><span class="s4">1.5</span><span class="s2">, -</span><span class="s4">1.4</span><span class="s2">, -</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">, </span><span class="s4">1.4</span><span class="s2">, </span><span class="s4">1.5</span><span class="s2">, </span><span class="s4">5.0</span><span class="s2">]</span>
            <span class="s1">values </span><span class="s2">+= [-</span><span class="s4">0.1</span><span class="s2">, -</span><span class="s4">0.0</span><span class="s2">]</span>
            <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">values</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_round1_npm</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">test_round1</span><span class="s2">(</span><span class="s1">flags</span><span class="s2">=</span><span class="s1">no_pyobj_flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_round2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">round_usecase2</span>

        <span class="s0">for </span><span class="s1">tp </span><span class="s0">in </span><span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">):</span>
            <span class="s1">prec </span><span class="s2">= </span><span class="s3">'single' </span><span class="s0">if </span><span class="s1">tp </span><span class="s0">is </span><span class="s1">types</span><span class="s2">.</span><span class="s1">float32 </span><span class="s0">else </span><span class="s3">'exact'</span>
            <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((</span><span class="s1">tp</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
            <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s2">[</span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.125</span><span class="s2">, </span><span class="s4">0.25</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.75</span><span class="s2">, </span><span class="s4">1.25</span><span class="s2">,</span>
                      <span class="s4">1.5</span><span class="s2">, </span><span class="s4">1.75</span><span class="s2">, </span><span class="s4">2.25</span><span class="s2">, </span><span class="s4">2.5</span><span class="s2">, </span><span class="s4">2.75</span><span class="s2">, </span><span class="s4">12.5</span><span class="s2">, </span><span class="s4">15.0</span><span class="s2">, </span><span class="s4">22.5</span><span class="s2">]:</span>
                <span class="s0">for </span><span class="s1">n </span><span class="s0">in </span><span class="s2">(-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">):</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">n</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">n</span><span class="s2">),</span>
                                            <span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">)</span>
                    <span class="s1">expected </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">(-</span><span class="s1">x</span><span class="s2">, </span><span class="s1">n</span><span class="s2">)</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(-</span><span class="s1">x</span><span class="s2">, </span><span class="s1">n</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(-</span><span class="s1">x</span><span class="s2">, </span><span class="s1">n</span><span class="s2">),</span>
                                            <span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_round2_npm</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">test_round2</span><span class="s2">(</span><span class="s1">flags</span><span class="s2">=</span><span class="s1">no_pyobj_flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_sum_objmode</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">sum_usecase</span>

        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">((</span><span class="s1">types</span><span class="s2">.</span><span class="s1">Dummy</span><span class="s2">(</span><span class="s3">'list'</span><span class="s2">),), **</span><span class="s1">flags</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>

        <span class="s1">x </span><span class="s2">= </span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">))</span>

        <span class="s1">x </span><span class="s2">= [</span><span class="s1">x </span><span class="s2">+ </span><span class="s1">x</span><span class="s2">/</span><span class="s4">10.0 </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)]</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">))</span>

        <span class="s1">x </span><span class="s2">= [</span><span class="s1">complex</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">) </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)]</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_sum</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># In Python 3.8+ &quot;start&quot; can be specified as a kwarg, so test that too</span>
        <span class="s1">sum_default </span><span class="s2">= </span><span class="s1">njit</span><span class="s2">(</span><span class="s1">sum_usecase</span><span class="s2">)</span>
        <span class="s1">sum_kwarg </span><span class="s2">= </span><span class="s1">njit</span><span class="s2">(</span><span class="s1">sum_kwarg_usecase</span><span class="s2">)</span>

        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">sum_range</span><span class="s2">(</span><span class="s1">sz</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=</span><span class="s4">0</span><span class="s2">):</span>
            <span class="s1">tmp </span><span class="s2">= </span><span class="s1">range</span><span class="s2">(</span><span class="s1">sz</span><span class="s2">)</span>
            <span class="s1">ret </span><span class="s2">= </span><span class="s1">sum</span><span class="s2">(</span><span class="s1">tmp</span><span class="s2">, </span><span class="s1">start</span><span class="s2">)</span>
            <span class="s0">return </span><span class="s1">sum</span><span class="s2">(</span><span class="s1">tmp</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=</span><span class="s1">start</span><span class="s2">), </span><span class="s1">ret</span>

        <span class="s1">ntpl </span><span class="s2">= </span><span class="s1">namedtuple</span><span class="s2">(</span><span class="s3">'ntpl'</span><span class="s2">, [</span><span class="s3">'a'</span><span class="s2">, </span><span class="s3">'b'</span><span class="s2">])</span>

        <span class="s5"># check call with default kwarg, start=0</span>
        <span class="s0">def </span><span class="s1">args</span><span class="s2">():</span>
            <span class="s0">yield </span><span class="s2">[*</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)]</span>
            <span class="s0">yield </span><span class="s2">[</span><span class="s1">x </span><span class="s2">+ </span><span class="s1">x</span><span class="s2">/</span><span class="s4">10.0 </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)]</span>
            <span class="s0">yield </span><span class="s2">[</span><span class="s1">x </span><span class="s2">* </span><span class="s4">1j </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)]</span>
            <span class="s0">yield </span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">)</span>
            <span class="s0">yield </span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3j</span><span class="s2">)</span>
            <span class="s5"># uints will likely end up as floats as `start` is signed, so just</span>
            <span class="s5"># test mixed signed ints</span>
            <span class="s0">yield </span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">(</span><span class="s4">32</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">(</span><span class="s4">2</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int8</span><span class="s2">(</span><span class="s4">3</span><span class="s2">))</span>
            <span class="s1">tl </span><span class="s2">= </span><span class="s1">typed</span><span class="s2">.</span><span class="s1">List</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">5</span><span class="s2">))</span>
            <span class="s0">yield </span><span class="s1">tl</span>
            <span class="s0">yield </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s4">5</span><span class="s2">)</span>
            <span class="s0">yield </span><span class="s1">ntpl</span><span class="s2">(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">200</span><span class="s2">)</span>
            <span class="s0">yield </span><span class="s1">ntpl</span><span class="s2">(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">200j</span><span class="s2">)</span>

        <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">args</span><span class="s2">():</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">sum_default</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">sum_default</span><span class="s2">.</span><span class="s1">py_func</span><span class="s2">(</span><span class="s1">x</span><span class="s2">))</span>

        <span class="s5"># Check the uint use case, as start is signed, NumPy will end up with</span>
        <span class="s5"># a float result whereas Numba will end up with an int (see integer</span>
        <span class="s5"># typing NBEP).</span>
        <span class="s1">x </span><span class="s2">= (</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint64</span><span class="s2">(</span><span class="s4">32</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">(</span><span class="s4">2</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint8</span><span class="s2">(</span><span class="s4">3</span><span class="s2">))</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">sum_default</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">sum_default</span><span class="s2">.</span><span class="s1">py_func</span><span class="s2">(</span><span class="s1">x</span><span class="s2">))</span>

        <span class="s5"># check call with changing default kwarg, start</span>
        <span class="s0">def </span><span class="s1">args_kws</span><span class="s2">():</span>
            <span class="s0">yield </span><span class="s2">[*</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)], </span><span class="s4">12</span>
            <span class="s0">yield </span><span class="s2">[</span><span class="s1">x </span><span class="s2">+ </span><span class="s1">x</span><span class="s2">/</span><span class="s4">10.0 </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)], </span><span class="s4">19j</span>
            <span class="s0">yield </span><span class="s2">[</span><span class="s1">x </span><span class="s2">* </span><span class="s4">1j </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)], -</span><span class="s4">2</span>
            <span class="s0">yield </span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">), </span><span class="s4">9</span>
            <span class="s0">yield </span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3j</span><span class="s2">), -</span><span class="s4">0</span>
            <span class="s5"># uints will likely end up as floats as `start` is signed, so just</span>
            <span class="s5"># test mixed signed ints</span>
            <span class="s0">yield </span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">(</span><span class="s4">32</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">(</span><span class="s4">2</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int8</span><span class="s2">(</span><span class="s4">3</span><span class="s2">)), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">(</span><span class="s4">7</span><span class="s2">)</span>
            <span class="s1">tl </span><span class="s2">= </span><span class="s1">typed</span><span class="s2">.</span><span class="s1">List</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">5</span><span class="s2">))</span>
            <span class="s0">yield </span><span class="s1">tl</span><span class="s2">, </span><span class="s4">100</span>
            <span class="s0">yield </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">((</span><span class="s4">5</span><span class="s2">, </span><span class="s4">5</span><span class="s2">)), </span><span class="s4">10 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">((</span><span class="s4">5</span><span class="s2">,))</span>
            <span class="s0">yield </span><span class="s1">ntpl</span><span class="s2">(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">200</span><span class="s2">), -</span><span class="s4">50</span>
            <span class="s0">yield </span><span class="s1">ntpl</span><span class="s2">(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">200j</span><span class="s2">), </span><span class="s4">9</span>

        <span class="s0">for </span><span class="s1">x</span><span class="s2">, </span><span class="s1">start </span><span class="s0">in </span><span class="s1">args_kws</span><span class="s2">():</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">sum_kwarg</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=</span><span class="s1">start</span><span class="s2">),</span>
                                    <span class="s1">sum_kwarg</span><span class="s2">.</span><span class="s1">py_func</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=</span><span class="s1">start</span><span class="s2">))</span>

        <span class="s5"># check call with range()</span>
        <span class="s0">for </span><span class="s1">start </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(-</span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">):</span>
            <span class="s0">for </span><span class="s1">sz </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(-</span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">):</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">sum_range</span><span class="s2">(</span><span class="s1">sz</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=</span><span class="s1">start</span><span class="s2">),</span>
                                        <span class="s1">sum_range</span><span class="s2">.</span><span class="s1">py_func</span><span class="s2">(</span><span class="s1">sz</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=</span><span class="s1">start</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_sum_exceptions</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">sum_default </span><span class="s2">= </span><span class="s1">njit</span><span class="s2">(</span><span class="s1">sum_usecase</span><span class="s2">)</span>
        <span class="s1">sum_kwarg </span><span class="s2">= </span><span class="s1">njit</span><span class="s2">(</span><span class="s1">sum_kwarg_usecase</span><span class="s2">)</span>

        <span class="s5"># check start as string/bytes/bytearray is error</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;sum() can't sum {}&quot;</span>

        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">.</span><span class="s1">TypingError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">sum_kwarg</span><span class="s2">((</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">), </span><span class="s3">'a'</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s1">msg</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s3">'strings'</span><span class="s2">), </span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">))</span>

        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">.</span><span class="s1">TypingError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">sum_kwarg</span><span class="s2">((</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">), </span><span class="s6">b'123'</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s1">msg</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s3">'bytes'</span><span class="s2">), </span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">))</span>

        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">.</span><span class="s1">TypingError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">sum_kwarg</span><span class="s2">((</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">), </span><span class="s1">bytearray</span><span class="s2">(</span><span class="s6">b'123'</span><span class="s2">))</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s1">msg</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s3">'bytearray'</span><span class="s2">), </span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">))</span>

        <span class="s5"># check invalid type has no impl</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">.</span><span class="s1">TypingError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">sum_default</span><span class="s2">(</span><span class="s3">'abcd'</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s3">'No implementation'</span><span class="s2">, </span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_truth</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">truth_usecase</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s0">True</span><span class="s2">), </span><span class="s1">cfunc</span><span class="s2">(</span><span class="s0">True</span><span class="s2">))</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s0">False</span><span class="s2">), </span><span class="s1">cfunc</span><span class="s2">(</span><span class="s0">False</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_type_unary</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Test type(val) and type(val)(other_val)</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">type_unary_usecase</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>

        <span class="s0">def </span><span class="s1">check</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">):</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">), </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s1">check</span><span class="s2">(</span><span class="s4">1.5</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)</span>
        <span class="s1">check</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2.5</span><span class="s2">)</span>
        <span class="s1">check</span><span class="s2">(</span><span class="s4">1.5j</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)</span>
        <span class="s1">check</span><span class="s2">(</span><span class="s0">True</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)</span>
        <span class="s1">check</span><span class="s2">(</span><span class="s4">2.5j</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_zip</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">run_nullary_func</span><span class="s2">(</span><span class="s1">zip_usecase</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_zip_npm</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">test_zip</span><span class="s2">(</span><span class="s1">flags</span><span class="s2">=</span><span class="s1">no_pyobj_flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_zip_1</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">run_nullary_func</span><span class="s2">(</span><span class="s1">zip_1_usecase</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_zip_1_npm</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">test_zip_1</span><span class="s2">(</span><span class="s1">flags</span><span class="s2">=</span><span class="s1">no_pyobj_flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_zip_3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">run_nullary_func</span><span class="s2">(</span><span class="s1">zip_3_usecase</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_zip_3_npm</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">test_zip_3</span><span class="s2">(</span><span class="s1">flags</span><span class="s2">=</span><span class="s1">no_pyobj_flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_zip_0</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">run_nullary_func</span><span class="s2">(</span><span class="s1">zip_0_usecase</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_zip_0_npm</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">test_zip_0</span><span class="s2">(</span><span class="s1">flags</span><span class="s2">=</span><span class="s1">no_pyobj_flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_zip_first_exhausted</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">=</span><span class="s1">forceobj_flags</span><span class="s2">):</span>
        <span class="s7">&quot;&quot;&quot; 
        Test side effect to the input iterators when a left iterator has been 
        exhausted before the ones on the right. 
        &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">run_nullary_func</span><span class="s2">(</span><span class="s1">zip_first_exhausted</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_zip_first_exhausted_npm</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">test_zip_first_exhausted</span><span class="s2">(</span><span class="s1">flags</span><span class="s2">=</span><span class="s1">nrt_no_pyobj_flags</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_pow_op_usecase</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">args </span><span class="s2">= [</span>
            <span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s4">2.0</span><span class="s2">, </span><span class="s4">3</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">3.0</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s4">2j</span><span class="s2">, </span><span class="s4">3.0j</span><span class="s2">),</span>
        <span class="s2">]</span>

        <span class="s0">for </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s0">in </span><span class="s1">args</span><span class="s2">:</span>
            <span class="s1">argtys </span><span class="s2">= (</span><span class="s1">typeof</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">typeof</span><span class="s2">(</span><span class="s1">y</span><span class="s2">))</span>
            <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">argtys</span><span class="s2">, **</span><span class="s1">no_pyobj_flags</span><span class="s2">)(</span><span class="s1">pow_op_usecase</span><span class="s2">)</span>
            <span class="s1">r </span><span class="s2">= </span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">r</span><span class="s2">, </span><span class="s1">pow_op_usecase</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_pow_usecase</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">args </span><span class="s2">= [</span>
            <span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s4">2.0</span><span class="s2">, </span><span class="s4">3</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">3.0</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s4">2j</span><span class="s2">, </span><span class="s4">3.0j</span><span class="s2">),</span>
        <span class="s2">]</span>

        <span class="s0">for </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s0">in </span><span class="s1">args</span><span class="s2">:</span>
            <span class="s1">argtys </span><span class="s2">= (</span><span class="s1">typeof</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">typeof</span><span class="s2">(</span><span class="s1">y</span><span class="s2">))</span>
            <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">argtys</span><span class="s2">, **</span><span class="s1">no_pyobj_flags</span><span class="s2">)(</span><span class="s1">pow_usecase</span><span class="s2">)</span>
            <span class="s1">r </span><span class="s2">= </span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">r</span><span class="s2">, </span><span class="s1">pow_usecase</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">_check_min_max</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">pyfunc</span><span class="s2">):</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">njit</span><span class="s2">()(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">()</span>
        <span class="s1">got </span><span class="s2">= </span><span class="s1">cfunc</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">got</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_min_max_iterable_input</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>

        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">frange</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">, </span><span class="s1">step</span><span class="s2">):</span>
            <span class="s1">i </span><span class="s2">= </span><span class="s1">start</span>
            <span class="s0">while </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">stop</span><span class="s2">:</span>
                <span class="s0">yield </span><span class="s1">i</span>
                <span class="s1">i </span><span class="s2">+= </span><span class="s1">step</span>

        <span class="s0">def </span><span class="s1">sample_functions</span><span class="s2">(</span><span class="s1">op</span><span class="s2">):</span>
            <span class="s0">yield lambda</span><span class="s2">: </span><span class="s1">op</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">))</span>
            <span class="s0">yield lambda</span><span class="s2">: </span><span class="s1">op</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">4</span><span class="s2">, </span><span class="s4">12</span><span class="s2">))</span>
            <span class="s0">yield lambda</span><span class="s2">: </span><span class="s1">op</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(-</span><span class="s4">4</span><span class="s2">, -</span><span class="s4">15</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">))</span>
            <span class="s0">yield lambda</span><span class="s2">: </span><span class="s1">op</span><span class="s2">([</span><span class="s4">6.6</span><span class="s2">, </span><span class="s4">5.5</span><span class="s2">, </span><span class="s4">7.7</span><span class="s2">])</span>
            <span class="s0">yield lambda</span><span class="s2">: </span><span class="s1">op</span><span class="s2">([(</span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">), (</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)])</span>
            <span class="s0">yield lambda</span><span class="s2">: </span><span class="s1">op</span><span class="s2">(</span><span class="s1">frange</span><span class="s2">(</span><span class="s4">1.1</span><span class="s2">, </span><span class="s4">3.3</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">))</span>
            <span class="s0">yield lambda</span><span class="s2">: </span><span class="s1">op</span><span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, -</span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">])</span>
            <span class="s0">yield lambda</span><span class="s2">: </span><span class="s1">op</span><span class="s2">([(</span><span class="s4">3</span><span class="s2">,), (</span><span class="s4">1</span><span class="s2">,), (</span><span class="s4">2</span><span class="s2">,)])</span>

        <span class="s0">for </span><span class="s1">fn </span><span class="s0">in </span><span class="s1">sample_functions</span><span class="s2">(</span><span class="s1">op</span><span class="s2">=</span><span class="s1">min</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_check_min_max</span><span class="s2">(</span><span class="s1">fn</span><span class="s2">)</span>

        <span class="s0">for </span><span class="s1">fn </span><span class="s0">in </span><span class="s1">sample_functions</span><span class="s2">(</span><span class="s1">op</span><span class="s2">=</span><span class="s1">max</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_check_min_max</span><span class="s2">(</span><span class="s1">fn</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestOperatorMixedTypes</span><span class="s2">(</span><span class="s1">TestCase</span><span class="s2">):</span>

    <span class="s0">def </span><span class="s1">test_eq_ne</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">opstr </span><span class="s0">in </span><span class="s2">(</span><span class="s3">'eq'</span><span class="s2">, </span><span class="s3">'ne'</span><span class="s2">):</span>
            <span class="s1">op </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">operator</span><span class="s2">, </span><span class="s1">opstr</span><span class="s2">)</span>

            <span class="s2">@</span><span class="s1">njit</span>
            <span class="s0">def </span><span class="s1">func</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">):</span>
                <span class="s0">return </span><span class="s1">op</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">)</span>

            <span class="s5"># all these things should evaluate to being equal or not, all should</span>
            <span class="s5"># survive typing.</span>
            <span class="s1">things </span><span class="s2">= (</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">2.0</span><span class="s2">, </span><span class="s4">1.1</span><span class="s2">, </span><span class="s4">1j</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s3">&quot;&quot;</span><span class="s2">, </span><span class="s3">&quot;1&quot;</span><span class="s2">)</span>
            <span class="s0">for </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s0">in </span><span class="s1">itertools</span><span class="s2">.</span><span class="s1">product</span><span class="s2">(</span><span class="s1">things</span><span class="s2">, </span><span class="s1">things</span><span class="s2">):</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">func</span><span class="s2">.</span><span class="s1">py_func</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">), </span><span class="s1">func</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_cmp</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">opstr </span><span class="s0">in </span><span class="s2">(</span><span class="s3">'gt'</span><span class="s2">, </span><span class="s3">'lt'</span><span class="s2">, </span><span class="s3">'ge'</span><span class="s2">, </span><span class="s3">'le'</span><span class="s2">, </span><span class="s3">'eq'</span><span class="s2">, </span><span class="s3">'ne'</span><span class="s2">):</span>
            <span class="s1">op </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">operator</span><span class="s2">, </span><span class="s1">opstr</span><span class="s2">)</span>
            <span class="s2">@</span><span class="s1">njit</span>
            <span class="s0">def </span><span class="s1">func</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">):</span>
                <span class="s0">return </span><span class="s1">op</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">)</span>

            <span class="s5"># numerical things should all be comparable</span>
            <span class="s1">things </span><span class="s2">= (</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">1.1</span><span class="s2">)</span>
            <span class="s0">for </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s0">in </span><span class="s1">itertools</span><span class="s2">.</span><span class="s1">product</span><span class="s2">(</span><span class="s1">things</span><span class="s2">, </span><span class="s1">things</span><span class="s2">):</span>
                <span class="s1">expected </span><span class="s2">= </span><span class="s1">func</span><span class="s2">.</span><span class="s1">py_func</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
                <span class="s1">got </span><span class="s2">= </span><span class="s1">func</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
                <span class="s1">message </span><span class="s2">= (</span><span class="s3">&quot;%s %s %s does not match between Python and Numba&quot;</span>
                           <span class="s2">% (</span><span class="s1">x</span><span class="s2">, </span><span class="s1">opstr</span><span class="s2">, </span><span class="s1">y</span><span class="s2">))</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">got</span><span class="s2">, </span><span class="s1">message</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestIsinstanceBuiltin</span><span class="s2">(</span><span class="s1">TestCase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">test_isinstance</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">isinstance_usecase</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>

        <span class="s1">inputs </span><span class="s2">= (</span>
            <span class="s4">3</span><span class="s2">,              </span><span class="s5"># int</span>
            <span class="s4">5.0</span><span class="s2">,            </span><span class="s5"># float</span>
            <span class="s3">&quot;Hello&quot;</span><span class="s2">,        </span><span class="s5"># string</span>
            <span class="s6">b'world'</span><span class="s2">,       </span><span class="s5"># bytes</span>
            <span class="s4">1j</span><span class="s2">,             </span><span class="s5"># complex</span>
            <span class="s2">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">],      </span><span class="s5"># list</span>
            <span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">),   </span><span class="s5"># UniTuple</span>
            <span class="s1">set</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">]),    </span><span class="s5"># set</span>
            <span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s3">'nba'</span><span class="s2">, </span><span class="s4">2</span><span class="s2">),  </span><span class="s5"># Heterogeneous Tuple</span>
            <span class="s5"># {'hello': 2},   # dict - doesn't work as input</span>
            <span class="s0">None</span><span class="s2">,</span>
        <span class="s2">)</span>

        <span class="s0">for </span><span class="s1">inpt </span><span class="s0">in </span><span class="s1">inputs</span><span class="s2">:</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s1">inpt</span><span class="s2">)</span>
            <span class="s1">got </span><span class="s2">= </span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">inpt</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">got</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_isinstance_dict</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Tests typed.Dict and LiteralStrKeyDict</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">isinstance_dict</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">pyfunc</span><span class="s2">(), </span><span class="s1">cfunc</span><span class="s2">())</span>

    <span class="s0">def </span><span class="s1">test_isinstance_issue9125</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">invalid_isinstance_usecase_phi_nopropagate2</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">pyfunc</span><span class="s2">(</span><span class="s4">3</span><span class="s2">), </span><span class="s1">cfunc</span><span class="s2">(</span><span class="s4">3</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_isinstance_numba_types</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># This makes use of type aliasing between python scalars and NumPy</span>
        <span class="s5"># scalars, see also test_numba_types()</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">isinstance_usecase_numba_types</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>

        <span class="s1">inputs </span><span class="s2">= (</span>
            <span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">(</span><span class="s4">1</span><span class="s2">), </span><span class="s3">'int32'</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">(</span><span class="s4">2</span><span class="s2">), </span><span class="s3">'int64'</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">(</span><span class="s4">3.0</span><span class="s2">), </span><span class="s3">'float32'</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">(</span><span class="s4">4.0</span><span class="s2">), </span><span class="s3">'float64'</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">complex64</span><span class="s2">(</span><span class="s4">5j</span><span class="s2">), </span><span class="s3">'no match'</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s1">typed</span><span class="s2">.</span><span class="s1">List</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">]), </span><span class="s3">'typed list'</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s1">typed</span><span class="s2">.</span><span class="s1">Dict</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">), </span><span class="s3">'typed dict'</span><span class="s2">)</span>
        <span class="s2">)</span>

        <span class="s0">for </span><span class="s1">inpt</span><span class="s2">, </span><span class="s1">expected </span><span class="s0">in </span><span class="s1">inputs</span><span class="s2">:</span>
            <span class="s1">got </span><span class="s2">= </span><span class="s1">cfunc</span><span class="s2">(</span><span class="s1">inpt</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">got</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_isinstance_numba_types_2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">isinstance_usecase_numba_types_2</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">pyfunc</span><span class="s2">(), </span><span class="s1">cfunc</span><span class="s2">())</span>

    <span class="s0">def </span><span class="s1">test_isinstance_invalid_type</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">pyfunc </span><span class="s2">= </span><span class="s1">isinstance_usecase_invalid_type</span>
        <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">pyfunc</span><span class="s2">)</span>

        <span class="s5"># valid type</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertTrue</span><span class="s2">(</span><span class="s1">cfunc</span><span class="s2">(</span><span class="s4">3.4</span><span class="s2">))</span>

        <span class="s5"># invalid type</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">'Cannot infer numba type of python type'</span>

        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">.</span><span class="s1">TypingError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">cfunc</span><span class="s2">(</span><span class="s4">100</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s1">msg</span><span class="s2">, </span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_isinstance_exceptions</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">fns </span><span class="s2">= [</span>
            <span class="s2">(</span><span class="s1">invalid_isinstance_usecase</span><span class="s2">,</span>
             <span class="s3">'Cannot infer numba type of python type'</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s1">invalid_isinstance_usecase_phi_nopropagate</span><span class="s2">,</span>
             <span class="s2">(</span><span class="s3">'isinstance() cannot determine the type of variable &quot;z&quot; due to a '</span>
             <span class="s3">'branch.'</span><span class="s2">)),</span>
            <span class="s2">(</span><span class="s1">invalid_isinstance_optional_usecase</span><span class="s2">,</span>
             <span class="s2">(</span><span class="s3">'isinstance() cannot determine the type of variable &quot;z&quot; due to a '</span>
             <span class="s3">'branch.'</span><span class="s2">)),</span>
            <span class="s2">(</span><span class="s1">invalid_isinstance_unsupported_type_usecase</span><span class="s2">(),</span>
             <span class="s2">(</span><span class="s3">'isinstance() does not support variables of type &quot;ntpl('</span><span class="s2">)),</span>
        <span class="s2">]</span>

        <span class="s0">for </span><span class="s1">fn</span><span class="s2">, </span><span class="s1">msg </span><span class="s0">in </span><span class="s1">fns</span><span class="s2">:</span>
            <span class="s1">fn </span><span class="s2">= </span><span class="s1">njit</span><span class="s2">(</span><span class="s1">fn</span><span class="s2">)</span>

            <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">.</span><span class="s1">TypingError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
                <span class="s1">fn</span><span class="s2">(</span><span class="s4">100</span><span class="s2">)</span>

            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s1">msg</span><span class="s2">, </span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_combinations</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Combinatorically test common classes and instances</span>
        <span class="s0">def </span><span class="s1">gen_w_arg</span><span class="s2">(</span><span class="s1">clazz_type</span><span class="s2">):</span>
            <span class="s0">def </span><span class="s1">impl</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
                <span class="s0">return </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">clazz_type</span><span class="s2">)</span>
            <span class="s0">return </span><span class="s1">impl</span>

        <span class="s1">clazz_types </span><span class="s2">= (</span><span class="s1">int</span><span class="s2">, </span><span class="s1">float</span><span class="s2">, </span><span class="s1">complex</span><span class="s2">, </span><span class="s1">str</span><span class="s2">, </span><span class="s1">list</span><span class="s2">, </span><span class="s1">tuple</span><span class="s2">, </span><span class="s1">bytes</span><span class="s2">, </span><span class="s1">set</span><span class="s2">, </span><span class="s1">range</span><span class="s2">,</span>
                       <span class="s1">np</span><span class="s2">.</span><span class="s1">int8</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">,)</span>
        <span class="s1">instances </span><span class="s2">= (</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2.3</span><span class="s2">, </span><span class="s4">4j</span><span class="s2">, </span><span class="s3">'5'</span><span class="s2">, [</span><span class="s4">6</span><span class="s2">,], (</span><span class="s4">7</span><span class="s2">,), </span><span class="s6">b'8'</span><span class="s2">, {</span><span class="s4">9</span><span class="s2">,}, </span><span class="s0">None</span><span class="s2">,</span>
                     <span class="s2">(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">11</span><span class="s2">, </span><span class="s4">12</span><span class="s2">), (</span><span class="s4">13</span><span class="s2">, </span><span class="s3">'a'</span><span class="s2">, </span><span class="s4">14j</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">15</span><span class="s2">, </span><span class="s4">16</span><span class="s2">, </span><span class="s4">17</span><span class="s2">]),</span>
                     <span class="s1">np</span><span class="s2">.</span><span class="s1">int8</span><span class="s2">(</span><span class="s4">18</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">(</span><span class="s4">19</span><span class="s2">),</span>
                     <span class="s1">typed</span><span class="s2">.</span><span class="s1">Dict</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">unicode_type</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">),</span>
                     <span class="s1">typed</span><span class="s2">.</span><span class="s1">List</span><span class="s2">.</span><span class="s1">empty_list</span><span class="s2">(</span><span class="s1">types</span><span class="s2">.</span><span class="s1">complex128</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s4">4</span><span class="s2">))</span>

        <span class="s0">for </span><span class="s1">ct </span><span class="s0">in </span><span class="s1">clazz_types</span><span class="s2">:</span>
            <span class="s1">fn </span><span class="s2">= </span><span class="s1">njit</span><span class="s2">(</span><span class="s1">gen_w_arg</span><span class="s2">(</span><span class="s1">ct</span><span class="s2">))</span>
            <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">instances</span><span class="s2">:</span>
                <span class="s1">expected </span><span class="s2">= </span><span class="s1">fn</span><span class="s2">.</span><span class="s1">py_func</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>
                <span class="s1">got </span><span class="s2">= </span><span class="s1">fn</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">got</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_numba_types</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Check types which are Numba types, this would break without the jit</span>
        <span class="s5"># decorator in all cases except numba.typed containers.</span>
        <span class="s0">def </span><span class="s1">gen_w_arg</span><span class="s2">(</span><span class="s1">clazz_type</span><span class="s2">):</span>
            <span class="s0">def </span><span class="s1">impl</span><span class="s2">():</span>
                <span class="s0">return </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">clazz_type</span><span class="s2">)</span>
            <span class="s0">return </span><span class="s1">impl</span>

        <span class="s1">clazz_types </span><span class="s2">= (</span><span class="s1">types</span><span class="s2">.</span><span class="s1">Integer</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">Float</span><span class="s2">, </span><span class="s1">types</span><span class="s2">.</span><span class="s1">Array</span><span class="s2">,)</span>

        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;Numba type classes.*are not supported&quot;</span>
        <span class="s0">for </span><span class="s1">ct </span><span class="s0">in </span><span class="s1">clazz_types</span><span class="s2">:</span>
            <span class="s1">fn </span><span class="s2">= </span><span class="s1">njit</span><span class="s2">(</span><span class="s1">gen_w_arg</span><span class="s2">(</span><span class="s1">ct</span><span class="s2">))</span>
            <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">.</span><span class="s1">TypingError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
                <span class="s1">fn</span><span class="s2">()</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertRegex</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">), </span><span class="s1">msg</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_python_numpy_scalar_alias_problem</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># There's a problem due to Python and NumPy scalars being aliased in the</span>
        <span class="s5"># type system. This is because e.g. int scalar values and NumPy np.intp</span>
        <span class="s5"># type alias to types.intp. This test merely records this fact.</span>

        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">():</span>
            <span class="s0">return </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">intp</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">int</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">foo</span><span class="s2">(), </span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">foo</span><span class="s2">.</span><span class="s1">py_func</span><span class="s2">(), </span><span class="s0">False</span><span class="s2">)</span>

        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">bar</span><span class="s2">():</span>
            <span class="s0">return </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">intp</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">bar</span><span class="s2">(), </span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">bar</span><span class="s2">.</span><span class="s1">py_func</span><span class="s2">(), </span><span class="s0">False</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_branch_prune</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Check that isinstance branches are pruned allowing otherwise</span>
        <span class="s5"># impossible type specific specialisation.</span>

        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">str</span><span class="s2">):</span>
                <span class="s0">return </span><span class="s1">x </span><span class="s2">+ </span><span class="s3">'some_string'</span>
            <span class="s0">elif </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">complex</span><span class="s2">):</span>
                <span class="s0">return </span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>
            <span class="s0">elif </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">tuple</span><span class="s2">):</span>
                <span class="s0">return </span><span class="s1">len</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s0">assert </span><span class="s4">0</span>

        <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s2">(</span><span class="s3">'string'</span><span class="s2">, </span><span class="s4">1 </span><span class="s2">+ </span><span class="s4">2j</span><span class="s2">, (</span><span class="s3">'a'</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4j</span><span class="s2">)):</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">foo</span><span class="s2">.</span><span class="s1">py_func</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>
            <span class="s1">got </span><span class="s2">= </span><span class="s1">foo</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">got</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestGetattrBuiltin</span><span class="s2">(</span><span class="s1">MemoryLeakMixin</span><span class="s2">, </span><span class="s1">TestCase</span><span class="s2">):</span>
    <span class="s5"># Tests the getattr() builtin</span>

    <span class="s0">def </span><span class="s1">test_getattr_func_retty</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>

        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s1">attr </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s3">'__hash__'</span><span class="s2">)</span>
            <span class="s0">return </span><span class="s1">attr</span><span class="s2">()</span>

        <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2.34</span><span class="s2">, (</span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">7</span><span class="s2">)):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">foo</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">foo</span><span class="s2">.</span><span class="s1">py_func</span><span class="s2">(</span><span class="s1">x</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_getattr_value_retty</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>

        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s3">'ndim'</span><span class="s2">)</span>

        <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">3</span><span class="s2">):</span>
            <span class="s1">tmp </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">((</span><span class="s4">1</span><span class="s2">, ) * </span><span class="s1">x</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">foo</span><span class="s2">(</span><span class="s1">tmp</span><span class="s2">), </span><span class="s1">foo</span><span class="s2">.</span><span class="s1">py_func</span><span class="s2">(</span><span class="s1">tmp</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_getattr_module_obj</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Consts on modules work ok</span>

        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">():</span>
            <span class="s0">return </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">np</span><span class="s2">, </span><span class="s3">'pi'</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">foo</span><span class="s2">(), </span><span class="s1">foo</span><span class="s2">.</span><span class="s1">py_func</span><span class="s2">())</span>

    <span class="s0">def </span><span class="s1">test_getattr_module_obj_not_implemented</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Functions on modules do not work at present</span>

        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">():</span>
            <span class="s0">return </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">np</span><span class="s2">, </span><span class="s3">'cos'</span><span class="s2">)(</span><span class="s4">1</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">.</span><span class="s1">TypingError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">foo</span><span class="s2">()</span>

        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;Returning function objects is not implemented&quot;</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s1">msg</span><span class="s2">, </span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_getattr_raises_attribute_error</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>

        <span class="s1">invalid_attr </span><span class="s2">= </span><span class="s3">'__not_a_valid_attr__'</span>

        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">invalid_attr</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">AttributeError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">foo</span><span class="s2">(</span><span class="s4">1.23</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s3">f&quot;'float64' has no attribute '</span><span class="s0">{</span><span class="s1">invalid_attr</span><span class="s0">}</span><span class="s3">'&quot;</span><span class="s2">,</span>
                      <span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_getattr_with_default</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Checks returning a default works</span>

        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">default</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s3">'__not_a_valid_attr__'</span><span class="s2">, </span><span class="s1">default</span><span class="s2">)</span>

        <span class="s0">for </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">((</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2.34</span><span class="s2">, (</span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">7</span><span class="s2">),), (</span><span class="s0">None</span><span class="s2">, </span><span class="s4">20</span><span class="s2">, </span><span class="s3">'some_string'</span><span class="s2">)):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">foo</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">), </span><span class="s1">foo</span><span class="s2">.</span><span class="s1">py_func</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_getattr_non_literal_str</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>

        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">nonliteral_str</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">nonliteral_str</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">.</span><span class="s1">TypingError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">foo</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s3">'__hash__'</span><span class="s2">)</span>

        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;argument 'name' must be a literal string&quot;</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s1">msg</span><span class="s2">, </span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_getattr_no_optional_type_generated</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>

        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">default_hash</span><span class="s2">():</span>
            <span class="s0">return </span><span class="s4">12345</span>

        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">():</span>
            <span class="s1">hash_func </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s4">1</span><span class="s2">), </span><span class="s3">&quot;__not_a_valid_attr__&quot;</span><span class="s2">,</span>
                                <span class="s1">default_hash</span><span class="s2">)</span>
            <span class="s0">return </span><span class="s1">hash_func</span><span class="s2">() </span><span class="s5"># Optionals have no call support</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">foo</span><span class="s2">(), </span><span class="s1">foo</span><span class="s2">.</span><span class="s1">py_func</span><span class="s2">())</span>


<span class="s0">class </span><span class="s1">TestHasattrBuiltin</span><span class="s2">(</span><span class="s1">MemoryLeakMixin</span><span class="s2">, </span><span class="s1">TestCase</span><span class="s2">):</span>
    <span class="s5"># Tests the hasattr() builtin</span>

    <span class="s0">def </span><span class="s1">test_hasattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>

        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s3">'__hash__'</span><span class="s2">), </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s3">'__not_a_valid_attr__'</span><span class="s2">)</span>

        <span class="s1">ty </span><span class="s2">= </span><span class="s1">types</span><span class="s2">.</span><span class="s1">int64</span>
        <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2.34</span><span class="s2">, (</span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">7</span><span class="s2">), </span><span class="s1">typed</span><span class="s2">.</span><span class="s1">Dict</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">(</span><span class="s1">ty</span><span class="s2">, </span><span class="s1">ty</span><span class="s2">),</span>
                  <span class="s1">typed</span><span class="s2">.</span><span class="s1">List</span><span class="s2">.</span><span class="s1">empty_list</span><span class="s2">(</span><span class="s1">ty</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s4">4</span><span class="s2">), </span><span class="s3">'ABC'</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">foo</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">foo</span><span class="s2">.</span><span class="s1">py_func</span><span class="s2">(</span><span class="s1">x</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_hasattr_non_const_attr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># This tests that an error is raised in the case that a hasattr() call</span>
        <span class="s5"># is made on an attribute that cannot be resolved as a compile time</span>
        <span class="s5"># constant (there's a phi in the way!).</span>

        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">(</span><span class="s1">pred</span><span class="s2">):</span>
            <span class="s0">if </span><span class="s1">pred </span><span class="s2">&gt; </span><span class="s4">3</span><span class="s2">:</span>
                <span class="s1">attr </span><span class="s2">= </span><span class="s3">&quot;__hash__&quot;</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s1">attr </span><span class="s2">= </span><span class="s3">&quot;__str__&quot;</span>

            <span class="s1">hasattr</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">attr</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">.</span><span class="s1">NumbaTypeError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
            <span class="s1">foo</span><span class="s2">(</span><span class="s4">6</span><span class="s2">)</span>

        <span class="s1">msg </span><span class="s2">= (</span><span class="s3">'hasattr() cannot determine the type of variable '</span>
               <span class="s3">'&quot;attr&quot; due to a branch.'</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s1">msg</span><span class="s2">, </span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">))</span>


<span class="s0">class </span><span class="s1">TestStrAndReprBuiltin</span><span class="s2">(</span><span class="s1">MemoryLeakMixin</span><span class="s2">, </span><span class="s1">TestCase</span><span class="s2">):</span>

    <span class="s0">def </span><span class="s1">test_str_default</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>

        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">():</span>
            <span class="s0">return </span><span class="s1">str</span><span class="s2">()</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">foo</span><span class="s2">(), </span><span class="s1">foo</span><span class="s2">.</span><span class="s1">py_func</span><span class="s2">())</span>

    <span class="s0">def </span><span class="s1">test_str_object_kwarg</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>

        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s1">str</span><span class="s2">(</span><span class="s1">object</span><span class="s2">=</span><span class="s1">x</span><span class="s2">)</span>

        <span class="s1">value </span><span class="s2">= </span><span class="s3">&quot;a string&quot;</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">foo</span><span class="s2">(</span><span class="s1">value</span><span class="s2">), </span><span class="s1">foo</span><span class="s2">.</span><span class="s1">py_func</span><span class="s2">(</span><span class="s1">value</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_str_calls_dunder_str</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>

        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s1">str</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>

        <span class="s1">Dummy</span><span class="s2">, </span><span class="s1">DummyType </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">make_dummy_type</span><span class="s2">()</span>
        <span class="s1">dummy </span><span class="s2">= </span><span class="s1">Dummy</span><span class="s2">()</span>
        <span class="s1">string_repr </span><span class="s2">= </span><span class="s3">&quot;this is the dummy object str&quot;</span>
        <span class="s1">Dummy</span><span class="s2">.</span><span class="s1">__str__</span><span class="s2">= </span><span class="s0">lambda </span><span class="s1">inst</span><span class="s2">: </span><span class="s1">string_repr</span>

        <span class="s2">@</span><span class="s1">overload_method</span><span class="s2">(</span><span class="s1">DummyType</span><span class="s2">, </span><span class="s3">&quot;__str__&quot;</span><span class="s2">)</span>
        <span class="s0">def </span><span class="s1">ol_dummy_string</span><span class="s2">(</span><span class="s1">dummy</span><span class="s2">):</span>
            <span class="s0">def </span><span class="s1">impl</span><span class="s2">(</span><span class="s1">dummy</span><span class="s2">):</span>
                <span class="s0">return </span><span class="s1">string_repr</span>
            <span class="s0">return </span><span class="s1">impl</span>

        <span class="s2">@</span><span class="s1">overload_method</span><span class="s2">(</span><span class="s1">DummyType</span><span class="s2">, </span><span class="s3">&quot;__repr__&quot;</span><span class="s2">)</span>
        <span class="s0">def </span><span class="s1">ol_dummy_repr</span><span class="s2">(</span><span class="s1">dummy</span><span class="s2">):</span>
            <span class="s0">def </span><span class="s1">impl</span><span class="s2">(</span><span class="s1">dummy</span><span class="s2">):</span>
                <span class="s0">return </span><span class="s3">&quot;SHOULD NOT BE CALLED&quot;</span>
            <span class="s0">return </span><span class="s1">impl</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">foo</span><span class="s2">(</span><span class="s1">dummy</span><span class="s2">), </span><span class="s1">foo</span><span class="s2">.</span><span class="s1">py_func</span><span class="s2">(</span><span class="s1">dummy</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_str_falls_back_to_repr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>

        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s1">str</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>

        <span class="s1">Dummy</span><span class="s2">, </span><span class="s1">DummyType </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">make_dummy_type</span><span class="s2">()</span>
        <span class="s1">dummy </span><span class="s2">= </span><span class="s1">Dummy</span><span class="s2">()</span>
        <span class="s1">string_repr </span><span class="s2">= </span><span class="s3">&quot;this is the dummy object repr&quot;</span>
        <span class="s1">Dummy</span><span class="s2">.</span><span class="s1">__repr__</span><span class="s2">= </span><span class="s0">lambda </span><span class="s1">inst</span><span class="s2">: </span><span class="s1">string_repr</span>

        <span class="s2">@</span><span class="s1">overload_method</span><span class="s2">(</span><span class="s1">DummyType</span><span class="s2">, </span><span class="s3">&quot;__repr__&quot;</span><span class="s2">)</span>
        <span class="s0">def </span><span class="s1">ol_dummy_repr</span><span class="s2">(</span><span class="s1">dummy</span><span class="s2">):</span>
            <span class="s0">def </span><span class="s1">impl</span><span class="s2">(</span><span class="s1">dummy</span><span class="s2">):</span>
                <span class="s0">return </span><span class="s1">string_repr</span>
            <span class="s0">return </span><span class="s1">impl</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">foo</span><span class="s2">(</span><span class="s1">dummy</span><span class="s2">), </span><span class="s1">foo</span><span class="s2">.</span><span class="s1">py_func</span><span class="s2">(</span><span class="s1">dummy</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_repr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s1">repr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">x</span>

        <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s2">(</span><span class="s3">&quot;abc&quot;</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s4">123</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">foo</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">foo</span><span class="s2">.</span><span class="s1">py_func</span><span class="s2">(</span><span class="s1">x</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_repr_fallback</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># checks str/repr fallback, there's no overloaded __str__ or __repr__</span>
        <span class="s5"># for the dummy type so it has to use generic '&lt;object type:(type)&gt;'</span>
        <span class="s5"># string for the `repr` call.</span>

        <span class="s1">Dummy</span><span class="s2">, </span><span class="s1">DummyType </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">make_dummy_type</span><span class="s2">()</span>
        <span class="s1">dummy </span><span class="s2">= </span><span class="s1">Dummy</span><span class="s2">()</span>
        <span class="s1">string_repr </span><span class="s2">= </span><span class="s3">f&quot;&lt;object type:</span><span class="s0">{</span><span class="s1">typeof</span><span class="s2">(</span><span class="s1">dummy</span><span class="s2">)</span><span class="s0">}</span><span class="s3">&gt;&quot;</span>
        <span class="s1">Dummy</span><span class="s2">.</span><span class="s1">__repr__</span><span class="s2">= </span><span class="s0">lambda </span><span class="s1">inst</span><span class="s2">: </span><span class="s1">string_repr</span>

        <span class="s2">@</span><span class="s1">box</span><span class="s2">(</span><span class="s1">DummyType</span><span class="s2">)</span>
        <span class="s0">def </span><span class="s1">box_dummy</span><span class="s2">(</span><span class="s1">typ</span><span class="s2">, </span><span class="s1">obj</span><span class="s2">, </span><span class="s1">c</span><span class="s2">):</span>
            <span class="s1">clazobj </span><span class="s2">= </span><span class="s1">c</span><span class="s2">.</span><span class="s1">pyapi</span><span class="s2">.</span><span class="s1">unserialize</span><span class="s2">(</span><span class="s1">c</span><span class="s2">.</span><span class="s1">pyapi</span><span class="s2">.</span><span class="s1">serialize_object</span><span class="s2">(</span><span class="s1">Dummy</span><span class="s2">))</span>
            <span class="s0">return </span><span class="s1">c</span><span class="s2">.</span><span class="s1">pyapi</span><span class="s2">.</span><span class="s1">call_function_objargs</span><span class="s2">(</span><span class="s1">clazobj</span><span class="s2">, ())</span>

        <span class="s2">@</span><span class="s1">njit</span>
        <span class="s0">def </span><span class="s1">foo</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s1">str</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertEqual</span><span class="s2">(</span><span class="s1">foo</span><span class="s2">(</span><span class="s1">dummy</span><span class="s2">), </span><span class="s1">foo</span><span class="s2">.</span><span class="s1">py_func</span><span class="s2">(</span><span class="s1">dummy</span><span class="s2">))</span>



<span class="s0">if </span><span class="s1">__name__ </span><span class="s2">== </span><span class="s3">'__main__'</span><span class="s2">:</span>
    <span class="s1">unittest</span><span class="s2">.</span><span class="s1">main</span><span class="s2">()</span>
</pre>
</body>
</html>