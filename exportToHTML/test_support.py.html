<html>
<head>
<title>test_support.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #2aacb8;}
.s4 { color: #6aab73;}
.s5 { color: #5f826b; font-style: italic;}
.s6 { color: #7a7e85;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_support.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">itertools</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>

<span class="s0">from </span><span class="s1">numba </span><span class="s0">import </span><span class="s1">jit</span>
<span class="s0">from </span><span class="s1">numba</span><span class="s2">.</span><span class="s1">core </span><span class="s0">import </span><span class="s1">utils</span>
<span class="s0">from </span><span class="s1">numba</span><span class="s2">.</span><span class="s1">tests</span><span class="s2">.</span><span class="s1">support </span><span class="s0">import </span><span class="s1">TestCase</span><span class="s2">, </span><span class="s1">forbid_codegen</span>
<span class="s0">from </span><span class="s2">.</span><span class="s1">enum_usecases </span><span class="s0">import </span><span class="s2">*</span>
<span class="s0">import </span><span class="s1">unittest</span>

<span class="s1">DBL_EPSILON </span><span class="s2">= </span><span class="s3">2</span><span class="s2">**-</span><span class="s3">52</span>
<span class="s1">FLT_EPSILON </span><span class="s2">= </span><span class="s3">2</span><span class="s2">**-</span><span class="s3">23</span>

<span class="s1">INF </span><span class="s2">= </span><span class="s1">float</span><span class="s2">(</span><span class="s4">'inf'</span><span class="s2">)</span>
<span class="s1">NAN </span><span class="s2">= </span><span class="s1">float</span><span class="s2">(</span><span class="s4">'nan'</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestAssertPreciseEqual</span><span class="s2">(</span><span class="s1">TestCase</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot; 
    Tests for TestCase.assertPreciseEqual(). 
    &quot;&quot;&quot;</span>

    <span class="s1">int_types </span><span class="s2">= [</span><span class="s1">int</span><span class="s2">]</span>
    <span class="s1">np_float_types </span><span class="s2">= [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">]</span>
    <span class="s1">float_types </span><span class="s2">= [</span><span class="s1">float</span><span class="s2">] + </span><span class="s1">np_float_types</span>
    <span class="s1">np_complex_types </span><span class="s2">= [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">complex64</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">complex128</span><span class="s2">]</span>
    <span class="s1">complex_types </span><span class="s2">= [</span><span class="s1">complex</span><span class="s2">] + </span><span class="s1">np_complex_types</span>
    <span class="s1">bool_types </span><span class="s2">= [</span><span class="s1">bool</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">bool_</span><span class="s2">]</span>

    <span class="s0">def </span><span class="s1">eq</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">left</span><span class="s2">, </span><span class="s1">right</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">assert_succeed</span><span class="s2">(</span><span class="s1">left</span><span class="s2">, </span><span class="s1">right</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">left</span><span class="s2">, </span><span class="s1">right</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">right</span><span class="s2">, </span><span class="s1">left</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>
        <span class="s1">assert_succeed</span><span class="s2">(</span><span class="s1">left</span><span class="s2">, </span><span class="s1">right</span><span class="s2">)</span>
        <span class="s1">assert_succeed</span><span class="s2">((</span><span class="s1">left</span><span class="s2">, </span><span class="s1">left</span><span class="s2">), (</span><span class="s1">right</span><span class="s2">, </span><span class="s1">right</span><span class="s2">))</span>
        <span class="s1">assert_succeed</span><span class="s2">([</span><span class="s1">left</span><span class="s2">, </span><span class="s1">left</span><span class="s2">], [</span><span class="s1">right</span><span class="s2">, </span><span class="s1">right</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">ne</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">left</span><span class="s2">, </span><span class="s1">right</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">assert_fail</span><span class="s2">(</span><span class="s1">left</span><span class="s2">, </span><span class="s1">right</span><span class="s2">):</span>
            <span class="s0">try</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">assertPreciseEqual</span><span class="s2">(</span><span class="s1">left</span><span class="s2">, </span><span class="s1">right</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>
            <span class="s0">except </span><span class="s1">AssertionError</span><span class="s2">:</span>
                <span class="s0">pass</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">fail</span><span class="s2">(</span><span class="s4">&quot;%s and %s unexpectedly considered equal&quot; </span><span class="s2">% (</span><span class="s1">left</span><span class="s2">, </span><span class="s1">right</span><span class="s2">))</span>
        <span class="s1">assert_fail</span><span class="s2">(</span><span class="s1">left</span><span class="s2">, </span><span class="s1">right</span><span class="s2">)</span>
        <span class="s1">assert_fail</span><span class="s2">(</span><span class="s1">right</span><span class="s2">, </span><span class="s1">left</span><span class="s2">)</span>
        <span class="s1">assert_fail</span><span class="s2">((</span><span class="s1">left</span><span class="s2">, </span><span class="s1">left</span><span class="s2">), (</span><span class="s1">right</span><span class="s2">, </span><span class="s1">right</span><span class="s2">))</span>
        <span class="s1">assert_fail</span><span class="s2">((</span><span class="s1">right</span><span class="s2">, </span><span class="s1">right</span><span class="s2">), (</span><span class="s1">left</span><span class="s2">, </span><span class="s1">left</span><span class="s2">))</span>
        <span class="s1">assert_fail</span><span class="s2">([</span><span class="s1">left</span><span class="s2">, </span><span class="s1">left</span><span class="s2">], [</span><span class="s1">right</span><span class="s2">, </span><span class="s1">right</span><span class="s2">])</span>
        <span class="s1">assert_fail</span><span class="s2">([</span><span class="s1">right</span><span class="s2">, </span><span class="s1">right</span><span class="s2">], [</span><span class="s1">left</span><span class="s2">, </span><span class="s1">left</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">test_types</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6"># assertPreciseEqual() should test for type compatibility</span>
        <span class="s6"># int-like, float-like, complex-like are not compatible</span>
        <span class="s0">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">c </span><span class="s0">in </span><span class="s1">itertools</span><span class="s2">.</span><span class="s1">product</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">int_types</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">float_types</span><span class="s2">,</span>
                                         <span class="s1">self</span><span class="s2">.</span><span class="s1">complex_types</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">i</span><span class="s2">(</span><span class="s3">1</span><span class="s2">), </span><span class="s1">f</span><span class="s2">(</span><span class="s3">1</span><span class="s2">))</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">f</span><span class="s2">(</span><span class="s3">1</span><span class="s2">), </span><span class="s1">c</span><span class="s2">(</span><span class="s3">1</span><span class="s2">))</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">i</span><span class="s2">(</span><span class="s3">1</span><span class="s2">), </span><span class="s1">c</span><span class="s2">(</span><span class="s3">1</span><span class="s2">))</span>
        <span class="s6"># int and long are compatible between each other</span>
        <span class="s0">for </span><span class="s1">u</span><span class="s2">, </span><span class="s1">v </span><span class="s0">in </span><span class="s1">itertools</span><span class="s2">.</span><span class="s1">product</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">int_types</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">int_types</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">u</span><span class="s2">(</span><span class="s3">1</span><span class="s2">), </span><span class="s1">v</span><span class="s2">(</span><span class="s3">1</span><span class="s2">))</span>
        <span class="s6"># int and bool are not compatible between each other</span>
        <span class="s0">for </span><span class="s1">u</span><span class="s2">, </span><span class="s1">v </span><span class="s0">in </span><span class="s1">itertools</span><span class="s2">.</span><span class="s1">product</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">int_types</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">bool_types</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">u</span><span class="s2">(</span><span class="s3">1</span><span class="s2">), </span><span class="s1">v</span><span class="s2">(</span><span class="s3">1</span><span class="s2">))</span>
        <span class="s6"># NumPy float types are not compatible between each other</span>
        <span class="s0">for </span><span class="s1">u</span><span class="s2">, </span><span class="s1">v </span><span class="s0">in </span><span class="s1">itertools</span><span class="s2">.</span><span class="s1">product</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">np_float_types</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">np_float_types</span><span class="s2">):</span>
            <span class="s0">if </span><span class="s1">u </span><span class="s0">is </span><span class="s1">v</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">u</span><span class="s2">(</span><span class="s3">1</span><span class="s2">), </span><span class="s1">v</span><span class="s2">(</span><span class="s3">1</span><span class="s2">))</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">u</span><span class="s2">(</span><span class="s3">1</span><span class="s2">), </span><span class="s1">v</span><span class="s2">(</span><span class="s3">1</span><span class="s2">))</span>
        <span class="s6"># NumPy complex types are not compatible between each other</span>
        <span class="s0">for </span><span class="s1">u</span><span class="s2">, </span><span class="s1">v </span><span class="s0">in </span><span class="s1">itertools</span><span class="s2">.</span><span class="s1">product</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">np_complex_types</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">np_complex_types</span><span class="s2">):</span>
            <span class="s0">if </span><span class="s1">u </span><span class="s0">is </span><span class="s1">v</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">u</span><span class="s2">(</span><span class="s3">1</span><span class="s2">), </span><span class="s1">v</span><span class="s2">(</span><span class="s3">1</span><span class="s2">))</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">u</span><span class="s2">(</span><span class="s3">1</span><span class="s2">), </span><span class="s1">v</span><span class="s2">(</span><span class="s3">1</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_int_values</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">tp </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">int_types</span><span class="s2">:</span>
            <span class="s0">for </span><span class="s1">prec </span><span class="s0">in </span><span class="s2">[</span><span class="s4">'exact'</span><span class="s2">, </span><span class="s4">'single'</span><span class="s2">, </span><span class="s4">'double'</span><span class="s2">]:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s3">0</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s3">0</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s3">0</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s3">1</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(-</span><span class="s3">1</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s3">1</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s3">2</span><span class="s2">**</span><span class="s3">80</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s3">1</span><span class="s2">+</span><span class="s3">2</span><span class="s2">**</span><span class="s3">80</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_bool_values</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">tpa</span><span class="s2">, </span><span class="s1">tpb </span><span class="s0">in </span><span class="s1">itertools</span><span class="s2">.</span><span class="s1">product</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">bool_types</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">bool_types</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tpa</span><span class="s2">(</span><span class="s0">True</span><span class="s2">), </span><span class="s1">tpb</span><span class="s2">(</span><span class="s0">True</span><span class="s2">))</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tpa</span><span class="s2">(</span><span class="s0">False</span><span class="s2">), </span><span class="s1">tpb</span><span class="s2">(</span><span class="s0">False</span><span class="s2">))</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tpa</span><span class="s2">(</span><span class="s0">True</span><span class="s2">), </span><span class="s1">tpb</span><span class="s2">(</span><span class="s0">False</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_abs_tol_parse</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6"># check invalid values in abs_tol kwarg raises</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">(</span><span class="s3">1e-17</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">(</span><span class="s3">1e-17</span><span class="s2">), </span><span class="s1">abs_tol</span><span class="s2">=</span><span class="s4">&quot;invalid&quot;</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">(</span><span class="s3">1</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">(</span><span class="s3">2</span><span class="s2">), </span><span class="s1">abs_tol</span><span class="s2">=</span><span class="s1">int</span><span class="s2">(</span><span class="s3">7</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_float_values</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">tp </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">float_types</span><span class="s2">:</span>
            <span class="s0">for </span><span class="s1">prec </span><span class="s0">in </span><span class="s2">[</span><span class="s4">'exact'</span><span class="s2">, </span><span class="s4">'single'</span><span class="s2">, </span><span class="s4">'double'</span><span class="s2">]:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s3">1.5</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s3">1.5</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">)</span>
                <span class="s6"># Signed zeros</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s3">0.0</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s3">0.0</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(-</span><span class="s3">0.0</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(-</span><span class="s3">0.0</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s3">0.0</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(-</span><span class="s3">0.0</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s3">0.0</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(-</span><span class="s3">0.0</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">, </span><span class="s1">ignore_sign_on_zero</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
                <span class="s6"># Infinities</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">INF</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">INF</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">INF</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s3">1e38</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(-</span><span class="s1">INF</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(-</span><span class="s1">INF</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">INF</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(-</span><span class="s1">INF</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">)</span>
                <span class="s6"># NaNs</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">NAN</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">NAN</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">NAN</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s3">0</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">NAN</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">INF</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">NAN</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(-</span><span class="s1">INF</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_float64_values</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">tp </span><span class="s0">in </span><span class="s2">[</span><span class="s1">float</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">]:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s3">1.0 </span><span class="s2">+ </span><span class="s1">DBL_EPSILON</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s3">1.0</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_float32_values</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">tp </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s3">1.0 </span><span class="s2">+ </span><span class="s1">FLT_EPSILON</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s3">1.0</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_float64_values_inexact</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">tp </span><span class="s0">in </span><span class="s2">[</span><span class="s1">float</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">]:</span>
            <span class="s0">for </span><span class="s1">scale </span><span class="s0">in </span><span class="s2">[</span><span class="s3">1.0</span><span class="s2">, -</span><span class="s3">2</span><span class="s2">**</span><span class="s3">3</span><span class="s2">, </span><span class="s3">2</span><span class="s2">**-</span><span class="s3">4</span><span class="s2">, -</span><span class="s3">2</span><span class="s2">**-</span><span class="s3">20</span><span class="s2">]:</span>
                <span class="s1">a </span><span class="s2">= </span><span class="s1">scale </span><span class="s2">* </span><span class="s3">1.0</span>
                <span class="s1">b </span><span class="s2">= </span><span class="s1">scale </span><span class="s2">* (</span><span class="s3">1.0 </span><span class="s2">+ </span><span class="s1">DBL_EPSILON</span><span class="s2">)</span>
                <span class="s1">c </span><span class="s2">= </span><span class="s1">scale </span><span class="s2">* (</span><span class="s3">1.0 </span><span class="s2">+ </span><span class="s1">DBL_EPSILON </span><span class="s2">* </span><span class="s3">2</span><span class="s2">)</span>
                <span class="s1">d </span><span class="s2">= </span><span class="s1">scale </span><span class="s2">* (</span><span class="s3">1.0 </span><span class="s2">+ </span><span class="s1">DBL_EPSILON </span><span class="s2">* </span><span class="s3">4</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">a</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">b</span><span class="s2">))</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">a</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">b</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'exact'</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">a</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">b</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'double'</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">a</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">b</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'double'</span><span class="s2">, </span><span class="s1">ulps</span><span class="s2">=</span><span class="s3">1</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">a</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">c</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'double'</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">a</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">c</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'double'</span><span class="s2">, </span><span class="s1">ulps</span><span class="s2">=</span><span class="s3">2</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">a</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">d</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'double'</span><span class="s2">, </span><span class="s1">ulps</span><span class="s2">=</span><span class="s3">2</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">a</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">c</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'double'</span><span class="s2">, </span><span class="s1">ulps</span><span class="s2">=</span><span class="s3">3</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">a</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">d</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'double'</span><span class="s2">, </span><span class="s1">ulps</span><span class="s2">=</span><span class="s3">3</span><span class="s2">)</span>
            <span class="s6"># test absolute tolerance based on eps</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s3">1e-16</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s3">3e-16</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'double'</span><span class="s2">, </span><span class="s1">abs_tol</span><span class="s2">=</span><span class="s4">&quot;eps&quot;</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s3">1e-16</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s3">4e-16</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'double'</span><span class="s2">, </span><span class="s1">abs_tol</span><span class="s2">=</span><span class="s4">&quot;eps&quot;</span><span class="s2">)</span>
            <span class="s6"># test absolute tolerance based on value</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s3">1e-17</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s3">1e-18</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'double'</span><span class="s2">, </span><span class="s1">abs_tol</span><span class="s2">=</span><span class="s3">1e-17</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s3">1e-17</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s3">3e-17</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'double'</span><span class="s2">, </span><span class="s1">abs_tol</span><span class="s2">=</span><span class="s3">1e-17</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_float32_values_inexact</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">tp </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span>
        <span class="s0">for </span><span class="s1">scale </span><span class="s0">in </span><span class="s2">[</span><span class="s3">1.0</span><span class="s2">, -</span><span class="s3">2</span><span class="s2">**</span><span class="s3">3</span><span class="s2">, </span><span class="s3">2</span><span class="s2">**-</span><span class="s3">4</span><span class="s2">, -</span><span class="s3">2</span><span class="s2">**-</span><span class="s3">20</span><span class="s2">]:</span>
            <span class="s6"># About the choice of 0.9: there seem to be issues when</span>
            <span class="s6"># converting</span>
            <span class="s1">a </span><span class="s2">= </span><span class="s1">scale </span><span class="s2">* </span><span class="s3">1.0</span>
            <span class="s1">b </span><span class="s2">= </span><span class="s1">scale </span><span class="s2">* (</span><span class="s3">1.0 </span><span class="s2">+ </span><span class="s1">FLT_EPSILON</span><span class="s2">)</span>
            <span class="s1">c </span><span class="s2">= </span><span class="s1">scale </span><span class="s2">* (</span><span class="s3">1.0 </span><span class="s2">+ </span><span class="s1">FLT_EPSILON </span><span class="s2">* </span><span class="s3">2</span><span class="s2">)</span>
            <span class="s1">d </span><span class="s2">= </span><span class="s1">scale </span><span class="s2">* (</span><span class="s3">1.0 </span><span class="s2">+ </span><span class="s1">FLT_EPSILON </span><span class="s2">* </span><span class="s3">4</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">a</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">b</span><span class="s2">))</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">a</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">b</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'exact'</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">a</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">b</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'double'</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">a</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">b</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'single'</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">a</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">c</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'single'</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">a</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">c</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'single'</span><span class="s2">, </span><span class="s1">ulps</span><span class="s2">=</span><span class="s3">2</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">a</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">d</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'single'</span><span class="s2">, </span><span class="s1">ulps</span><span class="s2">=</span><span class="s3">2</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">a</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">c</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'single'</span><span class="s2">, </span><span class="s1">ulps</span><span class="s2">=</span><span class="s3">3</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">a</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">d</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'single'</span><span class="s2">, </span><span class="s1">ulps</span><span class="s2">=</span><span class="s3">3</span><span class="s2">)</span>
        <span class="s6"># test absolute tolerance based on eps</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s3">1e-7</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s3">2e-7</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'single'</span><span class="s2">, </span><span class="s1">abs_tol</span><span class="s2">=</span><span class="s4">&quot;eps&quot;</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s3">1e-7</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s3">3e-7</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'single'</span><span class="s2">, </span><span class="s1">abs_tol</span><span class="s2">=</span><span class="s4">&quot;eps&quot;</span><span class="s2">)</span>
        <span class="s6"># test absolute tolerance based on value</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s3">1e-7</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s3">1e-8</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'single'</span><span class="s2">, </span><span class="s1">abs_tol</span><span class="s2">=</span><span class="s3">1e-7</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s3">1e-7</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s3">3e-7</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'single'</span><span class="s2">, </span><span class="s1">abs_tol</span><span class="s2">=</span><span class="s3">1e-7</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_complex_values</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6"># Complex literals with signed zeros are confusing, better use</span>
        <span class="s6"># the explicit constructor.</span>
        <span class="s1">c_pp</span><span class="s2">, </span><span class="s1">c_pn</span><span class="s2">, </span><span class="s1">c_np</span><span class="s2">, </span><span class="s1">c_nn </span><span class="s2">= [</span><span class="s1">complex</span><span class="s2">(</span><span class="s3">0.0</span><span class="s2">, </span><span class="s3">0.0</span><span class="s2">), </span><span class="s1">complex</span><span class="s2">(</span><span class="s3">0.0</span><span class="s2">, -</span><span class="s3">0.0</span><span class="s2">),</span>
                                  <span class="s1">complex</span><span class="s2">(-</span><span class="s3">0.0</span><span class="s2">, </span><span class="s3">0.0</span><span class="s2">), </span><span class="s1">complex</span><span class="s2">(-</span><span class="s3">0.0</span><span class="s2">, -</span><span class="s3">0.0</span><span class="s2">)]</span>
        <span class="s0">for </span><span class="s1">tp </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">complex_types</span><span class="s2">:</span>
            <span class="s0">for </span><span class="s1">prec </span><span class="s0">in </span><span class="s2">[</span><span class="s4">'exact'</span><span class="s2">, </span><span class="s4">'single'</span><span class="s2">, </span><span class="s4">'double'</span><span class="s2">]:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s3">1 </span><span class="s2">+ </span><span class="s3">2j</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s3">1 </span><span class="s2">+ </span><span class="s3">2j</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s3">1 </span><span class="s2">+ </span><span class="s3">1j</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s3">1 </span><span class="s2">+ </span><span class="s3">2j</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s3">2 </span><span class="s2">+ </span><span class="s3">2j</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s3">1 </span><span class="s2">+ </span><span class="s3">2j</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">)</span>
                <span class="s6"># Signed zeros</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">c_pp</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">c_pp</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">c_np</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">c_np</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">c_nn</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">c_nn</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">c_pp</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">c_pn</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">c_pn</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">c_nn</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">)</span>
                <span class="s6"># Infinities</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">complex</span><span class="s2">(</span><span class="s1">INF</span><span class="s2">, </span><span class="s1">INF</span><span class="s2">)), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">complex</span><span class="s2">(</span><span class="s1">INF</span><span class="s2">, </span><span class="s1">INF</span><span class="s2">)), </span><span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">complex</span><span class="s2">(</span><span class="s1">INF</span><span class="s2">, -</span><span class="s1">INF</span><span class="s2">)), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">complex</span><span class="s2">(</span><span class="s1">INF</span><span class="s2">, -</span><span class="s1">INF</span><span class="s2">)), </span><span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">complex</span><span class="s2">(-</span><span class="s1">INF</span><span class="s2">, -</span><span class="s1">INF</span><span class="s2">)), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">complex</span><span class="s2">(-</span><span class="s1">INF</span><span class="s2">, -</span><span class="s1">INF</span><span class="s2">)), </span><span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">complex</span><span class="s2">(</span><span class="s1">INF</span><span class="s2">, </span><span class="s1">INF</span><span class="s2">)), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">complex</span><span class="s2">(</span><span class="s1">INF</span><span class="s2">, -</span><span class="s1">INF</span><span class="s2">)), </span><span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">complex</span><span class="s2">(</span><span class="s1">INF</span><span class="s2">, </span><span class="s1">INF</span><span class="s2">)), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">complex</span><span class="s2">(-</span><span class="s1">INF</span><span class="s2">, </span><span class="s1">INF</span><span class="s2">)), </span><span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">complex</span><span class="s2">(</span><span class="s1">INF</span><span class="s2">, </span><span class="s3">0</span><span class="s2">)), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">complex</span><span class="s2">(</span><span class="s1">INF</span><span class="s2">, </span><span class="s3">0</span><span class="s2">)), </span><span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">)</span>
                <span class="s6"># NaNs</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">complex</span><span class="s2">(</span><span class="s1">NAN</span><span class="s2">, </span><span class="s3">0</span><span class="s2">)), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">complex</span><span class="s2">(</span><span class="s1">NAN</span><span class="s2">, </span><span class="s3">0</span><span class="s2">)), </span><span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">complex</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">NAN</span><span class="s2">)), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">complex</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">NAN</span><span class="s2">)), </span><span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">complex</span><span class="s2">(</span><span class="s1">NAN</span><span class="s2">, </span><span class="s1">NAN</span><span class="s2">)), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">complex</span><span class="s2">(</span><span class="s1">NAN</span><span class="s2">, </span><span class="s1">NAN</span><span class="s2">)), </span><span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">complex</span><span class="s2">(</span><span class="s1">INF</span><span class="s2">, </span><span class="s1">NAN</span><span class="s2">)), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">complex</span><span class="s2">(</span><span class="s1">INF</span><span class="s2">, </span><span class="s1">NAN</span><span class="s2">)), </span><span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">complex</span><span class="s2">(</span><span class="s1">NAN</span><span class="s2">, -</span><span class="s1">INF</span><span class="s2">)), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">complex</span><span class="s2">(</span><span class="s1">NAN</span><span class="s2">, -</span><span class="s1">INF</span><span class="s2">)), </span><span class="s1">prec</span><span class="s2">=</span><span class="s1">prec</span><span class="s2">)</span>
                <span class="s6"># FIXME</span>
                <span class="s6">#self.ne(tp(complex(NAN, INF)), tp(complex(NAN, -INF)))</span>
                <span class="s6">#self.ne(tp(complex(NAN, 0)), tp(complex(NAN, 1)))</span>
                <span class="s6">#self.ne(tp(complex(INF, NAN)), tp(complex(-INF, NAN)))</span>
                <span class="s6">#self.ne(tp(complex(0, NAN)), tp(complex(1, NAN)))</span>
                <span class="s6">#self.ne(tp(complex(NAN, 0)), tp(complex(0, NAN)))</span>
            <span class="s6"># XXX should work with other precisions as well?</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">complex</span><span class="s2">(</span><span class="s1">INF</span><span class="s2">, </span><span class="s3">0</span><span class="s2">)), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">complex</span><span class="s2">(</span><span class="s1">INF</span><span class="s2">, </span><span class="s3">1</span><span class="s2">)), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'exact'</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_complex128_values_inexact</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">tp </span><span class="s0">in </span><span class="s2">[</span><span class="s1">complex</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">complex128</span><span class="s2">]:</span>
            <span class="s0">for </span><span class="s1">scale </span><span class="s0">in </span><span class="s2">[</span><span class="s3">1.0</span><span class="s2">, -</span><span class="s3">2</span><span class="s2">**</span><span class="s3">3</span><span class="s2">, </span><span class="s3">2</span><span class="s2">**-</span><span class="s3">4</span><span class="s2">, -</span><span class="s3">2</span><span class="s2">**-</span><span class="s3">20</span><span class="s2">]:</span>
                <span class="s1">a </span><span class="s2">= </span><span class="s1">scale </span><span class="s2">* </span><span class="s3">1.0</span>
                <span class="s1">b </span><span class="s2">= </span><span class="s1">scale </span><span class="s2">* (</span><span class="s3">1.0 </span><span class="s2">+ </span><span class="s1">DBL_EPSILON</span><span class="s2">)</span>
                <span class="s1">c </span><span class="s2">= </span><span class="s1">scale </span><span class="s2">* (</span><span class="s3">1.0 </span><span class="s2">+ </span><span class="s1">DBL_EPSILON </span><span class="s2">* </span><span class="s3">2</span><span class="s2">)</span>
                <span class="s1">aa </span><span class="s2">= </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">complex</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">a</span><span class="s2">))</span>
                <span class="s1">ab </span><span class="s2">= </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">complex</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">))</span>
                <span class="s1">bb </span><span class="s2">= </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">complex</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">b</span><span class="s2">))</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">aa</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">ab</span><span class="s2">))</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">aa</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">ab</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'double'</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">ab</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">bb</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'double'</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">aa</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">bb</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'double'</span><span class="s2">)</span>
                <span class="s1">ac </span><span class="s2">= </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">complex</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">c</span><span class="s2">))</span>
                <span class="s1">cc </span><span class="s2">= </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">complex</span><span class="s2">(</span><span class="s1">c</span><span class="s2">, </span><span class="s1">c</span><span class="s2">))</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">aa</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">ac</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'double'</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">ac</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">cc</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'double'</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">aa</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">ac</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'double'</span><span class="s2">, </span><span class="s1">ulps</span><span class="s2">=</span><span class="s3">2</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">ac</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">cc</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'double'</span><span class="s2">, </span><span class="s1">ulps</span><span class="s2">=</span><span class="s3">2</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">aa</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">cc</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'double'</span><span class="s2">, </span><span class="s1">ulps</span><span class="s2">=</span><span class="s3">2</span><span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">aa</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">cc</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'single'</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_complex64_values_inexact</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">tp </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">complex64</span>
        <span class="s0">for </span><span class="s1">scale </span><span class="s0">in </span><span class="s2">[</span><span class="s3">1.0</span><span class="s2">, -</span><span class="s3">2</span><span class="s2">**</span><span class="s3">3</span><span class="s2">, </span><span class="s3">2</span><span class="s2">**-</span><span class="s3">4</span><span class="s2">, -</span><span class="s3">2</span><span class="s2">**-</span><span class="s3">20</span><span class="s2">]:</span>
            <span class="s1">a </span><span class="s2">= </span><span class="s1">scale </span><span class="s2">* </span><span class="s3">1.0</span>
            <span class="s1">b </span><span class="s2">= </span><span class="s1">scale </span><span class="s2">* (</span><span class="s3">1.0 </span><span class="s2">+ </span><span class="s1">FLT_EPSILON</span><span class="s2">)</span>
            <span class="s1">c </span><span class="s2">= </span><span class="s1">scale </span><span class="s2">* (</span><span class="s3">1.0 </span><span class="s2">+ </span><span class="s1">FLT_EPSILON </span><span class="s2">* </span><span class="s3">2</span><span class="s2">)</span>
            <span class="s1">aa </span><span class="s2">= </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">complex</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">a</span><span class="s2">))</span>
            <span class="s1">ab </span><span class="s2">= </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">complex</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">))</span>
            <span class="s1">bb </span><span class="s2">= </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">complex</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">b</span><span class="s2">))</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">aa</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">ab</span><span class="s2">))</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">aa</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">ab</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'double'</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">aa</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">ab</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'single'</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">ab</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">bb</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'single'</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">aa</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">bb</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'single'</span><span class="s2">)</span>
            <span class="s1">ac </span><span class="s2">= </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">complex</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">c</span><span class="s2">))</span>
            <span class="s1">cc </span><span class="s2">= </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">complex</span><span class="s2">(</span><span class="s1">c</span><span class="s2">, </span><span class="s1">c</span><span class="s2">))</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">aa</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">ac</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'single'</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">ac</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">cc</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'single'</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">aa</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">ac</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'single'</span><span class="s2">, </span><span class="s1">ulps</span><span class="s2">=</span><span class="s3">2</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">ac</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">cc</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'single'</span><span class="s2">, </span><span class="s1">ulps</span><span class="s2">=</span><span class="s3">2</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">tp</span><span class="s2">(</span><span class="s1">aa</span><span class="s2">), </span><span class="s1">tp</span><span class="s2">(</span><span class="s1">cc</span><span class="s2">), </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'single'</span><span class="s2">, </span><span class="s1">ulps</span><span class="s2">=</span><span class="s3">2</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_enums</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">values </span><span class="s2">= [</span><span class="s1">Color</span><span class="s2">.</span><span class="s1">red</span><span class="s2">, </span><span class="s1">Color</span><span class="s2">.</span><span class="s1">green</span><span class="s2">, </span><span class="s1">Color</span><span class="s2">.</span><span class="s1">blue</span><span class="s2">, </span><span class="s1">Shake</span><span class="s2">.</span><span class="s1">mint</span><span class="s2">,</span>
                  <span class="s1">Shape</span><span class="s2">.</span><span class="s1">circle</span><span class="s2">, </span><span class="s1">Shape</span><span class="s2">.</span><span class="s1">square</span><span class="s2">, </span><span class="s1">Planet</span><span class="s2">.</span><span class="s1">EARTH</span><span class="s2">, </span><span class="s1">Planet</span><span class="s2">.</span><span class="s1">MERCURY</span><span class="s2">]</span>
        <span class="s0">for </span><span class="s1">val </span><span class="s0">in </span><span class="s1">values</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">val</span><span class="s2">, </span><span class="s1">val</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">val</span><span class="s2">, </span><span class="s1">val</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">a</span><span class="s2">, </span><span class="s1">b </span><span class="s0">in </span><span class="s1">itertools</span><span class="s2">.</span><span class="s1">combinations</span><span class="s2">(</span><span class="s1">values</span><span class="s2">, </span><span class="s3">2</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_arrays</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">7</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">((</span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">))</span>
        <span class="s1">b </span><span class="s2">= </span><span class="s1">a</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">)</span>
        <span class="s6"># Different values</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b </span><span class="s2">+ </span><span class="s3">1</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">[:-</span><span class="s3">1</span><span class="s2">])</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">.</span><span class="s1">T</span><span class="s2">)</span>
        <span class="s6"># Different dtypes</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">.</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">))</span>
        <span class="s6"># Different layout</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">.</span><span class="s1">T</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">().</span><span class="s1">T</span><span class="s2">)</span>
        <span class="s6"># Different ndim</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">.</span><span class="s1">flatten</span><span class="s2">())</span>
        <span class="s6"># Different writeability</span>
        <span class="s1">b</span><span class="s2">.</span><span class="s1">flags</span><span class="s2">.</span><span class="s1">writeable </span><span class="s2">= </span><span class="s0">False</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">)</span>
        <span class="s6"># Precision</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
        <span class="s1">b </span><span class="s2">= </span><span class="s1">a </span><span class="s2">* (</span><span class="s3">1.0 </span><span class="s2">+ </span><span class="s1">DBL_EPSILON</span><span class="s2">)</span>
        <span class="s1">c </span><span class="s2">= </span><span class="s1">a </span><span class="s2">* (</span><span class="s3">1.0 </span><span class="s2">+ </span><span class="s1">DBL_EPSILON </span><span class="s2">* </span><span class="s3">2</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'double'</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">c</span><span class="s2">, </span><span class="s1">prec</span><span class="s2">=</span><span class="s4">'double'</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_npdatetime</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s4">'1900'</span><span class="s2">, </span><span class="s4">'Y'</span><span class="s2">)</span>
        <span class="s1">b </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s4">'1900'</span><span class="s2">, </span><span class="s4">'Y'</span><span class="s2">)</span>
        <span class="s1">c </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s4">'1900-01-01'</span><span class="s2">, </span><span class="s4">'D'</span><span class="s2">)</span>
        <span class="s1">d </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s4">'1901'</span><span class="s2">, </span><span class="s4">'Y'</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">)</span>
        <span class="s6"># Different unit</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">c</span><span class="s2">)</span>
        <span class="s6"># Different value</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">d</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_nptimedelta</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">timedelta64</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s4">'h'</span><span class="s2">)</span>
        <span class="s1">b </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">timedelta64</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s4">'h'</span><span class="s2">)</span>
        <span class="s1">c </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">timedelta64</span><span class="s2">(</span><span class="s3">60</span><span class="s2">, </span><span class="s4">'m'</span><span class="s2">)</span>
        <span class="s1">d </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">timedelta64</span><span class="s2">(</span><span class="s3">2</span><span class="s2">, </span><span class="s4">'h'</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">)</span>
        <span class="s6"># Different unit</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">c</span><span class="s2">)</span>
        <span class="s6"># Different value</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">ne</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">d</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestMisc</span><span class="s2">(</span><span class="s1">TestCase</span><span class="s2">):</span>

    <span class="s0">def </span><span class="s1">test_assertRefCount</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6"># Use floats to avoid integer interning</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s3">55.</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s3">66.</span>
        <span class="s1">l </span><span class="s2">= []</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRefCount</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">):</span>
            <span class="s0">pass</span>
        <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">AssertionError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">cm</span><span class="s2">:</span>
            <span class="s6"># y gains a reference</span>
            <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRefCount</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">):</span>
                <span class="s1">l</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">y</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s4">&quot;66&quot;</span><span class="s2">, </span><span class="s1">str</span><span class="s2">(</span><span class="s1">cm</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_forbid_codegen</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5">&quot;&quot;&quot; 
        Test that forbid_codegen() prevents code generation using the @jit 
        decorator. 
        &quot;&quot;&quot;</span>
        <span class="s0">def </span><span class="s1">f</span><span class="s2">():</span>
            <span class="s0">return </span><span class="s3">1</span>
        <span class="s0">with </span><span class="s1">forbid_codegen</span><span class="s2">():</span>
            <span class="s0">with </span><span class="s1">self</span><span class="s2">.</span><span class="s1">assertRaises</span><span class="s2">(</span><span class="s1">RuntimeError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">raises</span><span class="s2">:</span>
                <span class="s1">cfunc </span><span class="s2">= </span><span class="s1">jit</span><span class="s2">(</span><span class="s1">nopython</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)(</span><span class="s1">f</span><span class="s2">)</span>
                <span class="s1">cfunc</span><span class="s2">()</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">assertIn</span><span class="s2">(</span><span class="s4">&quot;codegen forbidden by test case&quot;</span><span class="s2">, </span><span class="s1">str</span><span class="s2">(</span><span class="s1">raises</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">))</span>


<span class="s0">if </span><span class="s1">__name__ </span><span class="s2">== </span><span class="s4">'__main__'</span><span class="s2">:</span>
    <span class="s1">unittest</span><span class="s2">.</span><span class="s1">main</span><span class="s2">()</span>
</pre>
</body>
</html>